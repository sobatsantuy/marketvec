!function(e){var t={};function o(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=7)}([function(e,t,o){const n=o(9),i=n.HOST_NAME,r="true"===n.IS_LOGS_REQUIRED;let s,d=e.exports={isCheckoutClickForced:!1,isAddToCartClickForced:!1,isAddToCartClickForcedReset:!1,isPrerenderingDisabled:!1,log:function(e,t){r&&console.log(e,t||"")},upsellFunnelLog:function(e,t){r&&console.log("[34m%s[0m",e,t||"")},ppaLog:function(e,t){r&&console.log("[35m%s[0m",e,t||"")},setSetup:function(e){s=e},getSetup:function(){return s},getHostName:function(){return i},isSnippetTesting:function(){return false},sortByPriorityAndLatestOffer:function(e){return e.sort((function(e,t){return Number(t.priority||0)-Number(e.priority||0)||t.createdAt-e.createdAt}))},removeExistingWidget:function(e){let t=document.querySelector(e);t&&t.remove()},filterProducts:function(e,t){const o=!!t&&("product-page-addon-widget"===t.type&&t.isSoldOutProductsShown);return e.filter((e=>(e.available||o)&&d.isImgAvailable(e))).map((e=>(e.variants&&e.variants.length&&(e.variants=e.variants.filter((e=>e.available||o))),e)))},getTranslations:function(e,t,o,n,i){if(e.shopLocales&&e.shopLocales.length>1){d.log("Checking shoplocale");const r=d.getCurrentLocale(),s=e.shopLocales.find((e=>e.primary));s&&s.locale!==r&&(d.log("Replacing primaery locale"),t.translations&&t.translations[r]&&(i.content=t.translations[r]),o.translations&&o.translations[r]&&(o.translations[r].overrideWidgeTitle&&(n.overrideWidgeTitle=o.translations[r].overrideWidgeTitle),n.discounts&&n.discounts.description&&o.translations[r].description&&(n.discounts.description=o.translations[r].description)),d.log("formattedOffer",n))}return{offer:n,widget:i}},getBoughtProductsRandomSortOrder:function(e,t){if(t){let t=d.getRandomSortOrder(e.length);return d.ppaLog("Random Sort Order:",t),d.ppaLog("True Sort Order",e.map((e=>e.sortNo))),e.map(((e,o)=>(e.sortNo=t[o],e)))}return e},mapAvailableProducts:function(e,t,o,n,i,r){return e.map((s=>{let d=t.find((e=>e.id==s.productId));const l=d&&("tags"===o||"all"===o||"products"===o&&1!==e.length)&&(r?r.some((e=>e.id===d.id)):n&&n.id===d.id);return d&&s.limitVariants&&s.limitVariants.length&&s.limitVariants.length<=d.variants.length&&(d.variants=d.variants.filter((e=>s.limitVariants.some((t=>t.id==e.id))))),d&&i&&(d.discount=s.discount),!l&&d})).filter((e=>e&&e.variants&&e.variants.length))},removeExtraItems:function(e,t){return Number(t)>0&&e.length>t?(d.ppaLog("Removed extra items (maxItemsInOffer) in boughttogether",e),e.slice(0,t)):e},getOffer:function(e,t,o){if(d.log("--------Finding best offer------"),t&&d.isImgAvailable(t)){let n=[];if(e.offers&&e.offers.length){let i=JSON.parse(JSON.stringify(e.offers.filter((e=>!e.version||e.version>=2&&"product-page"===e.placementPage&&e.upsellType===o))));return i=d.sortByPriorityAndLatestOffer(i),i.forEach((e=>{if("products"===e.for.selectorType){e.for.products.some((e=>e.handle===decodeURI(t.handle)))&&n.push(e)}else if("tags"===e.for.selectorType&&t.tags&&t.tags.length){e.for.products.some((e=>t.tags.some((t=>(t||"").toLowerCase()===(e.name||"").toLowerCase()))))&&n.push(e)}else"all"===e.for.selectorType&&n.push(e)})),d.log("applicableOffers:",n),n.length?n[0]:void 0}}else d.log("For product image not found, so no offer will be rendered")},getCartForms:function(){let e=[],t=document.querySelectorAll("form");if(t)for(let o=0;o<t.length;o++)"post"===t[o].method&&"string"==typeof t[o].action&&(t[o].action.endsWith("/cart")||t[o].action.endsWith("/cart/")||t[o].action.indexOf("/cart?")>-1)&&e.push(t[o]);return e},getBtnCSS:function(e,t=!1){let o="",n="",i=["#fff","#ffffff","white","rgb(255, 255, 255)","rgba(255, 255, 255, 1)","rgba(0, 0, 0, 0)","transparent"];return["color","background","background-color","font-size","font-family","letter-spacing","font-weight","text-transform"].forEach((r=>{!t&&"background-color"===r&&i.includes(d.getStyle(e,r))?(o+="background-color: green;",o+="color: white;"):o+=`${r}:${d.getStyle(e,r)};`,"color"===r&&(n=`${d.getStyle(e,r)};`)})),o.length?{fetchedCSS:o,addToCartSpinnerStrokeColor:n}:void 0},setBtnCSS:function(e,t=!1){if(s&&s.version>=4){let o=d.getBtnCSS(e,t);if(o){let e=t?`.lb-tpae-confirm-button{\n${o.fetchedCSS}\n}\n.tpae-order-spinner circle{\nstroke: ${o.addToCartSpinnerStrokeColor}\n}`:`.lb-upsell-modal-product-primary{\n${o.fetchedCSS}\n}\n.lb-upsell-primary-spinner circle{\nstroke: ${o.addToCartSpinnerStrokeColor}\n}\n                .lb-addon-popup-continue-btn{\n${o.fetchedCSS}\n}.lb-addon-popup-continue-spinner circle{\nstroke: ${o.addToCartSpinnerStrokeColor}\n}`;d.appendCustomTextCssToHead(e,"lb-upsell-checkout-css")}}},addCartSubmitClickListener:function(e,t,o){let n=e.querySelectorAll("button[type='submit']");if(n)for(let t=0;t<n.length;t++)"checkout"===n[t].name&&"true"!==n[t].getAttribute("listener")&&(n[t].setAttribute("listener","true"),d.setBtnCSS(n[t]),n[t].addEventListener?n[t].addEventListener("click",(function(i){o(i,n[t],e,!0)}),!0):n[t].attachEvent("onclick",(function(i){o(i,n[t],e,!0)}),!0));let i=e.querySelectorAll("input[type='submit']");if(i)for(let t=0;t<i.length;t++)"checkout"===i[t].name&&"true"!==i[t].getAttribute("listener")&&(i[t].setAttribute("listener","true"),d.setBtnCSS(i[t]),i[t].addEventListener?i[t].addEventListener("click",(function(n){o(n,i[t],e,!0)}),!0):i[t].attachEvent("onclick",(function(n){o(n,i[t],e,!0)}),!0));if(0===n.length&&0===i.length){let n=e.querySelectorAll("button[name='checkout'],input[name='checkout']");if(n&&n.length)for(let t=0;t<n.length;t++)"true"!==n[t].getAttribute("listener")&&(n[t].setAttribute("listener","true"),d.setBtnCSS(n[t]),n[t].addEventListener?n[t].addEventListener("click",(function(i){o(i,n[t],e,!0)}),!0):n[t].attachEvent("onclick",(function(i){o(i,n[t],e,!0)}),!0));else{let n=document.querySelectorAll("button,input");for(let i=0;i<n.length;i++)"true"!==n[i].getAttribute("lb-upsell-listener")&&"checkout"===n[i].getAttribute("name")&&t.some((e=>e===n[i].getAttribute("form")))&&(n[i].setAttribute("lb-upsell-listener","true"),d.setBtnCSS(n[i]),n[i].addEventListener?n[i].addEventListener("click",(function(t){o(t,n[i],e,!0)}),!0):n[i].attachEvent("onclick",(function(t){o(t,n[i],e,!0)}),!0))}}d.log("Added cart submit listeners.")},getProduct:function(e){return new Promise(((t,o)=>{const n=d.getProductRequestURL(e);var i=new XMLHttpRequest;i.open("GET",n,!0),i.setRequestHeader("Content-Type","application/json; charset=UTF-8"),i.send(),i.onload=()=>{200===i.status?t(JSON.parse(i.responseText)):t(void 0)}}))},getProducts:function(e){return new Promise(((t,o)=>{let n=[];e.forEach((e=>{n.push(d.getProduct(e))})),Promise.all(n).then((e=>{e&&e.length&&(e=e.filter((e=>e))),t(e)}))}))},isImgAvailable:function(e){return e&&e.featured_image||e&&e.media&&e.media.length&&e.media[0].src},getCart:function(e){return new Promise(((t,o)=>{var n=new XMLHttpRequest;n.open("GET",`https://${e}/cart.js`,!0),n.setRequestHeader("Content-Type","application/json; charset=UTF-8"),n.setRequestHeader("Access-Control-Allow-Origin","*"),n.send(),n.onload=()=>{200===n.status?t(JSON.parse(n.responseText)):o("Error while getting cart")},n.onerror=()=>{o("Error while getting cart")}}))},getWidgetSetup:function(e,t){return e&&e.widgets&&e.widgets.length?e.widgets.find((e=>e.type===t)):void 0},removeExistingStyleTag:function(e){let t=document.getElementById(e);t&&(d.log("Removing existing style tag"),t.remove())},appendCustomTextCssToHead:function(e,t){t&&d.removeExistingStyleTag(t);let o=e,n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");n.appendChild(i),i.type="text/css",i.id=t,i.styleSheet?i.styleSheet.cssText=o:i.appendChild(document.createTextNode(o))},formatPrice:function(e,t){e/=100;let o=(Math.round(100*e)/100).toFixed(2);return t?Math.round(Number(o||"0")):o},getStyle:function(e,t){var o,n=(e.ownerDocument||document).defaultView;return n&&n.getComputedStyle?(t=t.replace(/([A-Z])/g,"-$1").toLowerCase(),n.getComputedStyle(e,null).getPropertyValue(t)):e.currentStyle?(t=t.replace(/\-(\w)/g,(function(e,t){return t.toUpperCase()})),o=e.currentStyle[t],/^\d+(em|pt|%|ex)?$/i.test(o)?function(t){var o=e.style.left,n=e.runtimeStyle.left;return e.runtimeStyle.left=e.currentStyle.left,e.style.left=t||0,t=e.style.pixelLeft+"px",e.style.left=o,e.runtimeStyle.left=n,t}(o):o):void 0},getRandomSortOrder:function(e){let t=[];for(;t.length<e;){let o=Math.floor(Math.random()*e)+1;-1===t.indexOf(o)&&t.push(o)}return t},getPresentmentCurrency:function(){return window.Shopify&&window.Shopify.currency?window.Shopify.currency:void 0},getRootRoute:function(){return window.Shopify&&window.Shopify.routes?window.Shopify.routes.root:void 0},getCurrentLocale:function(){return window.Shopify&&window.Shopify.locale?window.Shopify.locale:void 0},isDiscountStacked:function(){return!(!window.discountOnCartProApp||!window.discountOnCartProApp.applyCode)},applyStackDiscount:function(e){d.isDiscountStacked()&&(d.log("Applying stacked discount"),window.discountOnCartProApp.applyCode(e.code))},removeStackDiscount:function(e){window.discountOnCartProApp&&window.discountOnCartProApp.removeCode&&window.discountOnCartProApp.removeCode(e.code)},getProductRequestURL:function(e){let t=d.getRootRoute(),o=`https://${window.location.hostname}/products/${e}.js`;return t&&"/"!==t&&(o=`https://${window.location.hostname}${t}products/${e}.js`),o},addItemsToCart:function(e){return new Promise(((t,o)=>{let n=new XMLHttpRequest;n.open("POST",`https://${window.location.hostname}/cart/add.js`,!0),n.setRequestHeader("Content-Type","application/json; charset=UTF-8"),n.send(JSON.stringify(e)),n.onload=function(){200===n.status?t("success"):o(n.status)},n.onerror=e=>{d.log("Error while adding items to cart",e)}}))},updateCart:function(e){return new Promise(((t,o)=>{let n=new XMLHttpRequest;n.open("POST",`https://${window.location.hostname}/cart/update.js`,!0),n.setRequestHeader("Content-Type","application/json; charset=UTF-8"),n.send(JSON.stringify(e)),n.onload=function(){200===n.status?t("success"):o(n.statusText)},n.onerror=e=>{d.log("Error while updateCart cart",e)}}))},arrayUnique:function(e){let t=e.concat();for(let e=0;e<t.length;++e)for(let o=e+1;o<t.length;++o)t[e]===t[o]&&t.splice(o--,1);return t},triggerCustomEvent:function(e,t){window.dispatchEvent&&window.dispatchEvent(new CustomEvent(t||"lb-upsell-added",{detail:e}))},getURLParam:function(e,t){if("shop"===e&&t&&t.includes("/assets/lb-upsell.js"))return Shopify&&Shopify.shop?Shopify.shop:void 0;var o=new RegExp("[?&]"+e+"=([^&#]*)").exec(t);return null==o?null:decodeURI(o[1])||0},getCSSEnhancements:function(e){let t=".lb-upsell-prevent-scroll{overflow:hidden!important;}.lb-upsell-variants-select{padding-right:25px!important}.ppa-add-checkbox-input,.ppa-prod-checkbox-left,.ppa-prod-checkbox-left-grid{height:16px!important;width:16px!important}.ppcse-spinner{margin:0!important}.ppcse-close{font-weight:250!important;color:#5f5f5f!important}.ppcse-modal-prod-price{font-size:18px!important;margin:0 0 16px 0!important;padding:0!important}.ppcse-modal-prod-price b{font-weight:initial!important}.ppcse-modal-prod-title{margin:0 0 16px 0!important;padding:0!important;font-size:21px!important}.ppcse-modal-form-label,.stepper-label{font-weight:400!important;font-size:13px!important;margin-bottom:0!important}.lb-upsell-modal-form-label{margin-bottom:4px!important}select.ppcse-modal-form-control{width:100%!important}.ppcse-modal-cart-btn{margin-bottom:20px!important;line-height:normal!important;cursor:pointer!important}.ppcse-modal-prod-desc iframe,.ppcse-modal-prod-desc img{width:100%!important}.ppcse-modal-prod-img{padding-right:15px!important;padding-left:15px!important}.lb-upsell-modal-container,.lb-upsell-modal-wrap,.ppcse-modal-wrap{z-index:2147483647!important}.lb-upsell-modal-bg,.ppcse-modal-bg{z-index:2147483646!important}.ppcse-img-lt{margin-right:0!important;margin-bottom:0!important}.ppcse-tot-container{padding-right:0!important}.ppcse-m{overflow:hidden}.ppa-prod-img{height:100px!important;width:100px!important}.ppa-add-btn-cont-grid,.ppa-add-checkbox-cont-grid{margin-top:auto!important}.ppa-add-checkbox-cont-grid{padding-top:6px}.ppa-prod-container-grid-margin{margin-bottom:15px!important}.ppa-add-checkbox-spinner{margin:3px 0!important}.lb-upsell-ppa-spinner-list-checkbox-left{margin:3px 10px 3px 3px!important}.ppa-prod-container{min-height:100px!important}.lb-upsell-modal-product-secondary:focus,.lb-upsell-modal-product-secondary:hover{background-color:#efefef!important;color:#000!important}.stepper-container-minus{border-color:#bbb!important}.stepper-container-plus{border-color:#bbb!important}.stepper-container-input{border-left:0!important;border-right:0px!important;border-color:#bbb!important}.lb-upsell-modal-product-details-variants select{border-color:#bbb!important}.lb-upsell-modal-offer-name{padding:14px!important;font-weight:700!important}";return e>=8&&(d.log("Appendin css enhancements 2",s.version),t+=".ppcse-compare-at-price{display:inline!important}.lb-upsell-ppa-carousel{margin-right:5px!important}.lb-upsell-modal-product-details-title{font-size:large!important;padding-top:0!important}.lb-upsell-modal-offer-name{text-align:center!important}.lb-upsell-modal-timer-container{width:96%!important;border-radius:4px!important}.lb-upsell-modal-product-img{border:1px solid #f5f5f5!important}.lb-upsell-modal-product-details-variants select{width:100%!important}.ppcse-tot-container-tot{padding-top:0!important}@media only screen and (max-width:768px){.ppa-add-to-cart-btn,.ppcs-variants-form-select{width:100px!important}}"),t},isCartPage:function(){return-1!==window.location.pathname.indexOf("/cart")},getSampleSnippetSetup:function(){return{isEnabled:!0,isSubscribed:!0,shopCurrencyCode:"INR",version:13,shopCurrencyFormat:"Rs. ",shopEmailCurrencyFormat:"Rs. ",isAmountNoDecimals:!1,accountMetricId:"f6b96261-76f2-4498-a3ad-550d3510c839",widgets:[{content:{totalLabel:"Total price",addToCartSuccessMsg:"Added to your cart!",thisItemLabel:"",title:"Frequently Bought Together",buttonLabel:"Add to cart"},createdAt:1626088296638,myShopifyDomain:"lb-upsell-demo.myshopify.com",isEnabled:!1,styles:{mobile:{imageHeight:"75px",widgetMargin:"20px 0px 20px 0px "},desktop:{imageHeight:"100px",widgetMargin:"40px 0px 40px 0px "}},position:{mobile:{insertPosition:"afterend",selector:".product-form"},desktop:{insertPosition:"afterend",selector:".product-form"}},useShopifyProductRecommendations:!0,maxItemsInOffer:2,recordType:"widget#ppcse",widgetMetricId:"fd647d99-6991-4970-a2d6-cebf0890807a",type:"product-page-cross-sell-embedded-widget",addToCartAction:"redirect"},{content:{addToCartSuccessMsg:"Added to cart",removeBtnLabel:"Remove",title:"Select addons",addToCartBtnLabel:"Add to cart",addedToCartBtnLabel:"Added"},myShopifyDomain:"hp-dev-1.myshopify.com",isEnabled:!1,position:{mobile:{insertPosition:"beforebegin",selector:"addToCartBtn"},desktop:{insertPosition:"beforebegin",selector:"addToCartBtn"}},layoutStyle:"grid",addActionStyle:"checkbox",productClickActionStyle:"popup",useShopifyProductRecommendations:!0,recordType:"widget#ppa",type:"product-page-addon-widget",widgetMetricId:"e28a6f2f-547a-4201-b151-0643caf4e32a",addToCartAction:"trigger"},{content:{totalLabel:"Total",countDownTimerText:"Limited time offer! Expires in {{timer}}",continueBtnLabel:"Continue",countDownTimerMins:5,countDownTimerSecs:0,addToCartBtnLabel:"Add",widgetDiscountLabel:"Limited time offer! Expires in {{timer}}",widgetTitle:"You might also like these"},createdAt:1659774736998,myShopifyDomain:"hp-dev-2.myshopify.com",isMultipleVariantsAdded:!0,isEnabled:!0,recordType:"widget#cppa",widgetMetricId:"18e31faf-0a17-4e57-aa4f-f5fbd587401f",type:"popup-cart-addons-widget"}]}}}},function(e,t,o){const n=o(0);let i=e.exports={getDiscountCode:function(e,t,o,i,r,s){return new Promise(((d,l)=>{let a=new XMLHttpRequest;"free_shipping"===o.type?(a.open("POST",`${n.getHostName()}/discounts/createShippingDiscountCode`,!0),a.setRequestHeader("Content-Type","application/json; charset=UTF-8"),a.setRequestHeader("Access-Control-Allow-Origin","*"),a.send(JSON.stringify({myShopifyDomain:e,discounts:o,minimumPurchaseValue:i,widgetType:s}))):(a.open("POST",`${n.getHostName()}/discounts/createDiscountCode`,!0),a.setRequestHeader("Content-Type","application/json; charset=UTF-8"),a.setRequestHeader("Access-Control-Allow-Origin","*"),a.send(JSON.stringify({myShopifyDomain:e,products:t,discounts:o,minimumPurchaseValue:i,cheapestProduct:r,widgetType:s}))),a.onload=()=>{n.log("discCodeReq.responseText",a.responseText),200===a.status?d(JSON.parse(a.responseText)):l("Error while createDiscountCode")},a.onerror=()=>{l("Error while createDiscountCode")}}))},deleteDiscountCode:function(e,t,o){return new Promise(((i,r)=>{let s=new XMLHttpRequest;o?(s.open("POST",`${n.getHostName()}/discounts/deleteShippingDiscountCode`,!0),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.setRequestHeader("Access-Control-Allow-Origin","*"),s.send(JSON.stringify({myShopifyDomain:e,discountCodeId:o}))):(s.open("POST",`${n.getHostName()}/discounts/deleteDiscountCode`,!0),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.setRequestHeader("Access-Control-Allow-Origin","*"),s.send(JSON.stringify({myShopifyDomain:e,priceRuleId:t}))),s.timeout=3e3,s.onload=()=>{n.log("deleteDiscountCode responseText",s.responseText),200===s.status||console.log("Error while deleteDiscountCode",s.status),i(s.status)},s.onerror=()=>{console.log("Error while deleteDiscountCode",s.status),i(s.status)},s.ontimeout=()=>{console.log("deleteDiscountCode timeout",s.status),i(s.status)}}))},isDiscountShown:function(e,t){let o=i.getDiscountFromStorage(),n=o?i.isDiscountValid(t,o):void 0;return!o||o&&o.forProductId===e||!n},isWidgetDiscountValid:function(e,t){let o=i.getDiscountFromStorage();return o&&o.code&&o.code.includes(t)&&i.isDiscountValid(e,o)},isDiscountValid:function(e,t){let o=!0,i=(new Date).getTime();if(e&&e.item_count&&t&&t.products&&t.products.length&&i<t.endsAt){if(t.products.forEach((t=>{e.items.some((e=>`${e.id}`==`${t.selectedVariantId}`))||(o=!1)})),o&&t&&t.forProductVariants&&t.forProductVariants.length&&(o=t.forProductVariants.some((t=>e.items.some((e=>`${e.id}`==`${t}`))))),o&&t&&t.leastPricedTriggerItem){const i=e.items.filter((e=>`${e.product_id}`==`${t.leastPricedTriggerItem.product_id}`));if(i&&i.length){let e=t.products.find((e=>`${e.id}`==`${i[0].product_id}`));e&&(n.log("triggerItemInOfferedProduct check",i[0].quantity>e.quantity),o=i.length>1||i[0].quantity>e.quantity)}else n.log("For product is not in cart, so discount is not valid,"),o=!1}o&&t&&t.minimumCartAmount&&Number(t.minimumCartAmount)>0&&Number(t.minimumCartAmount)>Number(e.items_subtotal_price/100)&&(n.log("cart subtotal is less than minimumCartAmount, so discount is not valid",t.minimumCartAmount),o=!1)}else o=!1;return o},saveDiscountToStorage:function(e,t,o,r,s,d){const l={products:t,code:o.code,priceRuleId:o.priceRuleId,discountCodeId:o.discountCodeId,endsAt:o.endsAt,forProductId:e,forProductVariants:r,leastPricedTriggerItem:s,minimumCartAmount:d};localStorage.setItem("lb-upsell-offer-discount",JSON.stringify(l)),i.saveStackDiscountToStorage(l),n.applyStackDiscount(l)},getDiscountFromStorage:function(){let e=localStorage.getItem("lb-upsell-offer-discount");return e?JSON.parse(e):void 0},saveStackDiscountToStorage:function(e){if(n.isDiscountStacked()){let t=i.getStackDiscountFromStorage();t.push(e),localStorage.setItem("lb-upsell-offer-discount-stack",JSON.stringify(t))}},getStackDiscountFromStorage:function(){const e=localStorage.getItem("lb-upsell-offer-discount-stack");return e?JSON.parse(e):[]},getStackDiscountValidationData:function(e){if(n.isDiscountStacked()){const t=i.getStackDiscountFromStorage();let o=[],r=[];return t&&t.length&&t.forEach((t=>{i.isDiscountValid(e,t)?o.push(t):r.push(t)})),n.log("validDiscountCodes",o),n.log("invalidDiscountCodes:",r),{validDiscountCodes:o,invalidDiscountCodes:r}}},validateStackDiscount:function(e,t){if(n.isDiscountStacked()){const o=i.getStackDiscountValidationData(t),r=i.getDiscountFromStorage();o&&o.invalidDiscountCodes&&o.invalidDiscountCodes.length&&(o.invalidDiscountCodes.forEach((t=>{n.removeStackDiscount(t),i.deleteDiscountCode(e.myShopifyDomain,t.priceRuleId,t.discountCodeId),r&&t.code===r.code&&(n.log("Deleting discount from storage",t.code),localStorage.removeItem("lb-upsell-offer-discount"))})),localStorage.setItem("lb-upsell-offer-discount-stack",JSON.stringify(o.validDiscountCodes)))}},process:function(e,t){const o=n.getWidgetSetup(e,"product-page-cross-sell-embedded-widget"),r=n.getWidgetSetup(e,"product-page-addon-widget");let s=i.getDiscountFromStorage();if((o&&o.isEnabled||r&&r.isEnabled)&&s){let e=s.code&&s.code.startsWith("ADD")?r.content.cartDiscountMsg:o.content.cartDiscountMsg,d=i.isDiscountValid(t,s),l=n.getCartForms();l.map((e=>e.getAttribute("id")));!function(e,t){if(e&&t){let t=n.getSetup();t&&t.customDiscountHelpSelector&&e?setTimeout((()=>{let o=document.querySelector(t.customDiscountHelpSelector);if(o){let n=document.querySelector(".lb-upsell-discount-help");n&&n.remove();let i=document.createElement("div");i.innerHTML=e,i.className="lb-upsell-discount-help",o.insertAdjacentElement(t.customDiscountHelpPosition,i)}}),500):setTimeout((()=>{let t=document.querySelector("ppcse-floting-toast");t&&(t.message=e,t.showFloatingToast())}),1e3)}}(e,d),i.addDiscountCodeToAllCartForms(d,l,s)}else n.log("Discounts wont be processed. ppcseWidget is not enabled / no discount in storage")},addDiscountCodeToAllCartForms:function(e,t,o){e&&t&&t.length&&t.forEach((e=>{n.log("Discount is valid, adding to cart form at page load");let t=`<input type="hidden" name="discount" value="${o.code}" > </input>`;e.insertAdjacentHTML("beforeend",t)}))},removeDicountCodeFromAllCartForms:function(e){let t=document.querySelectorAll(`input[value="${e}"]`);t&&t.length&&t.forEach((e=>{n.log("Rmeoving discount elements"),e.remove()}))}}},function(e,t,o){const n=o(0);let i=e.exports={getOfferHistory:function(){let e=sessionStorage.getItem("lb-upsell-offer-history");return e?JSON.parse(e):void 0},pushEvent:function(e,t,o,r,s,d,l,a,c){if(n.isSnippetTesting())console.log("Metrics wont be pushed in snippet tesing mode.");else{let u={eventType:e,eventData:{isShopifyRecosOffer:l,account:{metricId:s.accountMetricId,id:s.myShopifyDomain},offer:{id:l?void 0:r.recordType,metricId:l?void 0:r.offerMetricId,widget:{id:d.recordType,metricId:d.widgetMetricId,isMultipleVariantsAdded:"widget#tpae"===d.recordType?!1!==d.isMultipleVariantsAdded:d.isMultipleVariantsAdded},details:{offerUniqueId:l?`shopify#${o}`:`shopify#${d.recordType}-${o}`,offeredProducts:t,leastPricedTriggerItem:a,addedVariants:d.isMultipleVariantsAdded&&c}}}};if(n.log("event:",u),"offer-viewed"===u.eventType){let e=sessionStorage.getItem("lb-upsell-offer-viewed");e=e?JSON.parse(e):{},e[u.eventData.offer.details.offerUniqueId]?n.log("Event offer-viewed already pushed"):(n.log("Pushing offer-viewed event"),e[u.eventData.offer.details.offerUniqueId]={offerId:l?`shopify#${o}`:u.eventData.offer.id},sessionStorage.setItem("lb-upsell-offer-viewed",JSON.stringify(e)),s.isViewMetricNotTracked?n.log("View tracking is disabled"):i.apiRequest("/metrics",u))}else if("offer-clicked"===u.eventType){let e=localStorage.getItem("lb-upsell-offer-clicked");e=e?JSON.parse(e):{};let t=u.eventData.offer.details.offeredProducts;if(e[u.eventData.offer.details.offerUniqueId])n.log("Event offer-clicked already pushed");else{n.log("Pushing offer-clicked event"),e[u.eventData.offer.details.offerUniqueId]={products:t,addedVariants:u.eventData.offer.details.addedVariants,leastPricedTriggerItem:u.eventData.offer.details.leastPricedTriggerItem,offerSettings:l?void 0:{id:u.eventData.offer.id,metricId:u.eventData.offer.metricId},widgetSettings:{id:u.eventData.offer.widget.id,metricId:u.eventData.offer.widget.metricId,isMultipleVariantsAdded:u.eventData.offer.widget.isMultipleVariantsAdded},isShopifyRecosOffer:l},i.apiRequest("/metrics",u),localStorage.setItem("lb-upsell-offer-clicked",JSON.stringify(e));let o={id:u.eventData.account.id,metricId:u.eventData.account.metricId,shopCurrencyCode:s&&s.shopCurrencyCode,shopifyCurrency:n.getPresentmentCurrency()};localStorage.setItem("lb-upsell-account-settings",JSON.stringify(o))}}}},apiRequest:function(e,t){let o=new XMLHttpRequest;o.open("POST",`${n.getHostName()}${e}`,!0),o.setRequestHeader("Content-Type","application/json; charset=UTF-8"),o.send(JSON.stringify(t)),o.onload=function(){200===o.status&&n.log("Successfully processed event.")},o.onerror=function(){n.log("Error while processing metrics.")}},getFormattedOfferClicks:function(e){let t={};return Object.keys(e).forEach((o=>{if(e[o].offerSettings||e[o].isShopifyRecosOffer){let i=e[o].isShopifyRecosOffer?e[o].widgetSettings.id:e[o].offerSettings.id;t[i]?e[o].products&&t[i].products&&(t[i].products=n.arrayUnique(t[i].products.concat(e[o].products))):t[i]=e[o]}})),t},isConversionValid:function(e,t){return!t||(e.product_id!==t.product_id||(n.log("is 1+1 offer valid",e.quantity>t.quantity),e.quantity>t.quantity))},trackConversion:function(){let e=Shopify.checkout||{};n.log("checkout:",e);let t=localStorage.getItem("lb-upsell-offer-clicked");if(t=t?JSON.parse(t):void 0,e&&e.line_items&&e.line_items.length&&t&&Object.keys(t)&&Object.keys(t).length){let o=i.getFormattedOfferClicks(t),r=[];if(Object.keys(o).forEach((t=>{if(o[t].products&&o[t].products.length){let n=[],s=[],d=o[t];d.addedVariants&&d.addedVariants.length?d.addedVariants.forEach((n=>{let r=e.line_items.find((e=>`${e.variant_id}`==`${n.id}`));r&&i.isConversionValid(r,o[t].leastPricedTriggerItem)&&s.push(r)})):d.products.forEach((r=>{let s=e.line_items.find((e=>e.product_id===r));s&&i.isConversionValid(s,o[t].leastPricedTriggerItem)&&n.push(s)})),(n.length||s.length)&&r.push({id:d.isShopifyRecosOffer?void 0:d.offerSettings.id,metricId:d.isShopifyRecosOffer?void 0:d.offerSettings.metricId,widget:{id:d.widgetSettings.id,metricId:d.widgetSettings.metricId},details:{offeredProducts:d.products,converetedProducts:n,convertedVariants:s},isShopifyRecosOffer:d.isShopifyRecosOffer})}})),r&&r.length){let t=localStorage.getItem("lb-upsell-account-settings");t=t?JSON.parse(t):void 0;let o,s=localStorage.getItem("lb-upsell-offer-discount");s=s?JSON.parse(s):void 0,s&&s.code&&e.discount&&e.discount.applicable&&e.discount.code===s.code&&(o={code:s.code,priceRuleId:s.priceRuleId,discountCodeId:s.discountCodeId},localStorage.removeItem("lb-upsell-offer-discount"));let d={eventType:"offers-converted",eventData:{account:t,offers:r,order:{id:e.order_id,discount:e.discount},dicountToDelete:o}};n.log("event:",d),i.apiRequest("/metrics",d),localStorage.removeItem("lb-upsell-offer-clicked")}}}}},function(e,t,o){const n=o(0),i=o(1);let r=e.exports={isProductPage:function(){return-1!==window.location.pathname.indexOf("/products/")},getProductHandle:function(){const e=window.location.pathname.split("/");return e&&e.length&&e[e.length-1]},getProducts:function(e,t){return new Promise(((o,i)=>{let r=[n.getProduct(e)];t.boughtTogether.offeredProducts.products.forEach((e=>{r.push(n.getProduct(e.handle))})),Promise.all(r).then((e=>{e&&e.length&&(e=e.filter((e=>e))),o(e)}))}))},filterProducts:function(e,t){const o=!!t&&("product-page-addon-widget"===t.type&&t.isSoldOutProductsShown);return e.filter((e=>(e.available||o)&&n.isImgAvailable(e))).map((e=>(e.variants&&e.variants.length&&(e.variants=e.variants.filter((e=>e.available||o))),e)))},isAutoAddToCartValid:function(e){let t=n.getWidgetSetup(n.getSetup(),"product-page-cross-sell-embedded-widget");return"autoAddToCart"===t.addToCartAction&&(e.variants&&1===e.variants.length||!e.variants)&&document.querySelector(t.addToCartSelector)},getProductCartAddForms:function(){let e=[],t=document.querySelectorAll("form");if(t)for(let o=0;o<t.length;o++)if("post"===t[o].method&&"string"==typeof t[o].action&&(t[o].action.endsWith("/cart/add")||t[o].action.endsWith("/cart/add/")||t[o].action.indexOf("/cart/add?")>-1)){let n=t[o].querySelectorAll("button,input");for(let i=0;i<n.length;i++)if("add"===n[i].name||"submit"===n[i].type){e.push(t[o]);break}}return e&&e.length?e:void 0},getAddToCartBtnCSS:function(e){let t="",o="",i=["border-color","background-color","color","background","font-size","font-family","letter-spacing","font-weight","border","box-shadow","text-transform","border-width","border-radius","border-style"],s=r.getProductCartAddForms(),d=n.getSetup();if(s&&s.length){let e=s[0].querySelectorAll("button,input");for(let r=0;r<e.length;r++)if("add"===e[r].name||"submit"===e[r].type){let s,l;i.forEach((i=>{let a=n.getStyle(e[r],i);"background-color"===i&&(s=a),"border-color"===i&&(l=a),d&&d.version>=4&&"color"===i&&["rgba(0, 0, 0, 0)","rgb(255, 255, 255)","white"].includes(a)&&["rgba(0, 0, 0, 0)","rgb(255, 255, 255)","white"].includes(s)&&(a=l),t+=`${i}:${a};`,"color"===i&&(o=`${a};`)}));break}}return t.length?`${e}{\n${t}\n}\n.lb-upsell-tot-btn{\n${t}}\n.ppcse-spinner circle{\nstroke: ${o};\n}`:void 0},getFormattedWidgetInput:function(e,t,o,s,d){return new Promise(((l,a)=>{const c=n.getSetup();let u;u="product-page-addon-widget"===e.type?!i.isWidgetDiscountValid(d,"FUNDLL")&&!i.isWidgetDiscountValid(d,"BUNDLL")&&i.isDiscountShown(s,d,"ADDDLL"):!i.isWidgetDiscountValid(d,"FUNDLL")&&!i.isWidgetDiscountValid(d,"ADDDLL")&&i.isDiscountShown(s,d,"BUNDLL"),n.isDiscountStacked()&&(u=!0);let p={boughtTogether:[],discounts:u&&t.discounts&&t.discounts.isEnabled&&t.discounts,overrideWidgeTitle:t.overrideWidgeTitle},g={styles:e.styles,content:e.content,isQuantityPickerEnabled:e.isQuantityPickerEnabled,imageResolution:e.imageResolution,metadata:{shopCurrencyFormat:c&&c.shopEmailCurrencyFormat?c.shopEmailCurrencyFormat:c.shopCurrencyFormat,isAmountNoDecimals:c&&c.isAmountNoDecimals,shopMoneyInEmailsFormat:c&&c.shopMoneyInEmailsFormat,shopCurrencyCode:c&&c.shopCurrencyCode,presentmentCurrency:void 0,isUnitPriceShown:c&&c.isUnitPriceShown,setupVersion:c.version,variantsGroupSeperator:c.variantsGroupSeperator}},f=n.getTranslations(c,e,t,p,g);p=f.offer,g=f.widget,r.getProducts(o,t).then((i=>{n.ppaLog("--------Processing best offer --------"),n.ppaLog("Reference products fetch successfull",i),i=i&&i.length?i:[];let s=n.filterProducts(i,e);n.ppaLog("Filtered Products based on product/variant availablity & image:",s);let d=s.find((e=>(e.handle||"").toLowerCase()===(decodeURI(o)||"").toLowerCase()));d=JSON.parse(JSON.stringify(d)),d.isForProduct=!0;let a=JSON.parse(JSON.stringify(t.boughtTogether.offeredProducts.products));a=n.getBoughtProductsRandomSortOrder(a,t.isSortedRandomly),a.sort(((e,t)=>e.sortNo-t.sortNo)),a=n.mapAvailableProducts(a,s,t.for.selectorType,d,void 0,void 0),a=n.removeExtraItems(a,e.maxItemsInOffer),p.boughtTogether=a,g.metadata.presentmentCurrency=n.getPresentmentCurrency(),"product-page-addon-widget"===e.type?(g.addToCartAction=e.addToCartAction,g.layoutStyle=e.layoutStyle||"list",g.addActionStyle=e.addActionStyle||"button",g.productClickActionStyle=e.productClickActionStyle||"popup","trigger"===g.addToCartAction&&0===t.minSelectable&&1===t.maxSelectable&&(g.addActionStyle="checkbox-left"===g.addActionStyle?"radio-left":"radio")):g.addToCartAction=r.isAutoAddToCartValid(d,e)&&e.addToCartAction,"product-page-cross-sell-embedded-widget"===e.type&&(g.productClickActionStyle=e.productClickActionStyle||"popup",g.isProductDetailsCollpased=e.isProductDetailsCollpased,g.isImagesNotFiltered=e.isImagesNotFiltered),l({widget:g,offer:{for:d,boughtTogether:p.boughtTogether,discounts:p.discounts,overrideWidgeTitle:p.overrideWidgeTitle}})})).catch((e=>{n.ppaLog("Error while getProducts",e),a(e)}))}))},getShopifyProductRecomendation:function(e,t){return new Promise(((o,i)=>{let r;var s=new XMLHttpRequest;let d=n.getRootRoute();r=d&&"/"!==d?`https://${window.location.hostname}${d}recommendations/products.json?product_id=${e}&limit=${t}`:`https://${window.location.hostname}/recommendations/products.json?product_id=${e}&limit=${t}`,s.open("GET",r,!0),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.setRequestHeader("Access-Control-Allow-Origin","*"),s.send(),s.onload=()=>{200===s.status&&o(JSON.parse(s.responseText))},s.onerror=()=>{i("Error while getting product recommendations"+e)}}))},showShopifyProductRecommendations:function(e,t,o){return new Promise(((s,d)=>{let l=n.getSetup();if(n.log("Fetching productRecommendations"),e&&n.isImgAvailable(e)){let d=Number(t.maxItemsInOffer)>0?t.maxItemsInOffer:2;r.getShopifyProductRecomendation(e.id,d).then((d=>{if(n.log("ProductRecommendations result:",d),d&&d.products&&d.products.length){let a=n.filterProducts([e],t)[0],c=n.filterProducts(d.products,t);if(a&&c.length){let e={for:a,boughtTogether:c,discounts:void 0},d={styles:t.styles,content:t.content,metadata:{shopCurrencyFormat:l&&l.shopEmailCurrencyFormat?l.shopEmailCurrencyFormat:l.shopCurrencyFormat,isAmountNoDecimals:l&&l.isAmountNoDecimals,shopMoneyInEmailsFormat:l&&l.shopMoneyInEmailsFormat,shopCurrencyCode:l&&l.shopCurrencyCode,presentmentCurrency:n.getPresentmentCurrency(),isUnitPriceShown:l&&l.isUnitPriceShown,setupVersion:l.version,variantsGroupSeperator:l.variantsGroupSeperator}};if(l.shopLocales&&l.shopLocales.length>1){n.log("Checking shoplocale");const e=n.getCurrentLocale(),o=l.shopLocales.find((e=>e.primary));o&&o.locale!==e&&t.translations&&t.translations[e]&&(n.log("Replacing primaery locale"),d.content=t.translations[e])}let u,p=e.for;p=JSON.parse(JSON.stringify(p)),p.isForProduct=!0,"product-page-addon-widget"===t.type?(d.addToCartAction=t.addToCartAction,d.layoutStyle=t.layoutStyle||"list",d.addActionStyle=t.addActionStyle||"button",d.productClickActionStyle=t.productClickActionStyle||"popup",u=!i.isWidgetDiscountValid(o,"FUNDLL")&&!i.isWidgetDiscountValid(o,"BUNDLL")&&i.isDiscountShown(p.id,o,"ADDDLL")):(d.addToCartAction=r.isAutoAddToCartValid(p,t)&&t.addToCartAction,d.productClickActionStyle=t.productClickActionStyle||"popup",d.isProductDetailsCollpased=t.isProductDetailsCollpased,d.isImagesNotFiltered=t.isImagesNotFiltered,u=!i.isWidgetDiscountValid(o,"FUNDLL")&&!i.isWidgetDiscountValid(o,"ADDDLL")&&i.isDiscountShown(p.id,o,"BUNDLL")),n.isDiscountStacked()&&(u=!0),u&&"product-page-cross-sell-embedded-widget"===t.type&&t.useShopifyProductRecommendations&&t.recommendationDiscount&&t.recommendationDiscount.isEnabled&&(e.discounts={...t.recommendationDiscount,isAutoRecommendationDiscount:!0}),s({offer:{for:p,boughtTogether:e.boughtTogether,discounts:e.discounts},widget:d})}}}))}else n.log("For product image not found, so no offer will be rendered")}))}}},function(e,t,o){const n=o(0),i=o(1),r=(o(5),o(3));let s,d=e.exports={getCartItems:function(){return s},isThankyouPage:function(){return-1!==window.location.pathname.indexOf("/orders/")||-1!==window.location.pathname.indexOf("/thank_you")&&-1!==window.location.pathname.indexOf("/checkouts/")},proceedToCheckout:function(e,t,o,r,s,d,l){n.upsellFunnelLog("Proceeding to cart"),t&&n.isDiscountStacked()&&window.lbUpsellComponents&&void 0===window.lbUpsellComponents.handleUpsellFunnelCheckout&&(n.log("Defining handleUpsellFunnelCheckout for stack discounts"),window.lbUpsellComponents.handleUpsellFunnelCheckout=function(e){return new Promise(((t,o)=>{n.log("handleUpsellFunnelCheckout called",e),setTimeout((()=>{t("proceed")}),2e3)}))});let a,c=n.getSetup(),u=n.getWidgetSetup(c,"popup-upsell-funnel-widget"),p=n.getWidgetSetup(c,"popup-cart-addons-widget"),g=!1;if(window.lbUpsellComponents&&window.lbUpsellComponents.isAnchorTagUsedForCheckout||o&&o.tagName&&"a"===o.tagName.toLowerCase()&&"/checkout"===o.getAttribute("href")){n.upsellFunnelLog("Anchor tag checkout is used"),g=!0;let e=i.getDiscountFromStorage();d&&e&&!t&&(t=e,n.upsellFunnelLog("Replacing anchor tag discount code",t))}window.lbUpsellComponents&&window.lbUpsellComponents.handleUpsellFunnelCheckout?(n.log("handleUpsellFunnelCheckout will be called"),a=window.lbUpsellComponents.handleUpsellFunnelCheckout({acceptedProducts:e,discount:t,isPPCSEOrPPADiscValid:d})):(n.log("proceeding to checkout without checkoutPromise"),a=Promise.resolve()),a.then((i=>{if(n.log("result",i),r)n.upsellFunnelLog("Rendered by external app, triggering custom event"),n.triggerCustomEvent({acceptedProducts:e,discount:t},"selleasy-checkout-popup-completed");else if(("popup-upsell-funnel-widget"===s&&u&&u.isWindowRedirectUsedForCheckout||"popup-cart-addons-widget"===s&&p&&p.isWindowRedirectUsedForCheckout)&&e&&e.length&&l&&l.items&&e.some((e=>l.items.some((t=>`${t.product_id}`==`${e.id}`))))||g){n.upsellFunnelLog("Using window redirection for 1+1 offers");let e=n.getRootRoute();window.location.href=e&&"/"!==e?`${e}cart/checkout${t?`?discount=${t.code}`:""}`:"/cart/checkout"+(t?`?discount=${t.code}`:"")}else n.isCheckoutClickForced=!0,o.disabled=!1,o.click();setTimeout((()=>{const e=document.querySelector("#lb-upsell-modal-bg-id");e&&(e.style.display="none");const t=document.querySelector(".lb-upsell-modal-container");t&&(t.style.display="none");const o=document.querySelector("#lb-addon-popup-bg-id");o&&(o.style.display="block");const n=document.querySelector("#lb-addon-popup-container-id");n&&(n.style.display="block"),document.body.classList.remove("lb-upsell-prevent-scroll")}),5e3)}))},getFormattedWidgetInput:function(e,t,o,i){return new Promise(((r,d)=>{const l=n.getSetup();let a={boughtTogether:[],discounts:"popup-cart-addons"===t.upsellType&&o?t.discounts:t.tpaeDiscounts,overrideWidgeTitle:t.overrideWidgeTitle},c={styles:e.styles,content:e.content,isQuantityPickerEnabled:e.isQuantityPickerEnabled||!0,imageResolution:e.imageResolution,isMultipleVariantsAdded:"tq-page-addon-embedded-widget"===e.type?!1!==e.isMultipleVariantsAdded:e.isMultipleVariantsAdded,metadata:{shopCurrencyFormat:l&&l.shopEmailCurrencyFormat?l.shopEmailCurrencyFormat:l.shopCurrencyFormat,isAmountNoDecimals:l&&l.isAmountNoDecimals,shopMoneyInEmailsFormat:l&&l.shopMoneyInEmailsFormat,shopCurrencyCode:l&&l.shopCurrencyCode,presentmentCurrency:void 0,isUnitPriceShown:l&&l.isUnitPriceShown,setupVersion:l.version,variantsGroupSeperator:l.variantsGroupSeperator}},u=n.getTranslations(l,e,t,a,c);a=u.offer,c=u.widget;let p=[];if(t.boughtTogether.offeredProducts.products&&t.boughtTogether.offeredProducts.products.length&&t.boughtTogether.offeredProducts.products.forEach((e=>{p.push(e.handle)})),"popup-cart-addons"===t.upsellType&&a.discounts&&Number(a.discounts.minimumCartAmount)>0){const e=n.getPresentmentCurrency();let t=100*Number(a.discounts.minimumCartAmount)*Number(e&&e.rate||1);t>i.total_price&&(n.ppaLog(`Discounts will not be shown due to minimumCartAmount cond. minimumCartAmount - ${t}, cart total - ${i.total_price}`),a.discounts=void 0)}n.getProducts(p).then((o=>{n.ppaLog("--------Processing best offer --------"),n.ppaLog("Reference products fetch successfull",o),o=o&&o.length?o:[];let i=n.filterProducts(o,e);n.ppaLog("Filtered Products based on product/variant availablity & image:",i);let d=JSON.parse(JSON.stringify(t.boughtTogether.offeredProducts.products));d=n.getBoughtProductsRandomSortOrder(d,t.isSortedRandomly),d.sort(((e,t)=>e.sortNo-t.sortNo));const l=t.tpaeDiscounts&&t.tpaeDiscounts.isEnabled&&"byProducts"===t.tpaeDiscounts.discountType&&e.type;d=n.mapAvailableProducts(d,i,t.for.selectorType,void 0,l,s),d=n.removeExtraItems(d,e.maxItemsInOffer),a.boughtTogether=d,c.metadata.presentmentCurrency=n.getPresentmentCurrency(),c.addToCartAction=e.addToCartAction,c.layoutStyle=e.layoutStyle||"singleProductSlider",c.addActionStyle=e.addActionStyle||"button",c.productClickActionStyle=e.productClickActionStyle||"popup",r({widget:c,offer:{for:t.for,boughtTogether:a.boughtTogether,overrideWidgeTitle:a.overrideWidgeTitle,discounts:a.discounts}})})).catch((e=>{n.ppaLog("Error while getProducts",e),d(e)}))}))},getApplicableOffer:function(e,t,o){return new Promise(((i,r)=>{let d=e.offers&&e.offers.length?JSON.parse(JSON.stringify(e.offers.filter((e=>o.some((t=>t===e.upsellType)))))):[],l=[];if(d&&d.length&&t&&t.items){let e=[],a=[];t.items.forEach((t=>{a.push({productId:t.product_id,variantId:t.variant_id}),e.push(t.handle)})),(o.includes("tq-page-upsell")?Promise.resolve(t.items):n.getProducts(e)).then((e=>{s=e&&JSON.parse(JSON.stringify(e)),e.forEach((t=>{let o=d.filter((o=>{let n=o.for.triggerConditions||[];return!(n.length>0&&n.some((t=>"productExclusion"===t.type&&t.products&&t.products.length&&t.products.some((t=>e.some((e=>t.productId===`${e.id}`)))))))&&(!l.some((e=>e.recordType===o.recordType))&&("products"===o.for.selectorType?o.for.products.some((e=>o.for.isVariantsSelection&&e.limitVariants?e.productId===`${t.id}`&&e.limitVariants.some((e=>e.id===`${a.filter((e=>e.productId===t.id))[0].variantId}`)):e.productId===`${t.id}`)):"tags"===o.for.selectorType&&t.tags&&t.tags.length?o.for.products.some((e=>t.tags.some((t=>(t||"").toLowerCase()===(e.name||"").toLowerCase())))):"all"===o.for.selectorType||void 0))}));o.length&&l.push(...o)})),n.upsellFunnelLog("applicableOffers:",l),l.length?i(n.sortByPriorityAndLatestOffer(l)[0]):i(void 0)})).catch((e=>{console.log("Err while getApplicableOffer:",e),r("Error while fetching products",e)}))}else i(void 0)}))},getOrderQueryResponse:function(e,t){return new Promise(((o,i)=>{let r=`${n.getHostName()}/order`+(t?`/${t}`:""),s=new XMLHttpRequest;s.open("POST",r,!0),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.setRequestHeader("Access-Control-Allow-Origin","*"),s.send(JSON.stringify(e)),s.onload=()=>{n.log("tqOrderReq.responseText",s.responseText),200===s.status?o(JSON.parse(s.responseText)):i(`Error while ${t} parsing`)},s.onerror=()=>{i(`Error while ${t}`)}}))},getleastPricedTriggerItem:function(e,t){let o;if(e.item_count&&t.for)if("products"===t.for.selectorType&&t.for.products&&t.for.products.length)e.items.forEach((e=>{t.for.products.some((t=>`${t.productId}`==`${e.product_id}`))&&(o&&e.line_price<o.line_price||void 0===o)&&(o=e)}));else if("tags"===t.for.selectorType&&t.for.products&&t.for.products.length&&d.getCartItems&&d.getCartItems.length){let n=d.getCartItems.filter((e=>e.tags&&e.tags.length&&e.tags.some((e=>t.for.products.some((t=>t.name===e))))));n&&n.length&&n.forEach((t=>{let n=e.items.find((e=>`${e.product_id}`==`${t.id}`));n&&(o&&n.line_price<o.line_price||void 0===o)&&(o=n)}))}else"all"===t.for.selectorType&&e.items.forEach((e=>{(o&&e.line_price<o.line_price||void 0===o)&&(o=e)}));return o&&{id:o.id,quantity:o.quantity,variant_id:o.variant_id,title:o.title,line_price:o.line_price,product_title:o.product_title,product_id:o.product_id}},prerenderCartOffer:function(){if(n.isPrerenderingDisabled)n.log("Pre rendering diabled");else{let e,t=n.getSetup(),o=n.getWidgetSetup(t,"popup-cart-addons-widget");t.offers&&t.offers.length&&t.offers.some((e=>"popup-cart-addons"===e.upsellType))&&o&&o.isEnabled?n.getCart(window.location.hostname).then((r=>{if(n.log("prerenderCartOffer is Running"),r.item_count){let n=i.getDiscountFromStorage();!(n&&i.isDiscountValid(r,n))||n.code.includes("FUNDLL")||n.code.includes("CADDLL")||(e=!0),d.getApplicableOffer(t,r,["checkout-funnel","popup-cart-addons"]).then((t=>{t&&"popup-cart-addons"===t.upsellType&&o.isEnabled&&d.getFormattedWidgetInput(o,t,!e,r).then((e=>{localStorage.setItem("lb-upsell-cart-prerendered-data",JSON.stringify({widgetInput:e,setupOffer:t,expiry:new Date((new Date).getTime()+6e5).getTime()}))}))}))}})):n.isSnippetTesting()&&n.getCart(window.location.hostname).then((e=>{e.items[0].id=e.items[0].product_id,e.items[0].available=!0,r.showShopifyProductRecommendations(e.items[0],o).then((e=>{e.widget.isMultipleVariantsAdded=!0,n.ppaLog("Final offer input to wiget",e.offer),n.ppaLog("wiget settings",e.widget),n.ppaLog(JSON.stringify(e)),n.ppaLog("---------------"),localStorage.setItem("lb-upsell-cart-prerendered-data",JSON.stringify({widgetInput:e,setupOffer:{upsellType:"popup-cart-addons"}}))}))}))}},getPrerenderedData:function(){let e=localStorage.getItem("lb-upsell-cart-prerendered-data");if(e){e=JSON.parse(e),(new Date).getTime()>e.expiry&&(localStorage.removeItem("lb-upsell-cart-prerendered-data"),e=void 0)}return e},getFormattedTpaeOffer:function(e,t){return{boughtTogether:{offeredProducts:{products:e.map(((e,o)=>({discount:t,handle:e.handle,id:`gid://shopify/Product/${e.id}`,productId:`${e.id}`,sortNo:o+1,title:e.title})))}},for:{products:[],selectorType:"all"}}}}},function(e,t,o){const n=o(0),i=o(1),r=o(2),s=o(4);let d,l,a,c,u,p,g,f,m=e.exports={pufWidgetLib:function(){let e={};function t(e,t,o,i){if(e){let r=JSON.parse(JSON.stringify(e));return r.variants=r.variants.filter((e=>i&&i.length?e.available&&i.some((t=>t.id===`${e.id}`)):e.available)),r.available&&n.isImgAvailable(r)&&r.variants&&r.variants.length&&!function(e,t,o){return!(o&&o.isWindowRedirectUsedForCheckout&&"products"===t.for.selectorType&&t.for.products.some((t=>t.handle===decodeURI(e.handle))))&&e.variants.some((e=>l.items.some((t=>`${t.id}`==`${e.id}`))))}(e,t,o)?r:void 0}}function o(e,t){s.proceedToCheckout(e,t,a,f,"popup-upsell-funnel-widget",g,l)}function h(e,t,a,g,f){var m;n.isPrerenderingDisabled=!0,(m=e,new Promise(((e,t)=>{if(!m)return e(200);p=!0;let o={items:[{id:m.selectedVariantId,quantity:m.quantity}]};n.addItemsToCart(o).then((()=>{e(200)})).catch((t=>{e(t),console.log("Error while adding to cart",err)}))}))).then((p=>{let m=document.querySelector("lb-upsell-modal");if(200===p)if(f){if(n.upsellFunnelLog("Upsell funnel ended"),t&&t.length){let e=s.getleastPricedTriggerItem(l,u),t=c.upsellFunnel.offers.map((e=>e.offeredProduct&&e.offeredProduct.id||e.declinedOffer&&e.declinedOffer.offeredProduct&&e.declinedOffer.offeredProduct.id));r.pushEvent("offer-clicked",t,u.recordType,u,d,n.getWidgetSetup(d,"popup-upsell-funnel-widget"),!1,e)}if(a&&t&&t.length){let e=t.filter((e=>l.items.some((t=>`${t.id}`==`${e.selectedVariantId}`))));e&&e.length&&e.forEach((e=>{g+=Math.floor(Number(n.formatPrice(e.selectedVariantPrice,!1)||0))})),i.getDiscountCode(d.myShopifyDomain,t,c.upsellFunnel.discounts,g,void 0,"popup-upsell-funnel-widget").then((e=>{if(e&&e.code){e.endsAt=new Date((new Date).getTime()+6e4*(d.customDiscountEndTimeInMins||30)).getTime();let r=s.getleastPricedTriggerItem(l,u);i.saveDiscountToStorage("popup-upsell-funnel-widget",t,e,void 0,r,c.upsellFunnel.discounts.minimumCartAmount),i.addDiscountCodeToAllCartForms(!0,n.getCartForms(),e),o(t,e)}else o(t)})).catch((()=>{o(t)}))}else o(t)}else m.handleAddToCart(!0,p);else 422===p?(h=[{id:e.selectedVariantId}],new Promise(((e,t)=>{let o=new XMLHttpRequest;o.open("POST",`${n.getHostName()}/inventory`,!0),o.setRequestHeader("Content-Type","application/json; charset=UTF-8"),o.send(JSON.stringify({myShopifyDomain:d.myShopifyDomain,variants:h})),o.onload=function(){200===o.status?e(JSON.parse(o.responseText)):t(o.status)},o.onerror=e=>{n.upsellFunnelLog("Error while adding items to cart",e)}}))).then((t=>{if(t.productVariantInventory&&Object.keys(t.productVariantInventory).length){let o;const n=t.productVariantInventory[e.selectedVariantId];n&&"DENY"===n.inventoryPolicy&&n.tracked&&Number(e.quantity)>=Number(n.available)&&(o=Number(n.available)),m.handleAddToCart(!1,p,o)}})).catch((e=>{console.log("Error while fetching inventory data",e),o()})):(console.log("Unknown error while adding items to cart.",p),o());var h}))}function b(e,t){c=e,u=t,n.upsellFunnelLog("widgetInput:",JSON.stringify(e)),n.upsellFunnelLog("Rendering widget");let i=document.querySelector("lb-upsell-modal");i?(i.renderModal(e),function(e){e.addEventListener("upsellFunnelAddToCart",(function(e){e.detail&&e.detail&&(n.upsellFunnelLog("event.detail:",e.detail),h(e.detail.acceptedProduct,e.detail.acceptedProducts,e.detail.discounts,e.detail.totalWithoutDiscount,e.detail.isUpsellFunnelEnded))}))}(i)):(n.upsellFunnelLog("pufWidget not found"),o());let s=e.upsellFunnel.offers.map((e=>e.offeredProduct&&e.offeredProduct.id));r.pushEvent("offer-viewed",s,t.recordType,t,d,n.getWidgetSetup(d,"popup-upsell-funnel-widget"),!1),n.upsellFunnelLog("Widget successfully rendered")}return e.getPreRenderedWidgetInput=function(){let e=localStorage.getItem("lb-upsell-prerendered-data");return e=e?JSON.parse(e):void 0,e},e.initiateOffer=function(e,i,r,s,a){if(p)n.upsellFunnelLog("Ignoring as addtocart req is forced");else{n.upsellFunnelLog("Best offer:",a),function(e,o,i){return new Promise(((r,s)=>{let a=n.getPresentmentCurrency(),c=i&&o.upsellFunnel.discounts&&o.upsellFunnel.discounts.isEnabled&&o.upsellFunnel.discounts;if(c&&Number(c.minimumCartAmount)>0){let e=100*Number(c.minimumCartAmount)*Number(a&&a.rate||1);e>l.total_price&&(n.upsellFunnelLog(`Discounts will not be shown due to minimumCartAmount cond. minimumCartAmount - ${e}, cart total - ${l.total_price}`),c=void 0)}let u={offers:[],discounts:c,overrideWidgeTitle:o.overrideWidgeTitle},p={styles:e.styles,content:e.content,imageResolution:e.imageResolution,metadata:{isAmountNoDecimals:d&&d.isAmountNoDecimals,shopMoneyInEmailsFormat:d&&d.shopMoneyInEmailsFormat,shopCurrencyCode:d&&d.shopCurrencyCode,presentmentCurrency:a,isUnitPriceShown:d&&d.isUnitPriceShown,setupVersion:d.version,variantsGroupSeperator:d.variantsGroupSeperator}};if(d.shopLocales&&d.shopLocales.length>1){n.upsellFunnelLog("Checking shoplocale");const t=n.getCurrentLocale(),i=d.shopLocales.find((e=>e.primary));if(i&&i.locale!==t&&e.translations&&e.translations[t]){n.upsellFunnelLog("Replacing primaery locale");const o=p.content.countDownTimerMins&&JSON.parse(JSON.stringify(p.content.countDownTimerMins)),i=p.content.countDownTimerSecs&&JSON.parse(JSON.stringify(p.content.countDownTimerSecs));n.upsellFunnelLog("countDownTimerMins",o),p.content=e.translations[t],p.content.countDownTimerMins=o,p.content.countDownTimerSecs=i,n.upsellFunnelLog("formattedWidget.content",p.content)}if(o.upsellFunnel.offers&&o.upsellFunnel.offers.length&&o.translations&&o.translations[t]&&(o.translations[t].name&&(o.upsellFunnel.offers[0].name=o.translations[t].name),o.translations[t].discountTitle&&(o.upsellFunnel.offers[0].discountTitle=o.translations[t].discountTitle),o.translations[t].customDescription&&(o.upsellFunnel.offers[0].customDescription=o.translations[t].customDescription),o.upsellFunnel.offers.length>1))for(let e=1;e<=o.upsellFunnel.offers.length;e++)o.upsellFunnel.offers[e]&&(o.translations[t][`name-${e+1}a`]&&(o.upsellFunnel.offers[e].name=o.translations[t][`name-${e+1}a`]),o.translations[t][`discountTitle-${e+1}a`]&&(o.upsellFunnel.offers[e].discountTitle=o.translations[t][`discountTitle-${e+1}a`]),o.translations[t][`customDescription-${e+1}a`]&&(o.upsellFunnel.offers[e].customDescription=o.translations[t][`customDescription-${e+1}a`]),o.upsellFunnel.offers[e].declinedOffer&&(o.translations[t][`name-${e+1}b`]&&(o.upsellFunnel.offers[e].declinedOffer.name=o.translations[t][`name-${e+1}b`]),o.translations[t][`discountTitle-${e+1}b`]&&(o.upsellFunnel.offers[e].declinedOffer.discountTitle=o.translations[t][`discountTitle-${e+1}b`]),o.translations[t][`customDescription-${e+1}b`]&&(o.upsellFunnel.offers[e].declinedOffer.customDescription=o.translations[t][`customDescription-${e+1}b`])))}let g=[];o.upsellFunnel.offers.forEach((e=>{e.offeredProduct&&e.offeredProduct.handle&&!g.some((t=>t===e.offeredProduct.handle))&&g.push(e.offeredProduct.handle),e.declinedOffer&&e.declinedOffer.offeredProduct&&!g.some((t=>t===e.declinedOffer.offeredProduct.handle))&&g.push(e.declinedOffer.offeredProduct.handle)})),n.getProducts(g).then((n=>{let i=o.upsellFunnel.offers&&o.upsellFunnel.offers.length&&o.upsellFunnel.offers[0]&&o.upsellFunnel.offers[0].isVariantsSelection;JSON.parse(JSON.stringify(o)).upsellFunnel.offers.forEach((r=>{r.offeredProduct&&(r.offeredProduct=t(n.find((e=>`${e.id}`===r.offeredProduct.productId)),o,e,i&&r.offeredProduct.limitVariants)),r.declinedOffer&&r.declinedOffer.offeredProduct&&(r.declinedOffer.offeredProduct=t(n.find((e=>`${e.id}`===r.declinedOffer.offeredProduct.productId)),o,e,i&&r.declinedOffer.offeredProduct.limitVariants)),(r.offeredProduct||r.declinedOffer&&r.declinedOffer.offeredProduct)&&(0===u.offers.length?r.offeredProduct&&u.offers.push(r):u.offers.push(r))})),r({widget:p,upsellFunnel:u})})).catch((e=>{console.log("Err while get products",e),s(e)}))}))}(n.getWidgetSetup(e,"popup-upsell-funnel-widget"),a,r).then((e=>{n.log("widgetInput:",e),e.upsellFunnel&&e.upsellFunnel.offers[0]&&e.upsellFunnel.offers[0].offeredProduct&&e.widget?s?b(e,a):(n.upsellFunnelLog("Widget input"),n.upsellFunnelLog(JSON.stringify(e)),function(e,t){localStorage.setItem("lb-upsell-prerendered-data",JSON.stringify({widgetInput:e,setupOffer:t}))}(e,a)):(n.upsellFunnelLog("Coudn't find offer"),s&&(n.upsellFunnelLog("Proceeding to checkout"),o()))})).catch((e=>{console.log("Error while getFormattedWidgetInput",e),o()}))}},e.render=function(e,t,o,i,r,s,c){d=e,l=t,a=o,g=r,f=s,n.upsellFunnelLog("Puf render called,","isDiscountShown:",i);let u=m.pufWidgetLib().getPreRenderedWidgetInput();n.upsellFunnelLog("preRenderedData",u),u?(n.upsellFunnelLog("Rendeering widget with prerendered widgetInput"),b(u.widgetInput,u.setupOffer)):(n.upsellFunnelLog("No prerendered widgetInput found, initating offer."),m.pufWidgetLib().initiateOffer(e,t,i,!0,c))},e}}},function(e,t,o){const n=o(3),i=o(0),r=o(2),s=o(1);let d,l,a;e.exports={ppaWidgetLib:function(){let e,t={};function o(e){i.ppaLog("---pushOfferViewedEvent---");let t=i.getSetup(),o=i.getWidgetSetup(t,"product-page-addon-widget"),n=e.offer.boughtTogether&&e.offer.boughtTogether.map((e=>e.id));r.pushEvent("offer-viewed",n,e.offer.for.id,l,t,o,!1)}function c(){i.ppaLog("---pushing OfferClickedEvent---");let e=d.boughtTogether&&d.boughtTogether.map((e=>e.id)),t=i.getSetup(),o=i.getWidgetSetup(t,"product-page-addon-widget");r.pushEvent("offer-clicked",e,d.for.id,l,t,o,!1)}function u(e,t){let o=e.detail.totalWithoutDiscount>0&&t&&t[0]?t[0]:void 0;if(o&&o.code){let t=i.getSetup();o.endsAt=new Date((new Date).getTime()+6e4*(t.customDiscountEndTimeInMins||30)).getTime(),s.saveDiscountToStorage(d.for.id,e.detail.ajaxAddedItems,o)}if("add"===e.detail.addToCartAction){let t={items:e.detail.products.map((e=>({id:e.selectedVariantId,quantity:e.quantity})))};i.addItemsToCart(t).then((t=>{c();let n=document.querySelector("lb-upsell-product-page-addon");n&&n.handleAddToCartResponse(e.detail.products[0].id,"success"===t),i.triggerCustomEvent({widgetType:"product-page-addon-widget",currentAddToCartActionSetup:a,addToCartAction:e.detail.addToCartAction,discount:o})})).catch((e=>{i.ppaLog("Error - ppa widget ajax add to cart")}))}else n=e.detail.products,i.getCart(window.location.hostname).then((e=>{let t=0;if(e.items&&e.items.length){let o=e.items.find((e=>e.id===n[0].selectedVariantId));o&&(t=o.quantity-1)}let o={updates:{[n[0].selectedVariantId]:t}};i.updateCart(o).then((e=>{let t=document.querySelector("lb-upsell-product-page-addon");t&&t.handleAddToCartResponse(n[0].id,"success"===e),i.triggerCustomEvent({widgetType:"product-page-addon-widget",currentAddToCartActionSetup:a,addToCartAction:"remove"})}))}));var n}function p(e){e.addEventListener("ppaModalAddToCartClicked",(function(e){if(e.detail&&e.detail.products&&e.detail.products.length){let t={items:e.detail.products.map((e=>({id:e.selectedVariantId,quantity:e.quantity})))};c(),i.addItemsToCart(t).then((e=>{i.triggerCustomEvent({widgetType:"product-page-addon-widget",isFromModal:!0});let t=document.querySelector("ppcse-modal");t&&t.addToCartOnSuccess()})).catch((e=>{i.ppaLog("Error - ppa widget modal add to cart")}))}})),e.addEventListener("ppaAjaxAddToCartClicked",(function(e){if(e.detail&&e.detail.products&&e.detail.products.length){let t=[];if("add"===e.detail.addToCartAction&&e.detail.totalWithoutDiscount>0){let o=i.getSetup();t.push(s.getDiscountCode(o.myShopifyDomain,e.detail.ajaxAddedItems,e.detail.discounts,e.detail.totalWithoutDiscount,void 0,"product-page-addon-widget"))}else t.push(Promise.resolve(!0));Promise.all(t).then((t=>{u(e,t)})).catch((t=>{i.ppaLog("Error while creating discount code:",t),u(e,void 0)}))}})),e.addEventListener("ppaProductClicked",(function(e){e.detail&&c()}))}function g(e,t,o,n){let r={items:t.map((e=>({id:e.selectedVariantId,quantity:e.quantity||1})))};i.addItemsToCart(r).then((r=>{let l=o>0&&n&&n[0]?n[0]:void 0;if(l&&l.code){let e,o=i.getSetup();l.endsAt=new Date((new Date).getTime()+6e4*(o.customDiscountEndTimeInMins||30)).getTime();let n=i.getWidgetSetup(o,"product-page-addon-widget");n&&n.isDiscountForProductValidated&&(e=d.for.variants.map((e=>e.id))),s.saveDiscountToStorage(d.for.id,t,l,e)}c(),i.triggerCustomEvent({widgetType:"product-page-addon-widget",currentAddToCartAction:a,discount:l}),i.ppaLog("addToCartReq status:",`${r}`),i.isAddToCartClickForced=!0,i.isAddToCartClickForcedReset=!0,e.click();let u=document.querySelector("lb-upsell-product-page-addon");u&&u.resetAddToCartAction()})).catch((e=>{i.ppaLog("Error - ppa widget addAllItemsToCart add to cart",e)}))}function f(e){return new Promise(((t,n)=>{let r=function(){let e=[],t=document.querySelectorAll("form");if(t)for(let o=0;o<t.length;o++)"post"===t[o].method&&"string"==typeof t[o].action&&(t[o].action.endsWith("/cart/add")||t[o].action.endsWith("/cart/add/")||t[o].action.indexOf("/cart/add?")>-1)&&e.push(t[o]);return e&&e.length?e[0]:void 0}(),s=document.createElement("lb-upsell-product-page-addon");if(r){r.insertAdjacentElement("afterend",s);let n=document.querySelector("lb-upsell-product-page-addon");n?(n.widget=e.widget,n.offer=e.offer,n.widget.addToCartAction="ajax",a="ajax",i.ppaLog("Widget successfully added to cart form. Trigger changed to ajax"),p(n),o(e),t(!0)):(i.ppaLog("ppcseWidget not found"),t(!1))}else i.ppaLog("Could not find cart add form"),t(!1)}))}function m(){return window.innerWidth<=768}function h(e,t,r,s){i.removeExistingWidget("lb-upsell-product-page-addon");let d=n.getAddToCartBtnCSS(".ppa-add-to-cart-btn");d&&i.appendCustomTextCssToHead(d,"lb-upsell-ppa-atc-css");let l=m()?t.position.mobile.selector:t.position.desktop.selector,c=m()?t.position.mobile.insertPosition:t.position.desktop.insertPosition;r&&s&&(i.ppaLog("Using custom positioning"),l=r,c=s),i.ppaLog("----------Positioning widget----------"),"addToCartBtn"===l&&"beforebegin"===c?function(e){return new Promise(((t,r)=>{i.ppaLog("Adding widget to addWidgetToCartFormSubmitBtn");let s=n.getProductCartAddForms(),d=document.createElement("lb-upsell-product-page-addon");if(s&&s.length){let n=s[0].querySelectorAll("button,input");for(let e=0;e<n.length;e++)if("add"===n[e].name||"submit"===n[e].type){i.ppaLog("Positioning before button",n[e]),n[e].insertAdjacentElement("beforebegin",d);break}let r=document.querySelector("lb-upsell-product-page-addon");r?(r.widget=e.widget,r.offer=e.offer,a=e.widget.addToCartAction,i.ppaLog("Widget successfully added to cart form"),p(r),o(e),t(!0)):(i.ppaLog("ppcseWidget not found"),t(!1))}else i.ppaLog("Could not find cart add form"),t(!1)}))}(e).then((t=>{t||f(e).then((e=>{e||i.ppaLog("Cannot default position widget check selectors")}))})):function(e,t,n){return new Promise(((r,s)=>{i.ppaLog("added widget to custom selector");let d=document.querySelector(e);if(d){d.insertAdjacentHTML(t,"<lb-upsell-product-page-addon> \n </lb-upsell-product-page-addon>\n");let s=document.querySelector("lb-upsell-product-page-addon");s?(s.widget=n.widget,s.offer=n.offer,a=n.widget.addToCartAction,i.ppaLog(`Widget successfully added to selector , ${e}`),p(s),o(n),r(!0)):(i.ppaLog("ppcseWidget not found"),r(!1))}else i.ppaLog(`Could not find selector, ${e}`),r(!1)}))}(l,c,e).then((e=>{e||i.ppaLog("Check custom CSS selector.")}))}return t.handleAddToCart=function(e){let t=document.querySelector("lb-upsell-product-page-addon");t?t.getAddedItems().then((t=>{i.ppaLog("Result",t),t.addedItems&&t.addedItems.length&&"trigger"===a?function(e,t,o,n,r){let d=[];if(o>0){let t=i.getSetup();0===l.minSelectable&&1===l.maxSelectable?d.push(s.getDiscountCode(t.myShopifyDomain,[e[0],r],n,o,e[0],"product-page-addon-widget")):d.push(s.getDiscountCode(t.myShopifyDomain,e,n,o,void 0,"product-page-addon-widget"))}else d.push(Promise.resolve(!0));Promise.all(d).then((n=>{g(t,e,o,n)})).catch((n=>{i.ppaLog("Error while creatin g discount code.",n),g(t,e,o)}))}(t.addedItems,e,t.totalWithoutDiscount,t.discounts,t.forProduct):(i.isAddToCartClickForced=!0,i.isAddToCartClickForcedReset=!0,e.click())})):(i.isAddToCartClickForced=!0,i.isAddToCartClickForcedReset=!0,e.click())},t.render=function(t,o,r,s){e=t;const a=i.getSetup();if(n.isProductPage()||o){i.ppaLog("product page found");const e=a.widgets.find((e=>"product-page-addon-widget"===e.type));if(e&&e.isEnabled){const c=o||n.getProductHandle();i.getProduct(c).then((o=>{if(o.available)if(a.offers&&a.offers.length){const u=i.getOffer(a,o,"product-addons");i.ppaLog("Best offer :",u),u&&n.getFormattedWidgetInput(e,u,c,o.id,t).then((t=>{d=t.offer,l=u,i.ppaLog("Final offer input to wiget",t.offer),i.ppaLog("wiget settings",t.widget),i.ppaLog(JSON.stringify(t)),i.ppaLog("---------------"),t.offer&&t.offer.boughtTogether&&t.offer.boughtTogether.length?(i.ppaLog("---------------"),h(t,e,r,s)):(i.ppaLog("Not enough products to position widgets"),i.ppaLog("---------------"))}))}else i.ppaLog("No offer setup found"),e.useShopifyProductRecommendations&&n.showShopifyProductRecommendations(o,e).then((t=>{d=t.offer,i.ppaLog("Final offer input to wiget",t.offer),i.ppaLog("wiget settings",t.widget),i.ppaLog(JSON.stringify(t)),i.ppaLog("---------------"),h(t,e,r,s)}));else i.ppaLog("For product is not available.")})).catch((e=>{i.ppaLog("Error while querying product from AJAX API",e)}))}}},t}}},function(module,exports,__webpack_require__){(function(window){const ppcseWidget=__webpack_require__(8),ppaWidget=__webpack_require__(6),pufWidget=__webpack_require__(5),tpaeWidget=__webpack_require__(10),cartPageUtils=__webpack_require__(4),metrics=__webpack_require__(2),utils=__webpack_require__(0),discounts=__webpack_require__(1),checkoutHandler=__webpack_require__(11),addToCartHandler=__webpack_require__(13);let HOST_NAME=utils.getHostName(),setup,cart,callbackResults={isWidgetScriptLoaded:!1,isSetupLoaded:!1,isCartLoaded:!1};function processPufWidget(){let e=utils.getWidgetSetup(setup,"popup-upsell-funnel-widget");if(e&&e.isEnabled){let t=document.createElement("lb-upsell-modal");if(document.body.append(t),e.isPreRenderingEnabled){let e,t=utils.getWidgetSetup(setup,"product-page-cross-sell-embedded-widget"),o=discounts.getDiscountFromStorage();t&&t.isEnabled&&o&&o.code&&(e=o.code.includes("BUNDLL")&&discounts.isDiscountValid(cart,o)),pufWidget.pufWidgetLib().initiateOffer(setup,cart,!e,!1)}}}function processPcaWidget(){let e=utils.getWidgetSetup(setup,"popup-cart-addons-widget");if(e&&e.isEnabled){let e=document.createElement("lb-upsell-addon-popup");document.body.append(e)}}function renderWidgets(){window.lbUpsellComponents&&(window.lbUpsellComponents.isEnabled=setup&&setup.isEnabled),setup&&setup.isEnabled?(discounts.process(setup,cart),ppcseWidget.ppcseWidgetLib().render(setup,cart),ppaWidget.ppaWidgetLib().render(cart),tpaeWidget.TpaeWidgetLib().render(setup),checkoutHandler.registerListeners(setup),addToCartHandler.registerListeners(),window.location.pathname.includes("/orders/")||window.location.pathname.includes("/checkouts/")?utils.log("Cart page widgets will not be loaded in TQ page"):(processPufWidget(),processPcaWidget()),executeCustomJs(),registerMutationObserver(),registerCartChangeListeners(),discounts.validateStackDiscount(setup,cart),utils.isCartPage()&&setup.version>=13&&cartPageUtils.prerenderCartOffer()):utils.log("App Not enabled in admin")}function registerCartChangeListeners(){if(setup&&setup.version>=13&&utils.isCartPage()){utils.log("Registerred registerCartChangeListeners");const o=["/cart/add","/cart/update","/cart/change","/cart/clear"],n=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(){return this.addEventListener("load",(function(){o.some((e=>this._url.includes(e)))&&(utils.log("XML listener URL",this._url),localStorage.removeItem("lb-upsell-cart-prerendered-data"),utils.triggerCustomEvent({url:this._url},"lb-upsell-cart-updated"))})),n.apply(this,arguments)},e=window,"function"==typeof(t=window.fetch)&&(utils.log("Running ns fetch"),e.fetch=function(){var e=t.apply(this,arguments);return e.then((e=>{o.some((t=>e.url.includes(t)))&&(utils.log("Fetch listener URL",e.url),utils.triggerCustomEvent({url:e.url},"lb-upsell-cart-updated"))})),e}),window.addEventListener("lb-upsell-cart-updated",(function(e){utils.log("lb-upsell-cart-updated event:",e),localStorage.removeItem("lb-upsell-cart-prerendered-data"),cartPageUtils.prerenderCartOffer()}))}var e,t}function registerMutationObserver(){if(setup.version>=10){const e=new MutationObserver((e=>{e&&e.length&&e.forEach((e=>{if(e.addedNodes&&e.addedNodes.length)for(let t of e.addedNodes){if(!t||!t.querySelectorAll)continue;let e=t.querySelectorAll("button[type='submit'][name='checkout'], input[type='submit'][name='checkout'], a[href='/checkout']");e.length&&(utils.log("mutationObserver checkoutNodes",e),void 0!==window.lbUpsellComponents&&window.lbUpsellComponents.registerCheckoutListeners(),setup.customDiscountHelpPosition&&setup.customDiscountHelpSelector&&(utils.log("Calling discounts.process as customDiscountHelpPosition is set"),utils.getCart(window.location.hostname).then((e=>{discounts.process(setup,e)}))))}}))})),t=document.querySelector("body");e.observe(t,{childList:!0,subtree:!0})}}function executeCustomJs(){setup&&setup.isEnabled&&setup.customJs&&setup.customJs.length&&(utils.log("Running custom Js"),eval(setup.customJs))}function appendFloatingToastToBody(){if(window.location.pathname.includes("/cart")){let e=document.querySelector("ppcse-floting-toast");e&&e.remove();const t=document.createElement("ppcse-floting-toast");document.body.append(t)}}function appendProductDetailsModalToBody(){let e=utils.getWidgetSetup(setup,"product-page-cross-sell-embedded-widget"),t=utils.getWidgetSetup(setup,"product-page-addon-widget");if(!utils.isCartPage()&&(e&&e.isEnabled||t&&t.isEnabled)){utils.removeExistingWidget("ppcse-modal");const e=document.createElement("ppcse-modal");document.body.append(e)}let o=utils.getWidgetSetup(setup,"popup-cart-addons-widget");if(o&&o.isEnabled){utils.removeExistingWidget("lb-upsell-product-preview");const e=document.createElement("lb-upsell-product-preview");document.body.append(e)}}function callbackHandler(e){"widget"===e?callbackResults.isWidgetScriptLoaded=!0:"setup"===e?callbackResults.isSetupLoaded=!0:"cart"===e&&(callbackResults.isCartLoaded=!0),callbackResults.isSetupLoaded&&(utils.setSetup(setup),setup.version>=6&&(utils.log("Appendin css enhancements",setup.version),utils.appendCustomTextCssToHead(utils.getCSSEnhancements(setup.version),"lb-upsell-enhancements-css"))),callbackResults.isSetupLoaded&&setup&&setup.isEnabled&&setup.customCSS&&setup.customCSS.length&&utils.appendCustomTextCssToHead(setup.customCSS,"lb-upsell-custom-css"),callbackResults.isWidgetScriptLoaded&&callbackResults.isSetupLoaded&&setup&&setup.isEnabled&&appendFloatingToastToBody(),callbackResults.isSetupLoaded&&setup&&setup.isEnabled&&callbackResults.isWidgetScriptLoaded&&appendProductDetailsModalToBody(),callbackResults.isWidgetScriptLoaded&&callbackResults.isSetupLoaded&&callbackResults.isCartLoaded&&("complete"===document.readyState||"interactive"===document.readyState?renderWidgets():document.addEventListener("DOMContentLoaded",(function(){renderWidgets()})))}function initWidgets(){if(0===getScriptCount(scripts,!0)){var e=`${HOST_NAME}/lb-upsell-components/lb-upsell-components.esm.js`,t=document.createElement("script");t.defer=!0,t.readyState?t.onreadystatechange=function(){"loaded"!=t.readyState&&"complete"!=t.readyState||(utils.log("Widget script loaded successfully."),t.onreadystatechange=null,callbackHandler("widget"))}:t.onload=function(){utils.log("Widget script loaded successfully."),callbackHandler("widget")},t.src=e,t.type="module",document.getElementsByTagName("head")[0].appendChild(t)}else callbackHandler("widget")}function getScriptSrc(e){let t;for(let o=0;o<e.length;o++)if(e[o].src&&e[o].src.startsWith(`${HOST_NAME}/lb-upsell.js?shop=`)||e[o].src&&e[o].src.includes("/assets/lb-upsell.js")){t=e[o].src;break}return t}function getScriptCount(e,t=!1){let o=0;for(let n=0;n<e.length;n++)(t&&e[n].src&&e[n].src.includes("/lb-upsell-components.esm.js")||!t&&e[n].src&&(e[n].src.startsWith(`${HOST_NAME}/lb-upsell.js?shop=`)||e[n].src.includes("/assets/lb-upsell.js")))&&o++;return o}function getSetup(e){var t=new XMLHttpRequest;t.open("GET",`${HOST_NAME}/setup?myShopifyDomain=${e}`,!0),t.setRequestHeader("Content-Type","application/json; charset=UTF-8"),t.send(),t.onload=function(){200===t.status&&(setup=JSON.parse(t.responseText),utils.log("Setup fetch successfull"),callbackHandler("setup"))},t.onerror=function(){utils.log("Failed while fetching setup")}}function getUserType(){const e=localStorage.getItem("lb-upsell-userType");if(e)return e;{const e=0===Math.round(Math.random())?"A":"B";return localStorage.setItem("lb-upsell-userType",e),e}}function initAssets(e){window.lbUpsell={isInitialized:!0},utils.isCartPage()&&localStorage.removeItem("lb-upsell-cart-prerendered-data"),initWidgets(e);getUserType();getSetup(e),utils.getCart(window.location.hostname).then((e=>{cart=e,callbackHandler("cart")})).catch((e=>{utils.log("err while fetching cart:",e)}))}void 0===window.lbUpsellComponents&&(window.lbUpsellComponents={ppcseWidget:ppcseWidget.ppcseWidgetLib(),pufWidget:pufWidget.pufWidgetLib(),ppaWidget:ppaWidget.ppaWidgetLib(),tpaeWidget:tpaeWidget.TpaeWidgetLib(),registerCheckoutListeners:checkoutHandler.registerListeners,registerAddToCartListeners:addToCartHandler.registerListeners,handleUpsellFunnelCheckout:void 0,renderSelleasyCheckoutPopup:checkoutHandler.renderSelleasyCheckoutPopup});let scripts=document.getElementsByTagName("script"),IS_SNIPPET_TESTING=utils.isSnippetTesting();if(IS_SNIPPET_TESTING)console.log("Testing mode is enabled. Metrics will not work."),initWidgets(),setup=utils.getSampleSnippetSetup(),callbackResults.isCartLoaded=!0,callbackHandler("setup");else if("complete"===document.readyState&&getScriptCount(scripts)>1)utils.log("Script registered in head and scriptTag, so skipped running the script from scriptTag");else{const e=getScriptSrc(scripts);let t=utils.getURLParam("shop",e);t&&t.includes(" ")&&(t=t.replace(/\s/g,"")),(window.location.pathname.includes("/orders/")||window.location.pathname.includes("/checkouts/"))&&metrics.trackConversion();const o="true"===utils.getURLParam("isNotRenderedInHome",e)&&"/"===window.location.pathname;o||window.lbUpsell&&(!window.lbUpsell||window.lbUpsell.isInitialized)?utils.log("Not initalising assests - isNotRenderedInHome - ",o):t?initAssets(t):utils.log("myShopifyDomain not found")}})(window)},function(e,t,o){const n=o(2),i=o(0),r=o(1),s=o(3);e.exports={ppcseWidgetLib:function(){let e,t,o,d,l,a,c={};function u(){let e=document.querySelector("lb-product-page-cross-sell-ew");e&&e.addToCartOnSuccess("success")}function p(o,r,a){i.log("Successfully added items to cart.");let c=t.boughtTogether&&t.boughtTogether.map((e=>e.id));switch(n.pushEvent("offer-clicked",c,t.for.id,d,e,o,l),i.triggerCustomEvent({widgetType:"product-page-cross-sell-embedded-widget",discount:r,isFromModal:a}),o.addToCartAction){case"stay":u();break;case"redirect":setTimeout((()=>{let e=i.getRootRoute();window.location=e&&"/"!==e?`https://${window.location.hostname}${e}cart`:`https://${window.location.hostname}/cart`}),1e3);break;case"reload":u(),setTimeout((()=>{window.location.reload()}),1500);break;case"autoAddToCart":{let e=s.isAutoAddToCartValid(t.for);e?(e.click(),u()):(u(),setTimeout((()=>{window.location.reload()}),1500));break}case"redirect_checkout":{let e=i.getRootRoute();window.location.href=e&&"/"!==e?`${e}cart/checkout${r?`?discount=${r.code}`:""}`:"/cart/checkout"+(r?`?discount=${r.code}`:"");break}}}function g(n,d,l,a,c){let u={items:n.map((e=>{if(t.for.id!==e.id||!s.isAutoAddToCartValid(t.for))return{id:e.selectedVariantId,quantity:d?Number(d):1}})).filter((e=>e))};i.addItemsToCart(u).then((()=>{let i=l>0&&a&&a[0]?a[0]:void 0;i&&i.code&&(i.endsAt=new Date((new Date).getTime()+6e4*(e.customDiscountEndTimeInMins||30)).getTime(),r.saveDiscountToStorage(t.for.id,n,i)),p(o,i,c)})).catch((e=>{i.log("Error while adding items to cart",e),p(o,void 0,c)}))}function f(s){s.addEventListener("addToCartClicked",(function(t){t.detail&&t.detail.products&&t.detail.products.length&&(i.log("event.detail:",t.detail),function(t,o,n,s,d,l,a){let c=[];n>0?c.push(r.getDiscountCode(e.myShopifyDomain,t,l,n,d)):c.push(Promise.resolve(!0)),Promise.all(c).then((e=>{g(t,o,n,e,a)})).catch((e=>{i.log("Error while creatin g discount code.",e),g(t,o,n,void 0,a)}))}(t.detail.products,t.detail.quantity,t.detail.totalWithoutDiscount,t.detail.total,t.detail.cheapestProduct,t.detail.discounts,t.detail.isFromModal))})),s.addEventListener("productClicked",(function(i){if(i.detail){let i=t.boughtTogether&&t.boughtTogether.map((e=>e.id));n.pushEvent("offer-clicked",i,t.for.id,d,e,o,l)}}))}function m(){return window.innerWidth<=768}function h(t){return new Promise(((r,s)=>{let a=function(){let e=[],t=document.querySelectorAll("form");if(t)for(let o=0;o<t.length;o++)"post"===t[o].method&&"string"==typeof t[o].action&&(t[o].action.endsWith("/cart/add")||t[o].action.endsWith("/cart/add/")||t[o].action.indexOf("/cart/add?")>-1)&&e.push(t[o]);let o=window.Shopify&&window.Shopify.theme&&window.Shopify.theme.name&&"Dawn"===window.Shopify.theme.name,n=e&&e.length?e[0]:void 0;return o&&e&&e.length>0&&(n=e[1]),n}(),c=document.createElement("lb-product-page-cross-sell-ew");if(a){a.insertAdjacentElement("afterend",c);let s=document.querySelector("lb-product-page-cross-sell-ew");if(s){s.widget=t.widget,s.offer=t.offer,f(s);let a=t.offer.boughtTogether&&t.offer.boughtTogether.map((e=>e.id));n.pushEvent("offer-viewed",a,t.offer.for.id,d,e,o,l),i.log("Widget successfully added to cart form"),r(!0)}else i.log("ppcseWidget not found"),r(!1)}else i.log("Could not find cart add form"),r(!1)}))}function b(t,r,s){return new Promise(((a,c)=>{let u=document.querySelector(t);if(u){u.insertAdjacentHTML(r,"<lb-product-page-cross-sell-ew> \n </lb-product-page-cross-sell-ew>\n");let c=document.querySelector("lb-product-page-cross-sell-ew");if(c){c.widget=s.widget,c.offer=s.offer,f(c);let r=s.offer.boughtTogether&&s.offer.boughtTogether.map((e=>e.id));n.pushEvent("offer-viewed",r,s.offer.for.id,d,e,o,l),i.log(`Widget successfully added to selector , ${t}`),a(!0)}else i.log("ppcseWidget not found"),a(!1)}else i.log(`Could not find selector, ${t}`),a(!1)}))}function w(t,o){if(i.removeExistingWidget("lb-product-page-cross-sell-ew"),e.version>=2){let e=s.getAddToCartBtnCSS(".ppcse-tot-btn");e&&i.appendCustomTextCssToHead(e,"lb-upsell-ppcse-atc-css")}const n=m()?o.position.mobile.selector:o.position.desktop.selector,r=m()?o.position.mobile.insertPosition:o.position.desktop.insertPosition;i.log("----------Positioning widget----------"),e.version>=2?".product-form"===n&&"afterend"===r?h(t).then((e=>{e||b(n,r,t).then((e=>{e||b(".product-single","afterend").then((e=>{e||i.log("Could not add widget to .product-single in version 2 with default positioning, no more retries")}))}))})):b(n,r,t).then((e=>{e||i.log("Check custom CSS selector.")})):".product-single"===n&&"afterend"===r?b(n,r,t).then((e=>{e||h(t).then((e=>{e||i.log("Could not add widget to form in version 1 with default positioning, no more retries")}))})):b(n,r,t).then((e=>{e||i.log("Check custom CSS selector.")})),i.log("widgetInput:",JSON.stringify(t))}function S(e){s.showShopifyProductRecommendations(e,o,a).then((e=>{l=!0,t=e.offer,i.log("Final offer input to wiget",e.offer),i.log("wiget settings",e.widget),i.log("---------------"),w(e,o)}))}return c.render=function(n,r,l){if(e=n,a=r,s.isProductPage()||l){i.log("product page found");const n=e.widgets.find((e=>"product-page-cross-sell-embedded-widget"===e.type));if(n&&n.isEnabled){o=n;const a=l||s.getProductHandle();i.getProduct(a).then((o=>{if(o.available)if(e.offers&&e.offers.length){const l=i.getOffer(e,o,"frequently-bought-bundle");i.log("Best offer :",l),l?s.getFormattedWidgetInput(n,l,a,o.id,r).then((e=>{t=e.offer,d=l,e.offer&&e.offer.boughtTogether&&e.offer.boughtTogether.length?(i.log("Final offer input to wiget",e.offer),i.log("wiget settings",e.widget),i.log("---------------"),w(e,n)):(i.log("Not enough products to position widgets"),i.log("---------------"))})):(i.log("------No matching offer found.----------"),n.useShopifyProductRecommendations&&S(o))}else i.log("No offer setup found"),n.useShopifyProductRecommendations&&S(o);else i.log("For product is not available.")})).catch((e=>{i.log("Error while querying product from AJAX API",e)}))}}},c}}},function(e,t){e.exports={HOST_NAME:"https://upsell-app.logbase.io",IS_LOGS_REQUIRED:"false"}},function(e,t,o){const n=o(0),i=o(4),r=o(2),s=o(3);let d,l,a,c,u,p,g,f;e.exports={TpaeWidgetLib:function(){let e={};function t(e){let t=n.getWidgetSetup(a,"tq-page-addon-embedded-widget"),o=c.offer.boughtTogether&&c.offer.boughtTogether.map((e=>e.id));r.pushEvent(e,o,l.isRecommendationOffer?g&&g.product_id:l.recordType,l,a,t,l.isRecommendationOffer,g,f)}function o(e,o,r,s){n.ppaLog("added widget to custom selector");let l=document.querySelector(e);if(l){l.insertAdjacentHTML(o,"<lb-tq-page-upsell> \n </lb-tq-page-upsell>\n");let a=document.querySelector("lb-tq-page-upsell");a?(a.widget=r.widget,a.offer=r.offer,n.ppaLog(`Widget successfully added to selector , ${e}`),function(e,o){e.addEventListener("tqaeOrderClicked",(function(e){n.ppaLog("emited events",e,e.detail),f=e.detail.products,t("offer-clicked"),i.getOrderQueryResponse({order:e.detail,myShopifyDomain:d,customerId:p&&p.customer_id,orderId:u,isShippingFree:o&&o.isShippingFree},o.orderType).then((e=>{"editOrder"===o.orderType?window.location.reload():(window.open(e.url,"_blank").focus(),n.removeExistingWidget("lb-tq-page-upsell"))})).catch((e=>{n.ppaLog("Error while getting draft order",e)}))})),e.addEventListener("tqaeModalProductClicked",(function(e){n.ppaLog("emited events",e,e.detail),t("offer-clicked")})),e.addEventListener("tqaeOfferExpired",(function(e){let t=document.querySelector(".lb-tpae-confirm-button");t?t.click():n.removeExistingWidget("lb-tq-page-upsell"),localStorage.setItem("lb-upsell-Tpae-Expired",!0)}))}(a,s)):n.ppaLog("tpaeWidget not found"),t("offer-viewed")}else n.ppaLog(`Could not find selector, ${e}`)}function m(){return window.innerWidth<=768}function h(e,t){i.getFormattedWidgetInput(e,t).then((t=>{n.ppaLog("Tpae - widget input:",t),c=t,t.offer&&t.offer.boughtTogether&&t.offer.boughtTogether.length?(n.ppaLog("---------------"),function(e,t){n.removeExistingWidget("lb-tq-page-upsell");let i=m()?t.position.mobile.selector:t.position.desktop.selector,r=m()?t.position.mobile.insertPosition:t.position.desktop.insertPosition;n.ppaLog("----------Positioning widget----------"),o(i,r,e,t);let s=document.querySelector(".step__footer__continue-btn");s&&n.setBtnCSS(s,!0)}(t,e)):(n.ppaLog("Not enough products to position widgets"),n.ppaLog("---------------"))})).catch((e=>{n.ppaLog("Error while getFormattedWidgetInput",e)}))}function b(e,t){let o=Number(e.maxItemsInOffer)>0?e.maxItemsInOffer:2,r=i.getleastPricedTriggerItem(t,{for:{selectorType:"all"}});g=r,s.getShopifyProductRecomendation(r.product_id,o).then((t=>{if(n.log("ProductRecommendations result:",t),t.products.length>0){let o;e.useShopifyProductRecommendations&&e.recommendationDiscount&&e.recommendationDiscount.isEnabled&&(o=e.recommendationDiscount);let n=i.getFormattedTpaeOffer(t.products,o);n.tpaeDiscounts={isEnabled:e.useShopifyProductRecommendations,discountType:"byProducts"},l=n,l.isRecommendationOffer=!0,h(e,n)}}))}function w(){return a&&a.offers&&a.offers.length&&a.offers.some((e=>"tq-page-upsell"===e.upsellType))}return e.render=function(e){d=e.myShopifyDomain,a=e,p=function(){let e=Shopify.checkout||{};return e&&e.line_items&&e.line_items.length&&e.line_items.forEach((e=>{e.id=e.product_id})),e}();let t=n.getWidgetSetup(a,"tq-page-addon-embedded-widget");i.isThankyouPage()&&(n.ppaLog("thankyou page found"),(t.useShopifyProductRecommendations||w())&&new Promise(((e,t)=>{i.getOrderQueryResponse({myShopifyDomain:d,orderId:p.order_id}).then((t=>{let o=t.products;u=t.orderNumber,o&&o.length>0?e({items:o,item_count:o&&o.length}):e(void 0)})).catch((e=>{n.ppaLog("Error while getting order",e),t("Error while getting current Order")}))})).then((e=>{e?w()?i.getApplicableOffer(a,e,["tq-page-upsell"]).then((o=>{n.ppaLog("Best offer:",o),o?(l=o,h(t,o)):(n.ppaLog("Coudn't find Tpae offer"),t.useShopifyProductRecommendations&&b(t,e))})).catch((e=>{n.ppaLog("Error while finding Tpae offer",e)})):(n.ppaLog("No offers found"),t.useShopifyProductRecommendations&&b(t,e)):n.ppaLog("upsold order found, so tpae not rendered")})).catch((e=>{n.ppaLog("Offer not rendered. error while getting current order.",e)})))},e}}},function(module,exports,__webpack_require__){const utils=__webpack_require__(0),discounts=__webpack_require__(1),pufWidget=__webpack_require__(5),pcaWidget=__webpack_require__(12),cartPageUtils=__webpack_require__(4);let _checkoutHandler=module.exports={registerListeners:function(){let e=utils.getSetup(),t=utils.getWidgetSetup(e,"popup-upsell-funnel-widget"),o=utils.getWidgetSetup(e,"product-page-cross-sell-embedded-widget"),n=utils.getWidgetSetup(e,"product-page-addon-widget"),i=utils.getWidgetSetup(e,"popup-cart-addons-widget"),r=discounts.getDiscountFromStorage();if(o&&o.isEnabled||t&&t.isEnabled||n&&n.isEnabled||i&&i.isEnabled||r){let t=utils.getCartForms(),o=t.map((e=>e.getAttribute("id")));if(t&&t.length&&(utils.addCartSubmitClickListener(t[0],o,_checkoutHandler.handleCheckout),t.length>1&&utils.addCartSubmitClickListener(t[1],o,_checkoutHandler.handleCheckout),utils.upsellFunnelLog("Registered cart form listeners")),e.version>=5){let e=document.querySelectorAll('a[href="/checkout"]');utils.log("checkoutAnchors",e);for(let t=0;t<e.length;t++)"true"!==e[t].getAttribute("lb-upsell-listener")&&(e[t].setAttribute("lb-upsell-listener","true"),utils.setBtnCSS(e[t]),e[t].addEventListener?e[t].addEventListener("click",(function(o){_checkoutHandler.handleCheckout(o,e[t],void 0,!0)}),!0):e[t].attachEvent("onclick",(function(o){_checkoutHandler.handleCheckout(o,e[t],void 0,!0)}),!0))}}t&&t.isEnabled&&window.addEventListener("pageshow",(function(e){let t=utils.getCartForms();e.persisted&&t&&t.length&&(console.log("This page was restored from the bfcache so reloading manually."),window.location.reload())}))},isFormIgnored:function(cartForm){let isFormIgnored,setup=utils.getSetup();return setup&&setup.hiddenCartFormCustomJs&&(utils.log("Running hiddenCartFormCustomJs eval"),eval(setup.hiddenCartFormCustomJs)),utils.log("isFormIgnored",isFormIgnored),isFormIgnored},preventSubmit:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopImmediatePropagation&&e.stopImmediatePropagation()},proceedToCheckout:function(e,t,o){let n=utils.getSetup();if(e&&!t)if(window.lbUpsellComponents&&window.lbUpsellComponents.isAnchorTagUsedForCheckout||n&&n.version>14&&o&&e&&e.tagName&&"a"===e.tagName.toLowerCase()&&"/checkout"===e.getAttribute("href")){utils.upsellFunnelLog("window redirecting because of anchor tag");let e=utils.getRootRoute();window.location.href=e&&"/"!==e?`${e}cart/checkout${o?`?discount=${o.code}`:""}`:"/cart/checkout"+(o?`?discount=${o.code}`:"")}else utils.isCheckoutClickForced=!0,e.disabled=!1,e.click();if(t){const e={acceptedProducts:void 0,discount:void 0};utils.triggerCustomEvent(e,"selleasy-checkout-popup-completed")}},renderSelleasyCheckoutPopup:function(){_checkoutHandler.handleCheckout(void 0,void 0,void 0,!1,!0)},handleCheckout:function(e,t,o,n,i){if(window.lbUpsellComponents&&window.lbUpsellComponents.isDefaultCheckoutListenerIgnored&&n)console.log("Not rendering as called by our own listeners");else{let n=discounts.getDiscountFromStorage(),r=utils.getSetup();if(n||r.offers&&r.offers.length&&r.offers.some((e=>"checkout-funnel"===e.upsellType||"popup-cart-addons"))||utils.isSnippetTesting()){"undefined"==typeof handleUSCSKCheckout||handleUSCSKCheckout()?utils.isCheckoutClickForced||(utils.upsellFunnelLog("Checkout click handler called."),e&&(_checkoutHandler.preventSubmit(e),e.srcElement&&"checkout"===e.srcElement.getAttribute("name")&&(t=e.srcElement)),utils.getCart(window.location.hostname).then((e=>{let s,d=[];if(utils.isDiscountStacked()){const t=discounts.getStackDiscountValidationData(e);t&&t.invalidDiscountCodes&&t.invalidDiscountCodes.length?(t.invalidDiscountCodes.forEach((e=>{utils.removeStackDiscount(e),d.push(discounts.deleteDiscountCode(r.myShopifyDomain,e.priceRuleId,e.discountCodeId)),n&&e.code===n.code&&(utils.log("Deleting discount from storage",e.code),localStorage.removeItem("lb-upsell-offer-discount"))})),localStorage.setItem("lb-upsell-offer-discount-stack",JSON.stringify(t.validDiscountCodes))):d.push(Promise.resolve(!0))}else{let t=discounts.getDiscountFromStorage();const o=t&&discounts.isDiscountValid(e,t);o&&(t.code.includes("FUNDLL")||t.code.includes("CADDLL")||(s=!0),utils.upsellFunnelLog("Discount is valid, adding to form in checkoutSubmitHandler",t.code),discounts.addDiscountCodeToAllCartForms(!0,utils.getCartForms(),t)),t&&t.code&&!o?(utils.log("Discount code is not valid, calling removeDicountCodeFromAllCartForms"),discounts.removeDicountCodeFromAllCartForms(t.code),d.push(discounts.deleteDiscountCode(r.myShopifyDomain,t.priceRuleId,t.discountCodeId)),utils.log("Deleting discount from storage"),localStorage.removeItem("lb-upsell-offer-discount")):d.push(Promise.resolve(!0))}Promise.all(d).then((d=>{const l=!s||utils.isDiscountStacked();let a=utils.getWidgetSetup(r,"popup-upsell-funnel-widget"),c=utils.getWidgetSetup(r,"popup-cart-addons-widget");const u=cartPageUtils.getPrerenderedData();a&&a.isEnabled||c&&c.isEnabled?utils.isCartPage()&&u&&u.widgetInput.offer?(utils.log("prerenderedData:",u),"popup-cart-addons"===u.setupOffer.upsellType&&c&&c.isEnabled&&!_checkoutHandler.isFormIgnored(o)?pcaWidget.pcaWidgetLib().render(r,e,t,l,s,i,void 0,u):_checkoutHandler.proceedToCheckout(t,i,s&&n)):cartPageUtils.getApplicableOffer(r,e,["checkout-funnel","popup-cart-addons"]).then((d=>{utils.log("best offer:",d),d?"popup-cart-addons"===d.upsellType&&c&&c.isEnabled&&!_checkoutHandler.isFormIgnored(o)?pcaWidget.pcaWidgetLib().render(r,e,t,l,s,i,d):"checkout-funnel"===d.upsellType&&a&&a.isEnabled&&!_checkoutHandler.isFormIgnored(o)?pufWidget.pufWidgetLib().render(r,e,t,l,s,i,d):(utils.log("proceeding to checkout:",d),_checkoutHandler.proceedToCheckout(t,i,s&&n)):(utils.log("offer not found, proceeding to checkout:",d),_checkoutHandler.proceedToCheckout(t,i,s&&n))})).catch((e=>{console.log("Error while getApplicableOffer")})):(utils.log("puf/pca widget not enabled, proceeding to checkout"),_checkoutHandler.proceedToCheckout(t,i,s&&n))}))})).catch((e=>{utils.upsellFunnelLog("Error while handling checkout",e),_checkoutHandler.proceedToCheckout(t,i)}))):(console.log("Integrated app returned false"),e&&_checkoutHandler.preventSubmit(e))}else utils.upsellFunnelLog("No discount/funnel offers, so not preventing checkout btn"),_checkoutHandler.proceedToCheckout(t,i)}}}},function(e,t,o){const n=o(0),i=o(1),r=o(2),s=o(4);let d,l,a,c,u,p;e.exports={pcaWidgetLib:function(){let e={};function t(e,t,o){let g={items:e.map((e=>({id:e.selectedVariantId,quantity:e.quantity||1})))};n.addItemsToCart(g).then((f=>{let m=n.getSetup(),h=a.offer.boughtTogether&&a.offer.boughtTogether.map((e=>e.id)),b=s.getleastPricedTriggerItem(d,c);r.pushEvent("offer-clicked",h,c.recordType,c,m,n.getWidgetSetup(m,"popup-cart-addons-widget"),!1,b,g.items);let w=t>0&&o&&o[0]?o[0]:void 0;w&&w.code&&(w.endsAt=new Date((new Date).getTime()+6e4*(m.customDiscountEndTimeInMins||30)).getTime(),i.saveDiscountToStorage("popup-cart-addons-widget",e,w,void 0,b,a.offer.discounts.minimumCartAmount),i.addDiscountCodeToAllCartForms(!0,n.getCartForms(),w)),n.triggerCustomEvent({widgetType:"product-cart-addons-widget",discount:w}),n.ppaLog("addToCartReq status:",`${f}`),s.proceedToCheckout(e,w,l,p,"popup-cart-addons-widget",u,d)})).catch((e=>{n.ppaLog("Error - ppa widget addAllItemsToCart add to cart",e),s.proceedToCheckout(void 0,void 0,l,p,"popup-cart-addons-widget",u,d)}))}function o(){let e=document.querySelector("lb-upsell-addon-popup");e&&e.addEventListener("pcaContinueClicked",(function(e){n.ppaLog("event",e.detail),e.detail.addedItems&&e.detail.addedItems.length?function(e,o,r,s){n.isPrerenderingDisabled=!0;let d=[];if(o>0){let t=n.getSetup();d.push(i.getDiscountCode(t.myShopifyDomain,e,r,o,void 0,"popup-cart-addons-widget"))}else d.push(Promise.resolve(!0));Promise.all(d).then((n=>{t(e,o,n)})).catch((i=>{n.ppaLog("Error while creating discount code.",i),t(e,o)}))}(e.detail.addedItems,e.detail.totalWithoutDiscount,e.detail.discounts,e.detail.forProduct):s.proceedToCheckout(void 0,void 0,l,p,"popup-cart-addons-widget",u,d)}))}function g(e,t){let i=document.querySelector("lb-upsell-addon-popup");if(i){i.renderAddonPopup(a),o();let s=a.offer.boughtTogether&&a.offer.boughtTogether.map((e=>e.id));r.pushEvent("offer-viewed",s,c.recordType,c,t,e,!1),n.ppaLog("Widget successfully rendered")}}return e.render=function(e,t,o,i,r,f,m,h){d=t,l=o,u=r,p=f,c=m;let b=n.getWidgetSetup(e,"popup-cart-addons-widget");h?h.widgetInput.offer&&h.widgetInput.offer.boughtTogether&&h.widgetInput.offer.boughtTogether.length?(c=h.setupOffer,a={offer:h.widgetInput.offer,widget:h.widgetInput.widget},n.log("rendering widget throught pre rendered data"),g(b,e)):s.proceedToCheckout(void 0,void 0,l,p,"popup-cart-addons-widget",u,d):s.getFormattedWidgetInput(b,m,i,t).then((t=>{n.log("widgetInputData:",t),t.offer&&t.offer.boughtTogether&&t.offer.boughtTogether.length?(a=t,g(b,e),n.ppaLog("Final offer input to wiget",t.offer),n.ppaLog("wiget settings",t.widget),n.ppaLog(JSON.stringify(t))):s.proceedToCheckout(void 0,void 0,l,p,"popup-cart-addons-widget",u,d)})).catch((e=>{n.log("Proceed to checkout",e),s.proceedToCheckout(void 0,void 0,l,p,"popup-cart-addons-widget",u,d)}))},e}}},function(e,t,o){const n=o(0),i=(o(1),o(6)),r=o(3);let s=e.exports={addCartAddSubmitClickListener:function(e,t){let o=e.querySelectorAll("button,input");if(o)for(let e=0;e<o.length;e++)"add"!==o[e].name&&"submit"!==o[e].type||"true"!==o[e].getAttribute("listener")&&(o[e].setAttribute("listener","true"),o[e].addEventListener?o[e].addEventListener("click",(function(n){t(n,o[e])}),!0):o[e].attachEvent("onclick",(function(n){t(n,o[e])}),!0))},registerListeners:function(e){let t=n.getSetup(),o=n.getWidgetSetup(t,"product-page-addon-widget");if(o&&o.isEnabled&&"trigger"===o.addToCartAction&&t.offers&&t.offers.length&&t.offers.some((e=>"product-addons"===e.upsellType)))if(e||o.addToCartBtnSelector){let t=document.querySelector(o.addToCartBtnSelector);t&&(n.log("Replaced submitButtons with custom addToCartBtnSelector:",t),"true"!==t.getAttribute("listener")&&(t.setAttribute("listener","true"),t.addEventListener?t.addEventListener("click",(function(e){s.handleAddToCart(e,t)}),!0):t.attachEvent("onclick",(function(e){s.handleAddToCart(e,t)}),!0)));let i=document.querySelector(e);i&&(n.log("Replaced submitButtons with customAddToCartBtnSelector:",i),"true"!==i.getAttribute("listener")&&(i.setAttribute("listener","true"),i.addEventListener?i.addEventListener("click",(function(e){s.handleAddToCart(e,i)}),!0):i.attachEvent("onclick",(function(e){s.handleAddToCart(e,i)}),!0)))}else{let e=r.getProductCartAddForms();e&&e.length&&(s.addCartAddSubmitClickListener(e[0],s.handleAddToCart),n.upsellFunnelLog("Registered add to cart form listeners"))}else n.upsellFunnelLog("product-addons not setup, so not registering listeners")},handleAddToCart:function(e,t){if(n.isAddToCartClickForced)n.log("Add to cart click is forced"),n.isAddToCartClickForcedReset&&(n.isAddToCartClickForced=!1);else{e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopImmediatePropagation&&e.stopImmediatePropagation(),n.isAddToCartClickForcedReset=!1;let o=t||e.srcElement;i.ppaWidgetLib().handleAddToCart(o),n.log("------------")}}}}]);