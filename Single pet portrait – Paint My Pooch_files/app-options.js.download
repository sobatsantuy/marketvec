!function(){function t(t){return t&&t.__esModule?t.default:t}class e{static merge(t,i,r){for(let o in i)!i.hasOwnProperty(o)||null!=r&&-1===r.indexOf(o)||("[object Object]"===Object.prototype.toString.call(i[o])?t[o]=e.merge(t[o],i[o]):void 0!==i[o]&&(t[o]=i[o]));return t}static extend(){let t={},i=function(i){for(let r in i)i.hasOwnProperty(r)&&("[object Object]"===Object.prototype.toString.call(i[r])?t[r]=e.extend(t[r],i[r]):void 0!==i[r]&&(t[r]=i[r]))};for(let t=0;t<arguments.length;t++){i(arguments[t])}return t}static isElement(t){return"object"==typeof t&&void 0!==t.nodeType}static isNodeList(t){let i=Object.prototype.toString.call(t),r="object"==typeof t&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(i)&&"number"==typeof t.length&&(0===t.length||"object"==typeof t[0]&&t[0].nodeType>0);return!r&&Array.isArray(t)&&t.length>0?e.isElement(t[0]):r}static isInPage(t){return t!==document.body&&document.body.contains(t)}static isHidden(t){return 0===t.offsetHeight||0===t.offsetWidth||null===t.offsetParent||"none"===window.getComputedStyle(t).display||1===t.offsetHeight&&1===t.offsetWidth}static isScrolledIntoView(t){let e=t.getBoundingClientRect(),i=e.top,r=e.bottom;return i>=0&&r<=window.innerHeight}static matches(t,e){return Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(t){for(var e=(this.document||this.ownerDocument).querySelectorAll(t),i=e.length;--i>=0&&e.item(i)!==this;);return i>-1}),t.matches(e)}static matchesIncludeParent(t,i){return!(!t||!e.matches(t,i)&&null==e.findParent(t,i))}static findParent(t,i){if("function"==typeof t.closest)return t.closest(i)||null;for(;t;){if(e.matches(t,i))return t;t=t.parentElement}return null}static findInnerDimensions(t){let e=getComputedStyle(t),i=t.clientWidth,r=t.clientHeight;return r-=parseFloat(e.paddingTop)+parseFloat(e.paddingBottom),i-=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight),{height:r,width:i}}static getCalculatedPosition(t){const e=document.body,i=document.documentElement,r=window.pageYOffset||i.scrollTop||e.scrollTop,o=window.pageXOffset||i.scrollLeft||e.scrollLeft,n=t.getBoundingClientRect();return{top:n.top+r,left:n.left+o,right:n.left+o+n.width,bottom:n.top+r+n.height}}static findElementContainsText(t,i,r=document){return e.findElementContainsRegex(t,new RegExp(i),r)}static findElementContainsRegex(t,e,i=document){let r=i.querySelectorAll(t);return Array.prototype.filter.call(r,(function(t){return e.test(t.textContent)}))}static escapeRegex(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}static readCookie(t){t+="=";for(let e=document.cookie.split(/;\s*/),i=e.length-1;i>=0;i--)if(!e[i].indexOf(t))return e[i].replace(t,"")}static writeCookie(t,e,i,r="/"){let o=new Date;o.setDate(o.getDate()+i);let n=null==i?"":"; expires="+o.toUTCString();document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)+n+(r?"; path="+r:"")+";"}static removeCookie(t,e="/"){document.cookie=t+"=; Path="+e+"; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"}static addStyleElement(t,e){e&&"head"!=e||(e=document.head||document.getElementsByTagName("head")[0]);let i=document.createElement("style");return i.appendChild(document.createTextNode(t)),e.appendChild(i),i}static objectKeys(t){if(!Object.keys){let e,i=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.push(e);return i}return Object.keys(t)}static hasQueryParam(t,e){return-1!==t.indexOf(e)}static getQueryParam(t,e){let i=new RegExp("[?&]"+e+"=([^&#]*)","i").exec(t);return i?i[1]:null}static getQueryParams(t){let e={},i=document.createElement("a");i.href=t;let r=i.search.substring(1).split("&");for(let t=0;t<r.length;t++){let i=r[t].split("=");e[i[0]]=decodeURIComponent(i[1])}return e}static buildQueryParams(t){return Object.keys(t).map((e=>encodeURIComponent(e)+"="+encodeURIComponent(t[e]))).join("&")}static debounced(t,e){let i;return function(...r){i&&clearTimeout(i),i=setTimeout((()=>{e(...r),i=null}),t)}}static throttled(t,e){let i=0;return function(...r){const o=(new Date).getTime();if(!(o-i<t))return i=o,e(...r)}}static decodeHtml(t){const e=document.createElement("textarea");return e.innerHTML=t,e.value}static pathBaseName(t,e=!0){let i=t.split("/").pop();return e||(i=i.substring(0,i.lastIndexOf("."))),i}static getAgent(){return navigator.userAgent||navigator.vendor||window.opera}static isInApp(t){return t.indexOf("FBAN")>-1||t.indexOf("FBAV")>-1||t.indexOf("Instagram")>-1}static isFacebook(t){return t.indexOf("FBAN")>-1||t.indexOf("FBAV")>-1}static isInstagram(t){return t.indexOf("Instagram")>-1}static isIOS(t){return(t=t.toLowerCase()).indexOf("iphone")>-1||t.indexOf("ipad")>-1}static isAndroid(t){return(t=t.toLowerCase()).indexOf("android")>-1}static isMobile(t){return this.isAndroid(t)||this.isIOS(t)}}var i=e;var r,o,n=class{supports(){return"XMLHttpRequest"in window&&"JSON"in window&&"Promise"in window}parse(t){let e;if("text"!==this.settings.responseType&&""!==this.settings.responseType){let e=t.response;if("json"===this.settings.responseType&&"string"==typeof e)try{e=JSON.parse(e)}catch(t){}return{data:e,xhr:t}}try{e=JSON.parse(t.responseText)}catch(i){e=t.responseText}return{data:e,xhr:t}}param(t){if("string"==typeof t||"[object FormData]"===Object.prototype.toString.call(t)||"[object File]"===Object.prototype.toString.call(t)||"[object Blob]"===Object.prototype.toString.call(t))return t;if(/application\/json/i.test(this.settings.headers["Content-type"])||"[object Array]"===Object.prototype.toString.call(t))return JSON.stringify(t);let e=[];for(let i in t)t.hasOwnProperty(i)&&e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e.join("&")}addQueryParams(t){if(this.settings.queryParams){let e=[];for(let t in this.settings.queryParams)this.settings.queryParams.hasOwnProperty(t)&&e.push(t+"="+this.settings.queryParams[t]);if(e.length>0){let i=e.join("&");return-1===t.indexOf("?")?t+"?"+i:t+"&"+i}}return t}xhr(t){const e=new XMLHttpRequest,i=new Promise(((i,r)=>{e.onreadystatechange=()=>{if(4!==e.readyState)return;let t=this.parse(e);e.status>=200&&e.status<300?i(t):r(t)},t=this.addQueryParams(t),e.open(this.settings.method,t,!0,this.settings.username,this.settings.password),e.responseType=this.settings.responseType;for(let t in this.settings.headers)this.settings.headers.hasOwnProperty(t)&&e.setRequestHeader(t,this.settings.headers[t]);this.settings.timeout&&(e.timeout=this.settings.timeout,e.ontimeout=t=>{r({status:408,statusText:"Request timeout"})}),this.settings.withCredentials&&(e.withCredentials=!0),this.settings.onProgress&&(e.upload.onprogress=this.settings.onProgress),e.send(this.param(this.settings.data))}));return i.cancel=()=>{e.abort()},i}constructor(t,e){if(!this.supports())throw"This browser is not supported";return this.settings=i.extend({method:"GET",username:null,password:null,data:{},queryParams:{},headers:{"Content-type":"application/x-www-form-urlencoded"},responseType:"text",timeout:null,withCredentials:!1,onProgress:null},e||{}),this.xhr(t)}},a={};r=a,o=function(){"use strict";var t=function(){},e="undefined",i=typeof window!==e&&typeof window.navigator!==e&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function o(t,e){var i=t[e];if("function"==typeof i.bind)return i.bind(t);try{return Function.prototype.bind.call(i,t)}catch(e){return function(){return Function.prototype.apply.apply(i,[t,arguments])}}}function n(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(r){return"debug"===r&&(r="log"),typeof console!==e&&("trace"===r&&i?n:void 0!==console[r]?o(console,r):void 0!==console.log?o(console,"log"):t)}function s(e,i){for(var o=0;o<r.length;o++){var n=r[o];this[n]=o<e?t:this.methodFactory(n,e,i)}this.log=this.debug}function l(t,i,r){return function(){typeof console!==e&&(s.call(this,i,r),this[t].apply(this,arguments))}}function c(t,e,i){return a(t)||l.apply(this,arguments)}function p(t,i,o){var n,a=this,l="loglevel";function p(){var t;if(typeof window!==e&&l){try{t=window.localStorage[l]}catch(t){}if(typeof t===e)try{var i=window.document.cookie,r=i.indexOf(encodeURIComponent(l)+"=");-1!==r&&(t=/^([^;]+)/.exec(i.slice(r))[1])}catch(t){}return void 0===a.levels[t]&&(t=void 0),t}}"string"==typeof t?l+=":"+t:"symbol"==typeof t&&(l=void 0),a.name=t,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=o||c,a.getLevel=function(){return n},a.setLevel=function(i,o){if("string"==typeof i&&void 0!==a.levels[i.toUpperCase()]&&(i=a.levels[i.toUpperCase()]),!("number"==typeof i&&i>=0&&i<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+i;if(n=i,!1!==o&&function(t){var i=(r[t]||"silent").toUpperCase();if(typeof window!==e&&l){try{return void(window.localStorage[l]=i)}catch(t){}try{window.document.cookie=encodeURIComponent(l)+"="+i+";"}catch(t){}}}(i),s.call(a,i,t),typeof console===e&&i<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(t){p()||a.setLevel(t,!1)},a.enableAll=function(t){a.setLevel(a.levels.TRACE,t)},a.disableAll=function(t){a.setLevel(a.levels.SILENT,t)};var d=p();null==d&&(d=null==i?"WARN":i),a.setLevel(d,!1)}var d=new p,h={};d.getLogger=function(t){if("symbol"!=typeof t&&"string"!=typeof t||""===t)throw new TypeError("You must supply a name when creating a logger.");var e=h[t];return e||(e=h[t]=new p(t,d.getLevel(),d.methodFactory)),e};var u=typeof window!==e?window.log:void 0;return d.noConflict=function(){return typeof window!==e&&window.log===d&&(window.log=u),d},d.getLoggers=function(){return h},d.default=d,d},"function"==typeof define&&define.amd?define(o):a?a=o():r.log=o();class s{static get(t,e,i){let r=s.translations[t]||i||t;if(e)for(let t in e)e.hasOwnProperty(t)&&(r=r.replace(new RegExp("{"+t+"}","g"),e[t]));return r}static translate(t,e){if(t&&"string"==typeof t){if("#"===t.charAt(0))return s.get(t.substr(1).trim(),e);if(-1!==t.indexOf("#{")){let i=t;for(;-1!==i.indexOf("#{");){let t=i.indexOf("#{"),r=i.indexOf("}"),o=i.substring(t+2,r),n=s.get(o,e);i=i.replace("#{"+o+"}",n)}return i}}return t}static fetch(t){let e=s.api.replace("{locale}",t),i=new n(e,{method:"GET"});return s.ready=i.then((t=>(a.debug("[translate] "+e+" response",t.data),s.update(t.data),s.translations))).catch((t=>(a.error("[translate] "+e+" error",t),s.translations))),s.ready}static update(t){s.translations=i.extend(s.translations,t),s.updated()}static updated(){const t=new CustomEvent(s.event,{detail:{},cancelable:!0,bubbles:!0});window.dispatchEvent(t)}static onUpdated(t){window.addEventListener(s.event,t)}}s.locale=window.Shopify&&window.Shopify.locale?window.Shopify.locale:document.documentElement.lang,s.translations={},s.ready=Promise.resolve(!0),s.event="cloudlift.translate",s.api="";var l=s,c={};!function(){function t(t,e,i){return t.call.apply(t.bind,arguments)}function e(t,e,i){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function i(r,o,n){return(i=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?t:e).apply(null,arguments)}var r=Date.now||function(){return+new Date};function o(t,e){this.a=t,this.o=e||t,this.c=this.o.document}var n=!!window.FontFace;function a(t,e,i,r){if(e=t.c.createElement(e),i)for(var o in i)i.hasOwnProperty(o)&&("style"==o?e.style.cssText=i[o]:e.setAttribute(o,i[o]));return r&&e.appendChild(t.c.createTextNode(r)),e}function s(t,e,i){(t=t.c.getElementsByTagName(e)[0])||(t=document.documentElement),t.insertBefore(i,t.lastChild)}function l(t){t.parentNode&&t.parentNode.removeChild(t)}function p(t,e,i){e=e||[],i=i||[];for(var r=t.className.split(/\s+/),o=0;o<e.length;o+=1){for(var n=!1,a=0;a<r.length;a+=1)if(e[o]===r[a]){n=!0;break}n||r.push(e[o])}for(e=[],o=0;o<r.length;o+=1){for(n=!1,a=0;a<i.length;a+=1)if(r[o]===i[a]){n=!0;break}n||e.push(r[o])}t.className=e.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function d(t,e){for(var i=t.className.split(/\s+/),r=0,o=i.length;r<o;r++)if(i[r]==e)return!0;return!1}function h(t,e,i){function r(){p&&o&&l&&(p(c),p=null)}e=a(t,"link",{rel:"stylesheet",href:e,media:"all"});var o=!1,l=!0,c=null,p=i||null;n?(e.onload=function(){o=!0,r()},e.onerror=function(){o=!0,c=Error("Stylesheet failed to load"),r()}):setTimeout((function(){o=!0,r()}),0),s(t,"head",e)}function u(t,e,i,r){var o=t.c.getElementsByTagName("head")[0];if(o){var n=a(t,"script",{src:e}),s=!1;return n.onload=n.onreadystatechange=function(){s||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(s=!0,i&&i(null),n.onload=n.onreadystatechange=null,"HEAD"==n.parentNode.tagName&&o.removeChild(n))},o.appendChild(n),setTimeout((function(){s||(s=!0,i&&i(Error("Script load timeout")))}),r||5e3),n}return null}function m(){this.a=0,this.c=null}function f(t){return t.a++,function(){t.a--,v(t)}}function g(t,e){t.c=e,v(t)}function v(t){0==t.a&&t.c&&(t.c(),t.c=null)}function y(t){this.a=t||"-"}function _(t,e){this.c=t,this.f=4,this.a="n";var i=(e||"n4").match(/^([nio])([1-9])$/i);i&&(this.a=i[1],this.f=parseInt(i[2],10))}function w(t){var e=[];t=t.split(/,\s*/);for(var i=0;i<t.length;i++){var r=t[i].replace(/['"]/g,"");-1!=r.indexOf(" ")||/^\d/.test(r)?e.push("'"+r+"'"):e.push(r)}return e.join(",")}function b(t){return t.a+t.f}function x(t){var e="normal";return"o"===t.a?e="oblique":"i"===t.a&&(e="italic"),e}function C(t){var e=4,i="n",r=null;return t&&((r=t.match(/(normal|oblique|italic)/i))&&r[1]&&(i=r[1].substr(0,1).toLowerCase()),(r=t.match(/([1-9]00|normal|bold)/i))&&r[1]&&(/bold/i.test(r[1])?e=7:/[1-9]00/.test(r[1])&&(e=parseInt(r[1].substr(0,1),10)))),i+e}function E(t,e){this.c=t,this.f=t.o.document.documentElement,this.h=e,this.a=new y("-"),this.j=!1!==e.events,this.g=!1!==e.classes}function P(t){if(t.g){var e=d(t.f,t.a.c("wf","active")),i=[],r=[t.a.c("wf","loading")];e||i.push(t.a.c("wf","inactive")),p(t.f,i,r)}S(t,"inactive")}function S(t,e,i){t.j&&t.h[e]&&(i?t.h[e](i.c,b(i)):t.h[e]())}function O(){this.c={}}function k(t,e){this.c=t,this.f=e,this.a=a(this.c,"span",{"aria-hidden":"true"},this.f)}function $(t){s(t.c,"body",t.a)}function L(t){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+w(t.c)+";font-style:"+x(t)+";font-weight:"+t.f+"00;"}function T(t,e,i,r,o,n){this.g=t,this.j=e,this.a=r,this.c=i,this.f=o||3e3,this.h=n||void 0}function I(t,e,i,r,o,n,a){this.v=t,this.B=e,this.c=i,this.a=r,this.s=a||"BESbswy",this.f={},this.w=o||3e3,this.u=n||null,this.m=this.j=this.h=this.g=null,this.g=new k(this.c,this.s),this.h=new k(this.c,this.s),this.j=new k(this.c,this.s),this.m=new k(this.c,this.s),t=L(t=new _(this.a.c+",serif",b(this.a))),this.g.a.style.cssText=t,t=L(t=new _(this.a.c+",sans-serif",b(this.a))),this.h.a.style.cssText=t,t=L(t=new _("serif",b(this.a))),this.j.a.style.cssText=t,t=L(t=new _("sans-serif",b(this.a))),this.m.a.style.cssText=t,$(this.g),$(this.h),$(this.j),$(this.m)}y.prototype.c=function(t){for(var e=[],i=0;i<arguments.length;i++)e.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return e.join(this.a)},T.prototype.start=function(){var t=this.c.o.document,e=this,i=r(),o=new Promise((function(o,n){!function a(){var s;r()-i>=e.f?n():t.fonts.load((s=e.a,x(s)+" "+s.f+"00 300px "+w(s.c)),e.h).then((function(t){1<=t.length?o():setTimeout(a,25)}),(function(){n()}))}()})),n=null,a=new Promise((function(t,i){n=setTimeout(i,e.f)}));Promise.race([a,o]).then((function(){n&&(clearTimeout(n),n=null),e.g(e.a)}),(function(){e.j(e.a)}))};var F={D:"serif",C:"sans-serif"},M=null;function A(){if(null===M){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);M=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))}return M}function D(t,e,i){for(var r in F)if(F.hasOwnProperty(r)&&e===t.f[F[r]]&&i===t.f[F[r]])return!0;return!1}function R(t){var e,o=t.g.a.offsetWidth,n=t.h.a.offsetWidth;(e=o===t.f.serif&&n===t.f["sans-serif"])||(e=A()&&D(t,o,n)),e?r()-t.A>=t.w?A()&&D(t,o,n)&&(null===t.u||t.u.hasOwnProperty(t.a.c))?j(t,t.v):j(t,t.B):function(t){setTimeout(i((function(){R(this)}),t),50)}(t):j(t,t.v)}function j(t,e){setTimeout(i((function(){l(this.g.a),l(this.h.a),l(this.j.a),l(this.m.a),e(this.a)}),t),0)}function N(t,e,i){this.c=t,this.a=e,this.f=0,this.m=this.j=!1,this.s=i}I.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=r(),R(this)};var q=null;function V(t){0==--t.f&&t.j&&(t.m?((t=t.a).g&&p(t.f,[t.a.c("wf","active")],[t.a.c("wf","loading"),t.a.c("wf","inactive")]),S(t,"active")):P(t.a))}function B(t){this.j=t,this.a=new O,this.h=0,this.f=this.g=!0}function H(t,e,r,o,n){var a=0==--t.h;(t.f||t.g)&&setTimeout((function(){var t=n||null,s=o||{};if(0===r.length&&a)P(e.a);else{e.f+=r.length,a&&(e.j=a);var l,c=[];for(l=0;l<r.length;l++){var d=r[l],h=s[d.c],u=e.a,m=d;if(u.g&&p(u.f,[u.a.c("wf",m.c,b(m).toString(),"loading")]),S(u,"fontloading",m),u=null,null===q)if(window.FontFace){m=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var f=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);q=m?42<parseInt(m[1],10):!f}else q=!1;u=q?new T(i(e.g,e),i(e.h,e),e.c,d,e.s,h):new I(i(e.g,e),i(e.h,e),e.c,d,e.s,t,h),c.push(u)}for(l=0;l<c.length;l++)c[l].start()}}),0)}function z(t,e){this.c=t,this.a=e}function U(t,e){this.c=t,this.a=e}function W(t,e){this.c=t||Y,this.a=[],this.f=[],this.g=e||""}N.prototype.g=function(t){var e=this.a;e.g&&p(e.f,[e.a.c("wf",t.c,b(t).toString(),"active")],[e.a.c("wf",t.c,b(t).toString(),"loading"),e.a.c("wf",t.c,b(t).toString(),"inactive")]),S(e,"fontactive",t),this.m=!0,V(this)},N.prototype.h=function(t){var e=this.a;if(e.g){var i=d(e.f,e.a.c("wf",t.c,b(t).toString(),"active")),r=[],o=[e.a.c("wf",t.c,b(t).toString(),"loading")];i||r.push(e.a.c("wf",t.c,b(t).toString(),"inactive")),p(e.f,r,o)}S(e,"fontinactive",t),V(this)},B.prototype.load=function(t){this.c=new o(this.j,t.context||this.j),this.g=!1!==t.events,this.f=!1!==t.classes,function(t,e,i){var r=[],o=i.timeout;!function(t){t.g&&p(t.f,[t.a.c("wf","loading")]),S(t,"loading")}(e);r=function(t,e,i){var r,o=[];for(r in e)if(e.hasOwnProperty(r)){var n=t.c[r];n&&o.push(n(e[r],i))}return o}(t.a,i,t.c);var n=new N(t.c,e,o);for(t.h=r.length,e=0,i=r.length;e<i;e++)r[e].load((function(e,i,r){H(t,n,e,i,r)}))}(this,new E(this.c,t),t)},z.prototype.load=function(t){function e(){if(n["__mti_fntLst"+r]){var i,o=n["__mti_fntLst"+r](),a=[];if(o)for(var s=0;s<o.length;s++){var l=o[s].fontfamily;null!=o[s].fontStyle&&null!=o[s].fontWeight?(i=o[s].fontStyle+o[s].fontWeight,a.push(new _(l,i))):a.push(new _(l))}t(a)}else setTimeout((function(){e()}),50)}var i=this,r=i.a.projectId,o=i.a.version;if(r){var n=i.c.o;u(this.c,(i.a.api||"https://fast.fonts.net/jsapi")+"/"+r+".js"+(o?"?v="+o:""),(function(o){o?t([]):(n["__MonotypeConfiguration__"+r]=function(){return i.a},e())})).id="__MonotypeAPIScript__"+r}else t([])},U.prototype.load=function(t){var e,i,r=this.a.urls||[],o=this.a.families||[],n=this.a.testStrings||{},a=new m;for(e=0,i=r.length;e<i;e++)h(this.c,r[e],f(a));var s=[];for(e=0,i=o.length;e<i;e++)if((r=o[e].split(":"))[1])for(var l=r[1].split(","),c=0;c<l.length;c+=1)s.push(new _(r[0],l[c]));else s.push(new _(r[0]));g(a,(function(){t(s,n)}))};var Y="https://fonts.googleapis.com/css";function X(t){this.f=t,this.a=[],this.c={}}var G={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},Q={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},J={i:"i",italic:"i",n:"n",normal:"n"},K=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function Z(t,e){this.c=t,this.a=e}var tt={Arimo:!0,Cousine:!0,Tinos:!0};function et(t,e){this.c=t,this.a=e}function it(t,e){this.c=t,this.f=e,this.a=[]}Z.prototype.load=function(t){var e=new m,i=this.c,r=new W(this.a.api,this.a.text),o=this.a.families;!function(t,e){for(var i=e.length,r=0;r<i;r++){var o=e[r].split(":");3==o.length&&t.f.push(o.pop());var n="";2==o.length&&""!=o[1]&&(n=":"),t.a.push(o.join(n))}}(r,o);var n=new X(o);!function(t){for(var e=t.f.length,i=0;i<e;i++){var r=t.f[i].split(":"),o=r[0].replace(/\+/g," "),n=["n4"];if(2<=r.length){var a;if(a=[],s=r[1])for(var s,l=(s=s.split(",")).length,c=0;c<l;c++){var p;if((p=s[c]).match(/^[\w-]+$/))if(null==(d=K.exec(p.toLowerCase())))p="";else{if(p=null==(p=d[2])||""==p?"n":J[p],null==(d=d[1])||""==d)d="4";else var d=Q[d]||(isNaN(d)?"4":d.substr(0,1));p=[p,d].join("")}else p="";p&&a.push(p)}0<a.length&&(n=a),3==r.length&&(a=[],0<(r=(r=r[2])?r.split(","):a).length&&(r=G[r[0]])&&(t.c[o]=r))}for(t.c[o]||(r=G[o])&&(t.c[o]=r),r=0;r<n.length;r+=1)t.a.push(new _(o,n[r]))}}(n),h(i,function(t){if(0==t.a.length)throw Error("No fonts to load!");if(-1!=t.c.indexOf("kit="))return t.c;for(var e=t.a.length,i=[],r=0;r<e;r++)i.push(t.a[r].replace(/ /g,"+"));return e=t.c+"?family="+i.join("%7C"),0<t.f.length&&(e+="&subset="+t.f.join(",")),0<t.g.length&&(e+="&text="+encodeURIComponent(t.g)),e}(r),f(e)),g(e,(function(){t(n.a,n.c,tt)}))},et.prototype.load=function(t){var e=this.a.id,i=this.c.o;e?u(this.c,(this.a.api||"https://use.typekit.net")+"/"+e+".js",(function(e){if(e)t([]);else if(i.Typekit&&i.Typekit.config&&i.Typekit.config.fn){e=i.Typekit.config.fn;for(var r=[],o=0;o<e.length;o+=2)for(var n=e[o],a=e[o+1],s=0;s<a.length;s++)r.push(new _(n,a[s]));try{i.Typekit.load({events:!1,classes:!1,async:!0})}catch(t){}t(r)}}),2e3):t([])},it.prototype.load=function(t){var e=this.f.id,i=this.c.o,r=this;e?(i.__webfontfontdeckmodule__||(i.__webfontfontdeckmodule__={}),i.__webfontfontdeckmodule__[e]=function(e,i){for(var o=0,n=i.fonts.length;o<n;++o){var a=i.fonts[o];r.a.push(new _(a.name,C("font-weight:"+a.weight+";font-style:"+a.style)))}t(r.a)},u(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function(t){return t.o.location.hostname||t.a.location.hostname}(this.c)+"/"+e+".js",(function(e){e&&t([])}))):t([])};var rt=new B(window);rt.a.c.custom=function(t,e){return new U(e,t)},rt.a.c.fontdeck=function(t,e){return new it(e,t)},rt.a.c.monotype=function(t,e){return new z(e,t)},rt.a.c.typekit=function(t,e){return new et(e,t)},rt.a.c.google=function(t,e){return new Z(e,t)};var ot={load:i(rt.load,rt)};"function"==typeof define&&define.amd?define((function(){return ot})):c?c=ot:(window.WebFont=ot,window.WebFontConfig&&rt.load(window.WebFontConfig))}();class p{static getFont(t){for(let e of this.fonts)if(e.name===t)return e}static addFvd(t,e){return e+=":n4",t.files.italic&&(e+=",i4"),t.files.bold&&(e+=",n7"),t.files.bold_italic&&(e+=",i7"),e}static addGoogleFontStyle(t,e){let i=[];if(t.files.regular&&(t.files.regular_300?i.push("300"):i.push("400")),t.files.italic&&(t.files.italic_300?i.push("300italic"):i.push("italic")),t.files.bold&&i.push("bold"),t.files.bold_italic&&i.push("bolditalic"),i.length)return e+":"+i.join(",")}static loadFontsByName(t){let e=[],i=[];return null==this._loadQueue&&(this._loadQueue=Promise.resolve()),this._loadQueue=this._loadQueue.then((()=>{for(let r of t){let t=this.getFont(r);if(t&&!t.loaded)switch(t.type){case 0:t.loaded=!0;break;case 1:let o=this.addGoogleFontStyle(t,r);-1===i.indexOf(o)&&i.push(o);break;case 2:let n=this.addFvd(t,r);-1===e.indexOf(n)&&e.push(n)}}return e.length>0||i.length>0?this.loadFontsByFamilies(e,i):Promise.resolve(!0)})),this._loadQueue}static loadFontsByFamilies(t,e){return new Promise(((i,r)=>{const o={timeout:3e3};if(t&&t.length){let e=t.map((t=>t.substring(0,t.indexOf(":"))));o.custom={families:t,urls:[this.fontCss(e)]}}e&&e.length&&(o.google={families:e}),o.active=()=>{i()},o.inactive=()=>{i()},o.fontactive=(t,e)=>{let i=p.getFont(t);i?i.loaded=!0:p.fonts.push({name:t,loaded:!0})},o.fontinactive=(t,e)=>{let i=p.getFont(t);a.warn("[live-options] failed to load font",i),i.loaded=!0},c.load(o)}))}static fontPreview(t){let e=i.extend(p.apiParams,{name:t});return p.api+"/preview?"+i.buildQueryParams(e)}static fontCss(t){let e=i.extend(p.apiParams,{names:t.join(",")});return p.api+"/css?"+i.buildQueryParams(e)}}p.fonts=[],p.api="",p.apiParams={};var d=p;class h{static getInstance(t){return h._instance||(h._instance=new h(t)),h._instance}fakeProduct(t){this.isProduct=()=>!0,this.getHandleFromUrl=()=>t}isAdmin(){return null!=document.getElementById("admin_bar_iframe")}isProduct(){return-1!==window.location.pathname.indexOf("/products/")||this.isProductPreview()}isProductPreview(){return-1!==window.location.pathname.indexOf("/products_preview")}getDiscountUrl(t,e){return"/discount/"+t+(e?"?redirect="+e:"")}getDiscountCode(){return i.readCookie("discount_code")}saveDiscountCode(t){return i.writeCookie("discount_code",t,null,"/")}removeDiscountCode(){return i.removeCookie("discount_code")}getCustomerId(){return window.theme&&window.theme.customerId?window.theme.customerId:window.meta&&window.meta.page&&window.meta.page.customerId?window.meta.page.customerId:window.ShopifyAnalytics&&window.ShopifyAnalytics.meta&&window.ShopifyAnalytics.meta.page&&window.ShopifyAnalytics.meta.page.customerId?window.ShopifyAnalytics.meta.page.customerId:null}getHandleFromUrl(t=location.pathname){window.Shopify&&window.Shopify.routes&&window.Shopify.routes.root&&"/"!==window.Shopify.routes.root&&(t=t.replace(window.Shopify.routes.root,"/"));let e=t.replace(/\/$/,"").split("/"),i=("products"==e[e.length-2]||"products_preview"===e.pop())&&e[e.length-1].replace(/(.*)?\?.*$/,"$1");return decodeURIComponent(i)}tryGetProduct(){return this.isProduct()?this.getProduct():new Promise(((t,e)=>{t(null)}))}tryGetProductMap(){return this.isProduct()?this.getProduct().then((t=>h.products)):new Promise(((t,e)=>{t(h.products)}))}parseProductJsonElements(){let t=document.querySelectorAll('[id^="ProductJson-"]');if(0===t.length&&(t=document.querySelectorAll('[data-product-json], [data-section-type="dynamic-featured-product"]')),t.length>0)for(let e=0;e<t.length;e++){let i=t[e];try{let t=JSON.parse(i.innerHTML);"object"==typeof t.product&&(t=t.product),t.handle&&(h.products[t.handle+".js"]=this.convertProductJson(t))}catch(t){a.debug("error parsing ProductJson: ",i,t)}}}convertProductJson(t){if(t.options&&t.options.length&&"object"!=typeof t.options[0]){let e=[];for(let i=0;i<t.options.length;i++){let r={name:t.options[i],position:i+1,values:[]};for(let e=0;e<t.variants.length;e++){let i=t.variants[e]["option"+r.position];i&&-1===r.values.indexOf(i)&&r.values.push(i)}e.push(r)}t.options=e}return t}getProduct(t,e="js"){if(!t&&!(t=this.getHandleFromUrl())&&this.isProductPreview())for(const t in h.products)if(h.products.hasOwnProperty(t))return new Promise(((e,i)=>{e(h.products[t])}));let i,r=t+"."+e;return h.products[r]?new Promise(((t,e)=>{t(h.products[r])})):(t?i=this.settings.api+this.settings.path.products.replace("{handle}",t).replace("{view}",e):this.isProductPreview()&&(i=window.location.href.replace("products_preview","products_preview."+e)),new n(i,{method:"GET",responseType:"json"}).then((t=>{let i=t.data;return"json"===e&&(i=t.data.product),h.products[r]=i,i})).catch((t=>{throw t})))}isTheme(t){if(window.Shopify&&window.Shopify.theme){const e=window.Shopify.theme.theme_store_id;if("Dawn"===t&&(887===e||1368===e||1363===e||1356===e||1431===e||1434===e||1499===e||1500===e||1567===e))return!0;if("Expanse"===t&&902===e)return!0;if(window.Shopify.theme.name&&-1!==window.Shopify.theme.name.toLowerCase().indexOf(t.toLowerCase()))return!0}return!1}isThemeEditor(){return window.Shopify&&window.Shopify.designMode}onThemeSectionEvent(t,e){return document.addEventListener("shopify:section:"+t,e)}findProductForms(t=document){return t.querySelectorAll('form[action*="/cart/add"]')}findProductFormBestMatch(t,e){let i="#product_form_"+t,r=document.querySelector(i);if(r&&null!=r.querySelector("shopify-payment-terms")&&(r=null),!r){let i=null;if(e&&e.srcEl){let t=e.srcEl.parentNode;for(;t;){if(i=this.findProductForms(t),i.length){e.parentEl=t;break}t=t.parentNode}}if(null!=i&&0!==i.length||(i=this.findProductForms()),1===i.length)return i[0];if(i.length>1)for(let e=0;e<i.length;e++){let o=i[e].getAttribute("id");if((!o||-1===o.indexOf("installment")&&-1===o.indexOf("instalment"))&&null==i[e].querySelector("shopify-payment-terms")&&(r=i[e],r.dataset.productForm===t.toString()))return r}}return r}findProductFormVariantId(t){if(null!=t){let e=t.querySelector('[name=id], [name="id[]"]');if(null!=e&&e.value)return e.value}return null}findProductFormQuantity(t,e){if(null!=t){let i=t.querySelector("[name=quantity]")||(e?e.querySelector("[name=quantity]"):null);if(null!=i)return parseInt(i.value)}return 1}getFormProperties(t){const e=new FormData(t);return Array.from(e.keys()).reduce(((t,i)=>{if(-1!==i.indexOf("properties")){let r=i.indexOf("["),o=i.indexOf("]");if(-1!==r&&-1!==o){let n=i.substring(r+1,o);if(t.hasOwnProperty(n)){let r=e.getAll(i);t[n]=r[r.length-1]}else t[n]=e.get(i)}}return t}),{})}findExpressPaymentButtons(t=document){return t.querySelectorAll('.shopify-payment-button, [data-shopify="payment-button"]')}findExpressDynamicCheckoutCart(t=document){return t.querySelectorAll('#dynamic-checkout-cart, [data-shopify="dynamic-checkout-cart"]')}isExpressPaymentButton(t){return i.matchesIncludeParent(t,'.shopify-payment-button, [data-shopify="payment-button"]')}onProductFormSubmit(t,e,r,o,n=["[data-live-validate]"]){const s="[type=submit],.add_to_cart,.add-to-cart,.product-addToCart,.addToCart,.addtocart-js";let l=e.querySelectorAll(n.join(","));if(l.length&&(o=!1),!o){t.addEventListener("submit",r);let e=t.querySelectorAll(s);for(let t=0;t<e.length;t++){e[t].addEventListener("click",r)}let i=e.length,o=this.findExpressPaymentButtons(t);for(let t=0;t<o.length;t++){o[t].addEventListener("click",r,{capture:!0})}for(let t=0;t<l.length;t++){l[t].addEventListener("click",r,{capture:!0}),i=!0}return i||a.warn("[live-options] failed to find add to cart button"),i}{const t=s+',.shopify-payment-button, [data-shopify="payment-button"]';e.addEventListener("click",(e=>{e.target&&i.matchesIncludeParent(e.target,t)&&r(e)}),{capture:!0})}}onCartFormSubmit(t,e,r=["[data-live-checkout]"]){let o='form[action="/cart"], form[action$="/cart"], form[action*="/cart?"], form[action="/checkout"], form[action$="/checkout"], form[action*="/checkout?"]';if(r.push('a[href="/checkout"], a[href$="/checkout"], a[href*="/checkout?"], button[onclick*="/checkout"]'),e){document.addEventListener("submit",(e=>{e.target&&i.matches(e.target,o)&&t(e)}),{capture:!0});const e=r.join(",");document.addEventListener("click",(r=>{r.target&&(i.matches(r.target,e)||null!=i.findParent(r.target,e))&&t(r)}),{capture:!0})}else{let e=document.querySelectorAll(o);if(e.length)for(let i=0;i<e.length;i++){e[i].addEventListener("submit",(e=>{t(e)}))}let i=document.querySelectorAll(r.join(","));for(let e=0;e<i.length;e++){i[e].addEventListener("click",t,{capture:!0})}}}trimMoneyFormatAmount(t){let e=t.indexOf("{"),i=t.lastIndexOf("}");return-1!==e&&-1!==i&&(t=t.substring(e,i+1)),t.trim()}parseImageDimension(t){let e={x:0,y:0},i=/(\d*)x(\d*)/.exec(t);return i&&3===i.length&&(e.x=parseInt(i[1]),e.y=i[2]?parseInt(i[2]):e.x),e}stripImageDimension(t){let e=(t=t.replace(/_(\d*)x(\d*)/g,"")).lastIndexOf("@");-1!==e&&(t=t.substring(0,e));let i=t.lastIndexOf(".progressive");return-1!==i&&(t=t.substring(0,i)),t}constructor(t){this.settings=i.extend({api:"",path:{products:"/products/{handle}.{view}"}},t||{})}}h.products={},h.collections={};var u=h;class m{static getInstance(t){return m._instance||(m._instance=new m(t)),m._instance}getCart(t=!1){return t&&this.cache?Promise.resolve(this.cache):this._cart().then((t=>(this.cache=t,t)))}getItemLine(t,e){for(let i=0;i<t.items.length;i++){const r=t.items[i];if(e.key===r.key)return i+1}return-1}toItem(t,e,i){return{id:t,quantity:e,properties:i}}addItem(t){return this._cartAdd(t)}addItems(t){return this._cartAdd({items:t}).then((t=>t.items))}removeItem(t){return this.updateItem(t,this.toItem(null,0))}removeItemById(t){return this.updateItemById(this.toItem(t,0))}updateItem(t,e){return this._cartChange({line:t,quantity:e.quantity,properties:e.properties})}updateItemById(t){return this._cartChange(t)}updateItemQuantitiesById(t){return this._cartUpdate({updates:t})}setNote(t){return this._cartUpdate({note:t})}setAttributes(t){return this._cartUpdate({attributes:t})}clear(){return this._cartClear()}_cart(){return this._cartRequest("/cart.js",{method:"GET"})}_cartAdd(t){return this._cartRequest("/cart/add.js",{method:"POST",data:t})}_cartUpdate(t){return this._cartRequest("/cart/update.js",{method:"POST",data:t})}_cartChange(t){return this._cartRequest("/cart/change.js",{method:"POST",data:t})}_cartClear(){return this._cartRequest("/cart/clear.js",{method:"POST"})}_cartRequest(t,e){let r=i.extend(this.settings.requestOptions,e),o=this.settings.api+t;return new n(o,r).then((t=>(a.debug("[shopify-cart] "+o+" response",t.data),t.data))).catch((t=>{throw a.error("[shopify-cart] "+o+" error",t),t.data}))}constructor(t){this.cache=null,this.settings=i.extend({api:"",requestOptions:{responseType:"json",headers:{"Content-type":"application/json"}}},t||{})}}var f=m;class g{static register(t){return this.listeners.push(t),this.patched||this._patch(),()=>{let e=this.listeners.indexOf(t);-1!==e&&this.listeners.splice(e,1),0===this.listeners.length&&this._unpatch()}}static _callListeners(t){for(let e=0;e<g.listeners.length;e++){(0,g.listeners[e])(t)}}static _patch(){g.originalOpen=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(){let t=arguments[0],e=arguments[1];this.addEventListener("readystatechange",(function(){4==this.readyState&&200==this.status&&g._callListeners({method:t,url:e})}),!1),g.originalOpen.apply(this,arguments)},"function"==typeof window.fetch&&(g.originalFetch=window.fetch,window.fetch=function(){let t=arguments[0],e=void 0!==arguments[1]?arguments[1].method:"GET",i=g.originalFetch.apply(this,arguments);return i.then((()=>{"object"==typeof t&&t.pathname&&(t=t.pathname+t.search),g._callListeners({method:e,url:t})})),i}),this.patched=!0}static _unpatch(){g.originalOpen&&(XMLHttpRequest.prototype.open=g.originalOpen),g.originalFetch&&(window.fetch=g.originalFetch),this.patched=!1}}g.patched=!1,g.listeners=[];var v=g;
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const y=new WeakMap,_=t=>(...e)=>{const i=t(...e);return y.set(i,!0),i},w=t=>"function"==typeof t&&y.has(t),b="undefined"!=typeof window&&null!=window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,x=(t,e,i=null,r=null)=>{for(;e!==i;){const i=e.nextSibling;t.insertBefore(e,r),e=i}},C=(t,e,i=null)=>{for(;e!==i;){const i=e.nextSibling;t.removeChild(e),e=i}},E={},P={},S=`{{lit-${String(Math.random()).slice(2)}}}`,O=`\x3c!--${S}--\x3e`,k=new RegExp(`${S}|${O}`),$="$lit$";class L{constructor(t,e){this.parts=[],this.element=e;const i=[],r=[],o=document.createTreeWalker(e.content,133,null,!1);let n=0,a=-1,s=0;const{strings:l,values:{length:c}}=t;for(;s<c;){const t=o.nextNode();if(null!==t){if(a++,1===t.nodeType){if(t.hasAttributes()){const e=t.attributes,{length:i}=e;let r=0;for(let t=0;t<i;t++)T(e[t].name,$)&&r++;for(;r-- >0;){const e=l[s],i=M.exec(e)[2],r=i.toLowerCase()+$,o=t.getAttribute(r);t.removeAttribute(r);const n=o.split(k);this.parts.push({type:"attribute",index:a,name:i,strings:n}),s+=n.length-1}}"TEMPLATE"===t.tagName&&(r.push(t),o.currentNode=t.content)}else if(3===t.nodeType){const e=t.data;if(e.indexOf(S)>=0){const r=t.parentNode,o=e.split(k),n=o.length-1;for(let e=0;e<n;e++){let i,n=o[e];if(""===n)i=F();else{const t=M.exec(n);null!==t&&T(t[2],$)&&(n=n.slice(0,t.index)+t[1]+t[2].slice(0,-$.length)+t[3]),i=document.createTextNode(n)}r.insertBefore(i,t),this.parts.push({type:"node",index:++a})}""===o[n]?(r.insertBefore(F(),t),i.push(t)):t.data=o[n],s+=n}}else if(8===t.nodeType)if(t.data===S){const e=t.parentNode;null!==t.previousSibling&&a!==n||(a++,e.insertBefore(F(),t)),n=a,this.parts.push({type:"node",index:a}),null===t.nextSibling?t.data="":(i.push(t),a--),s++}else{let e=-1;for(;-1!==(e=t.data.indexOf(S,e+1));)this.parts.push({type:"node",index:-1}),s++}}else o.currentNode=r.pop()}for(const t of i)t.parentNode.removeChild(t)}}const T=(t,e)=>{const i=t.length-e.length;return i>=0&&t.slice(i)===e},I=t=>-1!==t.index,F=()=>document.createComment(""),M=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;class A{update(t){let e=0;for(const i of this.__parts)void 0!==i&&i.setValue(t[e]),e++;for(const t of this.__parts)void 0!==t&&t.commit()}_clone(){const t=b?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),e=[],i=this.template.parts,r=document.createTreeWalker(t,133,null,!1);let o,n=0,a=0,s=r.nextNode();for(;n<i.length;)if(o=i[n],I(o)){for(;a<o.index;)a++,"TEMPLATE"===s.nodeName&&(e.push(s),r.currentNode=s.content),null===(s=r.nextNode())&&(r.currentNode=e.pop(),s=r.nextNode());if("node"===o.type){const t=this.processor.handleTextExpression(this.options);t.insertAfterNode(s.previousSibling),this.__parts.push(t)}else this.__parts.push(...this.processor.handleAttributeExpressions(s,o.name,o.strings,this.options));n++}else this.__parts.push(void 0),n++;return b&&(document.adoptNode(t),customElements.upgrade(t)),t}constructor(t,e,i){this.__parts=[],this.template=t,this.processor=e,this.options=i}}const D=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:t=>t}),R=` ${S} `;class j{getHTML(){const t=this.strings.length-1;let e="",i=!1;for(let r=0;r<t;r++){const t=this.strings[r],o=t.lastIndexOf("\x3c!--");i=(o>-1||i)&&-1===t.indexOf("--\x3e",o+1);const n=M.exec(t);e+=null===n?t+(i?R:O):t.substr(0,n.index)+n[1]+n[2]+$+n[3]+S}return e+=this.strings[t],e}getTemplateElement(){const t=document.createElement("template");let e=this.getHTML();return void 0!==D&&(e=D.createHTML(e)),t.innerHTML=e,t}constructor(t,e,i,r){this.strings=t,this.values=e,this.type=i,this.processor=r}}const N=t=>null===t||!("object"==typeof t||"function"==typeof t),q=t=>Array.isArray(t)||!(!t||!t[Symbol.iterator]);class V{_createPart(){return new B(this)}_getValue(){const t=this.strings,e=t.length-1,i=this.parts;if(1===e&&""===t[0]&&""===t[1]){const t=i[0].value;if("symbol"==typeof t)return String(t);if("string"==typeof t||!q(t))return t}let r="";for(let o=0;o<e;o++){r+=t[o];const e=i[o];if(void 0!==e){const t=e.value;if(N(t)||!q(t))r+="string"==typeof t?t:String(t);else for(const e of t)r+="string"==typeof e?e:String(e)}}return r+=t[e],r}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}constructor(t,e,i){this.dirty=!0,this.element=t,this.name=e,this.strings=i,this.parts=[];for(let t=0;t<i.length-1;t++)this.parts[t]=this._createPart()}}class B{setValue(t){t===E||N(t)&&t===this.value||(this.value=t,w(t)||(this.committer.dirty=!0))}commit(){for(;w(this.value);){const t=this.value;this.value=E,t(this)}this.value!==E&&this.committer.commit()}constructor(t){this.value=void 0,this.committer=t}}class H{appendInto(t){this.startNode=t.appendChild(F()),this.endNode=t.appendChild(F())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=F()),t.__insert(this.endNode=F())}insertAfterPart(t){t.__insert(this.startNode=F()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){if(null===this.startNode.parentNode)return;for(;w(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=E,t(this)}const t=this.__pendingValue;t!==E&&(N(t)?t!==this.value&&this.__commitText(t):t instanceof j?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):q(t)?this.__commitIterable(t):t===P?(this.value=P,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){const e=this.startNode.nextSibling,i="string"==typeof(t=null==t?"":t)?t:String(t);e===this.endNode.previousSibling&&3===e.nodeType?e.data=i:this.__commitNode(document.createTextNode(i)),this.value=t}__commitTemplateResult(t){const e=this.options.templateFactory(t);if(this.value instanceof A&&this.value.template===e)this.value.update(t.values);else{const i=new A(e,t.processor,this.options),r=i._clone();i.update(t.values),this.__commitNode(r),this.value=i}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());const e=this.value;let i,r=0;for(const o of t)i=e[r],void 0===i&&(i=new H(this.options),e.push(i),0===r?i.appendIntoPart(this):i.insertAfterPart(e[r-1])),i.setValue(o),i.commit(),r++;r<e.length&&(e.length=r,this.clear(i&&i.endNode))}clear(t=this.startNode){C(this.startNode.parentNode,t.nextSibling,this.endNode)}constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}}class z{setValue(t){this.__pendingValue=t}commit(){for(;w(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=E,t(this)}if(this.__pendingValue===E)return;const t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=E}constructor(t,e,i){if(this.value=void 0,this.__pendingValue=void 0,2!==i.length||""!==i[0]||""!==i[1])throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=e,this.strings=i}}class U extends V{_createPart(){return new W(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}constructor(t,e,i){super(t,e,i),this.single=2===i.length&&""===i[0]&&""===i[1]}}class W extends B{}let Y=!1;(()=>{try{const t={get capture(){return Y=!0,!1}};window.addEventListener("test",t,t),window.removeEventListener("test",t,t)}catch(t){}})();class X{setValue(t){this.__pendingValue=t}commit(){for(;w(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=E,t(this)}if(this.__pendingValue===E)return;const t=this.__pendingValue,e=this.value,i=null==t||null!=e&&(t.capture!==e.capture||t.once!==e.once||t.passive!==e.passive),r=null!=t&&(null==e||i);i&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),r&&(this.__options=G(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=E}handleEvent(t){"function"==typeof this.value?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}constructor(t,e,i){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=e,this.eventContext=i,this.__boundHandleEvent=t=>this.handleEvent(t)}}const G=t=>t&&(Y?{capture:t.capture,passive:t.passive,once:t.once}:t.capture);const Q=new class{handleAttributeExpressions(t,e,i,r){const o=e[0];if("."===o){return new U(t,e.slice(1),i).parts}if("@"===o)return[new X(t,e.slice(1),r.eventContext)];if("?"===o)return[new z(t,e.slice(1),i)];return new V(t,e,i).parts}handleTextExpression(t){return new H(t)}};function J(t){let e=K.get(t.type);void 0===e&&(e={stringsArray:new WeakMap,keyString:new Map},K.set(t.type,e));let i=e.stringsArray.get(t.strings);if(void 0!==i)return i;const r=t.strings.join(S);return i=e.keyString.get(r),void 0===i&&(i=new L(t,t.getTemplateElement()),e.keyString.set(r,i)),e.stringsArray.set(t.strings,i),i}const K=new Map,Z=new WeakMap,tt=(t,e,i)=>{let r=Z.get(e);void 0===r&&(C(e,e.firstChild),Z.set(e,r=new H(Object.assign({templateFactory:J},i))),r.appendInto(e)),r.setValue(t),r.commit()};"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.3.0");const et=(t,...e)=>new j(t,e,"html",Q);function it(t){var e=t.getBoundingClientRect();return{width:e.width,height:e.height,top:e.top,right:e.right,bottom:e.bottom,left:e.left,x:e.left,y:e.top}}function rt(t){if("[object Window]"!==t.toString()){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function ot(t){var e=rt(t);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function nt(t){return t instanceof rt(t).Element||t instanceof Element}function at(t){return t instanceof rt(t).HTMLElement||t instanceof HTMLElement}function st(t){return t?(t.nodeName||"").toLowerCase():null}function lt(t){return((nt(t)?t.ownerDocument:t.document)||window.document).documentElement}function ct(t){return it(lt(t)).left+ot(t).scrollLeft}function pt(t){return rt(t).getComputedStyle(t)}function dt(t){var e=pt(t),i=e.overflow,r=e.overflowX,o=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+o+r)}function ht(t,e,i){void 0===i&&(i=!1);var r,o,n=lt(e),a=it(t),s=at(e),l={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(s||!s&&!i)&&(("body"!==st(e)||dt(n))&&(l=(r=e)!==rt(r)&&at(r)?{scrollLeft:(o=r).scrollLeft,scrollTop:o.scrollTop}:ot(r)),at(e)?((c=it(e)).x+=e.clientLeft,c.y+=e.clientTop):n&&(c.x=ct(n))),{x:a.left+l.scrollLeft-c.x,y:a.top+l.scrollTop-c.y,width:a.width,height:a.height}}function ut(t){return{x:t.offsetLeft,y:t.offsetTop,width:t.offsetWidth,height:t.offsetHeight}}function mt(t){return"html"===st(t)?t:t.assignedSlot||t.parentNode||t.host||lt(t)}function ft(t){return["html","body","#document"].indexOf(st(t))>=0?t.ownerDocument.body:at(t)&&dt(t)?t:ft(mt(t))}function gt(t,e){void 0===e&&(e=[]);var i=ft(t),r="body"===st(i),o=rt(i),n=r?[o].concat(o.visualViewport||[],dt(i)?i:[]):i,a=e.concat(n);return r?a:a.concat(gt(mt(n)))}function vt(t){return["table","td","th"].indexOf(st(t))>=0}function yt(t){if(!at(t)||"fixed"===pt(t).position)return null;var e=t.offsetParent;if(e){var i=lt(e);if("body"===st(e)&&"static"===pt(e).position&&"static"!==pt(i).position)return i}return e}function _t(t){for(var e=rt(t),i=yt(t);i&&vt(i)&&"static"===pt(i).position;)i=yt(i);return i&&"body"===st(i)&&"static"===pt(i).position?e:i||function(t){for(var e=mt(t);at(e)&&["html","body"].indexOf(st(e))<0;){var i=pt(e);if("none"!==i.transform||"none"!==i.perspective||i.willChange&&"auto"!==i.willChange)return e;e=e.parentNode}return null}(t)||e}var wt="top",bt="bottom",xt="right",Ct="left",Et="auto",Pt=[wt,bt,xt,Ct],St="start",Ot="end",kt="viewport",$t="popper",Lt=Pt.reduce((function(t,e){return t.concat([e+"-"+St,e+"-"+Ot])}),[]),Tt=[].concat(Pt,[Et]).reduce((function(t,e){return t.concat([e,e+"-"+St,e+"-"+Ot])}),[]),It=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function Ft(t){var e=new Map,i=new Set,r=[];function o(t){i.add(t.name),[].concat(t.requires||[],t.requiresIfExists||[]).forEach((function(t){if(!i.has(t)){var r=e.get(t);r&&o(r)}})),r.push(t)}return t.forEach((function(t){e.set(t.name,t)})),t.forEach((function(t){i.has(t.name)||o(t)})),r}var Mt={placement:"bottom",modifiers:[],strategy:"absolute"};function At(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some((function(t){return!(t&&"function"==typeof t.getBoundingClientRect)}))}function Dt(t){void 0===t&&(t={});var e=t,i=e.defaultModifiers,r=void 0===i?[]:i,o=e.defaultOptions,n=void 0===o?Mt:o;return function(t,e,i){void 0===i&&(i=n);var o,a,s={placement:"bottom",orderedModifiers:[],options:Object.assign(Object.assign({},Mt),n),modifiersData:{},elements:{reference:t,popper:e},attributes:{},styles:{}},l=[],c=!1,p={state:s,setOptions:function(i){d(),s.options=Object.assign(Object.assign(Object.assign({},n),s.options),i),s.scrollParents={reference:nt(t)?gt(t):t.contextElement?gt(t.contextElement):[],popper:gt(e)};var o=function(t){var e=Ft(t);return It.reduce((function(t,i){return t.concat(e.filter((function(t){return t.phase===i})))}),[])}(function(t){var e=t.reduce((function(t,e){var i=t[e.name];return t[e.name]=i?Object.assign(Object.assign(Object.assign({},i),e),{},{options:Object.assign(Object.assign({},i.options),e.options),data:Object.assign(Object.assign({},i.data),e.data)}):e,t}),{});return Object.keys(e).map((function(t){return e[t]}))}([].concat(r,s.options.modifiers)));return s.orderedModifiers=o.filter((function(t){return t.enabled})),s.orderedModifiers.forEach((function(t){var e=t.name,i=t.options,r=void 0===i?{}:i,o=t.effect;if("function"==typeof o){var n=o({state:s,name:e,instance:p,options:r}),a=function(){};l.push(n||a)}})),p.update()},forceUpdate:function(){if(!c){var t=s.elements,e=t.reference,i=t.popper;if(At(e,i)){s.rects={reference:ht(e,_t(i),"fixed"===s.options.strategy),popper:ut(i)},s.reset=!1,s.placement=s.options.placement,s.orderedModifiers.forEach((function(t){return s.modifiersData[t.name]=Object.assign({},t.data)}));for(var r=0;r<s.orderedModifiers.length;r++)if(!0!==s.reset){var o=s.orderedModifiers[r],n=o.fn,a=o.options,l=void 0===a?{}:a,d=o.name;"function"==typeof n&&(s=n({state:s,options:l,name:d,instance:p})||s)}else s.reset=!1,r=-1}}},update:(o=function(){return new Promise((function(t){p.forceUpdate(),t(s)}))},function(){return a||(a=new Promise((function(t){Promise.resolve().then((function(){a=void 0,t(o())}))}))),a}),destroy:function(){d(),c=!0}};if(!At(t,e))return p;function d(){l.forEach((function(t){return t()})),l=[]}return p.setOptions(i).then((function(t){!c&&i.onFirstUpdate&&i.onFirstUpdate(t)})),p}}var Rt={passive:!0};function jt(t){return t.split("-")[0]}function Nt(t){return t.split("-")[1]}function qt(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function Vt(t){var e,i=t.reference,r=t.element,o=t.placement,n=o?jt(o):null,a=o?Nt(o):null,s=i.x+i.width/2-r.width/2,l=i.y+i.height/2-r.height/2;switch(n){case wt:e={x:s,y:i.y-r.height};break;case bt:e={x:s,y:i.y+i.height};break;case xt:e={x:i.x+i.width,y:l};break;case Ct:e={x:i.x-r.width,y:l};break;default:e={x:i.x,y:i.y}}var c=n?qt(n):null;if(null!=c){var p="y"===c?"height":"width";switch(a){case St:e[c]=e[c]-(i[p]/2-r[p]/2);break;case Ot:e[c]=e[c]+(i[p]/2-r[p]/2)}}return e}var Bt={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Ht(t){var e,i=t.popper,r=t.popperRect,o=t.placement,n=t.offsets,a=t.position,s=t.gpuAcceleration,l=t.adaptive,c=t.roundOffsets?function(t){var e=t.x,i=t.y,r=window.devicePixelRatio||1;return{x:Math.round(e*r)/r||0,y:Math.round(i*r)/r||0}}(n):n,p=c.x,d=void 0===p?0:p,h=c.y,u=void 0===h?0:h,m=n.hasOwnProperty("x"),f=n.hasOwnProperty("y"),g=Ct,v=wt,y=window;if(l){var _=_t(i);_===rt(i)&&(_=lt(i)),o===wt&&(v=bt,u-=_.clientHeight-r.height,u*=s?1:-1),o===Ct&&(g=xt,d-=_.clientWidth-r.width,d*=s?1:-1)}var w,b=Object.assign({position:a},l&&Bt);return s?Object.assign(Object.assign({},b),{},((w={})[v]=f?"0":"",w[g]=m?"0":"",w.transform=(y.devicePixelRatio||1)<2?"translate("+d+"px, "+u+"px)":"translate3d("+d+"px, "+u+"px, 0)",w)):Object.assign(Object.assign({},b),{},((e={})[v]=f?u+"px":"",e[g]=m?d+"px":"",e.transform="",e))}var zt={left:"right",right:"left",bottom:"top",top:"bottom"};function Ut(t){return t.replace(/left|right|bottom|top/g,(function(t){return zt[t]}))}var Wt={start:"end",end:"start"};function Yt(t){return t.replace(/start|end/g,(function(t){return Wt[t]}))}function Xt(t,e){var i,r=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(r&&((i=r)instanceof rt(i).ShadowRoot||i instanceof ShadowRoot)){var o=e;do{if(o&&t.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function Gt(t){return Object.assign(Object.assign({},t),{},{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function Qt(t,e){return e===kt?Gt(function(t){var e=rt(t),i=lt(t),r=e.visualViewport,o=i.clientWidth,n=i.clientHeight,a=0,s=0;return r&&(o=r.width,n=r.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(a=r.offsetLeft,s=r.offsetTop)),{width:o,height:n,x:a+ct(t),y:s}}(t)):at(e)?function(t){var e=it(t);return e.top=e.top+t.clientTop,e.left=e.left+t.clientLeft,e.bottom=e.top+t.clientHeight,e.right=e.left+t.clientWidth,e.width=t.clientWidth,e.height=t.clientHeight,e.x=e.left,e.y=e.top,e}(e):Gt(function(t){var e=lt(t),i=ot(t),r=t.ownerDocument.body,o=Math.max(e.scrollWidth,e.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),n=Math.max(e.scrollHeight,e.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),a=-i.scrollLeft+ct(t),s=-i.scrollTop;return"rtl"===pt(r||e).direction&&(a+=Math.max(e.clientWidth,r?r.clientWidth:0)-o),{width:o,height:n,x:a,y:s}}(lt(t)))}function Jt(t,e,i){var r="clippingParents"===e?function(t){var e=gt(mt(t)),i=["absolute","fixed"].indexOf(pt(t).position)>=0&&at(t)?_t(t):t;return nt(i)?e.filter((function(t){return nt(t)&&Xt(t,i)&&"body"!==st(t)})):[]}(t):[].concat(e),o=[].concat(r,[i]),n=o[0],a=o.reduce((function(e,i){var r=Qt(t,i);return e.top=Math.max(r.top,e.top),e.right=Math.min(r.right,e.right),e.bottom=Math.min(r.bottom,e.bottom),e.left=Math.max(r.left,e.left),e}),Qt(t,n));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function Kt(t){return Object.assign(Object.assign({},{top:0,right:0,bottom:0,left:0}),t)}function Zt(t,e){return e.reduce((function(e,i){return e[i]=t,e}),{})}function te(t,e){void 0===e&&(e={});var i=e,r=i.placement,o=void 0===r?t.placement:r,n=i.boundary,a=void 0===n?"clippingParents":n,s=i.rootBoundary,l=void 0===s?kt:s,c=i.elementContext,p=void 0===c?$t:c,d=i.altBoundary,h=void 0!==d&&d,u=i.padding,m=void 0===u?0:u,f=Kt("number"!=typeof m?m:Zt(m,Pt)),g=p===$t?"reference":$t,v=t.elements.reference,y=t.rects.popper,_=t.elements[h?g:p],w=Jt(nt(_)?_:_.contextElement||lt(t.elements.popper),a,l),b=it(v),x=Vt({reference:b,element:y,strategy:"absolute",placement:o}),C=Gt(Object.assign(Object.assign({},y),x)),E=p===$t?C:b,P={top:w.top-E.top+f.top,bottom:E.bottom-w.bottom+f.bottom,left:w.left-E.left+f.left,right:E.right-w.right+f.right},S=t.modifiersData.offset;if(p===$t&&S){var O=S[o];Object.keys(P).forEach((function(t){var e=[xt,bt].indexOf(t)>=0?1:-1,i=[wt,bt].indexOf(t)>=0?"y":"x";P[t]+=O[i]*e}))}return P}function ee(t,e,i){return Math.max(t,Math.min(e,i))}function ie(t,e,i){return void 0===i&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function re(t){return[wt,xt,bt,Ct].some((function(e){return t[e]>=0}))}var oe=Dt({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(t){var e=t.state,i=t.instance,r=t.options,o=r.scroll,n=void 0===o||o,a=r.resize,s=void 0===a||a,l=rt(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return n&&c.forEach((function(t){t.addEventListener("scroll",i.update,Rt)})),s&&l.addEventListener("resize",i.update,Rt),function(){n&&c.forEach((function(t){t.removeEventListener("scroll",i.update,Rt)})),s&&l.removeEventListener("resize",i.update,Rt)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(t){var e=t.state,i=t.name;e.modifiersData[i]=Vt({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(t){var e=t.state,i=t.options,r=i.gpuAcceleration,o=void 0===r||r,n=i.adaptive,a=void 0===n||n,s=i.roundOffsets,l=void 0===s||s,c={placement:jt(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:o};null!=e.modifiersData.popperOffsets&&(e.styles.popper=Object.assign(Object.assign({},e.styles.popper),Ht(Object.assign(Object.assign({},c),{},{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:a,roundOffsets:l})))),null!=e.modifiersData.arrow&&(e.styles.arrow=Object.assign(Object.assign({},e.styles.arrow),Ht(Object.assign(Object.assign({},c),{},{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign(Object.assign({},e.attributes.popper),{},{"data-popper-placement":e.placement})},data:{}},{name:"applyStyles",enabled:!0,phase:"write",fn:function(t){var e=t.state;Object.keys(e.elements).forEach((function(t){var i=e.styles[t]||{},r=e.attributes[t]||{},o=e.elements[t];at(o)&&st(o)&&(Object.assign(o.style,i),Object.keys(r).forEach((function(t){var e=r[t];!1===e?o.removeAttribute(t):o.setAttribute(t,!0===e?"":e)})))}))},effect:function(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach((function(t){var r=e.elements[t],o=e.attributes[t]||{},n=Object.keys(e.styles.hasOwnProperty(t)?e.styles[t]:i[t]).reduce((function(t,e){return t[e]="",t}),{});at(r)&&st(r)&&(Object.assign(r.style,n),Object.keys(o).forEach((function(t){r.removeAttribute(t)})))}))}},requires:["computeStyles"]},{name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(t){var e=t.state,i=t.options,r=t.name,o=i.offset,n=void 0===o?[0,0]:o,a=Tt.reduce((function(t,i){return t[i]=function(t,e,i){var r=jt(t),o=[Ct,wt].indexOf(r)>=0?-1:1,n="function"==typeof i?i(Object.assign(Object.assign({},e),{},{placement:t})):i,a=n[0],s=n[1];return a=a||0,s=(s||0)*o,[Ct,xt].indexOf(r)>=0?{x:s,y:a}:{x:a,y:s}}(i,e.rects,n),t}),{}),s=a[e.placement],l=s.x,c=s.y;null!=e.modifiersData.popperOffsets&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[r]=a}},{name:"flip",enabled:!0,phase:"main",fn:function(t){var e=t.state,i=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var o=i.mainAxis,n=void 0===o||o,a=i.altAxis,s=void 0===a||a,l=i.fallbackPlacements,c=i.padding,p=i.boundary,d=i.rootBoundary,h=i.altBoundary,u=i.flipVariations,m=void 0===u||u,f=i.allowedAutoPlacements,g=e.options.placement,v=jt(g),y=l||(v===g||!m?[Ut(g)]:function(t){if(jt(t)===Et)return[];var e=Ut(t);return[Yt(t),e,Yt(e)]}(g)),_=[g].concat(y).reduce((function(t,i){return t.concat(jt(i)===Et?function(t,e){void 0===e&&(e={});var i=e,r=i.placement,o=i.boundary,n=i.rootBoundary,a=i.padding,s=i.flipVariations,l=i.allowedAutoPlacements,c=void 0===l?Tt:l,p=Nt(r),d=p?s?Lt:Lt.filter((function(t){return Nt(t)===p})):Pt,h=d.filter((function(t){return c.indexOf(t)>=0}));0===h.length&&(h=d);var u=h.reduce((function(e,i){return e[i]=te(t,{placement:i,boundary:o,rootBoundary:n,padding:a})[jt(i)],e}),{});return Object.keys(u).sort((function(t,e){return u[t]-u[e]}))}(e,{placement:i,boundary:p,rootBoundary:d,padding:c,flipVariations:m,allowedAutoPlacements:f}):i)}),[]),w=e.rects.reference,b=e.rects.popper,x=new Map,C=!0,E=_[0],P=0;P<_.length;P++){var S=_[P],O=jt(S),k=Nt(S)===St,$=[wt,bt].indexOf(O)>=0,L=$?"width":"height",T=te(e,{placement:S,boundary:p,rootBoundary:d,altBoundary:h,padding:c}),I=$?k?xt:Ct:k?bt:wt;w[L]>b[L]&&(I=Ut(I));var F=Ut(I),M=[];if(n&&M.push(T[O]<=0),s&&M.push(T[I]<=0,T[F]<=0),M.every((function(t){return t}))){E=S,C=!1;break}x.set(S,M)}if(C)for(var A=function(t){var e=_.find((function(e){var i=x.get(e);if(i)return i.slice(0,t).every((function(t){return t}))}));if(e)return E=e,"break"},D=m?3:1;D>0;D--){if("break"===A(D))break}e.placement!==E&&(e.modifiersData[r]._skip=!0,e.placement=E,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},{name:"preventOverflow",enabled:!0,phase:"main",fn:function(t){var e=t.state,i=t.options,r=t.name,o=i.mainAxis,n=void 0===o||o,a=i.altAxis,s=void 0!==a&&a,l=i.boundary,c=i.rootBoundary,p=i.altBoundary,d=i.padding,h=i.tether,u=void 0===h||h,m=i.tetherOffset,f=void 0===m?0:m,g=te(e,{boundary:l,rootBoundary:c,padding:d,altBoundary:p}),v=jt(e.placement),y=Nt(e.placement),_=!y,w=qt(v),b="x"===w?"y":"x",x=e.modifiersData.popperOffsets,C=e.rects.reference,E=e.rects.popper,P="function"==typeof f?f(Object.assign(Object.assign({},e.rects),{},{placement:e.placement})):f,S={x:0,y:0};if(x){if(n){var O="y"===w?wt:Ct,k="y"===w?bt:xt,$="y"===w?"height":"width",L=x[w],T=x[w]+g[O],I=x[w]-g[k],F=u?-E[$]/2:0,M=y===St?C[$]:E[$],A=y===St?-E[$]:-C[$],D=e.elements.arrow,R=u&&D?ut(D):{width:0,height:0},j=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},N=j[O],q=j[k],V=ee(0,C[$],R[$]),B=_?C[$]/2-F-V-N-P:M-V-N-P,H=_?-C[$]/2+F+V+q+P:A+V+q+P,z=e.elements.arrow&&_t(e.elements.arrow),U=z?"y"===w?z.clientTop||0:z.clientLeft||0:0,W=e.modifiersData.offset?e.modifiersData.offset[e.placement][w]:0,Y=x[w]+B-W-U,X=x[w]+H-W,G=ee(u?Math.min(T,Y):T,L,u?Math.max(I,X):I);x[w]=G,S[w]=G-L}if(s){var Q="x"===w?wt:Ct,J="x"===w?bt:xt,K=x[b],Z=ee(K+g[Q],K,K-g[J]);x[b]=Z,S[b]=Z-K}e.modifiersData[r]=S}},requiresIfExists:["offset"]},{name:"arrow",enabled:!0,phase:"main",fn:function(t){var e,i=t.state,r=t.name,o=i.elements.arrow,n=i.modifiersData.popperOffsets,a=jt(i.placement),s=qt(a),l=[Ct,xt].indexOf(a)>=0?"height":"width";if(o&&n){var c=i.modifiersData[r+"#persistent"].padding,p=ut(o),d="y"===s?wt:Ct,h="y"===s?bt:xt,u=i.rects.reference[l]+i.rects.reference[s]-n[s]-i.rects.popper[l],m=n[s]-i.rects.reference[s],f=_t(o),g=f?"y"===s?f.clientHeight||0:f.clientWidth||0:0,v=u/2-m/2,y=c[d],_=g-p[l]-c[h],w=g/2-p[l]/2+v,b=ee(y,w,_),x=s;i.modifiersData[r]=((e={})[x]=b,e.centerOffset=b-w,e)}},effect:function(t){var e=t.state,i=t.options,r=t.name,o=i.element,n=void 0===o?"[data-popper-arrow]":o,a=i.padding,s=void 0===a?0:a;null!=n&&("string"!=typeof n||(n=e.elements.popper.querySelector(n)))&&Xt(e.elements.popper,n)&&(e.elements.arrow=n,e.modifiersData[r+"#persistent"]={padding:Kt("number"!=typeof s?s:Zt(s,Pt))})},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(t){var e=t.state,i=t.name,r=e.rects.reference,o=e.rects.popper,n=e.modifiersData.preventOverflow,a=te(e,{elementContext:"reference"}),s=te(e,{altBoundary:!0}),l=ie(a,r),c=ie(s,o,n),p=re(l),d=re(c);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:p,hasPopperEscaped:d},e.attributes.popper=Object.assign(Object.assign({},e.attributes.popper),{},{"data-popper-reference-hidden":p,"data-popper-escaped":d})}}]}),ne="tippy-content",ae="tippy-backdrop",se="tippy-arrow",le="tippy-svg-arrow",ce={passive:!0,capture:!0};function pe(t,e,i){if(Array.isArray(t)){var r=t[e];return null==r?Array.isArray(i)?i[e]:i:r}return t}function de(t,e){var i={}.toString.call(t);return 0===i.indexOf("[object")&&i.indexOf(e+"]")>-1}function he(t,e){return"function"==typeof t?t.apply(void 0,e):t}function ue(t,e){return 0===e?t:function(r){clearTimeout(i),i=setTimeout((function(){t(r)}),e)};var i}function me(t){return[].concat(t)}function fe(t,e){-1===t.indexOf(e)&&t.push(e)}function ge(t){return t.split("-")[0]}function ve(t){return[].slice.call(t)}function ye(){return document.createElement("div")}function _e(t){return["Element","Fragment"].some((function(e){return de(t,e)}))}function we(t){return de(t,"MouseEvent")}function be(t){return!(!t||!t._tippy||t._tippy.reference!==t)}function xe(t){return _e(t)?[t]:function(t){return de(t,"NodeList")}(t)?ve(t):Array.isArray(t)?t:ve(document.querySelectorAll(t))}function Ce(t,e){t.forEach((function(t){t&&(t.style.transitionDuration=e+"ms")}))}function Ee(t,e){t.forEach((function(t){t&&t.setAttribute("data-state",e)}))}function Pe(t){var e=me(t)[0];return e&&e.ownerDocument||document}function Se(t,e,i){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach((function(e){t[r](e,i)}))}var Oe={isTouch:!1},ke=0;function $e(){Oe.isTouch||(Oe.isTouch=!0,window.performance&&document.addEventListener("mousemove",Le))}function Le(){var t=performance.now();t-ke<20&&(Oe.isTouch=!1,document.removeEventListener("mousemove",Le)),ke=t}function Te(){var t=document.activeElement;if(be(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}var Ie="undefined"!=typeof window&&"undefined"!=typeof document?navigator.userAgent:"",Fe=/MSIE |Trident\//.test(Ie);var Me={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},Ae=Object.assign({appendTo:function(){return document.body},aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},Me,{},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),De=Object.keys(Ae);function Re(t){var e=(t.plugins||[]).reduce((function(e,i){var r=i.name,o=i.defaultValue;return r&&(e[r]=void 0!==t[r]?t[r]:o),e}),{});return Object.assign({},t,{},e)}function je(t,e){var i=Object.assign({},e,{content:he(e.content,[t])},e.ignoreAttributes?{}:function(t,e){return(e?Object.keys(Re(Object.assign({},Ae,{plugins:e}))):De).reduce((function(e,i){var r=(t.getAttribute("data-tippy-"+i)||"").trim();if(!r)return e;if("content"===i)e[i]=r;else try{e[i]=JSON.parse(r)}catch(t){e[i]=r}return e}),{})}(t,e.plugins));return i.aria=Object.assign({},Ae.aria,{},i.aria),i.aria={expanded:"auto"===i.aria.expanded?e.interactive:i.aria.expanded,content:"auto"===i.aria.content?e.interactive?null:"describedby":i.aria.content},i}function Ne(t,e){t.innerHTML=e}function qe(t){var e=ye();return!0===t?e.className=se:(e.className=le,_e(t)?e.appendChild(t):Ne(e,t)),e}function Ve(t,e){_e(e.content)?(Ne(t,""),t.appendChild(e.content)):"function"!=typeof e.content&&(e.allowHTML?Ne(t,e.content):t.textContent=e.content)}function Be(t){var e=t.firstElementChild,i=ve(e.children);return{box:e,content:i.find((function(t){return t.classList.contains(ne)})),arrow:i.find((function(t){return t.classList.contains(se)||t.classList.contains(le)})),backdrop:i.find((function(t){return t.classList.contains(ae)}))}}function He(t){var e=ye(),i=ye();i.className="tippy-box",i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var r=ye();function o(i,r){var o=Be(e),n=o.box,a=o.content,s=o.arrow;r.theme?n.setAttribute("data-theme",r.theme):n.removeAttribute("data-theme"),"string"==typeof r.animation?n.setAttribute("data-animation",r.animation):n.removeAttribute("data-animation"),r.inertia?n.setAttribute("data-inertia",""):n.removeAttribute("data-inertia"),n.style.maxWidth="number"==typeof r.maxWidth?r.maxWidth+"px":r.maxWidth,r.role?n.setAttribute("role",r.role):n.removeAttribute("role"),i.content===r.content&&i.allowHTML===r.allowHTML||Ve(a,t.props),r.arrow?s?i.arrow!==r.arrow&&(n.removeChild(s),n.appendChild(qe(r.arrow))):n.appendChild(qe(r.arrow)):s&&n.removeChild(s)}return r.className=ne,r.setAttribute("data-state","hidden"),Ve(r,t.props),e.appendChild(i),i.appendChild(r),o(t.props,t.props),{popper:e,onUpdate:o}}He.$$tippy=!0;var ze=1,Ue=[],We=[];function Ye(t,e){var i,r,o,n,a,s,l,c,p,d=je(t,Object.assign({},Ae,{},Re((i=e,Object.keys(i).reduce((function(t,e){return void 0!==i[e]&&(t[e]=i[e]),t}),{}))))),h=!1,u=!1,m=!1,f=!1,g=[],v=ue(X,d.interactiveDebounce),y=ze++,_=(p=d.plugins).filter((function(t,e){return p.indexOf(t)===e})),w={id:y,reference:t,popper:ye(),popperInstance:null,props:d,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:_,clearDelayTimeouts:function(){clearTimeout(r),clearTimeout(o),cancelAnimationFrame(n)},setProps:function(e){0;if(w.state.isDestroyed)return;M("onBeforeUpdate",[w,e]),W();var i=w.props,r=je(t,Object.assign({},w.props,{},e,{ignoreAttributes:!0}));w.props=r,U(),i.interactiveDebounce!==r.interactiveDebounce&&(R(),v=ue(X,r.interactiveDebounce));i.triggerTarget&&!r.triggerTarget?me(i.triggerTarget).forEach((function(t){t.removeAttribute("aria-expanded")})):r.triggerTarget&&t.removeAttribute("aria-expanded");D(),F(),C&&C(i,r);w.popperInstance&&(K(),tt().forEach((function(t){requestAnimationFrame(t._tippy.popperInstance.forceUpdate)})));M("onAfterUpdate",[w,e])},setContent:function(t){w.setProps({content:t})},show:function(){0;var t=w.state.isVisible,e=w.state.isDestroyed,i=!w.state.isEnabled,r=Oe.isTouch&&!w.props.touch,o=pe(w.props.duration,0,Ae.duration);if(t||e||i||r)return;if($().hasAttribute("disabled"))return;if(M("onShow",[w],!1),!1===w.props.onShow(w))return;w.state.isVisible=!0,k()&&(x.style.visibility="visible");F(),V(),w.state.isMounted||(x.style.transition="none");if(k()){var n=T(),a=n.box,s=n.content;Ce([a,s],0)}l=function(){if(w.state.isVisible&&!f){if(f=!0,x.offsetHeight,x.style.transition=w.props.moveTransition,k()&&w.props.animation){var t=T(),e=t.box,i=t.content;Ce([e,i],o),Ee([e,i],"visible")}A(),D(),fe(We,w),w.state.isMounted=!0,M("onMount",[w]),w.props.animation&&k()&&function(t,e){H(t,e)}(o,(function(){w.state.isShown=!0,M("onShown",[w])}))}},function(){var t,e=w.props.appendTo,i=$();t=w.props.interactive&&e===Ae.appendTo||"parent"===e?i.parentNode:he(e,[i]);t.contains(x)||t.appendChild(x);K(),!1}()},hide:function(){0;var t=!w.state.isVisible,e=w.state.isDestroyed,i=!w.state.isEnabled,r=pe(w.props.duration,1,Ae.duration);if(t||e||i)return;if(M("onHide",[w],!1),!1===w.props.onHide(w))return;w.state.isVisible=!1,w.state.isShown=!1,f=!1,h=!1,k()&&(x.style.visibility="hidden");if(R(),B(),F(),k()){var o=T(),n=o.box,a=o.content;w.props.animation&&(Ce([n,a],r),Ee([n,a],"hidden"))}A(),D(),w.props.animation?k()&&function(t,e){H(t,(function(){!w.state.isVisible&&x.parentNode&&x.parentNode.contains(x)&&e()}))}(r,w.unmount):w.unmount()},hideWithInteractivity:function(t){0;L().addEventListener("mousemove",v),fe(Ue,v),v(t)},enable:function(){w.state.isEnabled=!0},disable:function(){w.hide(),w.state.isEnabled=!1},unmount:function(){0;w.state.isVisible&&w.hide();if(!w.state.isMounted)return;Z(),tt().forEach((function(t){t._tippy.unmount()})),x.parentNode&&x.parentNode.removeChild(x);We=We.filter((function(t){return t!==w})),w.state.isMounted=!1,M("onHidden",[w])},destroy:function(){0;if(w.state.isDestroyed)return;w.clearDelayTimeouts(),w.unmount(),W(),delete t._tippy,w.state.isDestroyed=!0,M("onDestroy",[w])}};if(!d.render)return w;var b=d.render(w),x=b.popper,C=b.onUpdate;x.setAttribute("data-tippy-root",""),x.id="tippy-"+w.id,w.popper=x,t._tippy=w,x._tippy=w;var E=_.map((function(t){return t.fn(w)})),P=t.hasAttribute("aria-expanded");function S(){var t=w.props.touch;return Array.isArray(t)?t:[t,0]}function O(){return"hold"===S()[0]}function k(){var t;return!!(null==(t=w.props.render)?void 0:t.$$tippy)}function $(){return c||t}function L(){var t=$().parentNode;return t?Pe(t):document}function T(){return Be(x)}function I(t){return w.state.isMounted&&!w.state.isVisible||Oe.isTouch||a&&"focus"===a.type?0:pe(w.props.delay,t?0:1,Ae.delay)}function F(){x.style.pointerEvents=w.props.interactive&&w.state.isVisible?"":"none",x.style.zIndex=""+w.props.zIndex}function M(t,e,i){var r;(void 0===i&&(i=!0),E.forEach((function(i){i[t]&&i[t].apply(void 0,e)})),i)&&(r=w.props)[t].apply(r,e)}function A(){var e=w.props.aria;if(e.content){var i="aria-"+e.content,r=x.id;me(w.props.triggerTarget||t).forEach((function(t){var e=t.getAttribute(i);if(w.state.isVisible)t.setAttribute(i,e?e+" "+r:r);else{var o=e&&e.replace(r,"").trim();o?t.setAttribute(i,o):t.removeAttribute(i)}}))}}function D(){!P&&w.props.aria.expanded&&me(w.props.triggerTarget||t).forEach((function(t){w.props.interactive?t.setAttribute("aria-expanded",w.state.isVisible&&t===$()?"true":"false"):t.removeAttribute("aria-expanded")}))}function R(){L().removeEventListener("mousemove",v),Ue=Ue.filter((function(t){return t!==v}))}function j(t){if(!(Oe.isTouch&&(m||"mousedown"===t.type)||w.props.interactive&&x.contains(t.target))){if($().contains(t.target)){if(Oe.isTouch)return;if(w.state.isVisible&&w.props.trigger.indexOf("click")>=0)return}else M("onClickOutside",[w,t]);!0===w.props.hideOnClick&&(w.clearDelayTimeouts(),w.hide(),u=!0,setTimeout((function(){u=!1})),w.state.isMounted||B())}}function N(){m=!0}function q(){m=!1}function V(){var t=L();t.addEventListener("mousedown",j,!0),t.addEventListener("touchend",j,ce),t.addEventListener("touchstart",q,ce),t.addEventListener("touchmove",N,ce)}function B(){var t=L();t.removeEventListener("mousedown",j,!0),t.removeEventListener("touchend",j,ce),t.removeEventListener("touchstart",q,ce),t.removeEventListener("touchmove",N,ce)}function H(t,e){var i=T().box;function r(t){t.target===i&&(Se(i,"remove",r),e())}if(0===t)return e();Se(i,"remove",s),Se(i,"add",r),s=r}function z(e,i,r){void 0===r&&(r=!1),me(w.props.triggerTarget||t).forEach((function(t){t.addEventListener(e,i,r),g.push({node:t,eventType:e,handler:i,options:r})}))}function U(){var t;O()&&(z("touchstart",Y,{passive:!0}),z("touchend",G,{passive:!0})),(t=w.props.trigger,t.split(/\s+/).filter(Boolean)).forEach((function(t){if("manual"!==t)switch(z(t,Y),t){case"mouseenter":z("mouseleave",G);break;case"focus":z(Fe?"focusout":"blur",Q);break;case"focusin":z("focusout",Q)}}))}function W(){g.forEach((function(t){var e=t.node,i=t.eventType,r=t.handler,o=t.options;e.removeEventListener(i,r,o)})),g=[]}function Y(t){var e,i=!1;if(w.state.isEnabled&&!J(t)&&!u){var r="focus"===(null==(e=a)?void 0:e.type);a=t,c=t.currentTarget,D(),!w.state.isVisible&&we(t)&&Ue.forEach((function(e){return e(t)})),"click"===t.type&&(w.props.trigger.indexOf("mouseenter")<0||h)&&!1!==w.props.hideOnClick&&w.state.isVisible?i=!0:et(t),"click"===t.type&&(h=!i),i&&!r&&it(t)}}function X(t){var e=t.target,i=$().contains(e)||x.contains(e);"mousemove"===t.type&&i||function(t,e){var i=e.clientX,r=e.clientY;return t.every((function(t){var e=t.popperRect,o=t.popperState,n=t.props.interactiveBorder,a=ge(o.placement),s=o.modifiersData.offset;if(!s)return!0;var l="bottom"===a?s.top.y:0,c="top"===a?s.bottom.y:0,p="right"===a?s.left.x:0,d="left"===a?s.right.x:0,h=e.top-r+l>n,u=r-e.bottom-c>n,m=e.left-i+p>n,f=i-e.right-d>n;return h||u||m||f}))}(tt().concat(x).map((function(t){var e,i=null==(e=t._tippy.popperInstance)?void 0:e.state;return i?{popperRect:t.getBoundingClientRect(),popperState:i,props:d}:null})).filter(Boolean),t)&&(R(),it(t))}function G(t){J(t)||w.props.trigger.indexOf("click")>=0&&h||(w.props.interactive?w.hideWithInteractivity(t):it(t))}function Q(t){w.props.trigger.indexOf("focusin")<0&&t.target!==$()||w.props.interactive&&t.relatedTarget&&x.contains(t.relatedTarget)||it(t)}function J(t){return!!Oe.isTouch&&O()!==t.type.indexOf("touch")>=0}function K(){Z();var e=w.props,i=e.popperOptions,r=e.placement,o=e.offset,n=e.getReferenceClientRect,a=e.moveTransition,s=k()?Be(x).arrow:null,c=n?{getBoundingClientRect:n,contextElement:n.contextElement||$()}:t,p=[{name:"offset",options:{offset:o}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!a}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(t){var e=t.state;if(k()){var i=T().box;["placement","reference-hidden","escaped"].forEach((function(t){"placement"===t?i.setAttribute("data-placement",e.placement):e.attributes.popper["data-popper-"+t]?i.setAttribute("data-"+t,""):i.removeAttribute("data-"+t)})),e.attributes.popper={}}}}];k()&&s&&p.push({name:"arrow",options:{element:s,padding:3}}),p.push.apply(p,(null==i?void 0:i.modifiers)||[]),w.popperInstance=oe(c,x,Object.assign({},i,{placement:r,onFirstUpdate:l,modifiers:p}))}function Z(){w.popperInstance&&(w.popperInstance.destroy(),w.popperInstance=null)}function tt(){return ve(x.querySelectorAll("[data-tippy-root]"))}function et(t){w.clearDelayTimeouts(),t&&M("onTrigger",[w,t]),V();var e=I(!0),i=S(),o=i[0],n=i[1];Oe.isTouch&&"hold"===o&&n&&(e=n),e?r=setTimeout((function(){w.show()}),e):w.show()}function it(t){if(w.clearDelayTimeouts(),M("onUntrigger",[w,t]),w.state.isVisible){if(!(w.props.trigger.indexOf("mouseenter")>=0&&w.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(t.type)>=0&&h)){var e=I(!1);e?o=setTimeout((function(){w.state.isVisible&&w.hide()}),e):n=requestAnimationFrame((function(){w.hide()}))}}else B()}return U(),D(),F(),M("onCreate",[w]),d.showOnCreate&&et(),x.addEventListener("mouseenter",(function(){w.props.interactive&&w.state.isVisible&&w.clearDelayTimeouts()})),x.addEventListener("mouseleave",(function(t){w.props.interactive&&w.props.trigger.indexOf("mouseenter")>=0&&(L().addEventListener("mousemove",v),v(t))})),w}function Xe(t,e){void 0===e&&(e={});var i=Ae.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",$e,ce),window.addEventListener("blur",Te);var r=Object.assign({},e,{plugins:i}),o=xe(t).reduce((function(t,e){var i=e&&Ye(e,r);return i&&t.push(i),t}),[]);return _e(t)?o[0]:o}Xe.defaultProps=Ae,Xe.setDefaultProps=function(t){Object.keys(t).forEach((function(e){Ae[e]=t[e]}))},Xe.currentInput=Oe;Xe.setDefaultProps({render:He});var Ge=Xe;const Qe=new WeakMap,Je=_((t=>e=>{if(!(e instanceof H))throw new Error("unsafeHTML can only be used in text bindings");const i=Qe.get(e);if(void 0!==i&&N(t)&&t===i.value&&e.value===i.fragment)return;const r=document.createElement("template");r.innerHTML=t;const o=document.importNode(r.content,!0);e.setValue(o),Qe.set(e,{value:t,fragment:o})})),Ke=(t,e)=>{const i=t.startNode.parentNode,r=void 0===e?t.endNode:e.startNode,o=i.insertBefore(F(),r);i.insertBefore(F(),r);const n=new H(t.options);return n.insertAfterNode(o),n},Ze=(t,e)=>(t.setValue(e),t.commit(),t),ti=(t,e,i)=>{const r=t.startNode.parentNode,o=i?i.startNode:t.endNode,n=e.endNode.nextSibling;n!==o&&x(r,e.startNode,n,o)},ei=t=>{C(t.startNode.parentNode,t.startNode,t.endNode.nextSibling)},ii=(t,e,i)=>{const r=new Map;for(let o=e;o<=i;o++)r.set(t[o],o);return r},ri=new WeakMap,oi=new WeakMap,ni=_(((t,e,i)=>{let r;return void 0===i?i=e:void 0!==e&&(r=e),e=>{if(!(e instanceof H))throw new Error("repeat can only be used in text bindings");const o=ri.get(e)||[],n=oi.get(e)||[],a=[],s=[],l=[];let c,p,d=0;for(const e of t)l[d]=r?r(e,d):d,s[d]=i(e,d),d++;let h=0,u=o.length-1,m=0,f=s.length-1;for(;h<=u&&m<=f;)if(null===o[h])h++;else if(null===o[u])u--;else if(n[h]===l[m])a[m]=Ze(o[h],s[m]),h++,m++;else if(n[u]===l[f])a[f]=Ze(o[u],s[f]),u--,f--;else if(n[h]===l[f])a[f]=Ze(o[h],s[f]),ti(e,o[h],a[f+1]),h++,f--;else if(n[u]===l[m])a[m]=Ze(o[u],s[m]),ti(e,o[u],o[h]),u--,m++;else if(void 0===c&&(c=ii(l,m,f),p=ii(n,h,u)),c.has(n[h]))if(c.has(n[u])){const t=p.get(l[m]),i=void 0!==t?o[t]:null;if(null===i){const t=Ke(e,o[h]);Ze(t,s[m]),a[m]=t}else a[m]=Ze(i,s[m]),ti(e,i,o[h]),o[t]=null;m++}else ei(o[u]),u--;else ei(o[h]),h++;for(;m<=f;){const t=Ke(e,a[f+1]);Ze(t,s[m]),a[m++]=t}for(;h<=u;){const t=o[h++];null!==t&&ei(t)}ri.set(e,a),oi.set(e,l)}}));class ai{add(t){this.classes.add(t),this.changed=!0}remove(t){this.classes.delete(t),this.changed=!0}commit(){if(this.changed){let t="";this.classes.forEach((e=>t+=e+" ")),this.element.setAttribute("class",t)}}constructor(t){this.classes=new Set,this.changed=!1,this.element=t;const e=(t.getAttribute("class")||"").split(/\s+/);for(const t of e)this.classes.add(t)}}const si=new WeakMap,li=_((t=>e=>{if(!(e instanceof B)||e instanceof W||"class"!==e.committer.name||e.committer.parts.length>1)throw new Error("The `classMap` directive must be used in the `class` attribute and must be the only part in the attribute.");const{committer:i}=e,{element:r}=i;let o=si.get(e);void 0===o&&(r.setAttribute("class",i.strings.join(" ")),si.set(e,o=new Set));const n=r.classList||new ai(r);o.forEach((e=>{e in t||(n.remove(e),o.delete(e))}));for(const e in t){const i=t[e];i!=o.has(e)&&(i?(n.add(e),o.add(e)):(n.remove(e),o.delete(e)))}"function"==typeof n.commit&&n.commit()})),ci=new WeakMap,pi=_((t=>e=>{if(!(e instanceof B)||e instanceof W||"style"!==e.committer.name||e.committer.parts.length>1)throw new Error("The `styleMap` directive must be used in the style attribute and must be the only part in the attribute.");const{committer:i}=e,{style:r}=i.element;let o=ci.get(e);void 0===o&&(r.cssText=i.strings.join(" "),ci.set(e,o=new Set)),o.forEach((e=>{e in t||(o.delete(e),-1===e.indexOf("-")?r[e]=null:r.removeProperty(e))}));for(const e in t)o.add(e),-1===e.indexOf("-")?r[e]=t[e]:r.setProperty(e,t[e])})),di=new WeakMap,hi=_((t=>e=>{if(!(e instanceof H))throw new Error("cache can only be used in text bindings");let i=di.get(e);void 0===i&&(i=new WeakMap,di.set(e,i));const r=e.value;if(r instanceof A){if(t instanceof j&&r.template===e.options.templateFactory(t))return void e.setValue(t);{let t=i.get(r.template);void 0===t&&(t={instance:r,nodes:document.createDocumentFragment()},i.set(r.template,t)),x(t.nodes,e.startNode.nextSibling,e.endNode)}}if(t instanceof j){const r=e.options.templateFactory(t),o=i.get(r);void 0!==o&&(e.setValue(o.nodes),e.commit(),e.value=o.instance)}e.setValue(t)})),ui=new WeakMap,mi=_((t=>e=>{const i=ui.get(e);if(void 0===t&&e instanceof B){if(void 0!==i||!ui.has(e)){const t=e.committer.name;e.committer.element.removeAttribute(t)}}else t!==i&&e.setValue(t);ui.set(e,t)})),fi=_((t=>e=>{let i;if(e instanceof X||e instanceof H)throw new Error("The `live` directive is not allowed on text or event bindings");if(e instanceof z)gi(e.strings),i=e.element.hasAttribute(e.name),e.value=i;else{const{element:r,name:o,strings:n}=e.committer;if(gi(n),e instanceof W){if(i=r[o],i===t)return}else e instanceof B&&(i=r.getAttribute(o));if(i===String(t))return}e.setValue(t)})),gi=t=>{if(2!==t.length||""!==t[0]||""!==t[1])throw new Error("`live` bindings can only contain a single expression")};class vi{add(t){this.classes.add(t),this.commit()}remove(t){this.classes.delete(t),this.commit()}commit(){let t="";this.classes.forEach((e=>t+=e+" ")),this.element.setAttribute("class",t)}constructor(t){this.classes=new Set,this.element=t;const e=(t.getAttribute("class")||"").split(/\s+/);for(const t of e)this.classes.add(t)}}let yi=!1;function _i(t){return yi?new vi(t):t.classList||new vi(t)}function wi(t=1){return new Promise((e=>0==--t?requestAnimationFrame((()=>e())):e(wi(t))))}function bi(t){let e=t;for(;e=e.parentNode||e.host;)if(e instanceof HTMLElement)return e;return null}function xi(t,e,i=!0){return new Promise((r=>{const o=new MutationObserver((async()=>{o.disconnect(),i&&await wi(),r()}));o.observe(t,{attributes:!0,attributeFilter:["class"]}),e&&e()}))}const Ci=new WeakMap;function Ei(t,e){return Ci.set(t,e),t}let Pi;function Si(t=!document.hidden){Pi=t}Si(),document.addEventListener("visibilitychange",(()=>Si()),!1);const Oi=new WeakMap;function ki(t){return function(e,i){return async r=>{if(!(r instanceof H))throw new Error("The `transition` directive can only be used on nodes");e||(e=et`<div></div>`),"string"!=typeof e&&"number"!=typeof e||(e=et`<div style="display: inline-block">${e}</div>`);const o=(n=e,Ci.get(n));var n;const{enter:a,leave:s,onEnter:l,onLeave:c,onAfterEnter:p,onAfterLeave:d,mode:h="in-out"}=i;let u=Oi.get(r);function m(t){const e=new H(r.options);return e.appendIntoPart(r),e.setValue(t),e.commit(),e}function f(t){const{startNode:e,endNode:i}=t;try{e&&t.clear()}catch(t){}e&&e.parentNode&&e.parentNode.removeChild(e),i&&i.parentNode&&i.parentNode.removeChild(i)}if(!Pi)return u&&u.last&&f(u.last),c&&await c(),d&&await d(),l&&await l(),u&&(u.last=m(e)),void(p&&await p());async function g(e){l&&await l(),a&&await t.transition(e,a,i),p&&await p()}async function v(e){c&&await c(),s&&await t.transition(e,s,i),f(e),d&&await d()}if(u||Oi.set(r,u={children:new Map,styles:new Map,transition:i}),t.init&&t.init({transition:i,data:u,add:m,remove:f}),u.last&&o&&o===u.name)u.last.setValue(e),u.last.commit();else if(u.name=o,"in-out"===h){const t=u.last;await g(u.last=m(e)),t&&await v(t)}else if("out-in"===h){const t=u.last;t&&await v(t),await g(u.last=m(e))}else u.last&&v(u.last),await g(u.last=m(e))}}}var $i,Li;function Ti(t,e){const i=e();for(let t in i)e[t]=i[t];return Object.defineProperty(e,"name",{get:()=>t}),e}function Ii(t,e){for(var i in e)try{e[i].constructor==Object?t[i]=Ii(t[i],e[i]):t[i]=e[i]}catch(r){t[i]=e[i]}return t}!function(t){t.InOut="in-out",t.OutIn="out-in",t.Both="both"}($i||($i={})),function(t){t[t.None=0]="None",t[t.Lock=1]="Lock",t.Auto="auto"}(Li||(Li={}));const Fi=Ti("fade",(function(t={}){const{duration:e=500,ease:i="ease-out",opacity:r=0}=t;return Ii({enter:{active:"fade-enter-active",from:"fade-enter-from",to:"fade-enter-to"},leave:{active:"fade-leave-active",from:"fade-leave-from",to:"fade-leave-to",lock:!0},css:`\n    .fade-leave-active {\n      position: fixed;\n      transition: opacity ${e}ms ${i}, transform ${e}ms ${i};\n    }\n    .fade-enter-active {\n      transition: opacity ${e}ms ${i}, transform ${e}ms ${i};\n    }\n  .fade-enter-from, .fade-leave-to {\n    opacity: ${r};\n  }\n  .fade-enter-to, .fade-leave-from {\n    opacity: 1;\n  }\n  `},t)})),Mi={async transition(t,e,i){const{duration:r=i.duration,active:o,from:n,to:a,lock:s}=e,l=function(t){let e=function(t){const e=[];let i=t.startNode.nextSibling;for(;i!==t.endNode;)e.push(i),i=i.nextSibling;return e}(t),i=e.filter((t=>{return!("#text"===(e=t).nodeName&&!(null===(i=e.nodeValue)||void 0===i?void 0:i.trim()));var e,i}));if(1!=i.length)throw new Error(`lit-transition directive expects exactly one child node,\n      but was passed ${i.map((t=>t.nodeName)).join(", ")}`);return i[0]}(t);if(!l)return;let c;s&&(s!==Li.Auto||o&&function(t,e){const i=bi(t);if(i){const t=(()=>{const t=document.createElement("div"),r=_i(t),o=i.shadowRoot||i;var n;n=e,Array.isArray(n)?n.forEach((t=>r.add(t))):r.add(n),o.appendChild(t);const a=window.getComputedStyle(t).position;return o.removeChild(t),a})();if("absolute"===t)return"relative"===window.getComputedStyle(i).position}return!1}(l,o))&&(c=function(t){const e=t.getBoundingClientRect();let i=0,r=0;{let e=t.offsetParent;for(;t&&t!==document&&!(t instanceof DocumentFragment)&&t!==e;)i+=t.offsetTop-(t.scrollTop||0),r+=t.offsetLeft-(t.scrollLeft||0),t=bi(t)}return{left:r,top:i,width:e.width,height:e.height}}(l)),await new Promise((async t=>{const e=_i(l),i=t=>Array.isArray(t)?t.forEach((t=>e.add(t))):e.add(t),s=t=>Array.isArray(t)?t.forEach((t=>e.remove(t))):e.remove(t);var p,d;function h(e){if(e){if(e.target!==l)return;e.preventDefault(),e.stopPropagation()}["transitionend","transitioncancel","animationend","animationcancel"].filter((t=>!e||t!==e.type)).forEach((t=>l.removeEventListener(t,h))),o&&s(o),n&&s(n),a&&s(a),t()}c&&(d=c,(p=l).style.marginLeft="0px",p.style.marginTop="0px",p.style.left=d.left+"px",p.style.top=d.top+"px",p.style.width=d.width+"px",p.style.height=d.height+"px");const u={once:!0};r?setTimeout(h,r):(l.addEventListener("transitionrun",(function(){l.addEventListener("transitionend",h,u),l.addEventListener("transitioncancel",h,u)}),u),l.addEventListener("animationstart",(function(){l.addEventListener("animationend",h,u),l.addEventListener("animationcancel",h,u)}),u)),n&&await xi(l,(()=>i(n))),o&&await xi(l,(()=>i(o))),n&&s(n),a&&i(a)}))},init({data:t,remove:e,add:i,transition:r}){if(t._cssSource!==r.css&&(t.css&&e(t.css),r.css)){t._cssSource=r.css;let e=r.css;e="string"==typeof e?et`<style>${e}</style>`:e,t.css=i(e)}}},Ai=(Ti("land",(function(t={}){const{duration:e=500,ease:i="ease-out",opacity:r=0}=t;return Ii({enter:{active:"land1-enter-active",from:"land1-enter-from",to:"land1-enter-to"},leave:{active:"land1-leave-active",from:"land1-leave-from",to:"land1-leave-to"},mode:"both",css:`\n      .land1-enter-active {\n        transform-origin: 50% 50%;\n        transition: transform ${e}ms ${i}, opacity ${e}ms ${i};\n      }\n      .land1-leave-active {\n        transform-origin: 50% 50%;\n        position: absolute;\n        transition: transform ${e}ms ${i}, opacity ${e}ms ${i};\n      }\n      .land1-enter-from {\n        opacity: ${r};\n        transform: translate(0px, 0px) scale(3);\n      }\n      .land1-leave-to {\n        transform: translate(0px, 100px);\n        opacity: ${r};\n      }`},t)})),Ti("slide",(function(t={}){const{left:e,right:i,up:r,down:o}=t;let n={};e&&(n={x:"-100%",x1:"100%"}),i&&(n={x:"100%",x1:"-100%"}),r&&(n={y:"100%",y1:"-100%"}),o&&(n={y:"-100%",y1:"100%"});let{mode:a,duration:s=500,x:l="100%",y:c="0%",x1:p="",y1:d="",ease:h="ease-out",leavePosition:u="",opacity:m=0}=Object.assign(Object.assign({},n),t);return p=p||l,d=d||c,Ii({enter:{active:"slide-enter-active",from:"slide-enter-from"},leave:{active:"slide-leave-active",to:"slide-leave-to",lock:Li.Auto},css:`\n    .slide-enter-active {\n      transition: transform ${s}ms ${h}, opacity ${s}ms ${h};\n    }\n    .slide-leave-active {\n      position: ${u||(a!==$i.OutIn?"absolute":"initial")};\n      transition: transform ${s}ms ${h}, opacity ${s}ms ${h};\n    }\n    .slide-leave-to {\n      opacity: ${m};\n      transform: translate(${l}, ${c});\n    }\n    .slide-enter-from {\n      opacity: ${m};\n      transform: translate(${p}, ${d});\n    }`,mode:a},t)})),_((function(t,e=Fi){return"function"==typeof e&&(e=e()),ki(Mi)(t,function(t={}){const{css:e,duration:i,enter:r={},leave:o={},mode:n=$i.Both,onAfterEnter:a,onAfterLeave:s,onEnter:l,onLeave:c,skipHidden:p=!0}=t;return{duration:i,skipHidden:p,css:et`<style>${e}</style>`,enter:0!=r&&(Array.isArray(r)||"string"==typeof r?{active:r}:Object.assign({active:"enter-active",from:"enter-from",to:"enter-to"},r)),leave:0!=o&&(Array.isArray(o)||"string"==typeof o?{active:o,lock:!1}:Object.assign({active:"leave-active",from:"leave-from",to:"leave-to",lock:!1},o)),onEnter:l,onLeave:c,onAfterEnter:a,onAfterLeave:s,mode:n}}(e))})));function Di(t,e){"string"==typeof t&&(t=t.replace(".",""));let i="";const r=/\{\{\s*(\w+)\s*\}\}/,o=e||"${{amount}}";function n(t,e=2,i=",",r="."){if(isNaN(t)||null==t)return 0;const o=(t=(t/100).toFixed(e)).split(".");return o[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,`$1${i}`)+(o[1]?r+o[1]:"")}switch(o.match(r)[1]){case"amount":i=n(t,2);break;case"amount_no_decimals":i=n(t,0);break;case"amount_with_comma_separator":i=n(t,2,".",",");break;case"amount_no_decimals_with_comma_separator":i=n(t,0,".",",")}return o.replace(r,i)}const Ri={OPTIONS:"_cl_options",ID:"_cl_options_id",PRICE:"_cl_options_price",PRICE_BASE:"_cl_options_price_base",CURRENCY:"_cl_options_currency",WEIGHT:"_cl_options_weight",QUANTITY_ID:"_cl_options_quantity_id",QUANTITY_DISCOUNT:"_cl_options_quantity_discount",VALIDATE:!0},ji={cartItem:!0,cartItemPreview:!0,cartItemPrice:!0,cartItemPriceOptions:!0,cartItemEdit:!1,cartItemClOptions:!0,cartItemPriceRemove:!0,cartCount:!0,cartTotal:!0,cartFormCapture:!0,cartDiscount:!1,cartPriceRegex:!1,productFormCapture:!0,productPrice:!0,productPriceAll:!1,productVariantHide:!0,productVariantFilter:!1,productVariantReset:!1,productVariantHistory:!1,productVariantHistoryPush:!0,productVariantHistoryReplace:!0,productPriceTimeout:!1,productPriceObserver:!1,productItemUpdate:!0,productItemModal:!1,productOptionsClear:!1,productCropOverlay:!0,amountNoDecimals:!1,themeGallery:!1,themeGalleryTimeout:!1,tooltipBody:!0,currencyFormat:!0},Ni={currency:"",currencyConvert:!1,currencyFactor:1,moneyFormat:"$ {{amount}}",moneyFormatWithCurrency:"${{amount}} USD",priceVariant:!1,priceVariantValue:.01,priceVariantId:"",priceProductHandle:""},qi=t=>{if(1!==Ni.currencyFactor)if(t*=Ni.currencyFactor,Ni.priceVariant){let e=Math.round(t/Ni.priceVariantValue);t=Ni.priceVariantValue*e,t=Math.round(100*t)/100}else t=Ni.currencyFactor>100&&t>100?100*Math.ceil(t/100):Math.ceil(t);return t},Vi=0,Bi=1,Hi=2,zi=1,Ui=2,Wi=3,Yi=4,Xi={EXPORT:!1,FORMULA:!1,QUANTITY:!1},Gi=(t,e="200x")=>"small"===t?"100x":"medium"===t?"200x":"large"===t?"400x":e,Qi=(t,e)=>{if((t=>t&&-1!==t.indexOf("https://cdn.shopify.com/"))(t)){let i=t.substring(t.lastIndexOf(".")+1);return"svg"===i?t:t.replace("."+i,"")+"_"+e+"."+i}return t};class Ji{}Ji.templates={};var Ki=Ji;var Zi=class{upload(t,e){const i=[],r=[];for(let o=0;o<t.length;o++){const a=t[o];i.push(new Promise(((t,i)=>{this._getSignedUrl(a).then((s=>{const l={method:"PUT",headers:{"Content-type":a.mimeType},data:a._file};0===o&&(l.onProgress=e);const c=new n(s.upload,l);r.push(c),c.then((()=>{a.url=s.download,a.path=s.path,t(a)})).catch((t=>{i(t)}))})).catch((t=>{i(t)}))})))}let o=Promise.all(i).then((t=>(a.info(t),t)));return o.cancel=()=>{for(let t=0;t<r.length;t++){r[t].cancel()}},o}_getSignedUrl(t){let e=this.settings.api+this.settings.path,r=i.extend(this.settings.queryParams,{name:encodeURIComponent(t.name),type:encodeURIComponent(t.mimeType),public:"1",cb:1e18*Math.random()+""});return new n(e,{method:"GET",queryParams:r}).then((t=>t.data))}constructor(t){this.settings=i.extend({api:"",path:"/api/storage",queryParams:{}},t||{})}};var tr=class{findToken(){let t=i.readCookie("token");t&&(this.settings.queryParams.token=t)}blobToFile(t,e){return new File([t],e,{lastModified:(new Date).getTime(),type:t.type})}fromBlob(t,e){return{name:e,size:t.size,mimeType:t.type,meta:{},_file:t}}fromNative(t){return{name:t.name?t.name:"",size:t.size,mimeType:t.type,meta:{},_file:t}}saveFile(t){return this.settings.queryParams.token||this.findToken(),this.settings.origin&&(t.origin=this.settings.origin),new n(this.settings.api+this.settings.path,{method:"POST",responseType:"json",headers:{"Content-type":"application/json"},data:t,queryParams:this.settings.queryParams}).then((t=>{if(!this.settings.queryParams.token&&t.data.token){let e=t.data.token;i.writeCookie("token",e,10,"/"),this.settings.queryParams.token=e}return t.data})).catch((t=>{throw t}))}removeFile(t){return Promise.resolve()}constructor(t){this.settings=i.extend({api:"",path:"/api/upload",queryParams:{}},t||{}),this.findToken()}},er={};!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof er?er=e():t.loadjs=e()}(er,(function(){var t=function(){},e={},i={},r={};function o(t,e){if(t){var o=r[t];if(i[t]=e,o)for(;o.length;)o[0](t,e),o.splice(0,1)}}function n(e,i){e.call&&(e={success:e}),i.length?(e.error||t)(i):(e.success||t)(e)}function a(e,i,r,o){var n,s,l=document,c=r.async,p=(r.numRetries||0)+1,d=r.before||t,h=e.replace(/[\?|#].*$/,""),u=e.replace(/^(css|img)!/,"");o=o||0,/(^css!|\.css$)/.test(h)?((s=l.createElement("link")).rel="stylesheet",s.href=u,(n="hideFocus"in s)&&s.relList&&(n=0,s.rel="preload",s.as="style")):/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(h)?(s=l.createElement("img")).src=u:((s=l.createElement("script")).src=e,s.async=void 0===c||c),s.onload=s.onerror=s.onbeforeload=function(t){var l=t.type[0];if(n)try{s.sheet.cssText.length||(l="e")}catch(t){18!=t.code&&(l="e")}if("e"==l){if((o+=1)<p)return a(e,i,r,o)}else if("preload"==s.rel&&"style"==s.as)return s.rel="stylesheet";i(e,l,t.defaultPrevented)},!1!==d(e,s)&&l.head.appendChild(s)}function s(t,i,r){var s,l;if(i&&i.trim&&(s=i),l=(s?r:i)||{},s){if(s in e)throw"LoadJS";e[s]=!0}function c(e,i){!function(t,e,i){var r,o,n=(t=t.push?t:[t]).length,s=n,l=[];for(r=function(t,i,r){if("e"==i&&l.push(t),"b"==i){if(!r)return;l.push(t)}--n||e(l)},o=0;o<s;o++)a(t[o],r,i)}(t,(function(t){n(l,t),e&&n({success:e,error:i},t),o(s,t)}),l)}if(l.returnPromise)return new Promise(c);c()}return s.ready=function(t,e){return function(t,e){t=t.push?t:[t];var o,n,a,s=[],l=t.length,c=l;for(o=function(t,i){i.length&&s.push(t),--c||e(s)};l--;)n=t[l],(a=i[n])?o(n,a):(r[n]=r[n]||[]).push(o)}(t,(function(t){n(e,t)})),s},s.done=function(t){o(t,[])},s.reset=function(){e={},i={},r={}},s.isDefined=function(t){return t in e},s}));class ir{static load(e,i,r={async:!0}){return r.returnPromise=!0,t(er)(e,i,r)}static isReady(e){return Array.isArray(e)||(e=[e]),new Promise(((i,r)=>{t(er).ready(e,(()=>{i(e)}))}))}static isDefined(e){return t(er).isDefined(e)}static loadOnce(t,e,i={async:!0}){return ir.isDefined(e)?ir.isReady(e):ir.load(t,e,i)}}var rr=ir;class or{static getInstance(t){return or._instance||(or._instance=new or(t)),or._instance}controller(){let t={files:[],inputs:[],onValidate:e=>{let i=!0;return e.required&&0===t.files.length&&(e.errors.push(l.get("product.options.validity.upload.required")),i=!1),i},onChange:(e,r,o,n)=>{let a=e.target;if(a.value&&a.files.length>0){const e=a.files;let s=[];for(let t=0;t<e.length;t++){const i=e[t];let o=r.params.maxMb||10;const n=1048576*o;if(i.size>n)return a.value="",r.errors=r.errors||[],r.errors.push(l.get("product.options.validity.upload.max",{max:o})),void a.dispatchEvent(new CustomEvent("options:render",{detail:r,cancelable:!0,bubbles:!0}));s.push(this._fileMeta.fromNative(i))}let c=i.findParent(a,".cl-po--upload"),p=c.querySelector("progress");p.max=100,p.value=0,p.style.display="block",this.upload(s,(t=>{if(t.lengthComputable){let e=t.loaded/t.total*100;e>p.value&&(p.value=e)}})).then((e=>{p.style.display="none";for(let e=0;e<t.files.length;e++){const i=t.files[e];i.uuid&&this._fileMeta.removeFile(i)}for(let e=0;e<t.inputs.length;e++){const i=t.inputs[e];i.parentNode&&i.parentNode.removeChild(i)}t.inputs.length=0,t.files=e;let i="";for(let e=0;e<t.files.length;e++){const n=t.files[e];i+=this._corsUrl(n.url);let a=e+1;a<t.files.length&&(i+=",");let s=document.createElement("input");s.type="hidden",r.params.multiple?s.name="properties["+r.name+"_"+a+"]":s.name="properties["+r.name+"]",s.value=n.url,this._linkForm(s,o),c.appendChild(s),t.inputs.push(s)}r.value=i,a.value="",n(r)}))}},update:(e,i)=>{if(e.value){if(0===t.inputs.length){t.files.push({url:e.value,name:"file"+e.value.substring(e.value.lastIndexOf(".")),meta:{}});let r=document.createElement("input");r.type="hidden",r.name="properties["+e.name+"]",r.value=e.value,e.value=this._corsUrl(e.value),this._linkForm(r,i),document.querySelector('[data-option="'+e.name+'"] .cl-po--upload').appendChild(r),t.inputs.push(r)}}else if(t.inputs.length>0){for(let e=0;e<t.inputs.length;e++){const i=t.inputs[e];i.parentNode&&i.parentNode.removeChild(i)}t.inputs.length=0,t.files.length=0}},remove:(e,i,r,o)=>{for(let i=0;i<t.files.length;i++)if(t.files[i]===r){this._fileMeta.removeFile(r),t.files.splice(i,1);for(let e=0;e<t.inputs.length;e++)if(t.inputs[e].value==r.url){let i=t.inputs[e];i.parentNode&&i.parentNode.removeChild(i),t.inputs.splice(e,1)}e.value="",o(e);break}},crop:(t,e)=>{e.dispatchEvent(new CustomEvent("option:crop",{detail:t,cancelable:!0,bubbles:!0}))}};return t}controllerLift(t,e,i,r){let o={option:t,selector:`.cl-po--upload-lift-${t.id}`,container:null,field:null,urls:[],onValidate:t=>{let e=!0;if(t.required&&0===o.urls.length)t.errors.push(l.get("product.options.validity.upload.required")),e=!1;else if(o.field)return o.field.validate();return e},syncValue:()=>{let t="";for(let e=0;e<o.urls.length;e++){t+=this._corsUrl(o.urls[e]),e+1<o.urls.length&&(t+=",")}o.option.value=t,r(o.option)},watchUploads:()=>{o.container=document.querySelector(o.selector),o.container&&(o.container.addEventListener("upload:added",(e=>{var i=e.detail;let r=t.params.variant||"original";i.url&&i.meta.variant===r&&(o.urls.push(i.url),o.syncValue())})),o.container.addEventListener("upload:removed",(e=>{var i=e.detail;let r=t.params.variant||"original";if(i.url&&i.meta.variant===r){let t=o.urls.indexOf(i.url);-1!==t&&(o.urls.splice(t,1),o.syncValue())}})))},update:(t,e)=>{t.value?0===o.urls.length&&t._controller.ready.then((()=>{let e=t.value.split(",");t._controller.field.restore(e),t.value=""})):o.urls.length>0&&t._controller.field&&t._controller.field.clearFiles()},crop:(t,e)=>{e.dispatchEvent(new CustomEvent("option:crop",{detail:t,cancelable:!0,bubbles:!0}))}};const n=r=>{i.removeEventListener("options:rendered",n);const a=()=>{let r=window.Cloudlift.upload.App;if(r.fields.length>0)for(let e=0;e<r.fields.length;e++){const i=r.fields[e];i.config.uuid==t.params.uuid&&(i.destroy(),r.fields.splice(e,1))}else r.config.setup=!1;for(let n=0;n<window.Cloudlift.upload.config.fields.length;n++){const a=window.Cloudlift.upload.config.fields[n];if(a.uuid===t.params.uuid){const n=JSON.parse(JSON.stringify(a));n.field=t.name,n.fileFetch=!1,n.selector=o.selector,r._createUploadField(n,e);const s=r.fields.length-1;o.field=r.fields[s],o.field._productForm=i,r.fields.splice(s,1),t._controller.onReady(o.field)}}o.field||(o.notfound=!0)};if(!t._controller.ready){t._controller.ready=new Promise(((e,i)=>{t._controller.onReady=e}));let e=()=>{setTimeout((()=>{window.Cloudlift.upload.App?o.field||a():e()}),300)};window.Cloudlift&&window.Cloudlift.upload&&(window.Cloudlift.upload.App?a():e());var s=t=>{window.Cloudlift.upload.App?o.field||a():e(),window.removeEventListener("cloudlift.upload.ready",s)};window.addEventListener("cloudlift.upload.ready",s),o.watchUploads()}};return i.addEventListener("options:rendered",n),o}_corsUrl(t){return t=(t=t.replace("https://upload.dev.cloudlift.app/s/dev","https://storage.googleapis.com/cloudlift-app-cloud-dev-upload")).replace("https://upload.cloudlift.app/s","https://storage.googleapis.com/cloudlift-app-cloud-prod-upload")}_linkForm(t,e){if(e){let i=e.getAttribute("id");i&&t.setAttribute("form",i)}}upload(t,e){try{let i=this._provider.upload(t,e);const r=new Promise(((t,e)=>{i.then((i=>{for(let t=0;t<i.length;t++)delete i[t]._file;let r=i[0];this._fileMeta.saveFile(r).then((e=>{const r=[];for(let t=1;t<i.length;t++){const o=i[t];o.parent=e.uuid,r.push(this._fileMeta.saveFile(o).then((t=>t)))}Promise.all(r).then((i=>{i.unshift(e),t(i)}))})).catch((t=>{e(t)}))})),i.catch((t=>{e(t)}))}));return r.cancel=()=>{i.cancel()},r}catch(t){return Promise.reject(t)}}constructor(t){this.settings=i.extend({api:"",queryParams:{}},t||{}),this._fileMeta=new tr({api:this.settings.api,queryParams:this.settings.queryParams,origin:4}),this._provider=new Zi({api:this.settings.api,queryParams:this.settings.queryParams})}}var nr=or;class ar{static getProductOption(t,e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t)return r;if(r.options&&r.options.length>0){let e=this.getProductOption(t,r.options);if(null!=e)return e}}return null}static hasEditLayer(t,e){return t&&e&&e!==ar.editLayer}static isEditLayer(t,e,i){return!!e&&(!i||!(t.name!==i&&!t.name.startsWith(i+"_")))}static isCropLayer(t,e,i){return!(!e||t.name!==i)}static hasRefRect(t){return t.params.refRect&&(t.params.autoScale||t.params.autoPos)}static getRefDimensions(t,e){return ar.hasRefRect(t)?{width:t.params.refWidth||e.config.width-100,height:t.params.refHeight||e.config.height-100}:{width:e.config.width,height:e.config.height}}static getRefCoordinates(t,e){return ar.hasRefRect(t)?{x:void 0!==t.params.refX?t.params.refX:50,y:void 0!==t.params.refY?t.params.refY:50}:t.params.autoPos?{x:0,y:0}:{x:0|t.params.x,y:0|t.params.y}}static getDimensions(t,e=!1){return e?{height:t.getScaledWidth(),width:t.getScaledHeight()}:{width:t.getScaledWidth(),height:t.getScaledHeight()}}static center(t,e,i,r){this.centerHorizontal(t,e,i,r),this.centerVertical(t,e,i,r)}static centerHorizontal(t,e,i,r){let o=i.x+r.width/2-e.width/2;t.left=parseFloat(o.toFixed(2))}static centerVertical(t,e,i,r){let o=i.y+r.height/2-e.height/2;t.top=parseFloat(o.toFixed(2))}}ar.editLayer="_";var sr=ar;var lr=class{static moveX(t,e){t._object.left+=e,this.updateMoving(t)}static moveY(t,e){t._object.top+=e,this.updateMoving(t)}static scale(t,e){t._object.scaleX+=e,t._object.scaleY+=e,this.updateScaling(t)}static rotate(){}static center(t,e){let i=sr.getDimensions(t._object),r=sr.getRefCoordinates(t,t._context),o=sr.getRefDimensions(t,t._context);"h"===e?sr.centerHorizontal(t._object,i,r,o):"v"===e?sr.centerVertical(t._object,i,r,o):sr.center(t._object,i,r,o),this.updateMoving(t)}static updateMoving(t){t._canvas&&(t._canvas.fire("object:moving",{target:t._object}),t._canvas.fire("object:modified",{target:t._object}),t._canvas.requestRenderAll())}static updateScaling(t){t._canvas&&(t._canvas.fire("object:scaling",{target:t._object}),t._canvas.fire("object:modified",{target:t._object}),t._canvas.requestRenderAll())}};const cr=(t,e)=>{if(t){let i={};i.used=e.value.length,i.min=e.params.min?e.params.min:0,i.max=e.params.max?e.params.max:1e3,i.left=i.max-i.used;for(let e in i)i.hasOwnProperty(e)&&(t=t.replace(new RegExp("{"+e+"}","g"),i[e]));return t}},pr=t=>t?t.replace(/\\n/g,"\n"):t,dr=(t,e)=>e?e.replace(new RegExp("{price}","g"),t):`(+ ${t})`,hr=t=>{if(t.values){let e=t._controller&&t._controller.multiSelect,i=e?[]:null;for(let r=0;r<t.values.length;r++){const o=t.values[r];if(e&&t._controller.isSelected(t,o))i.push(ur(o));else if(o.value==t.value)return o}if(i&&i.length)return{text:i.join(",")}}return t.value?{text:t.value}:null},ur=t=>t?t.text?t.text:t.value||"":"",mr=(t,e,i,r=!1)=>{let o=ur(e);if(t.params.valuePriceText){let r=fr(t,e,i);r&&(o+=" "+r)}return r&&(o=(t=>t.replace(/(<([^>]+)>)/gi,""))(o)),o},fr=(t,e,i)=>{if(e.price&&i)return dr(gr(t,e,i),t.params.priceTemplate)},gr=(t,e,i)=>{if(e.price&&i){let t=e.price;return Ni.currencyConvert&&!e.priceVariant&&(t=qi(t)),Di(100*t,i)}return""};let vr=(t,e,i,r=!1)=>{let o="";if(t.params.imgTooltip&&(o+=`<img src="${Qi(e.img,"600x")}" />${o}`),t.params.imgText||(o+=mr(t,e,i,r)),""!==o.trim())return o};const yr={mode:"both",enter:{active:"cl-po--fade-enter-active",from:"cl-po--fade-enter-from",to:"cl-po--fade-enter-to"},leave:{active:"cl-po--fade-leave-active",from:"cl-po--fade-leave-from",to:"cl-po--fade-leave-to"},duration:500},_r=()=>{let t=document.createElement("input");return t.type="color",t.value="!","color"===t.type&&"!"!==t.value},wr=(t,e={})=>(e["cl-po--invalid"]=t.errors&&t.errors.length>0,t._editor&&t._layer.params.collapse&&(e["cl-po--b-radius-0"]=!0),e),br=(t,e,i={})=>(t.params.size?i["cl-po--"+t.params.size]=!0:e&&(i["cl-po--"+e]=!0),t.params.shape&&(i["cl-po--"+t.params.shape]=!0),i),xr=(t,e,i,r)=>{e.params.toggle&&e.value===i.value&&(t.preventDefault(),t.stopImmediatePropagation(),e.value="",r(e))},Cr=(t,e={})=>(t.params.minWidth&&t.params.minWidth>0&&(e.minWidth=t.params.minWidth+"px"),e),Er=(t,e={})=>(t.params.btnColor&&(e.color=t.params.btnColor),t.params.btnBgColor&&(e.backgroundColor=t.params.btnBgColor),e),Pr=(t,e,r=300)=>0===(r=t.params.debounce||r)?e:i.debounced(r,e),Sr=t=>t.params.name?t.params.name:t.params.exclude?"_":`properties[${t.name}]`,Or=(t,e="noop")=>t.params.autocomplete?t.params.autocomplete:e,kr=(t,e)=>{if(t.params.optionFont){let i=e(t.params.optionFont);if(i&&i.value){let t=i.value,e=d.getFont(t);if(e)return e.loaded||d.loadFontsByName([t]),t}}return null},$r=(t,e,i)=>{if(t.target.value){let i=[];if("uppercase"===e.params.textTransform?t.target.value=t.target.value.toUpperCase():"lowercase"===e.params.textTransform&&(t.target.value=t.target.value.toLowerCase()),e.params.rowsMax){let i=t.target.value.split("\n");i.length>e.params.rowsMax&&(i.length=e.params.rowsMax,t.target.value=i.join("\n"))}if(e.params.textClean){if(!e._textClean)try{e._textClean=new RegExp(e.params.textClean,e.params.textCleanFlags||"ug")}catch(t){a.error("failed to compile textClean pattern for option: ",e.params.textClean,e,t)}e._textClean&&e._textClean.test(t.target.value)&&(t.target.value=t.target.value.replaceAll(e._textClean,""),i.push(l.get("product.options.validity.textClean",null,e.params.validationMsg||"Input not allowed")))}i.length&&(e.errors=i,e._error=!0)}return Lr(t,e,i)},Lr=(t,e,i)=>(e.value=t.target.value,i(e)),Tr=t=>{let e=[];return t._layer.params.editor.font&&e.push("font:"+(t._editor.fontFamily||"")),t._layer.params.editor.style&&(e.push("weight:"+(t._editor.fontWeight||"normal")),e.push("style:"+(t._editor.fontStyle||"normal"))),t._layer.params.editor.align&&e.push("align:"+(t._editor.textAlign||"left")),t._layer.params.editor.size&&e.push("size:"+(t._editor.fontSize||"normal")),t._layer.params.editor.color&&e.push("color:"+(t._editor.color||"#000000")),e.join(",")},Ir=(t,e,i)=>({multiSelect:!0,onValidate:t=>{let e=t.value?t.value.split(",").length:0;return t.params.minSelect&&e<t.params.minSelect?(t.errors.push(l.get("product.options.validity.selectMin",{min:t.params.minSelect})),!1):t.params.maxSelect&&e>t.params.maxSelect?(t.errors.push(l.get("product.options.validity.selectMax",{max:t.params.maxSelect})),!1):!(t.required&&!t.value)||(t.errors.push(l.get("product.options.validity.valueMissing")),!1)},onChange:(t,e)=>{let r=document.querySelector("#"+e.id);if(r){let t=document.querySelectorAll('[id^="'+e.id+'"]'),o=[];for(let e=0;e<t.length;e++){const i=t[e];i!==r&&i.checked&&o.push(i.value)}let n=o.join(",");r.value=n,e.value=n,i(e)}},isSelected:(t,e)=>{if(String(e.value).trim()===String(t.value).trim())return!0;if(t.value&&-1!==t.value.indexOf(e.value)){if(-1!==t.value.split(",").indexOf(e.value))return!0}return!1}});Ki.templates.hidden=(t,e,i)=>et`
    <input type="hidden" id="${t.id}" name="${Sr(t)}" .value=${fi(t.value)} form=${mi(e.productFormLink)}>
`;const Fr=t=>et`
    ${t._layer.params.collapseLabel?et`<span class="cl-po--edit-label">${t._layer.params.collapseLabel}</span>`:null}
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M15.728 9.686l-1.414-1.414L5 17.586V19h1.414l9.314-9.314zm1.414-1.414l1.414-1.414-1.414-1.414-1.414 1.414 1.414 1.414zM7.242 21H3v-4.243L16.435 3.322a1 1 0 0 1 1.414 0l2.829 2.829a1 1 0 0 1 0 1.414L7.243 21z" fill="var(--text-editor-color)"/></svg>
`;Ki.templates.text=(t,e,i)=>et`
    <input type="text" class="cl-po--input ${li(wr(t))}" id="${t.id}" name="${Sr(t)}" .value=${fi(t.value)} @input=${Pr(t,(e=>$r(e,t,i)))}
      ?required=${t.required} minlength=${mi(t.params.min)} maxlength=${mi(t.params.max)} pattern=${mi(t.params.pattern||void 0)} placeholder=${mi(t.params.placeholder)} autocomplete="${Or(t)}" form=${mi(e.productFormLink)} style=${pi({textTransform:t.params.textTransform})}>

    ${t._editor?t._layer.params.collapse?et`${Mr(Fr(t),Ki.templates.text_editor(t,e,i),!1,"cl-po--edit")}`:et`${Ki.templates.text_editor(t,e,i)}`:null}
`,Ki.templates.textarea=(t,e,i,r,o)=>et`
    <textarea class="cl-po--input ${li(wr(t))}" id="${t.id}" name="${Sr(t)}" .value=${fi(pr(t.value))} @input=${Pr(t,(e=>$r(e,t,i)))} @keyup=${t.params.textUsage?e=>((t,e)=>{let i=t.target;if(i){let t=i.parentNode.querySelector(".cl-po--text-help");t&&(e.value=i.value,t.innerHTML=cr(e.params.textHelp,e))}})(e,t):null}
     ?required=${t.required} minlength=${mi(t.params.min)} maxlength=${mi(t.params.max)} rows=${mi(t.params.rows)} placeholder=${mi(pr(t.params.placeholder))} style=${pi({textTransform:t.params.textTransform,fontFamily:kr(t,o)})} autocomplete="${Or(t)}" form=${mi(e.productFormLink)}>
    </textarea>

    ${t._editor?t._layer.params.collapse?et`${Mr(Fr(t),Ki.templates.text_editor(t,e,i),!1,"cl-po--edit")}`:et`${Ki.templates.text_editor(t,e,i)}`:null}
        
    ${t.params.textUsage?et`
        <div class="cl-po--help cl-po--text-help"></div>
    `:null}
`,Ki.templates.text_editor=(t,e,i)=>et`
    <div class="cl-po--text-editor">

        ${Ki.templates.hidden({id:t.id+"_editor",name:"_"+t.name+"_editor",params:{},value:Tr(t)},e)}
        
        ${t._layer.params.editor.font?et`
        <div class="cl-po--editor-group cl-po--font-family">
            ${Ki.templates.font({id:t.id+"_font",name:t.name+"_font",params:{name:t.name+"_font"},value:t._editor.fontFamily},e,(e=>{t._editor.fontFamily=e.value,i(t)}))}
        </div>`:null}
        ${t._layer.params.editor.style?et` 
        <div class="cl-po--editor-group cl-po--font-style">
            <div @click=${e=>{t._editor.fontWeight="bold"===t._editor.fontWeight?"normal":"bold",i(t)}} class="cl-po--swatch cl-po--swatch-button ${"bold"===t._editor.fontWeight?"selected":""}" data-tippy-content="${l.get("product.options.text.style.bold")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M8 11h4.5a2.5 2.5 0 1 0 0-5H8v5zm10 4.5a4.5 4.5 0 0 1-4.5 4.5H6V4h6.5a4.5 4.5 0 0 1 3.256 7.606A4.498 4.498 0 0 1 18 15.5zM8 13v5h5.5a2.5 2.5 0 1 0 0-5H8z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${e=>{t._editor.fontStyle="italic"===t._editor.fontStyle?"normal":"italic",i(t)}} class="cl-po--swatch cl-po--swatch-button ${"italic"===t._editor.fontStyle?"selected":""}" data-tippy-content="${l.get("product.options.text.style.italic")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M15 20H7v-2h2.927l2.116-12H9V4h8v2h-2.927l-2.116 12H15z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>`:null}
        ${t._layer.params.editor.align?et` 
        <div class="cl-po--editor-group cl-po--text-align">
            <div @click=${e=>{t._editor.textAlign="left",i(t)}} class="cl-po--swatch cl-po--swatch-button ${"left"===t._editor.textAlign?"selected":""}" data-tippy-content="${l.get("product.options.text.align.left")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M3 4h18v2H3V4zm0 15h14v2H3v-2zm0-5h18v2H3v-2zm0-5h14v2H3V9z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${e=>{t._editor.textAlign="center",i(t)}} class="cl-po--swatch cl-po--swatch-button ${"center"===t._editor.textAlign?"selected":""}" data-tippy-content="${l.get("product.options.text.align.center")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M3 4h18v2H3V4zm2 15h14v2H5v-2zm-2-5h18v2H3v-2zm2-5h14v2H5V9z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${e=>{t._editor.textAlign="right",i(t)}} class="cl-po--swatch cl-po--swatch-button ${"right"===t._editor.textAlign?"selected":""}" data-tippy-content="${l.get("product.options.text.align.right")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M3 4h18v2H3V4zm4 15h14v2H7v-2zm-4-5h18v2H3v-2zm4-5h14v2H7V9z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>`:null}
        ${t._layer.params.editor.size?et` 
        <div class="cl-po--editor-group cl-po--font-size">
            <div @click=${e=>{t._editor.fontSize=Math.max(t._layer.params.fontSizeMin||1,t._editor.fontSize-(t._layer.params.fontSizeStep||1)),i(t)}} class="cl-po--swatch cl-po--swatch-button">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M5 11h14v2H5z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div class="cl-po--swatch cl-po--swatch-button icon" data-tippy-content="${l.get("product.options.text.fontSize")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${e=>{t._editor.fontSize=Math.min(t._layer.params.fontSizeMax||1e5,t._editor.fontSize+(t._layer.params.fontSizeStep||1)),i(t)}} class="cl-po--swatch cl-po--swatch-button">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>`:null}
         ${t._layer.params.editor.color?et` 
        <div class="cl-po--editor-group cl-po--font-color">
            ${Ki.templates.color({id:t.id+"_color",name:t.name+"_color",params:{name:t.name+"_color"},value:t._editor.color||"#000000"},e,(e=>{t._editor.color=e.value,i(t)}))}
            ${_r()?et`
            <div class="cl-po--font-color-input">
            ${Ki.templates.color_input({id:t.id+"_color",name:t.name+"_color",params:{name:t.name+"_color"},value:t._editor.color||"#000000"},e,(e=>{t._editor.color=e.value,i(t)}))}
              </div>`:null}
        </div>`:null}
        
    </div>
`,Ki.templates.date=(t,e,i)=>{let r=void 0===t._controller;if(t._controller=t._controller||{setup:()=>{if(t._controller.native=(()=>{let t=document.createElement("input");return t.setAttribute("type","date"),t.setAttribute("value","a"),"a"!==t.value})(),t._controller.native)t._controller.ready=Promise.resolve();else{let i=[e.assets+"/static/lib/dateinput/dateinput.min.js"];t._controller.ready=rr.loadOnce(i,"option-date",{async:!1})}},onValidate:()=>{let e=t._controller.dateEl,i=e.checkValidity(),r=!1,o=!1;if(i&&!t._controller.native){if(e.min){let t=new Date(e.min+"T00:00:00");e.valueAsDate<t&&(i=!1,r=!0)}if(e.max){let t=new Date(e.max+"T00:00:00");e.valueAsDate>t&&(i=!1,o=!0)}}if(!i){if(e.validity.rangeUnderflow||r){let i=e.min,r=new Date(i+"T00:00:00");r.setDate(r.getDate()-1),i=t._controller.format(r,t.params.dateFormat||"yyyy-mm-dd"),t.errors.push(l.get("product.options.validity.dateMin",{min:i}))}else if(e.validity.rangeOverflow||o){let i=e.max,r=new Date(i+"T00:00:00");r.setDate(r.getDate()+1),i=t._controller.format(r,t.params.dateFormat||"yyyy-mm-dd"),t.errors.push(l.get("product.options.validity.dateMax",{max:i}))}else t.errors.push(l.get("product.options.validity.valueMissing"));return!1}return!0},onChange:(t,e)=>{e._controller.mapDateValue(e),i(e)},mapDateValue:t=>{t._controller.dateEl.value?t.params.dateFormat?t._controller.el.value=t._controller.format(t._controller.dateEl.valueAsDate,t.params.dateFormat):t._controller.el.value=t._controller.dateEl.value:t._controller.el.value="",t.value=t._controller.el.value},mapOptionValue:()=>{if(t.value&&t.value!==t._controller.el.value){let e,i=t.params.dateFormat;if(i&&"yyyy-mm-dd"!==i){let r;if(-1!==i.indexOf("/")?r=i.startsWith("yyyy")?/(?<year>\d{4})\/(?<month>\d{2})\/(?<day>\d{2})/:/(?<day>\d{2})\/(?<month>\d{2})\/(?<year>\d{4})/:-1!==i.indexOf(".")&&(r=i.startsWith("dd")?/(?<day>\d{2})\.(?<month>\d{2})\.(?<year>\d{4})/:/(?<month>\d{2})\.(?<day>\d{2})\.(?<year>\d{4})/),r){let i=r.exec(t.value);i&&(e=new Date(i.groups.year,i.groups.month-1,i.groups.day))}}else e=new Date(t.value+"T00:00:00");if(e)return t._controller.dateEl.valueAsDate=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),!0}return!1},format:(t,e)=>e=(e=(e=e.replace("yyyy",t.getFullYear())).replace("mm",("0"+(t.getMonth()+1)).slice(-2))).replace("dd",("0"+t.getDate()).slice(-2)),init:(t,e)=>{e&&(t._controller.options=e),t._controller.ready.then((()=>{if(t._controller.el=document.querySelector("#"+t.id),t._controller.dateEl=document.querySelector("#"+t.id+"-date"),!t._controller.native){if(window.navigator&&window.navigator.language){let e=navigator.language,i=e.substr(0,2);t._controller.dateEl.setAttribute("lang",e),"en"!==i&&t._controller.dateEl.setAttribute("data-first-day","mo")}t.params.dateFormat&&t._controller.dateEl.setAttribute("data-date-format",t.params.dateFormat)}t._controller.mapOptionValue(),t._controller.initMinMax(t)}))},initMinMax:t=>{const r=!isNaN(t.params.maxDays)&&null!=t.params.maxDays,o=!isNaN(t.params.minDays)&&null!=t.params.minDays;if(o||r){const n=e=>{r&&(e=>{if(e.setDate(e.getDate()+t.params.maxDays),t.params.maxDate){let i=new Date(t.params.maxDate+"T00:00:00");e>i&&(e=i)}t._controller.dateEl.max=t._controller.format(e,"yyyy-mm-dd"),t._controller.dateEl.valueAsDate&&t._controller.dateEl.valueAsDate>e&&(t._controller.dateEl.valueAsDate=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),t._controller.mapDateValue(t))})(new Date(e.getTime())),o&&(e=>{if(e.setDate(e.getDate()+t.params.minDays),t.params.minDate){let i=new Date(t.params.minDate+"T00:00:00");e<i&&(e=i)}t._controller.dateEl.min=t._controller.format(e,"yyyy-mm-dd"),(!t.value||t._controller.dateEl.valueAsDate&&t._controller.dateEl.valueAsDate<e)&&(t._controller.dateEl.valueAsDate=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),t._controller.mapDateValue(t))})(new Date(e.getTime()))};let a=new Date;if(t.params.optionDate){if(t._controller.options)for(let e=0;e<t._controller.options.length;e++){const i=t._controller.options[e];if(i.name===t.params.optionDate&&i._controller&&i._controller.dateEl){a=i._controller.dateEl.valueAsDate;break}}t._controller.optionChanged&&e.productForm.removeEventListener("option:changed",t._controller.optionChanged),t._controller.optionChanged=e=>{let r=e.detail;r.name===t.params.optionDate&&r._controller&&r._controller.dateEl&&(n(r._controller.dateEl.valueAsDate),i(t))},e.productForm.addEventListener("option:changed",t._controller.optionChanged)}n(a)}else if(t._controller.dateEl.min){let e=new Date(t._controller.dateEl.min+"T00:00:00");(!t.value||t._controller.dateEl.valueAsDate&&t._controller.dateEl.valueAsDate<e)&&(t._controller.dateEl.valueAsDate=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),t._controller.mapDateValue(t))}}},e.productForm)if(r){t._controller.setup();const i=r=>{let o=r.detail;e.productForm.removeEventListener("options:rendered",i),t._controller.init(t,o.config.options)};e.productForm.addEventListener("options:rendered",i)}else e.editorMode?t._controller.init(t):t._controller.mapOptionValue()&&t._controller.initMinMax(t);return et`
         <input type="hidden" name="${Sr(t)}" id="${t.id}" .value=${fi(t.value)} form=${mi(e.productFormLink)}  />
         <input type="date" class="cl-po--input ${li(wr(t))}" id="${t.id}-date" @change=${e=>t._controller.onChange(e,t)}
            ?required=${t.required} min=${mi(null!=t.params.minDate?t.params.minDate:void 0)} max=${mi(null!=t.params.maxDate?t.params.maxDate:void 0)}>
    `},Ki.templates.number=(t,e,i)=>et`
    <input type="number" class="cl-po--input ${li(wr(t))}" id="${t.id}" name="${Sr(t)}" .value=${fi(t.value)} @input=${Pr(t,(e=>Lr(e,t,i)))}
     ?required=${t.required} min=${mi(t.params.min)} max=${mi(t.params.max)} placeholder=${mi(t.params.placeholder)} autocomplete="${Or(t)}" form=${mi(e.productFormLink)}>
`,Ki.templates.dimension=(t,e,i)=>{let r=void 0===t._controller;if(t._controller=t._controller||{x:0,y:0,xInput:"",yInput:"",xEl:null,yEl:null,onValidate:t=>!t.required||t.value&&(t._controller.x>0||t._controller.y>0)?(t._controller.validateDimension(t,t.errors,!t._controller.xInput,!t._controller.yInput),!t.errors.length):(t.errors.push(l.get("product.options.validity.valueMissing")),!1),validateDimension:(t,e,i=!1,r=!1)=>{let o=t._controller.x,n=t._controller.y;if(t.params.bigX&&o<n){let t=o;o=n,n=t}const a=t=>t&&"#"===t[0]?t.substring(1):t;!i&&t.params.minX&&o<t.params.minX&&e.push(l.get(a(t.params.minXKey)||"{label} must be at least {min} {addon}",{label:t.params.labelX,min:t.params.minX,addon:t.params.addonX})),!r&&t.params.minY&&n<t.params.minY&&e.push(l.get(a(t.params.minYKey)||"{label} must be at least {min} {addon}",{label:t.params.labelY,min:t.params.minY,addon:t.params.addonY})),t.params.maxX&&o>t.params.maxX&&e.push(l.get(a(t.params.maxXKey)||"{label} must be at most {max} {addon}",{label:t.params.labelX,max:t.params.maxX,addon:t.params.addonX})),t.params.maxY&&n>t.params.maxY&&e.push(l.get(a(t.params.maxYKey)||"{label} must be at most {max} {addon}",{label:t.params.labelY,max:t.params.maxY,addon:t.params.addonY}))},optionValue:t=>(t.params.valueTemplate||"{x}x{y}").replace(new RegExp("{x}","g"),t._controller.x).replace(new RegExp("{y}","g"),t._controller.y).replace(new RegExp("{area}","g"),t._controller.area.toFixed(2)),onChange:(t,r,o=!1)=>{let n=r._controller;o||(n.xEl=n.xEl||document.querySelector("#"+r.id+"-x"),n.yEl=n.yEl||document.querySelector("#"+r.id+"-y"),n.xInput=n.xEl.value,n.yInput=n.yEl.value);const s=t=>t?t.replaceAll(",","."):"0";if(n.x=parseFloat(s(n.xInput))||0,n.y=parseFloat(s(n.yInput))||0,isNaN(r.params.rounding)||null===r.params.rounding||null!=t&&"blur"!==t.type||(0!==n.x&&(n.xInput=n.x.toFixed(r.params.rounding),n.x=parseFloat(n.xInput)),0!==n.y&&(n.yInput=n.y.toFixed(r.params.rounding),n.y=parseFloat(n.yInput))),r.params.areaCalc)try{if(!r._areaFunction)try{r._areaFunction=Function('"use strict";return (function(x,y){ return ('+r.params.areaCalc+") })")()}catch(t){a.error("failed to parse areaCalc: ",r.params.areaCalc,t),e.editorMode&&(r.errors=r.errors||[],r.errors.push(t))}r._areaFunction&&(n.area=r._areaFunction(n.x,n.y),n.area||(n.area=0))}catch(t){a.error("failed to calculate area with areaCalc: ",r.params.areaCalc,t),e.editorMode&&(r.errors=r.errors||[],r.errors.push(t))}else n.area=n.x*n.y;let l=[];if(n.validateDimension(r,l,!n.xInput,!n.yInput),l.length&&(r.errors=l,r._error=!0),r.value=n.optionValue(r),r.values||(r.values=[]),r.params.priceFormula)if(r.values.length&&r.values[0]._calc)r.values[0].value=r.value;else{let t="var x=option._controller.x;var y=option._controller.y;var area=option._controller.area;";-1===r.params.priceFormula.indexOf("return")?t+="return ("+r.params.priceFormula+")":t+=r.params.priceFormula;let e={value:r.value,text:"",priceType:Yi,priceFormula:t,_calc:!0};r.values.unshift(e)}else r.values.unshift({value:r.value,text:""});i(r)},restore:t=>{if(t.value&&t.value!==t._controller.optionValue(t)){let e=(t.params.valueTemplate||"{x}x{y}").replace(".","\\.").replace("*","\\*").replace(new RegExp("{x}","g"),"(?<x>.*)").replace(new RegExp("{y}","g"),"(?<y>.*)").replace(new RegExp("{area}","g"),"(?<area>.*)"),i=new RegExp(e,"g").exec(t.value);i&&i.groups&&(void 0!==i.groups.x&&(t._controller.xInput=i.groups.x),void 0!==i.groups.y&&(t._controller.yInput=i.groups.y),t._controller.onChange(null,t,!0))}},init:(t,e)=>{t.params.valueX&&(t._controller.xInput=String(t.params.valueX)),t.params.valueY&&(t._controller.yInput=String(t.params.valueY)),(t._controller.xInput||t._controller.yInput)&&t._controller.onChange(null,t,!0)}},r){const i=()=>{e.productForm.removeEventListener("options:rendered",i),t._controller.init(t)};e.productForm.addEventListener("options:rendered",i)}else t.value&&!t._controller.xEl&&t._controller.restore(t);return et`
            <input type="hidden" name="${Sr(t)}" id="${t.id}" value=${t.value} form=${mi(e.productFormLink)} />
            <div class="cl-po--dimension-container">
                 <div class="cl-po--dimension-item ${li({full:t.params.onlyX})}">
                     ${t.params.labelX?et`<label class="cl-po--label" for="${t.id}-x">${t.params.labelX}</label>`:null}
                     <div class="cl-po--input-group">
                         <input type="text" class="cl-po--input ${li(wr(t))}" id="${t.id}-x" name="properties[_${t.name}_x]" .value=${fi(t._controller.xInput)} @input=${Pr(t,(e=>t._controller.onChange(e,t)))} @blur=${e=>t._controller.onChange(e,t)}
                            ?required=${t.required} form=${mi(e.productFormLink)}>
                         ${t.params.addonX?et`<span class="cl-po--input cl-po--input-addon">${t.params.addonX}</span>`:null}
                     </div>
                 </div>
                <div class="cl-po--dimension-item ${li({"cl-hide":t.params.onlyX})}">
                    ${t.params.labelY?et`<label class="cl-po--label" for="${t.id}-y">${t.params.labelY}</label>`:null}
                    <div class="cl-po--input-group">
                        <input type="text" class="cl-po--input ${li(wr(t))}" id="${t.id}-y" name="properties[_${t.name}_y]" .value=${fi(t._controller.yInput)} @input=${Pr(t,(e=>t._controller.onChange(e,t)))} @blur=${e=>t._controller.onChange(e,t)}
                         ?required=${t.required} form=${mi(e.productFormLink)}>
                        ${t.params.addonY?et`<span class="cl-po--input cl-po--input-addon">${t.params.addonY}</span>`:null}
                    </div>
                </div>
           </div>
        `},Ki.templates.color=(t,e,i)=>et`
    ${_r()?et`
     <input type="color" class="cl-po--input ${li(wr(t))}" id="${t.id}" name="${Sr(t)}" .value=${fi(t.value)} @change=${e=>Lr(e,t,i)}
     ?required=${t.required} minlength=${mi(t.params.min)} maxlength=${mi(t.params.max)} placeholder=${mi(t.params.placeholder)} form=${mi(e.productFormLink)}>
        `:Ki.templates.color_input(t,e,i)}
`,Ki.templates.color_input=(t,e,i)=>et`
      <input type="text" class="cl-po--input ${li(wr(t))}" id="${t.id}" name="${Sr(t)}" .value=${fi(t.value)} @change=${e=>Lr(e,t,i)} 
      ?required=${t.required} pattern="#[0-9A-Fa-f]{6}" placeholder=${mi(t.params.placeholder)} autocomplete="${Or(t,"color")}" form=${mi(e.productFormLink)}>
`,Ki.templates["color-swatch"]=(t,e,i)=>t.params.multiSelect?(t._controller=t._controller||Ir(0,0,i),et`
            <div class="cl-po--swatch-container">
                <input type="hidden" name="${Sr(t)}" id="${t.id}" value=${t.value} form=${mi(e.productFormLink)} />
                ${ni(t.values||[],((i,r)=>et`
                    <label class="cl-po--swatch-item ${li({grow:t.params.grow})} ">
                        <input type="checkbox" class="cl-po--input ${li(wr(t))}" id="${t.id}-${r}"  .value=${i.value} @change=${e=>t._controller.onChange(e,t)}
                               .checked=${fi(t._controller.isSelected(t,i))} form=${mi(e.productFormLink)}>
                        <div class="cl-po--swatch cl-po--swatch-color ${li(br(t,"small"))}" style=${pi({backgroundColor:i.color})} data-tippy-content="${mr(t,i,Ni.moneyFormat)}" data-tippy-placement="bottom">
                        </div>
                    </label>
                    ${t.params.items&&(r+1)%t.params.items==0?et`<div class="cl-po--break" data-index=${r}></div>`:null}
                `))}
            </div>
        `):et`
            <div class="cl-po--swatch-container">
            ${ni(t.values||[],((r,o)=>et`
                <label class="cl-po--swatch-item ${li({grow:t.params.grow})}">
                    <input type="radio" class="cl-po--input ${li(wr(t))}" id="${t.id}-${o}" name="${Sr(t)}" .value=${r.value} @change=${e=>Lr(e,t,i)}
                           .checked=${fi(t.value==r.value)} ?required=${t.required} form=${mi(e.productFormLink)}>
                    <div class="cl-po--swatch cl-po--swatch-color ${li(br(t,"small"))}" style=${pi({backgroundColor:r.color})} data-tippy-content="${mr(t,r,Ni.moneyFormat)}" data-tippy-placement="bottom"
                         @click=${e=>xr(e,t,r,i)}>
                    </div>
                </label>
                ${t.params.items&&(o+1)%t.params.items==0?et`<div class="cl-po--break" data-index=${o}></div>`:null}
            `))}
            </div>
        `,Ki.templates["color-img-swatch"]=(t,e,i)=>Ki.templates["img-swatch"](t,e,i),Ki.templates["img-swatch"]=(t,e,i)=>t.params.multiSelect?(t._controller=t._controller||Ir(0,0,i),et`
            <div class="cl-po--swatch-container">
                <input type="hidden" name="${Sr(t)}" id="${t.id}" value=${t.value} form=${mi(e.productFormLink)} />
                ${ni(t.values||[],((i,r)=>et`
                    <label class="cl-po--swatch-item ${li({grow:t.params.grow})}">
                        <input type="checkbox" class="cl-po--input ${li(wr(t))}" id="${t.id}-${r}"  .value=${i.value} @change=${e=>t._controller.onChange(e,t)}
                               .checked=${fi(t._controller.isSelected(t,i))} form=${mi(e.productFormLink)}>
                        <div class="cl-po--swatch cl-po--swatch-img ${li(br(t,"large"))}" data-tippy-content="${mi(vr(t,i,Ni.moneyFormat))}" data-tippy-placement="bottom">
                            ${i.img?et`<img src="${Qi(i.img,Gi(t.params.size||"large"))}" />`:null}
                        </div>
                        ${t.params.imgText?et`<span class="cl-po--swatch-text">${Je(mr(t,i,Ni.moneyFormat))}</span>`:null}
                    </label>
                    ${t.params.items&&(r+1)%t.params.items==0?et`<div class="cl-po--break" data-index=${r}></div>`:null}
                `))}
            </div>
        `):et`
            <div class="cl-po--swatch-container">
                ${ni(t.values||[],((r,o)=>et`
                    <label class="cl-po--swatch-item ${li({grow:t.params.grow})}">
                        <input type="radio" class="cl-po--input ${li(wr(t))}" id="${t.id}-${o}" name="${Sr(t)}" .value=${r.value} @change=${e=>Lr(e,t,i)}
                               .checked=${fi(t.value==r.value)} ?required=${t.required} form=${mi(e.productFormLink)}>
                        <div class="cl-po--swatch cl-po--swatch-img  ${li(br(t,"large"))}" data-tippy-content="${mi(vr(t,r,Ni.moneyFormat))}" data-tippy-placement="bottom"
                             @click=${e=>xr(e,t,r,i)}>
                            ${r.img?et`<img src="${Qi(r.img,Gi(t.params.size||"large"))}" />`:null}
                        </div>
                        ${t.params.imgText?et`<span class="cl-po--swatch-text">${Je(mr(t,r,Ni.moneyFormat))}</span>`:null}
                    </label>
                    ${t.params.items&&(o+1)%t.params.items==0?et`<div class="cl-po--break" data-index=${o}></div>`:null}
                `))}
            </div>
        `,Ki.templates["button-swatch"]=(t,e,i)=>t.params.multiSelect?(t._controller=t._controller||Ir(0,0,i),et`
            <div class="cl-po--swatch-container">
                <input type="hidden" name="${Sr(t)}" id="${t.id}" value=${t.value} form=${mi(e.productFormLink)} />
                ${ni(t.values||[],((i,r)=>et`
                    <label class="cl-po--swatch-item ${li({grow:t.params.grow})}" >
                        <input type="checkbox" class="cl-po--input ${li(wr(t))}" id="${t.id}-${r}" .value=${i.value} @change=${e=>t._controller.onChange(e,t)}
                               .checked=${fi(t._controller.isSelected(t,i))} form=${mi(e.productFormLink)}>
                        <div class="cl-po--swatch cl-po--swatch-button ${li(br(t,"small"))}" style=${pi(Cr(t))} data-tippy-content="${mi(t.params.valuePriceTooltip?fr(t,i,Ni.moneyFormat):void 0)}" data-tippy-placement="bottom">
                            ${Je(mr(t,i,Ni.moneyFormat))}
                        </div>
                    </label>
                    ${t.params.items&&(r+1)%t.params.items==0?et`<div class="cl-po--break" data-index=${r}></div>`:null}
                `))}
            </div>
        `):et`
            <div class="cl-po--swatch-container">
                ${ni(t.values||[],((r,o)=>et`
                    <label class="cl-po--swatch-item ${li({grow:t.params.grow})}" >
                        <input type="radio" class="cl-po--input ${li(wr(t))}" id="${t.id}-${o}" name="${Sr(t)}" .value=${r.value} @change=${e=>Lr(e,t,i)}
                               .checked=${fi(t.value==r.value)} ?required=${t.required} form=${mi(e.productFormLink)}>
                        <div class="cl-po--swatch cl-po--swatch-button ${li(br(t,"small"))}" style=${pi(Cr(t))} data-tippy-content="${mi(t.params.valuePriceTooltip?fr(t,r,Ni.moneyFormat):void 0)}" data-tippy-placement="bottom"
                             @click=${e=>xr(e,t,r,i)}>
                            ${Je(mr(t,r,Ni.moneyFormat))}
                        </div>
                    </label>
                    ${t.params.items&&(o+1)%t.params.items==0?et`<div class="cl-po--break" data-index=${o}></div>`:null}
                `))}
            </div>
          
        `;Ki.templates["quantity-discount"]=(t,e,i)=>Xi.QUANTITY?(t._controller=t._controller||((t,e,i)=>{const r={quantity:1,quantityEl:null,quantityElOption:!1,quantityId:"",quantityDiscount:"",discount:0,discountType:zi,onChange:(t,e)=>{r.quantity=parseInt(e.value),r.syncEl(),r.selectDiscount(e),i(e)},selectDiscount:t=>{if(t.values)for(let e=0;e<t.values.length;e++){const i=t.values[e];if(i.value===t.value&&i._discount)return r.discount=i._discount,void(r.discountType=i.priceType)}r.discount=0},syncEl:()=>{r.quantityEl.value=r.quantity},syncValue:t=>{if(r.quantity=parseInt(r.quantityEl.value)||1,t.value="",r.discount=0,t.values)for(let e=0;e<t.values.length;e++){const i=t.values[e];if(i._discount){let e=parseInt(i.value);r.quantity>=e&&i._discount>r.discount&&(t.value=i.value)}}r.selectDiscount(t)},quantityDiscountText(t,e,i,r,o,n=""){let a,s,l,c,p=o.price.final,d=e*p;if(r===Ui)a=p-p*(i/100),l=a*e,s=`${t.params.textDiscountSave||"Save:"} ${i}%`,c=s;else{Ni.currencyConvert&&(i=qi(i));let t=Math.min(i,p);a=p-t,s="-"+Di(100*t,Ni.moneyFormat);let r=t*e;l=d-r,c="-"+Di(100*r,Ni.moneyFormat)}return`<span class="_quantity">${t.params.textDiscountBuy||"Buy:"} ${e}${n}</span>`+(t.params.discountTemplate||"{price} {compare} {discount}").replace(new RegExp("{compareP}","g"),`<span class="_compare">${Di(100*p,Ni.moneyFormat)}</span>`).replace(new RegExp("{compare}","g"),`<span class="_compare">${Di(100*d,Ni.moneyFormat)}</span>`).replace(new RegExp("{priceP}","g"),`<span class="_price">${Di(100*a,Ni.moneyFormat)}</span>`).replace(new RegExp("{price}","g"),`<span class="_price">${Di(100*l,Ni.moneyFormat)}</span>`).replace(new RegExp("{discountP}","g"),`<span class="_save">${s}</span>`).replace(new RegExp("{discount}","g"),`<span class="_save">${c}</span>`)},optionValueDiscountText(t,e,i){let o=parseInt(e.value);return r.quantityDiscountText(t,o,e._discount,e.priceType,i,"+")},init:t=>{let o=[];if(t.values)for(let e=0;e<t.values.length;e++){const i=t.values[e];if(i.price||i._price){i._discount=i._price||i.price,i.price=0,i._price=0;let t=parseInt(i.value);isNaN(t)||o.push(t+":"+i._discount+(i.priceType===Ui?"%":""))}}if(r.quantityId=e.uuid,t.params.quantityId&&(r.quantityId=t.params.quantityId),r.quantityDiscount=o.join(","),!r.quantityEl){const o="[name=quantity]";if(r.quantityEl=e.productForm.querySelector(o)||document.querySelector(o),r.quantityEl&&"hidden"===r.quantityEl.type&&(r.quantityEl.parentNode.removeChild(r.quantityEl),r.quantityEl=null),r.quantityEl)r.syncValue(t),r.quantityEl.addEventListener("change",(()=>{r.syncValue(t),i(t)}));else if(!r.quantityElOption){r.quantityElOption=!0;const i=o=>{e.productForm.removeEventListener("options:rendered",i),r.quantityEl=document.querySelector("#"+t.id+"-quantity"),r.quantityEl.value="1",r.syncValue(t)};e.productForm.addEventListener("options:rendered",i)}}}};return r.init(t),r})(t,e,i),e.editorMode&&t._controller.init(t),et`
            ${ni(t.values||[],((i,r)=>et`
                <label class="cl-po--radio-item" >
                    <input type="radio" class="cl-po--input ${li(wr(t))}" id="${t.id}-${r}" .value=${i.value} @change=${e=>Lr(e,t,(t=>t._controller.onChange(e,t)))}
                           .checked=${fi(t.value==i.value)} ?required=${t.required} form=${mi(e.productFormLink)}>
                    <div class="cl-po--discount-text">${Je(t._controller.optionValueDiscountText(t,i,e))}</div>
                </label>
            `))}

            ${!1!==t.params.discountLine&&t._controller.discount&&t._controller.quantity!==parseInt(t.value)?et`
                <label class="cl-po--radio-item cl-po--discount-text-custom">
                    <input type="radio" class="cl-po--input ${li(wr(t))}" style="opacity:0">
                    <div class="cl-po--discount-text">${Je(t._controller.quantityDiscountText(t,t._controller.quantity,t._controller.discount,t._controller.discountType,e))}</div>
                </label>
            `:null}
           
            ${t._controller.quantityElOption?et`
                <div class="cl-po--quantity-wrap cl-po--quantity-discount-el">
                    <span class="cl-po--quantity-btn" @click=${e=>{t._controller.quantity--,t._controller.syncEl(t),t._controller.syncValue(t),i(e,t)}}>-</span>
                    <input class="cl-po--input cl-po--quantity" id="${t.id}-quantity" name="quantity" form=${mi(e.productFormLink)} @change=${e=>{t._controller.syncValue(t),i(e,t)}}>
                    <span class="cl-po--quantity-btn" @click=${e=>{t._controller.quantity++,t._controller.syncEl(t),t._controller.syncValue(t),i(e,t)}}>+</span>
                </div>
            `:null}
            
            <input type="hidden" name="properties[${Ri.QUANTITY_ID}]" value=${t._controller.quantityId} form=${mi(e.productFormLink)}>
            <input type="hidden" name="properties[${Ri.QUANTITY_DISCOUNT}]" value=${t._controller.quantityDiscount} form=${mi(e.productFormLink)}>
        `):et``,Ki.templates.personalize=(t,e,i)=>et`
            <div class="cl-po--swatch-container">
                ${ni(t.values||[],((r,o)=>et`

                    <label class="cl-po--swatch-item ${li({grow:t.params.grow,personalize:t.value==r.value?"none":null})}" >
                        <input type="radio" class="cl-po--input ${li(wr(t))}" id="${t.id}-${o}" name="${Sr(t)}" .value=${r.value} @change=${e=>Lr(e,t,(t=>t._controller.onChange(e,t)))} 
                               .checked=${t.value==r.value} ?required=${t.required} form=${mi(e.productFormLink)}>
                        <div class="cl-po--swatch cl-po--swatch-button ${li(br(t,"small"))}" style=${pi(Cr(t,Er(t)))} data-tippy-content="${mi(t.params.valuePriceTooltip?fr(t,r,Ni.moneyFormat):void 0)}" data-tippy-placement="bottom"
                             @click=${e=>xr(e,t,r,i)}>
                            ${Je(mr(t,r,Ni.moneyFormat))}
                        </div>
                    </label>
                    ${t.params.items&&(o+1)%t.params.items==0?et`<div class="cl-po--break" data-index=${o}></div>`:null}
                `))}
            </div>
        `,Ki.templates.download=(t,e,i)=>et`
            <div class="cl-po--swatch-container">
                 <label class="cl-po--swatch-item ${li({grow:t.params.grow})}" >
                        <div class="cl-po--swatch cl-po--swatch-button ${li(br(t,"small"))}" style=${pi(Cr(t,Er(t)))}
                             @click=${i=>e.productForm.dispatchEvent(new CustomEvent("option:export",{detail:t,cancelable:!0,bubbles:!0}))}>
                             ${t.params.btnText||"Download"}
                        </div>
                 </label>
            </div>
        `,Ki.templates.radio=(t,e,i)=>et`
    ${ni(t.values||[],((r,o)=>et`
        <label class="cl-po--radio-item" >
            <input type="radio" class="cl-po--input ${li(wr(t))}" id="${t.id}-${o}" name="${Sr(t)}" .value=${r.value} @change=${e=>Lr(e,t,i)}
                   .checked=${fi(t.value==r.value)} ?required=${t.required} form=${mi(e.productFormLink)}>
            ${Je(mr(t,r,Ni.moneyFormat))}
        </label>
    `))}
`,Ki.templates.checkbox=(t,e,i)=>(t._controller=t._controller||Ir(0,0,i),et`
        <input type="hidden" name="${Sr(t)}" id="${t.id}" value=${t.value} form=${mi(e.productFormLink)} />
        ${ni(t.values||[],((i,r)=>et`
        <label class="cl-po--checkbox-item" >
            <input type="checkbox" class="cl-po--input ${li(wr(t))}" id="${t.id}-${r}" .value=${i.value} @change=${e=>t._controller.onChange(e,t)}
                   .checked=${fi(t._controller.isSelected(t,i))} form=${mi(e.productFormLink)}>
            ${Je(mr(t,i,Ni.moneyFormat))}
        </label>
    `))}
    `),Ki.templates.select=(t,e,i)=>et`
    <select class="cl-po--input ${li(wr(t))}" id="${t.id}" .value=${fi(t.value)} name="${Sr(t)}" @change=${e=>Lr(e,t,i)} ?required=${t.required} form=${mi(e.productFormLink)}>
        ${t.value?null:et`
           <option value="" selected>${t.params.textValueSelect||""}</option>`}
        
        ${ni(t.values||[],((e,i)=>et`            
            <option .value=${e.value} ?selected=${t.value==e.value} > ${mr(t,e,Ni.moneyFormat,!0)}</option>
        `))}
    </select>
`,Ki.templates.font=(t,e,i)=>{let r;r=t.params.fontFamilies&&t.params.fontFamilies.length?t.params.fontFamilies:d.fonts.map((t=>t.name)),t.params.fontSortAlpha&&r.sort(((t,e)=>t.localeCompare(e))),t.values=r.map((t=>({value:t,text:" ",img:d.fontPreview(t)})));let o="dropdown";return t.params.fontSwatch&&(t.params.grow=!0,t.params.items=t.params.fontSwatchItems||3,o="img-swatch"),et`
        <div class="cl-po--font-selector">
            ${Ki.templates[o](t,e,i)}
        </div>
    `},Ki.templates.dropdown=(t,e,i)=>{let r=void 0===t._controller;if(t._controller=t._controller||{setup:()=>{let i=[e.assets+"/static/lib/choicesjs/choices.min.css",e.assets+"/static/lib/choicesjs/choices.min.js"];t._controller.ready=rr.loadOnce(i,"option-dropdown",{async:!1})},mapValues:t=>{let e=t.values?t.values.map((e=>({value:e.value,label:mr(t,e,Ni.moneyFormat),customProperties:e.img,selected:t.value==e.value}))):[];return t.value||e.unshift({value:"",label:t.params.textValueSelect||"",selected:!0}),e},init:t=>{t._controller.ready.then((()=>{t._controller.selectEl=document.querySelector("#"+t.id);const e=t=>{let e=`<span class="o--text">${t.label}</span>`;return t.customProperties?`<img src="${Qi(t.customProperties,"200x")}" class="o--img"/> ${e}`:e};t._controller.instance=new Choices(t._controller.selectEl,{choices:t._controller.mapValues(t),itemSelectText:"",searchPlaceholderValue:t.params.textSearchValues||"",searchEnabled:t.params.searchValues||!1,searchChoices:t.params.searchValues||!1,shouldSort:!1,callbackOnCreateTemplates:function(t){return{item:(t,i,r)=>{let o=Choices.defaults.templates.item.apply(this,[t,i,r]);return o.innerHTML=e(i),o},choice:(t,i,r)=>{let o=Choices.defaults.templates.choice.apply(this,[t,i,r]);return o.innerHTML=e(i),o}}}})}))},updateChoices:t=>{t._controller.instance&&t._controller.instance.setChoices(t._controller.mapValues(t),"value","label",!0)},update:t=>{t._controller.instance&&t._controller.selectEl&&t.value!==t._controller.selectEl.value&&t._controller.instance.setChoiceByValue(t.value)}},e.productForm)if(r){t._controller.setup();const i=()=>{e.productForm.removeEventListener("options:rendered",i),t._controller.init(t)};e.productForm.addEventListener("options:rendered",i)}else if(e.editorMode)t._controller.updateChoices(t);else if(t._controller.update(t),t.params.valuePriceText){let e=hr(t);e&&e._priceFunction&&t._controller.updateChoices(t)}return et`
        <select class="cl-po--input ${li(wr(t))}" id="${t.id}" name="${Sr(t)}" @change=${e=>Lr(e,t,i)} ?required=${t.required} form=${mi(e.productFormLink)}>
        </select>
    `};const Mr=(t,e,i,r="")=>et`
    <div class="cl-po--collapse ${i?r+" cl-po--open":r}" @click=${t=>(t=>{let e=t.currentTarget,i=-1!==e.className.indexOf("open"),r=e.nextElementSibling;i||(r.style.maxHeight=r.scrollHeight+100+"px",setTimeout((()=>{r.style.maxHeight&&(r.style.maxHeight=null)}),500)),e.classList.toggle("cl-po--open")})(t)}>${t}</div>
    <div class="cl-po--panel ${r}">
        ${e}
    </div>
`;Ki.templates.group=(t,e,i,r,o)=>{const n=et`
            <div class="cl-po--group" >
                ${t.options&&t.options.length>0?et`
                    ${Ar(t.options,e,i,r,o)}
                `:null}
            </div>`;return t.params.collapse?Mr(Je(t.params.collapseLabel),n,t.params.collapseOpen):n},Ki.templates.html=(t,e,i)=>et`
    ${Je(t.params.html.replace(new RegExp("{product}","g"),e.product.id))}
`,Ki.templates.layer_editor=(t,e,i)=>et`
    ${t._layer.params.collapseLabel?et`<span class="cl-po--layer-editor-label cl-po--help">${t._layer.params.collapseLabel}</span>`:null}
    <div class="cl-po--text-editor cl-po--layer-editor">
        ${t._layer.params.editor.scale?et`
        <div class="cl-po--editor-group cl-po--layer-scale">
            <div @click=${e=>{lr.scale(t._layer,-(t._layer.params.editor.scaleStep||.1))}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.scaleDown",null,"Scale down")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M5 11h14v2H5z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${e=>{lr.scale(t._layer,t._layer.params.editor.scaleStep||.1)}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.scaleUp",null,"Scale up")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>
        `:null}
        ${t._layer.params.editor.center?et`
        <div class="cl-po--editor-group cl-po--layer-center">
            <div @click=${e=>{lr.center(t._layer,"h")}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.centerH",null,"Center horizontal")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M16.05,7.05 L21,12 L16.05,16.95 L14.636,15.536 L17.172,12.999 L4,13 L4,11 L17.172,11 L14.636,8.464 L16.05,7.05 Z M7.95,7.05 L9.364,8.464 L6.828,11 L20,11 L20,13 L6.828,13 L9.364,15.536 L7.95,16.95 L3,12 L7.95,7.05 Z" fill="var(--text-editor-color)"></path></svg>
            </div>
            <div @click=${e=>{lr.center(t._layer,"v")}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.centerV",null,"Center vertical")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><g transform="translate(7, 3)"><path d="M9.95,4.95 L8.536,6.364 L6,3.828 L6,17 L4,17 L4,3.828 L1.465,6.364 L0.05,4.95 L5,0 L9.95,4.95 Z M9.95,13.05 L5,18 L0.05,13.05 L1.464,11.636 L4.001,14.172 L4,1 L6,1 L6,14.172 L8.536,11.636 L9.95,13.05 L9.95,13.05 Z" fill="var(--text-editor-color)"></path></g></svg>
            </div>
            <div @click=${e=>{lr.center(t._layer)}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.center",null,"Center")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M11 11V5.828L9.172 7.657 7.757 6.243 12 2l4.243 4.243-1.415 1.414L13 5.828V11h5.172l-1.829-1.828 1.414-1.415L22 12l-4.243 4.243-1.414-1.415L18.172 13H13v5.172l1.828-1.829 1.415 1.414L12 22l-4.243-4.243 1.415-1.414L11 18.172V13H5.828l1.829 1.828-1.414 1.415L2 12l4.243-4.243 1.414 1.415L5.828 11z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>
        `:null}
        ${t._layer.params.editor.move?et`
        <div class="cl-po--editor-group cl-po--layer-move">
            <div @click=${e=>{lr.moveX(t._layer,-(t._layer.params.editor.moveStep||50))}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.moveLeft",null,"Move left")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M7.828 11H20v2H7.828l5.364 5.364-1.414 1.414L4 12l7.778-7.778 1.414 1.414z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${e=>{lr.moveX(t._layer,t._layer.params.editor.moveStep||50)}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.moveRight",null,"Move right")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${e=>{lr.moveY(t._layer,-(t._layer.params.editor.moveStep||50))}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.moveUp",null,"Move up")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M13 7.828V20h-2V7.828l-5.364 5.364-1.414-1.414L12 4l7.778 7.778-1.414 1.414L13 7.828z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${e=>{lr.moveY(t._layer,t._layer.params.editor.moveStep||50)}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.moveDown",null,"Move down")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M13 16.172l5.364-5.364 1.414 1.414L12 20l-7.778-7.778 1.414-1.414L11 16.172V4h2v12.172z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>
        `:null}
    </div>
`,Ki.templates.upload=(t,e,i)=>{let r=void 0===t._controller;return t._controller=t._controller||nr.getInstance().controller(),r||t._controller.update(t,e.productForm),et`  
        <div class="cl-po--upload ${li(wr(t))}">
            <div class="cl-po--upload-wrap">
                <label class="cl-po--input cl-po--upload-button">
                 <input type="file" @change=${r=>t._controller.onChange(r,t,e.productForm,i)} 
                    ?required=${t.required} ?multiple=${t.params.multiple}  accept=${mi(t.params.accept)} >
                 <span>${Je(t.params.button||"Choose file")}</span>
                </label>
                ${t.value&&t._layer&&t._layer.params.crop?et`
                    <label class="cl-po--input cl-po--upload-button crop ${li({"has-label":t._layer.params.cropLabel})}" @click=${i=>t._controller.crop(t,e.productForm)}>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M15 17v2H6a1 1 0 0 1-1-1V7H2V5h3V2h2v15h8zm2 5V7H9V5h9a1 1 0 0 1 1 1v11h3v2h-3v3h-2z" /></svg>
                        ${t._layer.params.cropLabel?et`<span class="cl-po--crop-label">${t._layer.params.cropLabel}</span>`:null}
                    </label>
                `:null}
            </div>
            <progress class="cl-po--preview-progress" style="display:none;"></progress>
            <div class="cl-po--upload-files">
             ${ni(t._controller.files,(r=>et`
                   <div>${r.name} <span class="cl-po--remove" @click=${o=>t._controller.remove(t,e.productForm,r,i)}>&times;</span></div>
             `))}
            </div>
            
            ${t.value&&t._layer&&t._layer&&t._layer.params.layerEditor?et`${Ki.templates.layer_editor(t,e,i)}`:null}
        </div>
    `},Ki.templates["upload-lift"]=(t,e,i)=>{if(t.params.uuid){t._controller&&(t._controller.field&&t._controller.field.config.uuid!==t.params.uuid?(t._controller.field.destroy(),delete t._controller):e.editorMode&&t._controller.notfound&&delete t._controller);let r=void 0===t._controller;return t._controller=t._controller||nr.getInstance().controllerLift(t,e.product,e.productForm,i),r||t._controller.update(t,e.productForm),t._controller.option=t,et`
            <div class="cl-po--upload-lift ${li(wr(t))}">
                <div class="cl-po--upload-lift-${t.id}"></div>
                ${t.value&&t._layer&&t._layer.params.crop?et`
                    <label class="cl-po--input cl-po--upload-lift-crop ${li({"has-label":t._layer.params.cropLabel})}" @click=${i=>t._controller.crop(t,e.productForm)}>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" ><path fill="currentColor" d="M15 17v2H6a1 1 0 0 1-1-1V7H2V5h3V2h2v15h8zm2 5V7H9V5h9a1 1 0 0 1 1 1v11h3v2h-3v3h-2z" /></svg>
                        ${t._layer.params.cropLabel?et`<span class="cl-po--crop-label">${t._layer.params.cropLabel}</span>`:null}
                    </label>
                `:null}

                ${t.value&&t._layer&&t._layer.params.layerEditor?et`${Ki.templates.layer_editor(t,e,i)}`:null}
            </div>`}return null};const Ar=(t,e,i,r,o)=>et`
    ${ni(t,(t=>t.name),((t,n)=>et`
            
             ${hi(t.visible?et`
                 <div class="cl-po--option" data-option="${t.name}">
                    ${t.label?et`
                    <label class="cl-po--label" for="${t.id}">${Je(t.label)} ${t.value&&t.params.labelValueText?et`<span class="cl-po--value">&nbsp;${ur(hr(t))}</span>`:null} ${t._priceText?et`<span class="cl-po--price">&nbsp;${Je(dr(t._priceText,t.params.priceTemplate))}</span>`:null}    ${t.params.info?et`<span class="cl-po--info" data-tippy-content="${t.params.info}"></span>`:null}</label>
                    `:null}
                    
                    ${Ki.templates[t.type]?et`
                      ${Ki.templates[t.type](t,e,i,r,o)}
                    `:null}
                     
                    ${t.params.help?et`
                    <div class="cl-po--help">${Je(t.params.help)}</div>
                    `:null}
                     
                    ${Ai(t.errors&&t.errors.length>0?Ei(et`
                    <div class="cl-po--errors">
                        ${ni(t.errors,((e,i)=>et`
                            <div class="cl-po--error" @click=${i=>r(i,t,e)}>${e}</div>
                        `))}
                    </div>
                    `,`${t.id}-errors`):Ei(et`<span></span>`,"noop"),yr)}
                   
                </div>
             `:null)}
    `))}
`;var Dr=(t,e,i,r,o,n)=>et`
<div class="cl-po--options">

${t.length>0?et`
        ${Ar(t,e,i,r,n)}
        
        ${e.editorMode?et`  
            <div class="cl-editor-mode">
                <p data-live-price="${e.product.id}" ></p>
                <p data-live-weight="${e.product.id}" ></p>
                <button class="cl-po--swatch cl-po--swatch-button cl-po--small" @click="${t=>o(t)}">
                    Add to cart (validation test)
                </button>
            </div>
            `:null}
    `:null} 
    
    <input type="hidden" name="properties[${Ri.OPTIONS}]" value=${e.uuid} form=${mi(e.productFormLink)}>
</div>
`;var Rr=(t,e,i,r,o,n)=>et`
<div class="ldcv ${r.className}" >
    <div class="base">
        <div class="inner card">
            <div class="cl-po--popup">
                <div class="cl-po--popup-preview">
                    ${t}
                </div>
                <div class="cl-po--popup-options cl--po-wrapper" id=${r.id}>
                    <div class="options-scroll">
                        ${r.visible?e:null}
                    </div>
                    <div class="options-atc">
                        <div class="atc-wrap">
                            <div class="atc-price">
                                ${i}
                            </div>
                            <div class="atc-button">
                                <button class="cl-po--swatch cl-po--swatch-button" @click="${t=>o(t)}" style=${pi(((t,e={})=>(t.params.atcColor&&(e.color=t.params.atcColor),t.params.atcBgColor&&(e.backgroundColor=t.params.atcBgColor),e))(r.option))}>
                                    ${r.option.params.atcText||"Add to Cart"}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="cl-po--popup-close" @click="${t=>n(t)}">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" ><path fill="none" d="M0 0h24v24H0z"/><path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm0-9.414l2.828-2.829 1.415 1.415L13.414 12l2.829 2.828-1.415 1.415L12 13.414l-2.828 2.829-1.415-1.415L10.586 12 7.757 9.172l1.415-1.415L12 10.586z"/></svg>
            </div>
        </div>
    </div>
</div>
`;var jr={};!function(t){var e=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,i=t.Blob&&function(){try{return Boolean(new Blob)}catch(t){return!1}}(),r=i&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(t){return!1}}(),o=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,n=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,a=(i||o)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(t){var e,a,s,l,c,p,d,h,u;if(!(e=t.match(n)))throw new Error("invalid data URI");for(a=e[2]?e[1]:"text/plain"+(e[3]||";charset=US-ASCII"),s=!!e[4],l=t.slice(e[0].length),c=s?atob(l):decodeURIComponent(l),p=new ArrayBuffer(c.length),d=new Uint8Array(p),h=0;h<c.length;h+=1)d[h]=c.charCodeAt(h);return i?new Blob([r?d:p],{type:a}):((u=new o).append(p),u.getBlob(a))};t.HTMLCanvasElement&&!e.toBlob&&(e.mozGetAsFile?e.toBlob=function(t,i,r){var o=this;setTimeout((function(){r&&e.toDataURL&&a?t(a(o.toDataURL(i,r))):t(o.mozGetAsFile("blob",i))}))}:e.toDataURL&&a&&(e.msToBlob?e.toBlob=function(t,i,r){var o=this;setTimeout((function(){(i&&"image/png"!==i||r)&&e.toDataURL&&a?t(a(o.toDataURL(i,r))):t(o.msToBlob(i))}))}:e.toBlob=function(t,e,i){var r=this;setTimeout((function(){t(a(r.toDataURL(e,i)))}))})),"function"==typeof define&&define.amd?define((function(){return a})):jr?jr=a:t.dataURLtoBlob=a}(window);var Nr=(t,e)=>et`
<div class="cl-po--preview"> 
    <canvas class="cl-po--canvas"></canvas>
</div>
`;var qr=(t,e,i,r)=>et`
<div class="cl-po--preview-crop">
    <button type="button" @click=${t=>i()}>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30"><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></svg>
    </button>
    <div>
        <button type="button" @click=${e=>t(!1)} >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30"><path d="M18.031 16.617l4.283 4.282-1.415 1.415-4.282-4.283A8.96 8.96 0 0 1 11 20c-4.968 0-9-4.032-9-9s4.032-9 9-9 9 4.032 9 9a8.96 8.96 0 0 1-1.969 5.617zm-2.006-.742A6.977 6.977 0 0 0 18 11c0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7a6.977 6.977 0 0 0 4.875-1.975l.15-.15zM7 10h8v2H7v-2z"/></svg>
        </button>
        <button type="button" @click=${e=>t(!0)} >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30"><path d="M18.031 16.617l4.283 4.282-1.415 1.415-4.282-4.283A8.96 8.96 0 0 1 11 20c-4.968 0-9-4.032-9-9s4.032-9 9-9 9 4.032 9 9a8.96 8.96 0 0 1-1.969 5.617zm-2.006-.742A6.977 6.977 0 0 0 18 11c0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7a6.977 6.977 0 0 0 4.875-1.975l.15-.15zM10 10V7h2v3h3v2h-3v3h-2v-3H7v-2h3z"/></svg>
        </button>
        <button type="button" @click=${t=>e(90)} >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30"><path fill="none" d="M0 0h24v24H0z"/><path d="M20 10.586l1.828-1.829 1.415 1.415L19 14.414l-4.243-4.242 1.415-1.415L18 10.586V8a3 3 0 0 0-3-3h-4V3h4a5 5 0 0 1 5 5v2.586zM13 9a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1h10zm-1 2H4v8h8v-8z"/></svg>
        </button>
    </div>
    <button type="button" @click=${t=>r()} style="background:#31cc01;margin-right:1px;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30"><path fill="white" d="M10 15.172l9.192-9.193 1.415 1.414L10 18l-6.364-6.364 1.414-1.414z"/></svg>
    </button>
    <svg class="icon-crop cursor" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <path class="cursor-x-y" d="M56 49v-3l4 4-4 4v-3h-5v5h3l-4 4-4-4h3v-5h-5v3l-4-4 4-4v3h5v-5h-3l4-4 4 4h-3v5z" />
    </svg>
    <svg class="icon-crop touch"  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">
        <path class="hand-x-y" d="M139.93,113.56l-41.12-6.93V76.08a9.25,9.25,0,0,0-9.25-9.25h0a9.25,9.25,0,0,0-9.25,9.25v57.36L71,122.65c-3.61-3.61-8.44-3.89-13.08,0,0,0-7.24,5.84-3.83,9.25l34,34h42.63a9.25,9.25,0,0,0,9.07-7.43l6.82-34.09A9.28,9.28,0,0,0,139.93,113.56Z"/>
    </svg>
</div>
`;class Vr{evaluateConditions(t,e,i){let r=1===e?"OR":"AND",o=a.getLevel();o<=a.levels.TRACE&&a.debug("====> evaluating conditions for: "+i+" in mode "+r,t);let n=!1;if(t.length)for(let i=0;i<t.length;i++){const r=t[i];if(n=this.evaluateCondition(r,this.data),o<=a.levels.TRACE&&a.debug("evaluated condition: ",r,n),1===e){if(n)break}else if(!n)break}else n=!0;return a.debug("======> evaluated conditions for: "+i+" in mode "+r,n),!!n}evaluateCondition(t,e){return"options"===t.data?this.evaluateOptionCondition(t,e.options):"product"===t.data?this.evaluateProductCondition(t,e.product):"variant"===t.data&&this.evaluateVariantCondition(t,e.variant)}evaluateOptionCondition(t,e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t.field){if(t.value&&-1!==t.value.indexOf(",")){let e=t.value.split(",");for(let i=0;i<e.length;i++){const o=e[i];if(this.evaluateOperation(t.operator,o,r.value))return!0}}if(0!==t.operator.indexOf("!")&&t.value&&r.value&&r._controller&&r._controller.multiSelect&&-1!==r.value.indexOf(",")){let e=r.value.split(",");for(let i=0;i<e.length;i++){const r=e[i];if(this.evaluateOperation(t.operator,t.value,r))return!0}return!1}return this.evaluateOperation(t.operator,t.value,r.value)}if(r.options&&r.options.length>0){if(this.evaluateOptionCondition(t,r.options))return!0}}return!1}evaluateVariantCondition(t,e){if(e)switch(t.field){case"variant":if(t.variants)for(let i=0;i<t.variants.length;i++)if(t.variants[i]&&t.variants[i].id.toString()===e.id.toString())return!0;break;case"variant_title":if(this.evaluateOperation(t.operator,t.value,e.title))return!0}return!1}evaluateProductCondition(t,e){switch(t.field){case"product":for(let i=0;i<t.products.length;i++)if(t.products[i]&&t.products[i].id.toString()===e.id.toString())return!0;break;case"product_handle":if(this.evaluateOperation(t.operator,t.value,e.handle))return!0;break;case"product_title":if(this.evaluateOperation(t.operator,t.value,e.title))return!0;break;case"product_type":if(e.type&&this.evaluateOperation(t.operator,t.value,e.type))return!0;if(e.product_type&&this.evaluateOperation(t.operator,t.value,e.product_type))return!0;break;case"product_vendor":if(this.evaluateOperation(t.operator,t.value,e.vendor))return!0;break;case"product_tags":let i;if(Array.isArray(e.tags))i=e.tags;else{if(!e.tags)break;i=e.tags.indexOf(", ")>=0?e.tags.split(", "):[e.tags]}for(let e=0;e<t.tags.length;e++)for(let r=0;r<i.length;r++)if(t.tags[e].toString().toLowerCase().trim()===i[r].toString().toLowerCase().trim())return!0}return!1}evaluateOperation(t,e,i){if(void 0!==i){switch(t){case"equals":return i.toString().toLowerCase().trim()===e.toString().toLowerCase().trim();case"!equals":return i.toString().toLowerCase().trim()!==e.toString().toLowerCase().trim();case"contains":return i.toString().toLowerCase().trim().indexOf(e.toString().toLowerCase().trim())>-1;case"!contains":return-1===i.toString().toLowerCase().trim().indexOf(e.toString().toLowerCase().trim());case"empty":return!i;case"!empty":return!!i;case"=":return parseFloat(i)===parseFloat(e);case"!=":return parseFloat(i)!==parseFloat(e);case">":return parseFloat(i)>parseFloat(e);case">=":return parseFloat(i)>=parseFloat(e);case"<":return parseFloat(i)<parseFloat(e);case"<=":return parseFloat(i)<=parseFloat(e)}return!1}}constructor(t,e={}){this.settings=i.extend({},t||{}),this.data=e}}Vr.MODE={OR:1,AND:2};var Br=Vr;var Hr=class{render(t,e,i){}_getOptions(t,e,i=t.params){let r={visible:!0,selectable:!1,evented:!1,lockUniScaling:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockMovementX:!0,lockMovementY:!0,hasControls:!1,lockScalingFlip:!0};if(r.visible=!0,r.centeredRotation=!0,i.autoRotate?r.angle=0:void 0!==i.angle&&(r.angle=i.angle%360),i.autoPos&&!t._interactive?(r.left=0,r.top=0):(void 0!==i.x&&(r.left=i.x),void 0!==i.y&&(r.top=i.y)),i.autoScale&&!t._interactiveScaled?(r.scaleX=1,r.scaleY=1):(void 0!==i.scaleX&&(r.scaleX=i.scaleX),void 0!==i.scaleY&&(r.scaleY=i.scaleY)),void 0!==i.width&&(r.width=i.width),void 0!==i.height&&(r.height=i.height),sr.isEditLayer(t,e.editorMode,e.editLayer)&&!e.cropMode){if(!sr.hasRefRect(t)){r.lockMovementX=!0===t.params.autoPos,r.lockMovementY=!0===t.params.autoPos,r.lockScalingX=!0===t.params.autoScale,r.lockScalingY=!0===t.params.autoScale;let e=!t.params.autoPos||!t.params.autoScale;r.hasControls=e,r.selectable=e,r.evented=e,r.lockRotation=!1}}else if(sr.isCropLayer(t,e.cropMode,e.cropLayer)){r.lockMovementX=!1,r.lockMovementY=!1,i.interactive=!1;let t=!1;r.lockScalingX=!t,r.lockScalingY=!t,r.hasControls=t,r.selectable=!0,r.evented=!0,r.borderColor="rgb(178,204,255)",r.borderScaleFactor=1}else t.params.interactive&&!e.cropMode&&(e.editorMode&&sr.hasEditLayer(e.editorMode,e.editLayer)||(r.lockMovementX=!1,r.lockMovementY=!1,"upload"!==t.type||i.autoScaleOverlay||void 0!==i.resizable||(i.resizable=!0),i.rotatable&&(r.lockRotation=!1),i.resizable&&(r.lockScalingX=!1,r.lockScalingY=!1),r.hasControls=i.resizable||i.rotatable,r.hasControls&&(r.transparentCorners=!1,r.cornerStyle="circle",r.cornerSize=fabric.isTouchSupported?25:20,r.cornerColor=t.params.interactiveColor||"rgb(178,204,255)"),r.selectable=!0,r.evented=!0,r.borderColor=t.params.interactiveColor||"rgb(178,204,255)"));if(sr.hasRefRect(t)&&"text"!==t.type&&"textbox"!==t.type&&isNaN(e.canvasRotate)){let i=this._getRefRect(t,e);i.set("absolutePositioned",!0),i.set("strokeWidth",0),r.clipPath=i}return r._layer=t,r}_isEditorMode(t,e){return!!e.editorMode&&(!e.editLayer||!(t.name!==e.editLayer&&!t.name.startsWith(e.editLayer+"_")))}_printObject(t){a.debug("width/height =",t.width,t.height),a.debug("scaled width/height =",t.getScaledWidth(),t.getScaledHeight()),a.debug("left/top = ",t.left,t.top),a.debug("boundingRect = ",t.getBoundingRect()),a.debug("boundingRectAbsolute = ",t.getBoundingRect(!0)),a.debug("boundingRectCalc = ",t.getBoundingRect(!1,!0)),a.debug("boundingRectAbsoluteCalc = ",t.getBoundingRect(!0,!0))}_applyAutoParams(t,e,i,r=e.params){let o=sr.getRefCoordinates(e,i),n=sr.getRefDimensions(e,i),a=sr.getDimensions(t),s=t.width,l=t.height;if(r.autoScale&&!e._interactiveScaled){let i=r.autoScaleRatio,o=r.autoScaleMax,c=r.autoScaleOverlay||!1;"text"===e.type&&(i=!0);let p=1,d=n.width/s,h=n.height/l;(o||a.height>n.height||a.width>n.width)&&(i?(c?(p=Math.max(d,h),r.interactive&&(d>h?t.lockMovementX=!0:t.lockMovementY=!0)):p=Math.min(d,h),t.scaleX=p,t.scaleY=p):(t.scaleY=h,t.scaleX=d),t.setCoords(),a=sr.getDimensions(t)),1!==p&&e.type}if(r.autoPos&&!e._interactive)if(r.autoCenter)sr.center(t,a,o,n);else{if(r.autoCenterH)sr.centerHorizontal(t,a,o,n);else if(t.left=o.x,"text"===e.type&&!r.textBox)if("center"===r.textAlign)sr.centerHorizontal(t,a,o,n);else if("right"===r.textAlign){let e=o.x+n.width-a.width;t.left=parseFloat(e.toFixed(2))}r.autoCenterV?sr.centerVertical(t,a,o,n):t.top=o.y}}_addRefRect(t,e,i,r){if(sr.isEditLayer(e,i.editorMode,i.editLayer)&&!i.cropMode)if(sr.hasRefRect(e)){let t=this._getRefRect(e,i);r.add(t),r.uniformScaling=!1}else r.uniformScaling=!0}_getRefRect(t,e){let i=t._objectRef||new fabric.Rect,r={visible:!0,lockUniScaling:!1,lockRotation:!0,lockMovementX:!1,lockMovementY:!1,lockScalingX:!1,lockScalingY:!1,hasControls:!0,lockScalingFlip:!0,selectable:!0,evented:!0};return r.left=void 0!==t.params.refX?t.params.refX:50,r.top=void 0!==t.params.refY?t.params.refY:50,r.width=t.params.refWidth||e.config.width-100,r.height=t.params.refHeight||e.config.height-100,r.scaleX=1,r.scaleY=1,r.fill="#139cf6",r.opacity=.5,r._layerRef=t,i.setOptions(r),t._objectRef=i,i}};var zr=t=>{const e=t.Image.filters,i=t.util.createClass;e.SwapColor=i(e.BaseFilter,{type:"SwapColor",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 colorSource;\nuniform vec4 colorDestination;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 delta = abs(colorSource.rgb - color.rgb);\ngl_FragColor = length(delta) < 0.02 ? colorDestination.rgba : color;\n}",colorSource:"rgb(255, 0, 0)",colorDestination:"rgb(0, 255, 0)",applyTo2d:function(e){var i,r=e.imageData.data,o=r.length,n=new t.Color(this.colorSource).getSource(),a=new t.Color(this.colorDestination).getSource();for(i=0;i<o;i+=4)r[i]===n[0]&&r[i+1]===n[1]&&r[i+2]===n[2]&&(r[i]=a[0],r[i+1]=a[1],r[i+2]=a[2])},getUniformLocations:function(t,e){return{uColorSource:t.getUniformLocation(e,"colorSource"),uColorDestination:t.getUniformLocation(e,"colorDestination")}},sendUniformData:function(e,i){var r=new t.Color(this.colorSource).getSource(),o=new t.Color(this.colorDestination).getSource();r[0]/=255,r[1]/=255,r[2]/=255,o[0]/=255,o[1]/=255,o[2]/=255,e.uniform4fv(i.uColorSource,r),e.uniform4fv(i.uColorDestination,o)},isNeutralState:function(){return this.colorSource===this.colorDestination},toObject:function(){return t.util.object.extend(this.callSuper("toObject"),{colorSource:this.colorSource,colorDestination:this.colorDestination})}}),t.Image.filters.SwapColor.fromObject=t.Image.filters.BaseFilter.fromObject};var Ur=class extends Hr{render(t,e,i){t._object&&t._object.clipPath&&delete t._object.clipPath;let r={...t.params};if(t.params.option&&t.params.interactive){let i=sr.getProductOption(t.params.option,e.options);i&&(i._layer=t)}if(t.params.optionColor){let i=sr.getProductOption(t.params.optionColor,e.options);if(i&&i.value)if("color"===i.type)r.color=i.value;else if(i.values&&i.values.length){let t=i.values.filter((t=>t.value===i.value));t.length&&(r.color=t[0].color)}}return t.params.crop&&"upload"===t.type&&(r.autoScaleOverlay=!0),this._getImage(t,e,i,r).then((o=>{if(this._addRefRect(o,t,e,i),null==o)return o;let n=this._getOptions(t,e,r);return o.set(n),n.hasControls&&!sr.isEditLayer(t,e.editorMode,e.editLayer)&&o.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1,bl:!n.lockScalingX,br:!n.lockScalingX,tl:!n.lockScalingY,tr:!n.lockScalingY,mtr:!n.lockRotation}),this._applyAutoParams(o,t,e,r),i.add(o),t._object=o,t._object}))}_getOptions(t,e,i=t.params){let r=super._getOptions(t,e,i);return i.opacity&&(r.opacity=i.opacity),r}_getImage(t,e,i,r=t.params){return t._object?(r.color&&r.color!==t._color&&(this._colorize(t._object,r.color),t._color=r.color),Promise.resolve(t._object)):new Promise(((e,i)=>{r.url&&-1!==r.url.indexOf(".svg")?fabric.loadSVGFromURL(r.url,((i,o)=>{void 0===i&&(a.warn("layer url not found: ",r.url),e(null));let n=fabric.util.groupSVGElements(i,o);r.color&&(this._colorize(n,r.color),t._color=r.color),e(n)}),null,{crossOrigin:"anonymous"}):fabric.Image.fromURL(r.url,(i=>{if(void 0===i)return a.warn("layer url not found: ",r.url),void e(null);r.color&&"overlay"===t.type&&(this._colorize(i,r.color),t._color=r.color),e(i)}),{crossOrigin:"anonymous"})}))}_colorize(t,e){if("group"===t.type){let i=t.getObjects();for(let t=0;t<i.length;t++){i[t].set("fill",e)}}else if("path"===t.type||"circle"===t.type)t.set("fill",e);else if("image"===t.type&&t.width&&t.height){let i;t.filters&&t.filters.length?i=t.filters[0]:(void 0===fabric.Image.filters.SwapColor&&zr(fabric),i=new fabric.Image.filters.SwapColor,i.colorSource="#fff",t.filters=[i]),i.colorDestination=e,t.applyFilters()}}};var Wr=class extends Hr{render(t,e,r){let o;o=t.params.textBox?t._object&&"textbox"===t._object.type?t._object:new fabric.Textbox("",{editable:!1}):t._object&&"text"===t._object.type?t._object:new fabric.Text("");let n=t.params.text||"",a={...t.params};if(t.params.option){let r=sr.getProductOption(t.params.option,e.options);if(r){r.value&&(n=r.value),r._layer=t;let o=!1;t.params.textEditor?(t._editor?a=i.extend(t.params,r._editor):t._editor=i.extend({},t.params),r._editor&&r._editor===t._editor||(r._editor=t._editor,a=i.extend(t.params,r._editor),o=!0)):r._editor&&(delete r._editor,o=!0),o&&e.productForm&&e.productForm.dispatchEvent(new CustomEvent("options:render",{detail:r,cancelable:!0,bubbles:!0}))}}if(t.params.optionFont){let i=sr.getProductOption(t.params.optionFont,e.options);i&&i.value&&(a.fontFamily=i.value)}if(t.params.optionColor){let i=sr.getProductOption(t.params.optionColor,e.options);if(i&&i.value)if("color"===i.type)a.color=i.value;else if(i.values&&i.values.length){let t=i.values.filter((t=>t.value===i.value));if(t.length){let e=t[0];e.color&&(a.color=e.color),e.img&&a.textPattern&&!a.urlPattern&&(a.urlPattern=e.img)}}}if(t.params.textShadow&&t.params.optionTextShadowColor){let i=sr.getProductOption(t.params.optionTextShadowColor,e.options);if(i&&i.value)if("color"===i.type)a.textShadowColor=i.value;else if(i.values&&i.values.length){let t=i.values.filter((t=>t.value===i.value));t.length&&(a.textShadowColor=t[0].color)}}if(t.params.textStroke&&t.params.optionTextStrokeColor){let i=sr.getProductOption(t.params.optionTextStrokeColor,e.options);if(i&&i.value)if("color"===i.type)a.textStrokeColor=i.value;else if(i.values&&i.values.length){let t=i.values.filter((t=>t.value===i.value));t.length&&(a.textStrokeColor=t[0].color)}}if(a.textVertical){let t=[];for(let e=0;e<n.length;e++)t.push(n.charAt(e));n=t.join("\n")}let s=this._getOptions(t,e,a);return s.text=n.replace(/\\n/g,"\n"),o.set(s),s.hasControls&&!sr.isEditLayer(t,e.editorMode,e.editLayer)&&o.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1,bl:!s.lockScalingX,br:!s.lockScalingX,tl:!s.lockScalingY,tr:!s.lockScalingY,mtr:!s.lockRotation}),this._applyAutoParams(o,t,e,a),this._addRefRect(o,t,e,r),r.add(o),t._object=o,a.textPattern&&a.urlPattern?this._applyTextPattern(o,t,a):Promise.resolve(t._object)}_getOptions(t,e,i=t.params){let r=super._getOptions(t,e,i);if(r.fill=i.color||"#000000",r.fontSize=i.fontSize||10,r.fontFamily=i.fontFamily||"Arial",r.fontStyle=i.fontStyle?i.fontStyle:"normal",r.fontWeight=i.fontWeight?i.fontWeight:"normal",r.textAlign=i.textAlign?i.textAlign:"left",r.lineHeight=i.lineHeight?i.lineHeight:1.16,i.fontSizeFactor&&(r.fontSize*=i.fontSizeFactor),i.textStroke&&(r.stroke=i.textStrokeColor?i.textStrokeColor:"#000000",r.strokeWidth=i.textStrokeWidth?i.textStrokeWidth:1,r.strokeLineJoin=i.textStrokeLine?i.textStrokeLine:"round",r.strokeLineCap=i.textStrokeLine?i.textStrokeLine:"round",r.paintFirst="stroke"),r.charSpacing=i.letterSpacing?100*i.letterSpacing:0,r.shadow=i.textShadow?new fabric.Shadow({color:i.textShadowColor?i.textShadowColor:"#000000",blur:i.textShadowBlur?i.textShadowBlur:1,offsetX:i.textShadowOffsetX?i.textShadowOffsetX:.5,offsetY:i.textShadowOffsetY?i.textShadowOffsetY:.5}):void 0,t.params.textBox&&(sr.hasRefRect(t)&&(i.refWidth||i.refHeight)?(r.width=i.refWidth,r.height=i.refHeight):(r.width=e.config.width,r.height=e.config.height)),t.params.textPath){let o=t.params.path||"",n=t.params.pathSide||"left",a=sr.getRefDimensions(t,e);if("path"===t.params.pathShape)o&&(r.path=new fabric.Path(o,{fill:!1}));else if("circle_top"===t.params.pathShape){let t=Math.min(a.width,a.height)/2;o=this._describeEllipse([0,0],[t,t],[90,359.9],0),n="left",r.path=new fabric.Path(o,{fill:!1}),r.path.width+=2*r.fontSize,r.path.height+=2*r.fontSize}else if("circle_bottom"===t.params.pathShape){let t=Math.min(a.width,a.height)/2;o=this._describeEllipse([0,0],[t,t],[270,359.9],0),n="right",r.path=new fabric.Path(o,{fill:!1})}else"ellipse_top"===t.params.pathShape?(o=this._describeEllipse([0,0],[a.width/2,a.height/2],[90,359.9],0),n="left",r.path=new fabric.Path(o,{fill:!1}),r.path.width+=2*r.fontSize,r.path.height+=2*r.fontSize):"ellipse_bottom"===t.params.pathShape&&(o=this._describeEllipse([0,0],[a.width/2,a.height/2],[270,359.9],0),n="right",r.path=new fabric.Path(o,{fill:!1}));r.path&&(r.pathStartOffset=i.letterSpacing?3*i.letterSpacing:0,r.pathSide=n,sr.isEditLayer(t,e.editorMode,e.editLayer)&&!e.cropMode&&r.path.setOptions({stroke:"rgb(178,204,255)",strokeWidth:2}))}return r}_applyTextPattern(t,e,i){return e._pattern&&e._pattern._url===i.urlPattern?(t.set("fill",e._pattern),Promise.resolve(e._object)):new Promise(((r,o)=>{fabric.Image.fromURL(i.urlPattern,(o=>{if(void 0===o)return a.warn("text layer urlPattern not found: ",i.url),void r(null);e._pattern=new fabric.Pattern({source:o._element,repeat:"repeat",offsetY:i.patternOffsetY||0,offsetX:i.patternOffsetX||0}),e._pattern._url=i.urlPattern,t.set("fill",e._pattern),r(e._object)}),{crossOrigin:"anonymous"})}))}_degreeToRadian(t){return t*Math.PI/180}_describeEllipse([t,e],[i,r],[o,n],a){o=this._degreeToRadian(o),n=this._degreeToRadian(n),a=this._degreeToRadian(a);const s=([[t,e],[i,r]],[o,n])=>[t*o+e*n,i*o+r*n],l=([t,e],[i,r])=>[t+i,e+r];n%=2*Math.PI;const c=(p=a,[[Math.cos(p),-Math.sin(p)],[Math.sin(p),Math.cos(p)]]);var p;const[d,h]=l(s(c,[i*Math.cos(o),r*Math.sin(o)]),[t,e]),[u,m]=l(s(c,[i*Math.cos(o+n),r*Math.sin(o+n)]),[t,e]),f=n>Math.PI?1:0,g=n>0?1:0;return"M "+d+" "+h+" A "+[i,r,a/(2*Math.PI)*360,f,g,u,m].join(" ")}};var Yr=class extends Hr{render(t,e,i){if(t.params.maskLayers&&t.params.maskLayers.length>0){i.clipPath&&delete i.clipPath;let r=[];return i.forEachObject((o=>{o._layer&&this._isMaskedLayer(t.params.maskLayers,o._layer.name)&&r.push(this._getClipPath(t,e,i,o).then((t=>{t?o.clipPath=t:delete o.clipPath,o.dirty=!0})))})),Promise.all(r)}return this._getClipPath(t,e,i).then((r=>(r?(e.mask=!0,i.clipPath=r,t._object=r):(delete i.clipPath,delete t._object),r)))}_isMaskedLayer(t,e){if(-1!==t.indexOf(e))return!0;for(let i=0;i<t.length;i++)if(e.startsWith(t[i]+"_"))return!0;return!1}_getClipPath(t,e,i,r){let o=this._getOptions(t,e),n=null;if(t.params.shape)switch(t.params.shape){case"circle":if(t._object&&"circle"!==t._object.type&&delete t._object,n=t._object||new fabric.Circle,t.params.radius)o.radius=t.params.radius;else if(!t.params.maskLayers||0===t.params.maskLayers.length){let t=e.config.width;o.radius=t/2}r&&(t.params.radius||(o.radius=r.width/2),o.left=-o.radius,o.top=-o.radius),n.setOptions(o);break;case"triangle":t._object&&"triangle"!==t._object.type&&delete t._object,n=t._object||new fabric.Triangle,t.params.maskLayers&&0!==t.params.maskLayers.length||(o.width=e.config.width,o.height=e.config.height),r&&(o.width=r.width,o.height=r.height,o.left=-o.width/2,o.top=-o.height/2),n.setOptions(o);break;case"svg":if(t.params.url){let n=null;return n=r&&r.clipPath&&r.clipPath._url===t.params.url?Promise.resolve(r.clipPath):i.clipPath&&i.clipPath._url===t.params.url?Promise.resolve(i.clipPath):new Promise(((e,i)=>{fabric.loadSVGFromURL(t.params.url,((i,r)=>{if(i){let t=fabric.util.groupSVGElements(i,r);e(t)}else a.warn("svg mask not found",t.params.url),e(null)}))})),n.then((i=>{if(i){o._url=t.params.url,o.width=i.width,o.height=i.height;let n=t.params.padding||3;if(t.params.maskLayers&&0!==t.params.maskLayers.length?r&&(o.scaleX=(r.width-n)/i.width,o.scaleY=(r.height-n)/i.height):(o.scaleX=(e.config.width-n)/i.width,o.scaleY=(e.config.height-n)/i.height),t.params.ratio||!0){let t=Math.min(o.scaleX,o.scaleY);o.scaleX=t,o.scaleY=t}r&&(o.left=-i.width*o.scaleX/2,o.top=-i.height*o.scaleY/2),i.setOptions(o)}return i}))}a.warn("svg mask missing url",t)}return Promise.resolve(n)}};var Xr=class extends Ur{_findProductUrl(t,e){let i=e.product;if(t.params.imgPos){let e=parseInt(t.params.imgPos);if(!isNaN(e)&&i.images.length>e-1)return i.images[e-1]}if(t.params.variant&&e.variantId)for(let t=0;t<e.product.variants.length;t++){const i=e.product.variants[t];if(i.id.toString()===e.variantId.toString()){if(i.featured_image&&i.featured_image.src)return i.featured_image.src;break}}return i.featured_image}_getImage(t,e,i,r=t.params){if(e.product){let i=this._findProductUrl(t,e);if(i)return t._object&&t._url===i?Promise.resolve(t._object):new Promise(((e,r)=>{fabric.Image.fromURL(i,(r=>{void 0===r&&(a.warn("product url not found: ",i),e(null)),t._url=i,e(r)}),{crossOrigin:"anonymous"})}))}else a.warn("missing product in render context");return Promise.resolve(null)}};var Gr=class extends Ur{_getImage(t,e,i,r=t.params){if(r.option){let o=sr.getProductOption(r.option,e.options);if(o){if(o._layer=t,o.value){let n=o.value;if(o.params.multiple||-1!==n.indexOf(",")){let t=n.split(","),e=r.fileIndex||t.length;if(e-=1,!(t.length>e))return Promise.resolve(null);n=t[e]}let s=!1;return t.params.layerEditor?t._context||(t._context=e,t._canvas=i,s=!0):t._context&&(delete t._context,s=!0),s&&e.productForm&&e.productForm.dispatchEvent(new CustomEvent("options:render",{detail:o,cancelable:!0,bubbles:!0})),!t._object||t._url!==n||!isNaN(t.params.rotate)&&t._rotate!==t.params.rotate||t.params.filters&&t._filters&&t._filters.length!==t.params.filters.length?new Promise(((i,o)=>{t._interactive&&(delete t._interactive,delete t._interactiveScaled),t.params.crop&&(t._autoCrop=!0);const s=o=>{if(void 0===o&&(a.warn("upload url not found: ",n),i(null)),t._url=n,t._rotate=0,t.params.autoRotate){let i=sr.getRefDimensions(t,e),r=o;r.width<r.height&&i.width>i.height?t._rotate=90:r.width>r.height&&i.width<i.height&&(t._rotate=-90)}if(t.params.rotate&&(t._rotate=t.params.rotate),0!==t._rotate){o.rotate(t._rotate),r.canvasRotate&&(e.canvasRotate=-1*t._rotate);let n={multiplier:1,format:-1!==t._url.indexOf(".png")?"png":"jpeg",quality:1},a=o.toDataURL(n);fabric.Image.fromURL(a,(e=>{this._applyFilters(e,t).then((()=>{i(e)}))}))}else this._applyFilters(o,t).then((()=>{i(o)}))};-1!==n.indexOf(".svg")?fabric.loadSVGFromURL(n,((t,r)=>{void 0===t&&(a.warn("upload url not found: ",n),i(null));let o=fabric.util.groupSVGElements(t,r),l=Math.max(e.config.width/o.viewBoxWidth,e.config.height/o.viewBoxHeight),c=o.toDataURL({multiplier:Math.min(10,l),format:"png"});fabric.Image.fromURL(c,(t=>{s(t)}))}),null,{crossOrigin:"anonymous"}):fabric.Image.fromURL(n,s,{crossOrigin:"anonymous"})})):(t.params.autoRotate&&0!==t._rotate&&r.canvasRotate&&(e.canvasRotate=-1*t._rotate),t._autoCrop&&delete t._autoCrop,Promise.resolve(t._object))}}else a.warn("no upload option found for layer",t)}else a.warn("missing option for layer",t);return Promise.resolve(null)}_applyFilters(t,e){let i=Promise.resolve(null);return e.params.filters&&(!e.params.urlFilter||e._urlFilterImage&&e._urlFilter===e.params.urlFilter||(i=new Promise(((t,i)=>{fabric.Image.fromURL(e.params.urlFilter,(i=>{i&&(e._urlFilter=e.params.urlFilter,e._urlFilterImage=i),t()}),{crossOrigin:"anonymous"})}))),-1!==e.params.filters.indexOf("removeBg")&&e.params.removeBgKey&&(i=new Promise(((i,r)=>{new n("https://api.remove.bg/v1.0/removebg",{method:"POST",responseType:"blob",headers:{"X-API-Key":e.params.removeBgKey},data:{image_url:t.getSrc(!1),size:e.params.removeBgSize||window.clRemoveBgSize||"auto",type:"auto"}}).then((r=>{const o=URL.createObjectURL(r.data);let n=new Image;n.onload=()=>{t.setElement(n),e._removeBg=!0,i()},n.src=o})).catch((t=>{a.error(t),i()}))}))),i.then((()=>{t.filters||(t.filters=[]);for(let i=0;i<e.params.filters.length;i++){let r;switch(e.params.filters[i]){case"multiply":e._urlFilterImage&&(r=new fabric.Image.filters.BlendImage({image:e._urlFilterImage,mode:"multiply",alpha:e.params.alphaFilter||.5}),r._sort=6);break;case"invert":r=new fabric.Image.filters.Invert,r._sort=2;break;case"grayscale":r=new fabric.Image.filters.Grayscale,r._sort=6;break;case"sepia":r=new fabric.Image.filters.Sepia,r._sort=5;break;case"removeWhite":r=new fabric.Image.filters.RemoveColor({threshold:.2}),r._sort=1}r&&t.filters.push(r)}if(t.filters.length){if(t.width>fabric.textureSize||t.height>fabric.textureSize){let e=Math.max(t.height,t.width);fabric.textureSize=e>4096?e:4096}t.filters.sort(((t,e)=>(t._sort||100)>(e._sort||100)?1:-1))}e._filters=[...e.params.filters],t.applyFilters()}))),i}};var Qr=class extends Ur{_getImage(t,e,i,r=t.params){let o=r.text||"";if(r.option){let t=sr.getProductOption(r.option,e.options);t&&t.value&&(o=t.value)}if(o){let i=a.getLevel();if(i<=a.levels.DEBUG&&console.time("====> QR RENDER"),t._object&&t._qrText===o)return i<=a.levels.DEBUG&&console.timeEnd("====> QR RENDER"),Promise.resolve(t._object);{let n=[e.assets+"/static/lib/easyqrcodejs/easy.qrcode.min.js"];return rr.loadOnce(n,"qrcode",{async:!1}).then((()=>new Promise(((n,s)=>{let l=(e,r)=>{i<=a.levels.DEBUG&&console.timeEnd("====> QR RENDER"),fabric.Image.fromURL(r,(e=>{if(void 0===e)return a.warn("qr image invalid"),void n(null);t._qrText=o,n(e)}))};if(t._qrDiv||(t._qrDiv=document.createElement("div")),e.editorMode&&t._qrCode&&(t._qrCode.clear(),delete t._qrCode),t._qrCode)t._qrCode._htOption.onRenderingEnd=l,t._qrCode._oDrawing._htOption.onRenderingEnd=l,t._qrCode.makeCode(o);else{let i=Math.min(e.config.width/2,1e3),n={text:o,width:i,height:i,onRenderingEnd:l};r.url&&(n.logo=r.url,n.crossOrigin="anonymous"),t._qrCode=new QRCode(t._qrDiv,n)}}))))}}return Promise.resolve(null)}};class Jr{}Jr.renderers={},Jr.renderers.overlay=new Ur,Jr.renderers.text=new Wr,Jr.renderers.mask=new Yr,Jr.renderers.product=new Xr,Jr.renderers.upload=new Gr,Jr.renderers.qrcode=new Qr;var Kr=Jr;var Zr=class{destroy(){this.element.removeChild(this._wrapper)}render(){tt(Nr(this.settings.product,{uuid:this.config.uuid}),this._wrapper)}_renderContext(){return{config:this.previewConfig,options:this.config.options,product:this.settings.product,assets:this.settings.assets,productForm:this._productForm,variantId:this.settings.variantId,editorMode:this.settings.editorMode,editLayer:this.settings.editLayer,cropMode:this.settings.cropMode,cropLayer:this.settings.cropLayer,mask:!1}}renderPreview(){let t=()=>{let t=a.getLevel();t<=a.levels.DEBUG&&console.time("====> RENDER PREVIEW "+this.previewConfig.position);let e=this._renderContext(),i=null;if(!this.static){let t=this._canvas.getActiveObject();this._canvas.discardActiveObject(),t&&(i=t._layer)}return this._rotateGroup&&this._rotateGroup.forEachObject((t=>{this._rotateGroup.remove(t)})),this._canvas.clear(),this._renderLayers(this.previewConfig.layers,e).then((()=>{this._canvas.clipPath&&!e.mask&&delete this._canvas.clipPath,i?this.selectLayer(i.name,!1):sr.hasEditLayer(this.settings.editorMode,this.settings.editLayer)&&this.selectLayer(this.settings.editLayer,!1),void 0!==e.canvasRotate&&(this._rotateGroup=new fabric.Group(this._canvas.getObjects()),this._rotateGroup.rotate(e.canvasRotate),this._rotateGroup.setCoords()),this._canvas.renderAll(),t<=a.levels.DEBUG&&console.timeEnd("====> RENDER PREVIEW "+this.previewConfig.position),this._responsiveCanvasHeight(),this._syncThemeGallery(),this._triggerEvent("preview:rendered",this)}))};return null==this._renderQueue&&(this._renderQueue=Promise.resolve()),this._renderQueue=this._renderQueue.then((()=>this._loadUsedFonts())).then((()=>t())),this._renderQueue}downloadBlob(t,e){const i=URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download=e||"download";const o=function(t){setTimeout((()=>{URL.revokeObjectURL(i),this.removeEventListener("click",o)}),150)};return r.addEventListener("click",o,!1),r.click(),r}export(e,i,r,o,n="jpeg",s=.8,l=!0){if(this._canvas){let p=a.getLevel();p<=a.levels.DEBUG&&console.time("====> EXPORT PREVIEW");let h,u=!1,m=0;if(this._canvas.forEachObject((t=>{t.visible&&t._layer&&(!0===t._layer.params[o]?(t.visible=!1,t._visible=!0,u=!0):"product"!==t._layer.type&&m++)})),l&&0===m)return a.debug("==> no visible layers - skipping export"),u&&this._canvas.forEachObject((t=>{t._visible&&(t.visible=!0,delete t._visible)})),null;if(this._canvas.renderAll(),"svg"===n){let t={width:e.width,height:e.height};i&&(t.viewBox={x:i.x,y:i.y,width:i.width,height:i.height});let o=this._canvas.toSVG(t);var c=[];for(let t=0;t<document.styleSheets.length;t++){const e=document.styleSheets[t];e.href&&(-1===e.href.indexOf("fonts.googleapis.com")&&-1===e.href.indexOf(d.api)||c.push(e.href))}if(c.length){let t=`<style type="text/css"><![CDATA[\n                            ${c.map((t=>`@import url("${t}");`)).join("\n")}\n                        ]]></style>`,e=o.indexOf("</defs>");o=o.substring(0,e)+t+o.substring(e)}h=r?new Blob([o],{type:"image/svg+xml"}):o}else{let o={multiplier:e.width/this._canvas.getWidth(),format:n,quality:s};i&&(o.left=i.x/o.multiplier,o.top=i.y/o.multiplier,o.width=i.width/o.multiplier,o.height=i.height/o.multiplier);let a=this._canvas.toDataURL(o);h=r?t(jr)(a):a}return u&&(this._canvas.forEachObject((t=>{t._visible&&(t.visible=!0,delete t._visible)})),this._canvas.renderAll()),p<=a.levels.DEBUG&&console.timeEnd("====> EXPORT PREVIEW"),h}return null}exportLayer(e,i,r="jpeg",o=.8){let n=this._canvas.getObjects();for(let s=0;s<n.length;s++){const l=n[s];if(l._layer&&l._layer.name===e){let e={multiplier:1,withoutTransform:!0,format:r,quality:o},n=l.clipPath;if(n){l.clipPath=null;let t=n.getBoundingRect(!0,!0);a.debug("crop rect",t);let i=l.getBoundingRect(!0,!0);a.debug("bounding rect",i);let r=l.width/l.getScaledWidth();e.left=Math.round((t.left-i.left)*r),e.top=Math.round((t.top-i.top)*r),e.width=Math.round(t.width*r),e.height=Math.round(t.height*r),e.left=Math.max(e.left,0),e.top=Math.max(e.top,0),e.width=Math.min(e.width,l.width-e.left),e.height=Math.min(e.height,l.height-e.top)}let s,c=l.toDataURL(e);return s=i?t(jr)(c):c,n&&(l.clipPath=n),s}}return null}exportLayerCoords(t){let e=this._canvas.getObjects();for(let i=0;i<e.length;i++){const r=e[i];if(r._layer&&(r._layer.name===t||r._layer.name.startsWith(t+"_")))return{x:Math.round(r.left),y:Math.round(r.top),w:Math.round(r.getScaledWidth()),h:Math.round(r.getScaledHeight()),r:Math.round(r.angle)}}return null}clear(){this._canvas&&this._canvas.clear()}updateConfig(t){let e=!1;return this.previewConfig.width===t.width&&this.previewConfig.height===t.height||(e=!0),this.previewConfig=t,e&&this._setDimensions(),this.renderPreview()}selectLayer(t,e=!0,i=this.previewConfig.layers){for(let r=0;r<i.length;r++){const o=i[r];if(o.layers&&o.layers.length>0&&this.selectLayer(t,e,o.layers))return!0;if(o.name===t&&o._object&&(sr.isEditLayer(o,this.settings.editorMode,this.settings.editLayer)&&(this._canvas.preserveObjectStacking=!1,delete o._interactive),this._canvas.contains(o._object)))return this._canvas.setActiveObject(o._object),e&&this._canvas.renderAll(),!0}return!1}deSelect(t=!0){this._canvas.discardActiveObject(),this.settings.editorMode&&!this._canvas.preserveObjectStacking&&(this._canvas.preserveObjectStacking=!0),t&&this._canvas.renderAll()}_init(){this._wrapper=document.createElement("div"),this._wrapper.className=this.settings.classNamePrefix+"--preview-wrapper",this._wrapper.setAttribute("id",this.config.uuid+"_preview"),this._wrapper.style.width="100%",this.settings.position?(this.element.insertAdjacentElement(this.settings.position,this._wrapper),this.element!==this._wrapper.parentNode&&(this.element=this._wrapper.parentNode)):this.element.appendChild(this._wrapper),this.render(),this._preview=this._wrapper.querySelector("."+this.settings.classNamePrefix+"--preview"),this._preview.classList.add("cl-hide");let t=this._wrapper.querySelector("."+this.settings.classNamePrefix+"--canvas");this.static=this._isStatic(),fabric.devicePixelRatio<2&&(fabric.devicePixelRatio=2),window.clPreviewRatio&&(fabric.devicePixelRatio=parseInt(window.clPreviewRatio)),fabric.Object.NUM_FRACTION_DIGITS=8,this.static?this._canvas=new fabric.StaticCanvas(t):(fabric.isTouchSupported&&this._patchCanvasTouchScroll(),this._updateCanvasControls(),this._canvas=new fabric.Canvas(t,{selection:!1,preserveObjectStacking:!0,allowTouchScrolling:!0}),this._subscribeCanvasEvents()),this._setDimensions(),this.renderPreview().then((()=>{this._watchFormChanges(),this._watchWindowResize(),this._watchWindowScroll(),this._preview.classList.remove("cl-hide")})).catch((t=>{a.error("[live-options] failed render preview",t)}))}_setDimensions(){let t=this._canvas.getZoom();1!==t&&this._canvas.setZoom(1);let e=fabric.devicePixelRatio,r=this.previewConfig.width*this.previewConfig.height,o=window.clPreviewMaxRetina||9e6;e>1&&r>o&&i.isMobile(i.getAgent())&&(this._canvas.enableRetinaScaling=!1),this._canvas.setDimensions({width:this.previewConfig.width,height:this.previewConfig.height}),1!==t&&this._resizeCanvas()}_renderLayers(t,e){let i=Promise.resolve();for(let r=0;r<t.length;r++){const o=t[r];i=i.then((()=>this._renderLayer(o,e)))}return i}_renderLayer(t,e){let i=!0;if(t.conditions&&t.conditions.length&&(i=this.conditionsEngine.evaluateConditions(t.conditions,Br.MODE.AND,"layer.name="+t.name)),this.settings.editorMode&&this.visibleEditor.hasOwnProperty(t.name)&&(i=this.visibleEditor[t.name]),this.visible[t.name]=i,i){if(a.debug("rendering layer: ",t),t.layers&&t.layers.length>0)return this._renderLayers(t.layers,e);let i=Kr.renderers[t.type];if(i)return i.render(t,e,this._canvas)}return Promise.resolve()}_loadUsedFonts(){let t=[];for(let e=0;e<this.previewConfig.layers.length;e++){const i=this.previewConfig.layers[e];if("text"===i.type){if(i.params.fontFamily&&t.push(i.params.fontFamily),i.params.option&&i.params.textEditor){let e=sr.getProductOption(i.params.option,this.config.options);e&&e._editor&&e._editor.fontFamily&&t.push(e._editor.fontFamily)}if(i.params.optionFont){let e=sr.getProductOption(i.params.optionFont,this.config.options);e&&e.value&&t.push(e.value)}}}return t.length>0?d.loadFontsByName(t):Promise.resolve(!0)}_isStatic(){if(this.settings.editorMode)return!1;for(let t=0;t<this.previewConfig.layers.length;t++){const e=this.previewConfig.layers[t];if(e.params.interactive||e.params.crop&&"upload"===e.type)return!1}return!0}_watchFormChanges(){this._productForm?(this._productForm.addEventListener("option:changed",(t=>this._optionChanged(t))),this._productForm.addEventListener("option:crop",(t=>this._optionCrop(t))),this._productForm.addEventListener("option:export",(t=>this._optionExport(t))),this._productForm.addEventListener("option:variant_changed",(t=>this._variantChanged(t)))):a.warn("product-preview no productForm found for config: "+this.config.uuid)}_subscribeCanvasEvents(){let t=a.getLevel();this._canvas.on("object:modified",(e=>{let r=e.target;if(t<=a.levels.TRACE&&a.debug("object:modified",r),r._layer){let e=r._layer,o=e.params;o.x=Math.round(r.left),o.y=Math.round(r.top),t<=a.levels.TRACE&&a.debug("=> layer x,y = ",o.x,o.y),o.crop?(o.scaleX=r.scaleX,o.scaleY=r.scaleY):(o.scaleX=parseFloat(r.scaleX.toFixed(3)),o.scaleY=parseFloat(r.scaleY.toFixed(3))),0!==r.angle&&(o.angle=Math.round(r.angle)),e._editor&&(i.merge(e._editor,e.params,["x","y","scaleX","scaleY","angle"]),this._productForm&&this._productForm.dispatchEvent(new CustomEvent("options:render",{detail:null,cancelable:!0,bubbles:!0}))),this._triggerEvent("layer:changed",e)}else if(r._layerRef){let t=r._layerRef.params;t.refX=Math.round(r.left),t.refY=Math.round(r.top),t.refWidth=Math.round(r.getScaledWidth()),t.refHeight=Math.round(r.getScaledHeight()),a.debug("updated layer rectRef params",t),this._triggerEvent("layer:changed",r._layerRef),this.renderPreview()}})),this._canvas.on("object:moving",(e=>{let i=e.target;if(t<=a.levels.TRACE&&a.debug("object:moving",i),i._layer){let e=i._layer,r=e.params,o=sr.isCropLayer(e,this.settings.cropLayer,this.settings.cropLayer);if(o||r.interactive&&!sr.isEditLayer(e,this.settings.editorMode,this.settings.editLayer)){e._interactive=!0;let n={x:0,y:0},s={x:this.previewConfig.width,y:this.previewConfig.height},l={width:this.previewConfig.width,height:this.previewConfig.height};sr.hasRefRect(e)&&(n.x=r.refX,n.y=r.refY,s.x=r.refX+r.refWidth,s.y=r.refY+r.refHeight,l.width=r.refWidth,l.height=r.refHeight);let c=i.getBoundingRect(!0,!0);if(t<=a.levels.TRACE&&a.debug("boundingRect = ",c),r.interactiveBox||o){let t=r.autoScaleOverlay||o;t&&e._interactiveScaled&&(c.width<l.width||c.height<l.height)&&(t=!1),t?(n.x-=c.width-l.width,n.y-=c.height-l.height,s.x-=l.width,s.y-=l.height):(s.x-=c.width,s.y-=c.height)}else{let t=50/this._canvas.getZoom();n.x-=c.width-t,n.y-=c.height-t,s.x-=t,s.y-=t}c.left<n.x?(0!==i.angle?i.setPositionByOrigin({x:n.x+c.width/2,y:i.getCenterPoint().y},"center","center"):i.left=n.x,t<=a.levels.TRACE&&a.debug("=> reset object.left  = ",i.left)):c.left>s.x&&(0!==i.angle?i.setPositionByOrigin({x:s.x+c.width/2,y:i.getCenterPoint().y},"center","center"):i.left=s.x,t<=a.levels.TRACE&&a.debug("=> reset object.left  = ",i.left)),c.top<n.y?(0!==i.angle?i.setPositionByOrigin({x:i.getCenterPoint().x,y:n.y+c.height/2},"center","center"):i.top=n.y,t<=a.levels.TRACE&&a.debug("=> reset object.top  = ",i.left)):c.top>s.y&&(0!==i.angle?i.setPositionByOrigin({x:i.getCenterPoint().x,y:s.y+c.height/2},"center","center"):i.top=s.y,t<=a.levels.TRACE&&a.debug("=> reset object.top  = ",i.left))}}}));const e=e=>{let i=e.target;if(t<=a.levels.TRACE&&a.debug("object:scaling",i),i._layer){let r=i._layer,o=r.params;if(o.interactive&&!sr.isEditLayer(r,this.settings.editorMode,this.settings.editLayer)&&(r._interactive=!0,r._interactiveScaled=!0,o.resizable&&(i.lockMovementX=!1,i.lockMovementY=!1),o.interactiveBox)){let n={x:0,y:0},s={x:this.previewConfig.width,y:this.previewConfig.height};sr.hasRefRect(r)&&(n.x=o.refX,n.y=o.refY,s.x=o.refX+o.refWidth,s.y=o.refY+o.refHeight);let l=i.getBoundingRect(!0,!0);t<=a.levels.TRACE&&a.debug("boundingRect = ",l);let c=null,p=20;if(e.transform&&e.transform.corner&&("tr"==e.transform.corner?(n.x-=p,s.y+=p):"tl"==e.transform.corner?(s.x+=p,s.y+=p):"br"==e.transform.corner?(n.x-=p,n.y-=p):"bl"==e.transform.corner&&(s.x+=p,n.y-=p)),Math.floor(l.left)<n.x){c=(i.aCoords.tr.x-n.x)/(l.width/i.scaleX),0!==i.angle?i.setPositionByOrigin({x:n.x+l.width/2,y:i.getCenterPoint().y},"center","center"):i.left=n.x}else if(Math.floor(l.left+l.width)>s.x){let t=s.x-l.left;c=t/(l.width/i.scaleX),0!==i.angle?i.setPositionByOrigin({x:s.x-t+l.width/2,y:i.getCenterPoint().y},"center","center"):i.left=s.x-t}if(Math.floor(l.top)<n.y){c=(l.top+l.height-n.y)/(l.height/i.scaleY),0!==i.angle?i.setPositionByOrigin({x:i.getCenterPoint().x,y:n.y+l.height/2},"center","center"):i.top=n.y}else if(Math.floor(l.top+l.height)>s.y){let t=s.y-l.top;c=t/(l.height/i.scaleY),0!==i.angle?i.setPositionByOrigin({x:i.getCenterPoint().x,y:s.y-t+l.height/2},"center","center"):i.top=s.y-t}null!=c&&(i.scaleX=c,i.scaleY=c,i.setCoords(),this._canvas.requestRenderAll(),t<=a.levels.TRACE&&a.debug("=> reset object.scale  = ",c))}}};this._canvas.on("object:scaling",e),this._canvas.on("object:scaled",e),this._canvas.on("selection:created",(e=>{let i=e.selected?e.selected[0]:null;t<=a.levels.TRACE&&a.debug("selection:created",i),i._layer?this._triggerEvent("layer:selected",i._layer):i._layerRef&&this._triggerEvent("layer:selected",i._layerRef)})),this._canvas.on("selection:updated",(e=>{let i=e.selected?e.selected[0]:null;t<=a.levels.TRACE&&a.debug("selection:updated",i),i._layer?this._triggerEvent("layer:selected",i._layer):i._layerRef&&this._triggerEvent("layer:selected",i._layerRef)})),this._canvas.on("selection:cleared",(e=>{t<=a.levels.TRACE&&a.debug("selection:cleared")}))}_variantChanged(t){this.settings.variantId=t.detail.variantId,this._clearVisibleEditor(),this.renderPreview()}_optionChanged(t){let e=t.detail;this._clearVisibleEditor(),this.renderPreview().then((()=>{this.static||(e._layer&&e._layer._autoCrop?this._optionCrop(t):e._layer&&e._layer.params.interactive&&this.selectLayer(e._layer.name,!1))}))}_optionCrop(t){let e,r=t.detail;if(this.active){{let t=this._canvas.getObjects();for(let i=0;i<t.length;i++){const o=t[i];if(o._layer&&o._layer.params.option===r.name&&o._layer.params.crop){e=o._layer;break}}}if(e){if(this.settings.cropMode){this.settings.cropMode=!1,this.settings.cropLayer="";let t=this._getContainerWidth()/this.previewConfig.width;this.settings.maxHeight&&(t=this.settings.maxHeight/this.previewConfig.height),this._canvas.setViewportTransform([t,0,0,t,0,0]),this._highlight(!1),this._wrapper.removeChild(this._cropEl),delete this._cropEl}else{this.settings.cropMode=!0,this.settings.cropLayer=e.name;let t=e.params,o={width:this.previewConfig.width,height:this.previewConfig.height},n={x:e._object.left,y:e._object.top,scaleX:e._object.scaleX,scaleY:e._object.scaleY,rotate:0|e.params.rotate},a={_interactive:e._interactive,_interactiveScaled:e._interactiveScaled};if(delete e._interactive,delete e._interactiveScaled,sr.hasRefRect(e)){let i=this._renderContext(),r=sr.getRefDimensions(e,i),n=sr.getRefCoordinates(e,i),a=100;window.innerWidth<500&&(a=50,this.settings.maxHeight&&this.settings.maxHeight<200&&(a=20));let s=Math.min((this._canvas.getWidth()-a)/r.width,(this._canvas.getHeight()-a)/r.height);if(s>this._canvas.getZoom()){s=Math.min(s,2);let t=n.x+r.width/2,e=n.y+r.height/2,i=-t*s+this._canvas.getWidth()/2,o=-e*s+this._canvas.getHeight()/2;this._canvas.setViewportTransform([s,0,0,s,i,o])}o.width=t.refWidth,o.height=t.refHeight}if(this._cropEl=document.createElement("div"),!1!==window.clCropHelp){this._cropEl.classList.add("cl-po--crop-help"),"ontouchstart"in window||navigator.msMaxTouchPoints?this._cropEl.classList.add("touch"):this._cropEl.classList.add("cursor");const t=()=>{this._cropEl&&(this._cropEl.classList.remove("cl-po--crop-help"),this._canvas.off("object:moving",t),window.clCropHelp=!1)};this._canvas.on("object:moving",t),setTimeout(t,9e3)}tt(qr((t=>{let i=e._object;e._interactiveScaled=!0;let r=Math.min(o.width,o.height)/10,n=r/i.width;if(t)i.scaleX+=n,i.scaleY+=n,i.left-=r/2,i.top-=r/2;else{if(i.scaleX-=n,i.scaleY-=n,Math.round(i.getScaledWidth())<o.width||Math.round(i.getScaledHeight())<o.height)return i.scaleX+=n,void(i.scaleY+=n);i.left+=r/2,i.top+=r/2}this._canvas.fire("object:moving",{target:e._object}),this._canvas.renderAll()}),(t=>{e.params.rotate=e.params.rotate|e._rotate|0,e.params.rotate+=t,e.params.rotate=e.params.rotate%360,this.renderPreview()}),(()=>{i.merge(e.params,n),i.merge(e,a),this._optionCrop({detail:r})}),(()=>{e._interactive=!0,e._interactiveScaled=!0,this._canvas.fire("object:modified",{target:e._object}),this._optionCrop({detail:r})})),this._cropEl),this._wrapper.appendChild(this._cropEl),this._highlight(!0);let s=this._wrapper.getBoundingClientRect();s.top<0&&window.scrollTo&&window.scrollTo(s.left,s.top+window.scrollY-50)}this._canvas.discardActiveObject(),this.renderPreview().then((()=>{this.settings.cropMode&&this.selectLayer(this.settings.cropLayer)}))}}}_optionExport(t){let e=t.detail,i=this.previewConfig;if(e.params.exportView&&e.params.exportView!==i.name)return;let r=!(!i.exportConfig.crop||!i.exportConfig.cropConfig.width)&&i.exportConfig.cropConfig,o=i.exportConfig.originalFormat||"png",n=this.export({width:i.width,height:i.height},r,!0,"excludeOriginal",o,.8,!1);n&&this.downloadBlob(n,(e.params.exportName||i.name)+"."+o)}_clearVisibleEditor(){this.settings.editorMode&&(this.visibleEditor={})}_optionLayerUpdate(t){if(t._layer&&t._layer._object){let e=this._canvas.getObjects().indexOf(t._layer._object);return this._canvas.remove(t._layer._object),this._renderLayer(t._layer).then((t=>{this._canvas.moveTo(t,e)}))}}_watchWindowResize(){let t=i.debounced(200,(t=>{this._resizeCanvas(),this.settings.stickyMode&&this._stickyPreview(!0)}));this._resizeCanvas(),window.addEventListener("resize",t)}_watchWindowScroll(){let t=!1;window.addEventListener("scroll",(()=>{t||(this.settings.sticky||this._highlightEl)&&(window.requestAnimationFrame((()=>{this.settings.sticky&&this._stickyPreview(),this._highlightEl&&this._highlight(!0),t=!1})),t=!0)})),this.settings.sticky&&window.addEventListener("preview:active",(()=>this._stickyPreview()))}_getContainerWidth(){let t=this._wrapper.offsetWidth,e=this._wrapper;for(;0===t&&e.parentNode;)e=e.parentNode,e.offsetWidth>0&&(t=i.findInnerDimensions(e).width);return t}_responsiveCanvasHeight(){if(!this.settings.cropMode){let t=0;this._canvas.forEachObject((e=>{if(e.visible&&e._layer&&e._layer.params.responsive){let i=e.getBoundingRect(),r=i.top+i.height;r>t&&(t=r)}}));let e=this.previewConfig.height*this._canvas.getZoom();t>0&&t<e?this._canvas.setHeight(t):this._canvas.setHeight(e)}}_resizeCanvas(){const t=this._canvas.getWidth()/this._canvas.getHeight(),e=this._getContainerWidth();let i=e/this._canvas.getWidth(),r=this._canvas.getZoom()*i;if(1!==r){let o={width:e,height:e/t};this.settings.maxHeight&&o.height>this.settings.maxHeight&&(o.height=this.settings.maxHeight,o.width=o.height*t,i=o.width/this._canvas.getWidth(),r=this._canvas.getZoom()*i),this._canvas.setDimensions(o),this._canvas.setZoom(r)}this._highlightEl&&this._highlight(!0)}_highlight(t){if(ji.productCropOverlay&&!i.findParent(this.element,".cl-po--popup-preview")||(t=!1),!t&&this._highlightEl&&(document.body.removeChild(this._highlightEl),delete this._highlightEl,document.body.classList.remove("cl-highlight")),t){let t=!1;this._highlightEl||(this._highlightEl=document.createElement("div"),this._highlightEl.className="cl-po--preview-highlight",t=!0);let e=i.getCalculatedPosition(this._wrapper);const r=20,o=e.right-e.left+r,n=e.bottom-e.top+r;this._highlightEl.style.display="block",this._highlightEl.style.position="absolute",this._highlightEl.style.width=`${o}px`,this._highlightEl.style.height=`${n}px`,this._highlightEl.style.top=e.top-r/2+"px",this._highlightEl.style.left=e.left-r/2+"px",t&&(document.body.appendChild(this._highlightEl),document.body.classList.add("cl-highlight"))}}_stickyPreview(t=!1){let e=this._canvas.lowerCanvasEl,r=e.getBoundingClientRect(),o=this._stickyMaxTop||0;if(r.top>o||!this.active||this.settings.cropMode||0===r.width||0===r.height)this.settings.stickyMode&&(a.debug("----\x3e sticky end",e),this.element.removeEventListener("layer:changed",this._syncSticky),this.element.removeEventListener("preview:rendered",this._syncSticky),document.body.removeChild(this._stickyEl),delete this._stickyEl,delete this._stickyImgEl,delete this._stickyTarget,delete this._stickyMaxTop,this.settings.stickyMode=!1);else{let o,n,s=!1,l=window.clStickyMobileSize||25;this._stickyTarget=this._stickyTarget||document.querySelector("#"+this.config.uuid);let c=this._stickyTarget.getBoundingClientRect();if(c.top>r.bottom&&window.innerWidth<=768&&(s=!0,o=window.innerHeight/100*l,n="overlay"===this.settings.stickyMobile?o:0),this.settings.stickyMode){let e=this._stickyEl.getBoundingClientRect();if(c.bottom>0){let t=e.height-c.bottom;this._stickyEl.style.top=t>0?-1*t+"px":"0px"}else this._stickyEl.style.top=-1*(e.height+5)+"px";t&&(s?(this._stickyEl.classList.add("mobile"),this._stickyEl.classList.add(this.settings.stickyMobile),this._stickyEl.style.removeProperty("left"),this._stickyEl.style.removeProperty("width"),this._stickyImgEl.style.height=o+"px",this._stickyMaxTop=-1*(r.height-n)):(this._stickyEl.classList.remove("mobile"),this._stickyImgEl.style.removeProperty("height"),this._stickyEl.style.left=r.left+"px",this._stickyEl.style.width=r.width+"px"))}else if(a.trace("---\x3e sticky check"+c.bottom+" > "+r.bottom),c.bottom>r.bottom){if(s){if(r.bottom>n)return;this._stickyMaxTop=-1*(r.height-n)}this._stickyEl=document.createElement("div"),this._stickyEl.className="cl-po--preview-sticky",this._stickyEl.style.position="fixed",this._stickyImgEl=document.createElement("img"),s?(this._stickyEl.classList.add("mobile"),this._stickyEl.classList.add(this.settings.stickyMobile),this._stickyImgEl.style.height=o+"px"):(this._stickyEl.style.left=r.left+"px",this._stickyEl.style.width=r.width+"px"),this._stickyEl.style.top="0px",this._stickyEl.addEventListener("click",(t=>{let r=i.getCalculatedPosition(e);window.scroll({top:r.top-50,behavior:"smooth"})})),this._stickyEl.appendChild(this._stickyImgEl),this._syncSticky(),document.body.appendChild(this._stickyEl),this.element.addEventListener("layer:changed",this._syncSticky),this.element.addEventListener("preview:rendered",this._syncSticky),this.settings.stickyMode=!0,a.debug("--\x3e sticky start",this._stickyEl,this._stickyTarget)}}}_syncThemeGallery(){if(ji.themeGallery){if(this.shopifyStore.isTheme("Dawn")){let t=i.findParent(this.element,"media-gallery");if(t&&t.setActiveMedia){let e=i.findParent(this.element,".product__media-item");if(e&&e.dataset.mediaId){this.element.scrollIntoView=function(){},t.setActiveMedia(e.dataset.mediaId,!0);let r=i.findParent(this.element,".slider");return void(r&&r.scrollTo&&(r.scrollLeft=0))}}}try{if(!1!==this._themeGalleryImgEl){if(this._themeGalleryVariant&&this.settings.variantId!==this._themeGalleryVariant)return void(this._themeGalleryVariant=this.settings.variantId);if(!this._themeGalleryImgEl)if(void 0===this.previewConfig.views||this.previewConfig.gallery&&!0!==this.config.previewConfig.galleryConfig.hideThumbnails)this._themeGalleryImgEl=!1;else{let e;if(this.settings.product.media&&this.settings.product.media.length){var t=0;for(let e=0;e<this.previewConfig.layers.length;e++){const i=this.previewConfig.layers[e];if("product"===i.type){this._themeGalleryVariant=this.settings.variantId,i.params.imgPos?this.settings.product.media.length>i.params.imgPos-1&&(t=i.params.imgPos-1):i.params.variant&&delete this._themeGalleryVariant;break}}e=this.settings.product.media[t]}if(e){let t,r=i.pathBaseName(e.src,!1);if(this.settings.selectorThumbnail&&(t=document.querySelectorAll(this.settings.selectorThumbnail),a.debug("found "+t.length+" gallery thumbnails with selector: ",this.settings.selectorThumbnail,t)),!t||0===t.length){t=[];let e=document.querySelectorAll('img[src*="'+r+'"], img[data-src*="'+r+'"], img[data-srcset*="'+r+'"]');if(e.length>0)for(let r=0;r<e.length;r++){const o=e[r];let n=i.findParent(o,"form");null!==n&&-1!==n.action.indexOf("cart")||t.push(o)}a.debug("found "+t.length+" gallery thumbnails with src: ",r,t)}if(t.length){let e=Number.MAX_VALUE;for(let o=0;o<t.length;o++){const n=t[o];let a=(n.src&&-1===n.src.indexOf("data:")?n.src:null)||n.dataset.src||n.dataset.srcset,s=i.pathBaseName(a,!1);s=this.shopifyStore.stripImageDimension(s);let l=s.replace(r,"").length;l<e&&(e=l,this._themeGalleryImgEl=n)}a.debug("selected theme gallery thumbnail: ",this._themeGalleryImgEl)}}}if(this._themeGalleryImgEl&&this._themeGalleryImgEl.click){let t=i.isHidden(this._wrapper);ji.themeGalleryTimeout?setTimeout((()=>this._themeGalleryImgEl.click()),300):this._themeGalleryImgEl.click(),t&&setTimeout((()=>window.dispatchEvent(new Event("resize"))),500)}}}catch(t){a.error("error syncing theme gallery ",t)}}}_triggerEvent(t,e){const i=new CustomEvent(t,{detail:e,cancelable:!0,bubbles:!0});this.element.dispatchEvent(i)}_patchCanvasTouchScroll(){window.clCanvasTouchStart||(window.clCanvasTouchStart=fabric.Canvas.prototype._onTouchStart,fabric.util.object.extend(fabric.Canvas.prototype,{_onTouchStart:function(t){var e=this.findTarget(t);(!this.allowTouchScrolling||e||this.isDrawingMode)&&window.clCanvasTouchStart.call(this,t)}}))}_updateCanvasControls(){var t="#b2ccff";const e=t=>("#"===t.charAt(0)&&(t="%23"+t.substring(1)),"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath d='M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm4.82-4.924a7 7 0 1 0-1.852 1.266l-.975-1.755A5 5 0 1 1 17 12h-3l2.82 5.076z' fill='"+t+"'/%3E%3C/svg%3E"),i=(t,e,i,o,n)=>{t.save(),t.translate(e,i),t.rotate(fabric.util.degreesToRadians(o.angle)),t.drawImage(r,-n/2,-n/2,n,n),t.restore()};var r=document.createElement("img");r.src=e(t),r.dataset.fill=t,fabric.Object.prototype.controls.mtr=new fabric.Control({x:0,y:-.5,offsetY:-40,cursorStyle:"crosshair",actionHandler:fabric.controlsUtils.rotationWithSnapping,actionName:"rotate",render:function(t,o,n,a,s){const l=1.5*s.cornerSize;r.dataset.fill!=t.fillStyle&&(r.onload=function(){i(t,o,n,s,l)},r.dataset.fill=t.fillStyle,r.src=e(t.fillStyle)),i(t,o,n,!1,l)},cornerSize:28,withConnection:!0})}constructor(t,e,r,o,n){var s,l,c;c=()=>{let t={format:"png",multiplier:this.previewConfig.width/this._canvas.getWidth()};this._stickyImgEl.src=this._canvas.toDataURL(t),this._canvas.requestRenderAll()},(l="_syncSticky")in(s=this)?Object.defineProperty(s,l,{value:c,enumerable:!0,configurable:!0,writable:!0}):s[l]=c;let p={api:"https://api.cloudlift.app",assets:"https://assets.cloudlift.app",queryParams:{},selector:".cl-preview",selectorThumbnail:"",position:"",classNamePrefix:"cl-po",product:{},variantId:null,editorMode:!1,editLayer:sr.editLayer,cropMode:!1,cropLayer:"",sticky:!1,stickyMobile:"overlay",stickyMode:!1,maxHeight:0};this.config=t,this.previewConfig=e,this.active=!0,this.settings=i.extend(p,n||{}),this.visible={},this.visibleEditor={},this.shopifyStore=u.getInstance(),this._productForm=r,this.conditionsEngine=o,null!==this.settings.selector&&(i.isElement(this.settings.selector)?this.element=this.settings.selector:this.element=document.querySelector(this.settings.selector)),null!=this.element?(a.info("--\x3e new product-preview: ",this.element),this.resources=[this.settings.assets+"/static/lib/fabricjs/fabric.min.js"],this.ready=rr.loadOnce(this.resources,"product-preview",{async:!1}).then((()=>this._init()))):a.warn("no elements with selector found: ",this.settings.selector)}};class to{static generateId(){return Date.now().toString()}static getItem(t){return to.storage.hasOwnProperty(t)||(to.storage[t]=to.parseItem(t)),to.storage[t]}static storeItem(t,e){to.storage[t]=e,window.localStorage&&localStorage.setItem(to.keyPrefix+t,JSON.stringify(e))}static parseItem(t){if(window.localStorage){let e=localStorage.getItem(to.keyPrefix+t);if(e)return JSON.parse(e)}return{}}}to.storage={},to.keyPrefix="cl_";var eo=to;var io=class{_init(){let t=[];for(let e=0;e<this.settings.product.options.length;e++){const r=this.settings.product.options[e];let o={name:r.name,label:r.name,type:"select",id:"option_"+this.settings.product.id+"_"+r.name.replace(/^[^a-zA-Z]+|[^\w]+/g,""),params:{name:"v_"+r.name},visible:!0,values:[],_variantOption:r,_themeEl:null},n=!1;for(let t=0;t<this.config.variantOptions.length;t++){let e=this.config.variantOptions[t];if(e.name===r.name){i.merge(o,e),n=!0;break}}n||this.config.variantOptions.length>e&&i.merge(o,this.config.variantOptions[e]),this.settings.variant.id?o.value=this.settings.variant["option"+r.position]:o.value=r.values[0];let a=o.values.length>0,s=[];for(let t=0;t<r.values.length;t++){let e=r.values[t],i=null;if(a)for(let t=0;t<o.values.length;t++){const r=o.values[t];if(r&&r.value===e){i=r;break}}i||(i={text:e,value:e}),s.push(i)}if(o.values=s,t.push(o),!this.settings.editorMode){if(o._themeEl=this._productForm.querySelector('[data-live-variant-option="'+r.position+'"]'),!o._themeEl){let t=this._productForm.querySelectorAll("select");const e=t=>{if(t.length===r.values.length){for(let e=0;e<t.length;e++){const i=t[e];if(-1===r.values.indexOf(i))return!1}return!0}return!1};for(let i=0;i<t.length;i++){const n=t[i];if(n.dataset.index&&-1!==n.dataset.index.indexOf(r.position.toString())){o._themeEl=n;break}{let t=[],i=n.querySelectorAll("option");for(let e=0;e<i.length;e++){const r=i[e];t.push(r.value)}if(e(t)){o._themeEl=n;break}}}if(!o._themeEl){let t=this._productForm.querySelectorAll("input[type=radio]"),i=[];for(let n=0;n<t.length;n++){const a=t[n];if(-1===i.indexOf(a.name)){i.push(a.name);let t=this._productForm.querySelectorAll('input[name="'+a.name+'"]');if(a.dataset.index&&-1!==a.dataset.index.indexOf(r.position.toString())){o._themeEl=t;break}{let i=[];for(let e=0;e<t.length;e++){const r=t[e];i.push(r.value)}if(e(i)){o._themeEl=t;break}}}}}}if(o._themeEl&&ji.productVariantHide){let t=o._themeEl;i.isNodeList(o._themeEl)&&(t=t[0]);let e=t;for(;e.parentNode!==this._productForm&&-1===e.textContent.indexOf(r.name);)e=e.parentNode;e.style.display="none"}let t=this._productForm.querySelector("[data-live-variant-options]");null!=t&&(t.style.display="none")}}this.config.variantOptions=t}syncVariantChanges(t){if(t._themeEl)if(i.isNodeList(t._themeEl))for(let e=0;e<t._themeEl.length;e++){const i=t._themeEl[e];i.value==t.value&&(i.checked=!0,i.dispatchEvent(new Event("change",{bubbles:!0})))}else if("SELECT"===t._themeEl.tagName){for(let e=0;e<t._themeEl.options.length;e++){if(t._themeEl.options[e].value==t.value){t._themeEl.selectedIndex=e;break}}t._themeEl.dispatchEvent(new Event("change",{bubbles:!0}))}}syncAllVariantOptions(){for(let t=0;t<this.config.variantOptions.length;t++){const e=this.config.variantOptions[t];this.syncVariantChanges(e)}}findSelectedVariant(){this.settings.variant=null;for(let t=0;t<this.settings.product.variants.length;t++){const e=this.settings.product.variants[t];let i=!0;for(let t=0;t<this.config.variantOptions.length;t++){const r=this.config.variantOptions[t];if(e["option"+r._variantOption.position]!=r.value){i=!1;break}}if(i){this.settings.variant=e;break}}return this.settings.variant}resetVariant(){this.settings.variant=this.settings.product.variants[0];for(let t=0;t<this.config.variantOptions.length;t++){const e=this.config.variantOptions[t];let i="option"+e._variantOption.position;e.value=this.settings.variant[i]}}filterVariantValues(){let t={};if(this.config.variantOptions.length>1)for(let e=0;e<this.config.variantOptions.length;e++){const i=this.config.variantOptions[e];let r="option"+i._variantOption.position;if(e>0){let e=i._values||i.values,o=[];for(let i=0;i<e.length;i++){const n=e[i];let a=!1;for(let e=0;e<this.settings.product.variants.length;e++){const i=this.settings.product.variants[e];let o=!0;for(const e in t)if(t.hasOwnProperty(e)&&t[e]!==i[e]){o=!1;break}if(o&&i[r]===n.value){a=!0;break}}a&&o.push(n)}e.length!==o.length&&(i._values=e,i.values=o)}t[r]=i.value}}constructor(t,e,r){this.settings=i.extend({product:{},variant:{},editorMode:!1},r||{}),this.config=t,this._productForm=e,this._init()}};const ro=t=>{if(window.Shopify){function e(){setTimeout((function(){window.ShopifyXR.addModels([t]),window.ShopifyXR.setupXRElements()}),1e3)}window.ShopifyXR?e():window.Shopify.loadFeatures([{name:"shopify-xr",version:"1.0",onLoad:e}])}for(var i,r=t.sources.length-1;r>=0&&"glb"!==(i=t.sources[r]).format;r--);return et`<div class="cl-embed" style="padding-top: 100%;"><model-viewer toggleable="true" src=${i.url} poster=${t.preview_image.src} camera-controls="true" style="--poster-color: transparent;" data-shopify-feature="1.12"></model-viewer></div>
        ${!1!==window.clGalleryXR?et`<button class="button button--full-width product__xr-button cl-xr-button" type="button" data-shopify-xr="" data-shopify-title="Model" data-shopify-model3d-id=${t.id} data-shopify-xr-hidden="">
                <svg xmlns="http://www.w3.org/2000/svg" focusable="false" fill="none" viewBox="0 0 18 21"><path d="M7.67998 20.629L1.28002 16.723C0.886205 16.4784 0.561675 16.1368 0.337572 15.731C0.113468 15.3251 -0.00274623 14.8686 -1.39464e-05 14.405V6.59497C-0.00238367 6.13167 0.113819 5.6755 0.33751 5.26978C0.561202 4.86405 0.884959 4.52227 1.278 4.27698L7.67796 0.377014C8.07524 0.131403 8.53292 0.000877102 8.99999 9.73346e-08C9.46678 -0.000129605 9.92446 0.129369 10.322 0.374024V0.374024L16.722 4.27399C17.1163 4.51985 17.4409 4.86287 17.6647 5.27014C17.8885 5.67742 18.0039 6.13529 18 6.59998V14.409C18.0026 14.8725 17.8864 15.3289 17.6625 15.7347C17.4386 16.1405 17.1145 16.4821 16.721 16.727L10.321 20.633C9.92264 20.8742 9.46565 21.0012 8.99999 21C8.53428 20.9998 8.07761 20.8714 7.67998 20.629V20.629ZM8.72398 2.078L2.32396 5.97803C2.22303 6.04453 2.14066 6.13551 2.08452 6.24255C2.02838 6.34959 2.00031 6.46919 2.00298 6.59003V14.4C2.00026 14.5205 2.02818 14.6396 2.08415 14.7463C2.14013 14.853 2.22233 14.9438 2.32298 15.01L7.99999 18.48V10.919C8.00113 10.5997 8.08851 10.2867 8.25292 10.0129C8.41732 9.73922 8.65267 9.51501 8.93401 9.36401L15.446 5.841L9.28001 2.08002C9.19614 2.02738 9.09901 1.99962 8.99999 2C8.90251 1.99972 8.8069 2.02674 8.72398 2.078V2.078Z" fill="currentColor"></path></svg>
                ${window.clGalleryXRText||"View in your space"}
            </button>`:null}`};var oo=(t,e)=>et`
<div class="cl-po--gallery ${e.layout}">

    <div class="splide cl-po--gallery-main  ${li({"hide-thumb-mobile":e.hideThumbnailsMobile})}">
        <div class="splide__track">
            <div class="splide__list">
                ${ni(t,(t=>t.id),((t,e)=>et`
                    <div class="splide__slide">
                        ${"video"===t.media_type||"external_video"===t.media_type||"model"===t.media_type?et`<div class="cl-po--gallery-img" data-media-position=${t.position} >${(t=>{if("model"===t.media_type)return ro(t);var e=void 0!==window.clGalleryAutoplay&&window.clGalleryAutoplay,i={paddingBottom:1/t.aspect_ratio*100+"%"};if("external_video"===t.media_type){if("youtube"===t.host)return et`<div class="cl-embed" style=${pi(i)}><iframe src="https://www.youtube.com/embed/${t.external_id}?controls=1&amp;enablejsapi=1&amp;modestbranding=1&amp;playsinline=1&amp;rel=0&amp;autoplay=${e?"1":"0"}" loading="lazy" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div>`;if("vimeo"===t.host)return et`<div class="cl-embed" style=${pi(i)}><iframe src="https://player.vimeo.com/video/${t.external_id}?byline=0&amp;controls=1&amp;playsinline=1&amp;title=0" loading="lazy" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen" ></iframe></div>`}for(var r=[],o=[],n=t.sources.length-1;n>=0;n--){var a=t.sources[n];-1===o.indexOf(a.mime_type)&&(r.push(a),o.push(a.mime_type))}return et`<div class="cl-embed" style=${pi(i)}><video autoplay=${mi(e?"autoplay":void 0)} loop=${mi(e?"loop":void 0)} muted="muted" playsinline="playsinline" controls="controls" preload="none" poster="${t.preview_image.src}">
        ${ni(r,(t=>et`
            <source src="${t.url}" type="${t.mime_type}">
        `))}
    </video></div>`})(t)}</div>`:et`<img class="cl-po--gallery-img" src=${t.src} data-media-position=${t.position} />`}
                    </div>
                `))}
            </div>
        </div>
    </div>
    ${e.hideThumbnails?null:et`
        <div class="splide cl-po--gallery-thumbnails ${li({"cl-hide-mobile":e.hideThumbnailsMobile})}">
            <div class="splide__track">
                <div class="splide__list">
                    ${ni(t,(t=>t.id),((t,e)=>et`
                    <div class="splide__slide">
                        <img class="cl-po--gallery-thumbnail" src=${Qi(t.src||t.preview_image.src,"200x")} data-media-position=${t.position} />
                    </div>
                `))}
                </div>
            </div>
        </div>
    `}
</div>
`;var no=class{destroy(){if(this._previews)for(let t=0;t<this._previews.length;t++){this._previews[t].destroy()}this.element.removeChild(this._wrapper)}render(){tt(oo(this.media,this.settings.galleryConfig),this._wrapper)}selectPreview(t){this._splideThumbnails.go(this._getMediaIndex(t))}_init(){this._wrapper=document.createElement("div"),this._wrapper.className=this.settings.classNamePrefix+"--gallery-wrapper",this._wrapper.setAttribute("id",this.config.uuid+"_gallery"),this._wrapper.style.width="100%",this.settings.position?(this.element.insertAdjacentElement(this.settings.position,this._wrapper),this.element!==this._wrapper.parentNode&&(this.element=this._wrapper.parentNode)):this.element.appendChild(this._wrapper);let t=[this.config.previewConfig];if(this.config.previewConfig.views.length&&t.push(...this.config.previewConfig.views),this._filterProductMedia(t),this.settings.galleryConfig.loader&&this._addLoader(),this.render(),this._splideMain=new Splide(this._wrapper.querySelector("."+this.settings.classNamePrefix+"--gallery-main"),{type:"fade",keyboard:"focused",drag:!this.settings.editorMode&&!this.settings.galleryConfig.hideThumbnails,rewind:!0,arrows:this.settings.galleryConfig.arrows,pagination:this.settings.galleryConfig.pagination||this.settings.galleryConfig.paginationMobile,classes:{pagination:"splide__pagination"+(this.settings.galleryConfig.paginationMobile?" mobile":"")}}),this.settings.galleryConfig.hideThumbnails)this._splideThumbnails={go:t=>{this._splideMain.go(t),this._selectPreview(t)}},this._splideMain.mount();else{let t="left"===this.settings.galleryConfig.layout||"right"===this.settings.galleryConfig.layout?"ttb":"ltr";this._splideThumbnails=new Splide(this._wrapper.querySelector("."+this.settings.classNamePrefix+"--gallery-thumbnails"),{keyboard:"focused",autoWidth:!0,fixedHeight:100,height:"ttb"===t?600:0,direction:t,rewind:!0,gap:3,arrows:this.settings.galleryConfig.arrowsThumbnails,pagination:this.settings.galleryConfig.paginationThumbnails,isNavigation:!0,breakpoints:{600:{fixedHeight:66}}}),this._splideThumbnails.mount(),this._splideMain.sync(this._splideThumbnails).mount(),this._splideThumbnails.on("moved",((t,e)=>{this._selectPreview(t)}))}let e=[];for(let i=0;i<t.length;i++){let r=t[i],o=this._wrapper.querySelector("."+this.settings.classNamePrefix+'--gallery-main [data-media-position="'+r.position+'"]');if(o){let t=o.parentNode;t.removeChild(o);let n=new Zr(this.config,r,this._productForm,this.conditionsEngine,{api:this.settings.api,assets:this.settings.assets,selector:t,selectorThumbnail:this.settings.selectorThumbnail,sticky:this.settings.sticky,stickyMobile:this.settings.stickyMobile,maxHeight:this.settings.maxHeight,product:this.settings.product,variantId:this.settings.variantId,editorMode:this.settings.editorMode});n.active=1===r.position,0===i&&this.settings.galleryConfig.previewActive&&isNaN(this.settings.galleryConfig.position)&&(n.active=!0),n.active&&(this._preview=n),this.settings.galleryConfig.hideThumbnails||(n._thumbnailEl=this._wrapper.querySelector("."+this.settings.classNamePrefix+'--gallery-thumbnails [data-media-position="'+r.position+'"]')),e.push(n.ready.then((()=>{if(n._thumbnailEl){const t=t=>{let e={format:"png",multiplier:200/n._canvas.getHeight()};n._thumbnailEl.src=n._canvas.toDataURL(e),n._canvas.requestRenderAll()};n.element.addEventListener("layer:changed",t),n.element.addEventListener("preview:rendered",t)}}))),this._previews.push(n)}else a.warn("[live-options] gallery - missing media image for view: ",r)}return this._watchFormChanges(),this._splideMain.options.drag&&!this._isStatic(t)&&this._watchPreviewChanges(),this.settings.editorMode&&window.clProductGalleryPosition?(this.selectPreview(window.clProductGalleryPosition),delete window.clProductGalleryPosition):isNaN(this.settings.galleryConfig.position)?this._selectVariantThumbnail(this._getVariantById(this.settings.variantId)):this.selectPreview(this.settings.galleryConfig.position),!this._preview&&this._previews.length&&(this._preview=this._previews[0]),Promise.all(e)}_filterProductMedia(t){this.media=this.settings.product.media.filter((t=>-1===this.settings.galleryConfig.exclude.indexOf(t.position))),this.settings.galleryConfig.hideThumbnails&&(this.media=this.media.filter((e=>{for(let i=0;i<t.length;i++){if(t[i].position===e.position)return!0}return!1})))}_getMediaIndex(t){for(let e=0;e<this.media.length;e++)if(this.media[e].position===t)return e;return-1}_getMediaPosition(t){return t<this.media.length?this.media[t].position:-1}_selectPreview(t){if(this.media.length>t){let e=this.media[t];!this.settings.galleryConfig.previewActive&&this._preview&&(this._preview.active=!1);for(let t=0;t<this._previews.length;t++){const i=this._previews[t];if(i.previewConfig.position===e.position){this._preview&&(this._preview.active=!1),this._preview=i,this._preview.active=!0,this._triggerEvent("preview:active",{position:e.position});break}}"model"===e.media_type?this._splideMain.Components.Drag.disabled||(this._DragRestore=!0,this._splideMain.Components.Drag.disabled=!0):this._DragRestore&&(this._splideMain.Components.Drag.disabled=!1,delete this._DragRestore)}}_selectVariantThumbnail(t){if(this._preview&&this._preview.active){let t=this._findProductLayer(this._preview.previewConfig);if(t&&t.params.variant)return}if(t&&(t.featured_media||t.featured_image)){let e=t.featured_media||t.featured_image,i=this._getMediaIndex(e.position);if(-1!==i)this._splideThumbnails.go(i);else for(let t=0;t<this._previews.length;t++){const e=this._previews[t];let r=this._findProductLayer(e.previewConfig);if(r&&r.params.variant&&(i=this._getMediaIndex(e.previewConfig.position),-1!==i))return void this._splideThumbnails.go(i)}}}_findProductLayer(t){for(let e=0;e<t.layers.length;e++){const i=t.layers[e];if("product"===i.type)return i}return null}_watchFormChanges(){this._productForm&&(this._productForm.addEventListener("option:changed",(t=>this._optionChanged(t))),this._productForm.addEventListener("option:crop",(t=>this._optionChanged(t))),this._productForm.addEventListener("option:variant_changed",(t=>this._variantChanged(t))))}_watchPreviewChanges(){this.element.addEventListener("preview:rendered",(t=>this._checkInteractive(t))),this.element.addEventListener("preview:active",(t=>this._checkInteractive(t)))}_variantChanged(t){this.settings.variantId=t.detail.variantId,this._selectVariantThumbnail(this._getVariantById(this.settings.variantId))}_optionChanged(t){let e=t.detail,i=-1,r=-1,o=this._getMediaPosition(this._splideMain.index);for(let t=0;t<this._previews.length;t++){const n=this._previews[t];if(n._canvas){let t=n._canvas.getObjects();for(let o=0;o<t.length;o++){const a=t[o];if(a._layer&&a._layer.params.option===e.name){n.previewConfig.position!==i&&(i=n.previewConfig.position,-1===r&&(r=i));break}}}if(-1===i){for(let t=0;t<n.previewConfig.layers.length;t++){if(n.previewConfig.layers[t].params.option===e.name){n.previewConfig.position!==i&&(i=n.previewConfig.position,-1===r&&(r=i));break}}if(-1===i)for(let t=0;t<n.previewConfig.layers.length;t++){const o=n.previewConfig.layers[t];if(o.conditions.length){let t=!1;for(let a=0;a<o.conditions.length;a++){const s=o.conditions[a];if(s.field===e.name&&this.conditionsEngine.evaluateOptionCondition(s,[e])&&n.previewConfig.position!==i){i=n.previewConfig.position,-1===r&&(r=i),t=!0;break}}if(t)break}}}if(i===o)return;i=-1}-1!==r&&(this.selectPreview(r),t&&"option:crop"===t.type&&this._selectPreview(this._getMediaIndex(r)))}_getVariantById(t){if(this.settings.product.variants&&this.settings.product.variants.length>0)for(let e=0;e<this.settings.product.variants.length;e++){const i=this.settings.product.variants[e];if(i.id.toString()===t.toString())return i}return null}_checkInteractive(t){let e=!1;if(this._preview&&this._preview._canvas)if(this._preview.settings.cropMode)e=!0;else{let t=this._preview._canvas.getObjects();for(let i=0;i<t.length;i++){const r=t[i];if(r._layer&&r._layer.params.interactive){e=!0;break}}}this._splideMain.Components.Drag.disabled=e}_isStatic(t){for(let e=0;e<t.length;e++){const i=t[e];for(let t=0;t<i.layers.length;t++){const e=i.layers[t];if(e.params.interactive||e.params.crop&&"upload"===e.type)return!1}}return!0}_addLoader(){let t="300px",e=this._getMediaIndex(isNaN(this.settings.galleryConfig.position)?1:this.settings.galleryConfig.position);if(-1!==e){let i=this.media[e];if(i){let e=i.aspect_ratio;if(!e&&i.width&&i.height&&(e=i.width/i.height),e){let i=this.element.offsetWidth,r=this._wrapper;for(;0===i&&r.parentNode;)r=r.parentNode,r.offsetWidth>0&&(i=r.offsetWidth);i&&(t=Math.round(i/e)+"px")}}}a.debug("--\x3e product-gallery loader minHeight:",t),this._loader=document.createElement("div"),this._loader.className="cl-po--gallery-loader",this._loader.style.minHeight=t,this._loader.innerHTML='<div class="cl-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>',this.element.insertBefore(this._loader,this._wrapper),this._wrapper.style.opacity="0";const i=t=>{this._preview!==t.detail&&this._preview||(this._removeLoader(),this.element.removeEventListener("preview:rendered",i))};this.element.addEventListener("preview:rendered",i)}_removeLoader(){this._wrapper.style.opacity="1",this._loader&&(this.element.removeChild(this._loader),this._loader=null)}_triggerEvent(t,e){const i=new CustomEvent(t,{detail:e,cancelable:!0,bubbles:!0});this.element.dispatchEvent(i)}constructor(t,e,r,o){this.config=t,this.settings=i.extend({api:"https://api.cloudlift.app",assets:"https://assets.cloudlift.app",queryParams:{},selector:".cl-gallery",position:"",sticky:!1,stickyMobile:"overlay",maxHeight:0,classNamePrefix:"cl-po",product:{},variantId:null,galleryConfig:{exclude:[],hideThumbnails:!1,hideThumbnailsMobile:!1,layout:"bottom",arrows:!1,arrowsThumbnails:!1,pagination:!1,paginationMobile:!1,paginationThumbnails:!1,previewActive:!1,loader:!1}},o||{}),window.clGallery&&(this.settings.galleryConfig=i.extend(this.settings.galleryConfig,window.clGallery)),this._previews=[],this.media=[],this._productForm=e,this.conditionsEngine=r,null!==this.settings.selector&&(i.isElement(this.settings.selector)?this.element=this.settings.selector:this.element=document.querySelector(this.settings.selector)),null!=this.element?(a.info("--\x3e new product-gallery: ",this.element),this.resources=[this.settings.assets+"/static/lib/splidejs/splide.min.js",this.settings.assets+"/static/lib/splidejs/splide.min.css"],this.ready=rr.loadOnce(this.resources,"product-gallery",{async:!1}).then((()=>this._init()))):a.warn("no elements with selector found: ",this.settings.selector)}};var ao=class{translate(){try{let t=JSON.stringify(this.config.options),e=t.indexOf("#");if(-1!==e){let i=/^#[0-9A-F]{6}$/i;for(;-1!==e;){let r=t.substr(e,7);if(!i.test(r))break;a.trace("[config-translate] skipping color:",r),e=t.indexOf("#",e+1)}}-1!==e?(this._translateOptions(this.config.options),this.config.variantOption&&this._translateOptions(this.config.variantOptions,!0),this.config.preview&&this._translatePreview(this.config.previewConfig),a.debug("[config-translate] translated options")):a.debug("[config-translate] skipped options translation")}catch(t){a.debug("[config-translate] error in translation",t)}}_translateOptions(t,e=!1){for(let i=0;i<t.length;i++){const r=t[i];if(r.label&&(r.label=l.translate(r.label)),e||(r.name&&(r.name=l.translate(r.name)),r.value&&(r.value=l.translate(r.value))),r.params.info&&(r.params.info=l.translate(r.params.info)),r.params.help&&(r.params.help=l.translate(r.params.help)),r.params.textHelp&&(r.params.textHelp=l.translate(r.params.textHelp)),r.params.placeholder&&(r.params.placeholder=l.translate(r.params.placeholder)),r.params.validationMsg&&(r.params.validationMsg=l.translate(r.params.validationMsg)),r.params.collapseLabel&&(r.params.collapseLabel=l.translate(r.params.collapseLabel)),r.params.textValueSelect&&(r.params.textValueSelect=l.translate(r.params.textValueSelect)),r.params.button&&(r.params.button=l.translate(r.params.button)),r.params.textDiscountSave&&(r.params.textDiscountSave=l.translate(r.params.textDiscountSave)),r.params.textDiscountBuy&&(r.params.textDiscountBuy=l.translate(r.params.textDiscountBuy)),r.params.labelX&&(r.params.labelX=l.translate(r.params.labelX)),r.params.labelY&&(r.params.labelY=l.translate(r.params.labelY)),r.values)for(let t=0;t<r.values.length;t++){const i=r.values[t];i.value&&!e&&(i.value=l.translate(i.value)),i.text&&(i.text=l.translate(i.text))}r.conditions.length&&this._translateConditions(r.conditions),r.options&&r.options.length&&this._translateOptions(r.options)}}_translatePreview(t){let e=[t];t.gallery&&e.push(...t.views);for(let t=0;t<e.length;t++){const i=e[t];this._translateLayers(i.layers)}}_translateLayers(t){for(let i=0;i<t.length;i++){const r=t[i];for(var e in r.params)r.params.hasOwnProperty(e)&&-1!==e.indexOf("option")&&(r.params[e]=l.translate(r.params[e]));r.params.text&&(r.params.text=l.translate(r.params.text)),r.conditions.length&&this._translateConditions(r.conditions),r.layers&&r.layers.length&&this._translateOptions(r.layers)}}_translateConditions(t){for(let e=0;e<t.length;e++){const i=t[e];if(i.field&&(i.field=l.translate(i.field)),i.value&&-1!==i.value.indexOf("#"))if(-1!==i.value.indexOf(",")){let t=i.value.split(",");for(let e=0;e<t.length;e++)t[e]=l.translate(t[e]);i.value=t.join(",")}else i.value=l.translate(i.value)}}constructor(t){this.config=t}};var so=class{destroy(){this.removeCss(),this.element.removeChild(this._wrapper),this._destroyPreview()}updateVariantOptions(t){this.config.variantOptions=t,this._variantOptions&&(this._variantOptions.settings.variant=this._getVariantById(this._variantId),this._variantOptions._init())}updateOptions(t,e=!0,i=!0){let r,o;if(e&&(r=this.getValues()),i&&(o=this._getControllers()),this.config.options.length=0,this.config.options.push(...t),this._generateOptionIds(this.config.options,"option_"+this.settings.product.id+"_"),this._translate.translate(),e){for(const t in r)r[t]||delete r[t];this.setValues(r)}i&&this._setControllers(o),this._destroyTooltips(),this.render()}updatePreview(t){this.config.preview=!0,this._translate._translatePreview(t),this._preview?this._preview.updateConfig(t).then((()=>this.render())):(this.config.previewConfig=t,this._initPreview())}updateCss(t){this.removeCss(),this._style=i.addStyleElement(t,this.settings.styleSelector)}removeCss(){this._style&&this._style.parentNode.removeChild(this._style)}validate(){let t=this._validateOptions(this.config.options);return a.debug("validated product-options: ",this.config,t),this.render(),t}render(){let t=[];try{this._evaluateOptionConditions(this.config.options),this._evaluateOptionPrice(this.config.options),this._variantIdOption&&t.push(this._variantIdOption),this._variantOptions&&this.config.variantOptions.length&&t.push(...this.config.variantOptions);const e={uuid:this.config.uuid,editorMode:this.settings.editorMode,price:this.price,product:this.settings.product,productForm:this._productForm,productFormLink:this._productFormLink,assets:this.settings.assets};t.push(...this.config.options),tt(Dr(t,e,this._optionValueChanged.bind(this),this._clearOptionError.bind(this),this.validate.bind(this),this._getOption.bind(this)),this._wrapper),this._triggerEvent("options:rendered",this),this._initTooltips()}catch(e){a.error("failed to render product options",t,e)}}getValues(t={},e=this.config.options){for(let i=0;i<e.length;i++){const r=e[i];r.options&&r.options.length?this.getValues(t,r.options):t[r.name]=r.value}return t}setValues(t,e=this.config.options){for(let i=0;i<e.length;i++){const r=e[i];if(r.options&&r.options.length)this.setValues(t,r.options);else if(t.hasOwnProperty(r.name))r.value=t[r.name];else if("upload-lift"===r.type){let e=[];for(const i in t)t.hasOwnProperty(i)&&-1!==i.indexOf(r.name+"_")&&e.push(t[i]);e.length&&(r.value=e.join(","))}}}_init(){this.config.css&&this.updateCss(this.config.css),this._wrapper=document.createElement("div"),this._wrapper.className=this.settings.classNamePrefix+"--wrapper",this._wrapper.setAttribute("id",this.config.uuid),this.settings.position?(this.element.insertAdjacentElement(this.settings.position,this._wrapper),this.element!==this._wrapper.parentNode&&(this.element=this._wrapper.parentNode)):this.element.appendChild(this._wrapper),this._generateOptionIds(this.config.options,"option_"+this.settings.product.id+"_"),ji.productOptionsClear&&(this._optionValuesClear=this.getValues()),this._findProductForm()?(this._translate=new ao(this.config),this._translate.translate(),this._productForm.noValidate=!0,this._productForm.addEventListener("options:render",(t=>this.render())),this._watchFormSubmit(),this._watchVariantChanges(),this.config.preview&&this._initPreview(),i.hasQueryParam(window.location.href,"item")&&this._restoreCartItem()):a.warn("product-options no product form found for element: ",this.element,this.config)}_variantsInCurrency(){let t=[];Ni.priceVariant&&t.push(this.shopifyStore.getProduct(Ni.priceProductHandle||"product-options").then((t=>{Ni.priceVariantValue=t.price/100})).catch((()=>!0)));const e=e=>{let i=e.priceVariant,r=i.handle;!r&&i.title&&(r=i.title.substring(0,i.title.indexOf("-")).trim().replaceAll(" ","-").toLowerCase()),r&&t.push(t.push(this.shopifyStore.getProduct(r).then((t=>{if(t.variants)for(let r=0;r<t.variants.length;r++){const o=t.variants[r];if(o.id.toString()===i.id.toString()){e.price=o.price/100;break}}})).catch((()=>!0))))},i=t=>{if(t.values)for(let i=0;i<t.values.length;i++){const r=t.values[i];r.priceVariant&&e(r)}};for(let t=0;t<this.config.options.length;t++){let e=this.config.options[t];if(i(e),e.options&&e.options.length)for(let t=0;t<e.options.length;t++){i(e.options[t])}}return Promise.all(t)}_validateOptions(t,e=!1){let r=!0;for(let o=0;o<t.length;o++){const n=t[o];if(n.visible)if(n.options&&n.options.length){this._validateOptions(n.options,e)||(r=!1)}else if(n._controller&&"function"==typeof n._controller.onValidate){n.errors=[],n._controller.onValidate(n)||(r=!1)}else{let t=this.element;this._popup&&this._popup.isOn()&&this._popupEl&&(t=this._popupEl);let o=t.querySelector(`#${n.id}`);if(null==o&&(o=t.querySelector(`#${n.id}-0`)),null!=o&&!o.checkValidity()){if(r=!1,e||!o.scrollIntoView||i.isScrolledIntoView(o)||(o.style.scrollMargin="50px",o.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),o.style.scrollMargin="",e=!0),n.errors=[],n.params.validationMsg){n.errors.push(n.params.validationMsg);continue}for(const t in o.validity)if(o.validity[t]){let e="";e="tooLong"===t?l.get(this.settings.errorPrefix+t,{max:o.maxLength}):"tooShort"===t?l.get(this.settings.errorPrefix+t,{min:o.minLength}):"rangeOverflow"===t?l.get(this.settings.errorPrefix+t,{max:o.max}):"rangeUnderflow"===t?l.get(this.settings.errorPrefix+t,{min:o.min}):"patternMismatch"===t?l.get(this.settings.errorPrefix+t,{pattern:o.pattern}):l.get(this.settings.errorPrefix+t),e&&(-1===e.indexOf(this.settings.errorPrefix)?n.errors.push(e):a.warn("missing translation for "+e))}}}}return r}_findProductForm(){if(this._productForm=i.findParent(this.element,this.settings.selectorForm),!this._productForm){let t={srcEl:this.element};this._productForm=this.shopifyStore.findProductFormBestMatch(this.settings.product.id,t),t.parentEl&&(this._productFormParentEl=t.parentEl)}if(this._productFormParent=this._productForm.contains(this._wrapper),!this._productFormParent||this._productFormLinkForce){let t=this._productForm.getAttribute("id");t&&(this._productFormLink=t),this.shopifyStore.findExpressPaymentButtons().length&&(this._buyNowCapture=!0)}return null!==this._productForm}_initVariantOptions(){let t=this.shopifyStore.findProductFormVariantId(this._productForm);if(this.settings.product&&this.settings.product.variants&&(t||(t=this.settings.product.variants[0].id.toString()),this.config.variantOption&&this.settings.product.variants.length>1&&(this._variantOptions=new io(this.config,this._productFormParentEl||this._productForm,{product:this.settings.product,variant:this._getVariantById(t),editorMode:this.settings.editorMode}),ji.productVariantFilter&&this._variantOptions.filterVariantValues()),this.settings.editorMode))if(this._variantIdOption={name:"id",id:"option_"+this.settings.product.id+"_id",value:t,params:{name:"id",info:"<b>Only shown in the App to test conditional options based on the selected variant.</b>"},visible:!0},1===this.settings.product.variants.length||this.config.variantOption)this._variantIdOption.type="hidden";else{this._variantIdOption.label="Variant",this._variantIdOption.type="select",this._variantIdOption.values=[];for(let t=0;t<this.settings.product.variants.length;t++){const e=this.settings.product.variants[t];this._variantIdOption.values.push({text:e.title,value:e.id.toString()})}}return t}_watchVariantChanges(){let t=this._initVariantOptions();return this._onVariantChange(null,t),this._productForm.addEventListener("change",(t=>this._onVariantChange(t))),ji.productVariantHistory&&(ji.productVariantHistoryPush&&this._watchVariantHistory("pushState"),ji.productVariantHistoryReplace&&this._watchVariantHistory("replaceState")),null!==this._variantId}_watchVariantHistory(t){if("function"==typeof window.history[t]){const e=window.history[t],i=this._productForm;window.history[t]=function(t){return setTimeout((function(){i.dispatchEvent(new Event("change"))}),300),e.apply(window.history,arguments)}}}_onVariantChange(t,e){if(e||(e=this.shopifyStore.findProductFormVariantId(this._productFormParentEl||this._productForm)),e!==this._variantId){if(this._variantId=e,delete this.conditionsEngine.data.variant,this._variantId){let t=this._getVariantById(this._variantId);t&&(this.conditionsEngine.data.variant=t),this._clearVisibleEditor(),this._triggerEvent("option:variant_changed",{variantId:this._variantId})}this.render()}}_getVariantById(t){if(this.settings.product.variants&&this.settings.product.variants.length>0)for(let e=0;e<this.settings.product.variants.length;e++){const i=this.settings.product.variants[e];if(i.id.toString()===t.toString())return i}return null}_triggerEvent(t,e){const i=new CustomEvent(t,{detail:e,cancelable:!0,bubbles:!0});this.element.dispatchEvent(i),this._productFormParent||this._productForm.dispatchEvent(i)}_optionValueChanged(t){t._variantOption&&this._variantOptions&&this._variantOptionValueChanged(t),this._clearVisibleEditor(),this._triggerEvent("option:changed",t),t.errors&&t.errors.length&&(t._error?delete t._error:t.errors.length=0),this.render()}_variantOptionValueChanged(t){let e=this._variantOptions.findSelectedVariant();!e&&ji.productVariantReset&&(this._variantOptions.resetVariant(),this._variantOptions.syncAllVariantOptions()),ji.productVariantFilter&&this._variantOptions.filterVariantValues(),this._variantOptions.syncVariantChanges(t),this._variantIdOption&&e&&(this._variantIdOption.value=e.id.toString(),this._onVariantChange(null,this._variantIdOption.value))}_clearVisibleEditor(){this.settings.editorMode&&(this.visibleEditor={})}_clearOptionError(t,e,i){const r=e.errors.indexOf(i);r>-1&&e.errors.splice(r,1),this.render()}_generateOptionIds(t,e){for(let i=0;i<t.length;i++){const r=t[i];let o=r.name.replace(/^[^a-zA-Z0-9]+|[^\w]+/g,"");if(r.id=e+o,r.list&&this.settings.lists&&this.settings.lists.hasOwnProperty(r.list)&&(r.values=JSON.parse(JSON.stringify(this.settings.lists[r.list]))),"personalize"===r.type){let t=this._initPersonalize(r);return this._generateOptionIds(t,e)}r.options&&r.options.length&&this._generateOptionIds(r.options,e)}}_evaluateOptionConditions(t){for(let e=0;e<t.length;e++){const i=t[e];let r=!0;i.conditions&&i.conditions.length&&(r=this.conditionsEngine.evaluateConditions(i.conditions,Br.MODE.AND,"option.name="+i.name)),this.settings.editorMode&&this.visibleEditor.hasOwnProperty(i.name)&&(r=this.visibleEditor[i.name]),this.visible[i.name]=r,i.visible=r,i.options&&i.options.length&&this._evaluateOptionConditions(i.options)}}_evaluateOptionPrice(t){this.price.options={},this.price.total=0,this.price.totalBase=0,this.price.variants=[],this.price.variantTotal=0,this.price.weight=0,this.price.final=0,this._evaluateOptionPriceTotal(t),this._patchProductPriceTotal(),this._patchProductWeightTotal()}_patchProductPriceTotal(){let t=this._variantPrice;if(this._variantId){let e=this._getVariantById(this._variantId);e&&(t=e.price,this._variantPrice=t,this._variantCompareAtPrice=e.compare_at_price)}if(!isNaN(t)&&(this.price.final=this.price.total+t/100,0!==this.price.total||this._priceElList&&this._priceElList.length)){if(this._priceElList&&this._priceElList.length)for(let t=0;t<this._priceElList.length;t++)if(!i.isInPage(this._priceElList[t])){delete this._priceElList;break}if((!this._priceElList||0===this._priceElList.length)&&(this._priceElList=document.querySelectorAll('[data-live-price="'+this.settings.product.id+'"]'),0===this._priceElList.length&&ji.productPrice)){let e=Di(t,this.shopifyStore.trimMoneyFormatAmount(Ni.moneyFormat)),r=i.findElementContainsRegex("*",new RegExp(`^.{0,50}${e}.{0,50}$`,"s"));if(r.length>0&&(r=r.filter((t=>!i.isHidden(t)&&!this._wrapper.contains(t)))),0===r.length&&(a.debug("no productPrice elements found for price:",e),ji.amountNoDecimals&&(e=Di(t,"{{ amount_no_decimals }}"),a.debug("trying fallback {{ amount_no_decimals }} price: ",e),r=i.findElementContainsRegex("*",new RegExp(`^.{0,50}${e}.{0,50}$`,"s")),r.length>0&&(r=r.filter((t=>!i.isHidden(t)&&!this._wrapper.contains(t)))))),r.length)if(a.debug("found "+r.length+" productPrice elements",r),ji.productPriceAll)this._priceElList=r.filter((t=>{for(let e=0;e<r.length;e++){const i=r[e];if(i!==t&&t.contains(i))return!1}return!0}));else{let t=null,e=-1,i=this._wrapper.getBoundingClientRect();for(let o=0;o<r.length;o++){const n=r[o];let a=n.getBoundingClientRect(),s=Math.abs(i.top-a.top)+Math.abs(i.left-a.left);(!t||t.contains(n)||s<e)&&(t=n,e=s)}t&&(this._priceElList=[t])}}const e=()=>{let e=t+100*this.price.total,i=Di(e,Ni.moneyFormat);if(this._priceElList&&this._priceElList.length)for(let t=0;t<this._priceElList.length;t++){this._priceElList[t].innerHTML=i}this._triggerEvent("options:price",{price:e,priceFormat:i})};if(e(),ji.productPriceTimeout&&setTimeout((()=>e()),1e3),this._variantCompareAtPrice){let t=document.querySelectorAll('[data-live-price-compare="'+this.settings.product.id+'"]');if(t.length){let e=Di(this._variantCompareAtPrice+100*this.price.total,Ni.moneyFormat);for(let i=0;i<t.length;i++){t[i].innerHTML=e}}}ji.productPriceObserver&&!this._priceElObserver&&"MutationObserver"in window&&(this._priceElObserver=new MutationObserver((t=>{if(this._priceElList&&this._priceElList.length){a.trace("observer priceEl for removed nodes",this._priceElList);let e=!1;for(let i=0;i<t.length;i++){const r=t[i];if(r.removedNodes.length>0){if(1===r.removedNodes.length&&1!==r.removedNodes[0].nodeType)continue;const t=Array.from(r.removedNodes);for(let i=0;i<this._priceElList.length;i++){const r=this._priceElList[i];if(t.indexOf(r)>-1||t.some((t=>t.contains(r)))){a.debug("priceEl was removed:",r),e=!0;break}}}if(e)break}e&&(a.debug("-> triggering patchProductTotal"),this._patchProductPriceTotal())}})),this._priceElObserver.observe(document.body,{subtree:!0,childList:!0}))}}_patchProductWeightTotal(){if((0!==this.price.weight||this._weightElList&&this._weightElList.length)&&(this._weightElList&&0!==this._weightElList.length||(this._weightElList=document.querySelectorAll('[data-live-weight="'+this.settings.product.id+'"]')),this._weightElList&&this._weightElList.length))for(let t=0;t<this._weightElList.length;t++){const e=this._weightElList[t];let i=this.price.weight;if(this._variantId){let t=this._getVariantById(this._variantId);t&&t.weight&&(t.grams?i+=t.grams/1e3:i+=t.weight/1e3)}let r=i.toFixed(2)+"kg",o=e.dataset.liveWeightUnit||"kg";"g"===o?r=Math.round(1e3*i)+"g":"lb"===o?r=(2.205*i).toFixed(2)+"lb":"oz"===o&&(r=(35.274*i).toFixed(2)+"oz"),e.innerHTML=r}}_evaluateOptionPriceTotal(t){for(let e=0;e<t.length;e++){const i=t[e];if(i.visible){if(i._priceText&&delete i._priceText,void 0!==i.value&&i.values)for(let t=0;t<i.values.length;t++){const e=i.values[t];let r=String(e.value).trim()===String(i.value).trim();if(e.priceText&&i.value&&(r=!0),!r&&i._controller&&i._controller.multiSelect&&(r=i._controller.isSelected(i,e)),e.priceType)if(e.hasOwnProperty("_price")||(e._price=e.price),e.priceType===Ui){let t=this._getVariantById(this._variantId);t&&t.price?e.price=t.price/100/100*e._price:e.price=0}else e.priceType===Wi?e.price=e._price*i.value.length:e.priceType===Yi&&Xi.FORMULA&&(e.price=this._priceValueFormula(i,e));if(r&&(this.settings.priceWeight&&e.weight&&(this.price.weight+=e.weight),e.priceVariant&&(this.price.variants.push(e.priceVariant),e.priceVariantQuantity&&(e.priceVariant.quantity=-1),e.price&&(this.price.variantTotal+=e.price)),e.price)){let t,r,o=e.price;e.priceVariant||Ni.currencyConvert&&(r=o,this.price.totalBase+=r,o=qi(r)),this.price.options.hasOwnProperty(i.name)?(t=this.price.options[i.name],t.price+=o,t.priceBase&&(t.priceBase+=r)):t={option:i,price:o,priceBase:r},this.price.total+=o,t.priceText=Di(100*t.price,Ni.moneyFormat),i.label&&i.params.labelPriceText&&(i._priceText=t.priceText),e.priceVariant||(this.price.options[i.name]=t)}}i.options&&i.options.length&&this._evaluateOptionPriceTotal(i.options)}}}_priceValueFormula(t,e){let i=0,r=e.priceFormula;try{if(!e._priceFunction)try{-1===r.indexOf("return")&&(r="return ( "+r+" )"),e._priceFunction=Function('"use strict";return (function(option, value, price, options){ '+r+" })")()}catch(i){a.error("failed to parse optionValue.priceFormula: ",e,r,i),this.settings.editorMode&&(t.errors=t.errors||[],t.errors.push(i))}e._priceFunction&&(this._priceFunctionUtil=this._priceFunctionUtil||{option:t=>this._getOption(t),value:t=>{const e=this._getOption(t);return e?e.value:""},price:t=>{if(this.price.options.hasOwnProperty(t)){let e=this.price.options[t];return e.priceBase||e.price}return 0},controller:t=>{const e=this._getOption(t);return e&&e._controller?e._controller:{}}},i=e._priceFunction(t,e.value,e._price,this._priceFunctionUtil),i||(i=0))}catch(e){a.error("failed to calculate price with priceFormula: ",r,e),this.settings.editorMode&&(t.errors=options.errors||[],t.errors.push(e))}return i}_watchFormSubmit(){this._productFormSubmit=!1,this._handleCartAdd(),this.shopifyStore.onProductFormSubmit(this._productForm,this._productFormParentEl||this._productForm,(t=>this._handleFormSubmit(t)),ji.productFormCapture),(this._productFormParentEl||this._productForm).addEventListener("keypress",(t=>{if(t.target&&"INPUT"===t.target.tagName){13===(t.keyCode||t.which)&&(t.preventDefault(),t.target.blur())}}))}_handleFormSubmit(t){if(!this._productFormSubmit){if(this._productFormSubmit=!0,!this.validate())return this._productFormSubmit=!1,t.preventDefault(),void t.stopImmediatePropagation();let e=this._hasExportPreviews(),i=0!==this.price.total||this.price.variants.length>0;this._buyNowCapture=!0;let r=e||i||this._itemKey||this._buyNowCapture&&this.shopifyStore.isExpressPaymentButton(t.target);r&&(t.preventDefault(),t.stopImmediatePropagation(),this._productFormEvent=t);let o=[];if(e){let t=Promise.resolve(),e=this._getPreviews();for(let i=0;i<e.length;i++){const r=e[i];if(this._isExportPreview(r)){let e=document.createElement("progress");e.max=100,e.value=0,e.className="cl-po--preview-progress";let i=this._wrapper;this._popupEl&&(i=this._popupEl.querySelector(".options-atc")),i.appendChild(e),t=t.then((()=>this._exportPreview(r,e).then((()=>{i.removeChild(e)}))))}}o.push(t)}if(i){const t=eo.generateId();let e=Promise.resolve();if(this.price.variants.length)for(let t=0;t<this.price.variants.length;t++){const i=this.price.variants[t];let r={};if(-1===i.quantity){let t=(this._productFormParentEl||this._productForm).querySelector('[name="quantity"]');t&&t.value?i.quantity=t.value:i.quantity=1}let o=this.shopifyCart.toItem(i.id,i.quantity,r);e=e.then((()=>this.shopifyCart.addItem(o))).catch((t=>{let e="Live Product Options: "+(t.description||"")+"\n**please check the linked products on options**";this.shopifyStore.isThemeEditor()?alert(e):console.error(e)}))}let r=this.price.total-this.price.variantTotal;if(r>0){let i=Math.round(100*r),o={};o[Ri.ID]=t;for(const t in this.price.options)if(this.price.options.hasOwnProperty(t)){const e=this.price.options[t];let i=e.priceText.replace(/(<([^>]+)>)/gi,"");o[e.option.name]=i,e.priceBase&&(o["_"+e.option.name]=e.priceBase)}if(this._setFormProperty(Ri.ID,t),this._setFormProperty(Ri.PRICE,i),Ni.currencyConvert&&(this._setFormProperty(Ri.CURRENCY,Ni.currency),this._setFormProperty(Ri.PRICE_BASE,Math.round(100*this.price.totalBase))),this.settings.priceDraft)eo.storeItem(t,{properties:o});else if(Ni.priceVariantId){let t=r/Ni.priceVariantValue,i=(this._productFormParentEl||this._productForm).querySelector('[name="quantity"]');i&&i.value&&(t*=i.value),t=Math.round(t);let n=this.shopifyCart.toItem(Ni.priceVariantId,t,o),a=(this._productFormParentEl||this._productForm).querySelector('input[name="selling_plan"]');a&&a.value&&(n.selling_plan=parseInt(a.value)),Ri.VALIDATE=!1,e=e.then((()=>this.shopifyCart.addItem(n))).catch((t=>{alert("Live Product Options: "+(t.description||"")+"\n**please check the Price settings in the app**")}))}else alert("Live Product Options: missing price options product\n**please check the Price settings in the app**")}else i=!1;o.push(e)}if(i||(this._removeFormProperty(Ri.ID),this._removeFormProperty(Ri.PRICE),this._removeFormProperty(Ri.PRICE_BASE),this._removeFormProperty(Ri.CURRENCY)),this.settings.priceWeight&&this.price.weight>0?this._setFormProperty(Ri.WEIGHT,this.price.weight):this._removeFormProperty(Ri.WEIGHT),r||"cloudlift.cart"!==t.type||(r=!0),r)return Promise.all(o).then((()=>{if(this._itemKey&&-1!==this._itemKey.indexOf(this._variantId)){const e=()=>this.shopifyCart.updateItemById({id:this._itemKey,quantity:this.shopifyStore.findProductFormQuantity(this._productFormParentEl||this._productForm),properties:this.shopifyStore.getFormProperties(this._productForm)}).then((()=>{window.location.href=this.shopifyStore.settings.api+"/cart"}));if(ji.productItemModal){let i="product.options.item.modal.",r=document.createElement("dialog");return r.className="cl-po--dialog",r.innerHTML=`\n                                  <form method="dialog">\n                                    <h4>${l.get(i+"title")}</h4>\n                                    <div class="action">\n                                      <button class="cl-po--swatch cl-po--swatch-button cl-po--small" value="update">${l.get(i+"update")}</button>\n                                      <button class="cl-po--swatch cl-po--swatch-button cl-po--small" value="add">${l.get(i+"add")}</button>\n                                    </div>\n                                  </form>`,void 0!==window.dialogPolyfill&&(window.dialogPolyfill.registerDialog(r),r.style.height="auto"),this._wrapper.appendChild(r),r.showModal(),r.addEventListener("close",(()=>{"update"===r.returnValue?e():"cloudlift.cart"===t.type?(delete this._itemKey,delete this._productFormSubmit,this._handleFormSubmit(t)):this._triggerFormEvent()})),!0}if(ji.productItemUpdate)return e()}return this.shopifyStore.isExpressPaymentButton(t.target)&&(t=new CustomEvent("cloudlift.cart",{detail:{onSuccess:()=>{const t=new CustomEvent("cloudlift.checkout",{detail:{},cancelable:!0,bubbles:!1});window.dispatchEvent(t)}},cancelable:!0,bubbles:!1})),"cloudlift.cart"===t.type?this.shopifyCart.addItem({id:this._variantId,quantity:this.shopifyStore.findProductFormQuantity(this._productFormParentEl||this._productForm),properties:this.shopifyStore.getFormProperties(this._productForm)}).then((()=>(t.detail&&"function"==typeof t.detail.onSuccess?t.detail.onSuccess():window.location.href=this.shopifyStore.settings.api+"/cart",!0))):(this._triggerFormEvent(),setTimeout((()=>{Ri.VALIDATE=!0}),5e3),!0)})).catch((t=>(a.error("[live-options] submit handler error",t),!1)));setTimeout((()=>this._productFormSubmit=!1),300)}return Promise.resolve(!1)}_handleCartAdd(){let t=document.querySelectorAll("[data-live-cart-add]");if(t.length){a.debug("found manual cart add btn",t);for(let e=0;e<t.length;e++){const i=t[e];(this._productFormParentEl||this._productForm).contains(i)&&(ji.productFormCapture=!1),i.addEventListener("click",(t=>{i.dataset.liveCartAdd&&this.settings.product.id.toString()!==i.dataset.liveCartAdd||(t.preventDefault(),t.stopImmediatePropagation(),this._productFormSubmit=!1,this._handleFormSubmit(new CustomEvent("cloudlift.cart",{detail:{},cancelable:!0,bubbles:!1})))}),{capture:!0})}}}_setFormProperty(t,e){let i;this._formInputs?this._formInputs.hasOwnProperty(t)&&(i=this._formInputs[t]):this._formInputs={},i?i.value=e:(i=document.createElement("input"),i.type="hidden",i.name="properties["+t+"]",i.value=e,this._productForm.appendChild(i)),this._formInputs[t]=i}_removeFormProperty(t){if(this._formInputs&&this._formInputs.hasOwnProperty(t)){let e=this._formInputs[t];e.parentNode.removeChild(e),delete this._formInputs[t]}}_triggerFormEvent(){if(this._productFormEvent){let t=this._productFormEvent;t.target||t.currentTarget?"click"===t.type?t.target&&t.target.click?t.target.click():t.currentTarget&&t.currentTarget.click?t.currentTarget.click():"BUTTON"===t.target.parentNode.tagName&&t.target.parentNode.click():"submit"===t.type&&t.target.submit():(a.error("missing event target - manual form submit"),this._productForm.submit()),this._productFormEvent=null,this._productFormSubmit=!1}this._optionValuesClear&&setTimeout((()=>{this.setValues(this._optionValuesClear),this.render(),this._renderPreview()}),1e3)}_getControllers(t={},e=this.config.options){for(let i=0;i<e.length;i++){const r=e[i];r.options&&r.options.length?this._getControllers(t,r.options):r._controller&&(t[r.name+"_"+r.type]=r._controller)}return t}_setControllers(t,e=this.config.options){for(let i=0;i<e.length;i++){const r=e[i];r.options&&r.options.length?this._setControllers(t,r.options):t.hasOwnProperty(r.name+"_"+r.type)&&(r._controller=t[r.name+"_"+r.type])}}_getOption(t,e=this.config.options){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t)return r;if(r.options&&r.options.length){let e=this._getOption(t,r.options);if(e)return e}}return null}_initPreview(){this.config.previewConfig.gallery?(this._gallery=new no(this.config,this._productForm,this.conditionsEngine,{api:this.settings.api,assets:this.settings.assets,selector:this.settings.selectorPreview,selectorThumbnail:this.settings.selectorThumbnail,position:this.settings.positionPreview,sticky:this.settings.stickyPreview,stickyMobile:this.settings.stickyPreviewMobile,maxHeight:this.settings.maxHeightPreview,product:this.settings.product,variantId:this._variantId,editorMode:this.settings.editorMode,galleryConfig:this.config.previewConfig.galleryConfig}),this._gallery.ready&&(this._gallery.ready.then((t=>{this._preview=this._gallery._preview})),this._gallery.element.addEventListener("preview:active",(()=>{this._preview=this._gallery._preview})))):this._preview=new Zr(this.config,this.config.previewConfig,this._productForm,this.conditionsEngine,{api:this.settings.api,assets:this.settings.assets,selector:this.settings.selectorPreview,selectorThumbnail:this.settings.selectorThumbnail,position:this.settings.positionPreview,sticky:this.settings.stickyPreview,stickyMobile:this.settings.stickyPreviewMobile,maxHeight:this.settings.maxHeightPreview,product:this.settings.product,variantId:this._variantId,editorMode:this.settings.editorMode})}_renderPreview(){this.config.preview&&(this._gallery&&this._gallery.ready?this._gallery.ready.then((()=>this._gallery._previews.forEach((t=>t.renderPreview())))):this._preview&&this._preview.ready&&this._preview.ready.then((()=>this._preview.renderPreview())))}_destroyPreview(){this._gallery?(this._gallery.destroy(),delete this._gallery):this._preview&&this._preview.destroy(),delete this._preview}_getPreviews(){return this._gallery?this._gallery._previews:this._preview?[this._preview]:[]}_isExportPreview(t){let e=t.previewConfig.export&&(t.previewConfig.exportConfig.thumbnail||t.previewConfig.exportConfig.original||Xi.EXPORT&&t.previewConfig.exports&&t.previewConfig.exports.length);if(!e)for(let e=0;e<t.previewConfig.layers.length;e++){const i=t.previewConfig.layers[e];if(i.params.crop&&"upload"===i.type)return!0;if(i.params.exportCoords)return!0}return e}_hasExportPreviews(){let t=this._getPreviews();for(let e=0;e<t.length;e++)if(this._isExportPreview(t[e]))return!0;return!1}_exportPreview(t,e){let i=[],r=t.previewConfig;if(r.export){if(r.exportConfig.original){e.value=5;let o=!(!r.exportConfig.crop||!r.exportConfig.cropConfig.width)&&r.exportConfig.cropConfig,n=r.exportConfig.originalFormat||"png",a=t.export({width:r.width,height:r.height},o,!0,"excludeOriginal",n);if(a){let t=this._upload._fileMeta.fromBlob(a,"preview_original."+n);t.meta.variant="original",t.meta.property=r.exportConfig.originalProperty,i.push(t)}e.value=10}if(r.exportConfig.thumbnail){e.value=10;let o=t.export({width:r.exportConfig.thumbnailWidth,height:r.exportConfig.thumbnailHeight},!1,!0,"excludeThumbnail","png",.8);if(o){let e=this._upload._fileMeta.fromBlob(o,"preview_thumbnail.png");e.meta.variant="thumbnail",r.exportConfig.thumbnailActive||window.clExportPreviewActive?(e.meta.property=t.active?"_preview":r.exportConfig.thumbnailProperty,r.exportConfig.thumbnailActiveOnly=!0,r.exportConfig.thumbnailActiveOnly&&!t.active||i.push(e)):(e.meta.property=r.exportConfig.thumbnailProperty,i.push(e))}e.value=15}if(Xi.EXPORT&&r.exports&&r.exports.length){let e="svg",o="excludeOriginal",n=t.export({width:r.width,height:r.height},!1,!0,o,e);if(n){let t=this._upload._fileMeta.fromBlob(n,"preview_export."+e);t.meta.variant="export",i.push(t)}}}for(let e=0;e<t.previewConfig.layers.length;e++){const r=t.previewConfig.layers[e];if("upload"===r.type&&(r.params.crop||r._removeBg)){let e="jpeg";(r._url&&-1!==r._url.indexOf(".png")||r._removeBg)&&(e="png");let o=t.exportLayer(r.name,!0,e,.8);if(o){let t=r.params.option||r.name,n=this._upload._fileMeta.fromBlob(o,t+"_crop."+e);n.meta.variant="original",n.meta.property=t,r._removeBg&&(n.meta.property="_remove_bg_"+t),i.push(n)}}if(r.params.exportCoords){let e=t.exportLayerCoords(r.name);e?this._setFormProperty("_"+r.name,`x:${e.x},y:${e.y},w:${e.w},h:${e.h}`+(0!==e.r?`,r:${e.r}`:"")):this._removeFormProperty("_"+r.name)}}if(i.length>0)return this._upload.upload(i,(t=>{if(t.lengthComputable){let i=t.loaded/t.total*100;i>e.value&&(e.value=i)}})).then((t=>{for(let e=0;e<t.length;e++){const i=t[e];if("export"===i.meta.variant)for(let t=0;t<r.exports.length;t++){const e=r.exports[t];this._setFormProperty(e.property,this._exportConfigUrl(e,i))}else this._setFormProperty(i.meta.property,i.url)}a.debug("export preview uploads:",t)}));if(this._removeFormProperty(r.exportConfig.originalProperty),this._removeFormProperty(r.exportConfig.thumbnailProperty),r.exports&&r.exports.length)for(let t=0;t<r.exports.length;t++)this._removeFormProperty(r.exports[t].property);return Promise.resolve()}_exportConfigUrl(t,e){let i=e.path.replace(".svg","."+t.format),r=this.settings.api.replace("api","convert").replace("local","dev")+"/export/"+i,o={w:t.width,h:t.height,u:t.unit,dpi:t.dpi};return t.crop&&t.cropConfig&&(o.cW=t.cropConfig.width,o.cH=t.cropConfig.height,o.cX=t.cropConfig.x,o.cY=t.cropConfig.y),r+"?c="+btoa(JSON.stringify(o))}_initTooltips(){let t=this._wrapper.querySelectorAll('[data-tippy-content]:not(.init):not([data-tippy-content=""])');if(t.length>0){this._tippyInstances||(this._tippyInstances=[]);for(let e=0;e<t.length;e++){const i=t[e];let r=i.getAttribute("data-tippy-content"),o=-1!==r.indexOf("<")&&-1!==r.indexOf(">"),n=window.innerWidth<=768;if(r=r.trim(),r){const t={allowHTML:!0,maxWidth:350,interactive:o,appendTo:ji.tooltipBody?document.body:"parent"};n&&(t.onShow=t=>{setTimeout((function(){t.hide()}),3e3)}),this._tippyInstances.push(Ge(i,t))}i.classList.add("init")}}}_initPersonalize(t){t._controller={onValidate:t=>!t.required||t.value===t.values[0].value||(t.value=t.values[0].value,this.render(),t.params.popup?this._onPersonalizeChanged(t):t.params.validationMsg&&t.errors.push(t.params.validationMsg),!1),onChange:(t,e)=>{this._optionValueChanged(e),this._onPersonalizeChanged(e)}};let e=[...this.config.options];e.splice(this.config.options.indexOf(t),1),e=e.filter((t=>"personalize"!==t.type));let i=[];i.push(t),t.values&&0!==t.values.length||(t.values=[{value:""}]);let r={data:"options",field:t.name,operator:"equals",value:t.values[0].value};if(i.push({name:"group_personalize",type:"group",value:"",required:!1,conditions:[r],params:{collapseOpen:!1,collapseLabel:"",collapse:!1},options:e,id:"option_group_personalize",visible:!1}),this.settings.editorMode&&t.params.popup&&(t.params.popup=!1),this.config.preview){t.params.popup&&(this.config.preview=!1,this._productFormLinkForce=!0);const e=(t,e)=>{for(let i=0;i<t.length;i++){const r=t[i];r.params.option&&r.conditions.unshift(e)}};if(e(this.config.previewConfig.layers,r),this.config.previewConfig.gallery)for(let t=0;t<this.config.previewConfig.views.length;t++){e(this.config.previewConfig.views[t].layers,r)}}return this.config.options.length=0,this.config.options.push(...i),this._personalizeOption=t,e}_onPersonalizeChanged(t){if(t.params.popup)if(t.value===t.values[0].value){this.config.preview=!0,this._personalizeGroupEl||(this._personalizeGroupEl=this._wrapper.querySelector('[data-option="group_personalize"]'),this._personalizeGroupEl.style.display="none");let e=Promise.resolve(!0);if(!rr.isDefined("popup")){let t=[this.settings.assets+"/static/lib/ldcover/ldcv.full.min.css",this.settings.assets+"/static/lib/ldcover/ldcv.min.js"];e=rr.loadOnce(t,"popup",{async:!1})}e.then((()=>{const e=()=>{let e={id:this.config.uuid,product:this.settings.product,className:"popup fade"+(t.params.popupFull?" full":""),option:t,visible:this.config.options[1].visible},r=this.settings.selectorPreview;if(!i.isElement(r)){if(r=document.createElement("img"),r.className="cl-po--gallery-img",this._variantId)for(let t=0;t<this.settings.product.variants.length;t++){const e=this.settings.product.variants[t];if(e.id.toString()===this._variantId.toString()){e.featured_image&&e.featured_image.src&&(r.src=e.featured_image.src);break}}r.src||(r.src=this.settings.product.featured_image)}tt(Rr(r,this._personalizeGroupEl,this._popupPriceEl,e,(t=>{this._productFormSubmit=!1,this._handleFormSubmit(new CustomEvent("cloudlift.cart",{detail:{},cancelable:!0,bubbles:!1}))}),(t=>{this._popup.set("close",!0)})),this._popupEl)};this._popupEl?e():(this._popupEl=document.createElement("div"),this._popupPriceEl=document.createElement("span"),this._priceElList?(i.isNodeList(this._priceElList)&&(this._priceElList=Array.prototype.slice.call(this._priceElList)),this._priceElList.push(this._popupPriceEl)):this._priceElList=[this._popupPriceEl],e(),this._personalizeGroupEl.style.display="",document.body.appendChild(this._popupEl),this._popup=new ldCover({root:this._popupEl.querySelector(".ldcv"),lock:!1}),this._popup.on("toggle.on",(()=>{if(this._preview)this._renderPreview();else{if(window.innerWidth<=768)this.settings.maxHeightPreview=Math.floor(window.innerHeight/4);else{let t=this.config.previewConfig.gallery&&"bottom"===this.config.previewConfig.galleryConfig.layout;this.settings.maxHeightPreview=t?550:660}this._initPreview()}this.render()}))),this._popup.get().then((i=>{t.value=t.values[1].value,this.render(),this._renderPreview(),e()})),this._popup.toggle()}))}else this._popup&&this._popup.set(!1,!0)}_destroyTooltips(){if(null!=this._tippyInstances)for(let t=0;t<this._tippyInstances.length;t++){const e=this._tippyInstances[t];e.reference.classList.remove("init"),e.destroy()}}_restoreCartItem(){let t=i.getQueryParam(window.location.href,"item");this.shopifyCart.getCart(!0).then((e=>{for(let i=0;i<e.items.length;i++){const r=e.items[i];if(r.key===t&&r.properties){a.debug("restoring cart item values: ",r.properties),this.setValues(r.properties),this.render(),this._renderPreview(),ji.productItemModal&&"function"!=typeof HTMLDialogElement&&(this._dialogPolyfill=rr.loadOnce([this.settings.assets+"/static/lib/dialog/dialog-polyfill.min.js",this.settings.assets+"/static/lib/dialog/dialog-polyfill.min.css"],"dialog",{async:!1})),this._itemKey=t,this._personalizeOption&&this._onPersonalizeChanged(this._personalizeOption);break}}}))}constructor(t,e){this.config=t,this.settings=i.extend({api:"https://api.cloudlift.app",assets:"https://assets.cloudlift.app",queryParams:{},selector:".cl-options",position:"",selectorPreview:".cl-preview",selectorThumbnail:"",positionPreview:"",stickyPreview:!1,stickyPreviewMobile:"overlay",maxHeightPreview:0,selectorForm:'form[action*="/cart/add"]',classNamePrefix:"cl-po",product:{},priceDraft:!0,priceWeight:!1,errorPrefix:"product.options.validity.",editorMode:!1,visible:{},visibleEditor:{},lists:null},e||{}),this.visible={},this.visibleEditor={},this.shopifyStore=u.getInstance(),this.shopifyCart=f.getInstance(),this.conditionsEngine=new Br({},{product:this.settings.product,options:this.config.options}),this._upload=nr.getInstance({api:this.settings.api,queryParams:this.settings.queryParams}),this.price={options:{},total:0,totalBase:0,variants:[],variantTotal:0,weight:0},i.isElement(this.settings.selector)?this.element=this.settings.selector:this.element=document.querySelector(this.settings.selector),null!=this.element?(a.info("--\x3e new product-options: ",this.element),Ni.currencyConvert&&1!==Ni.currencyFactor?this._variantsInCurrency().then((()=>this._init())):this._init()):a.warn("no elements with selector found: ",this.settings.selector)}};var lo=(t,e,i,r,o)=>et`
    
    ${t.type!==Hi?et`
    <div class="cl-po--discount">
        <div class="cl-po--discount-input">
            <input type="text" placeholder=${e.placeholder} class="${li({"cl-po--invalid":e.error})}" .value=${fi(e.code)} @input=${t=>o(t)} />
            <button @click=${t=>i(t)}>
                ${e.loading?et`<svg class="cl-po--icon loading" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M20 10c0 5.523-4.477 10-10 10S0 15.523 0 10 4.477 0 10 0v2c-4.418 0-8 3.582-8 8s3.582 8 8 8 8-3.582 8-8h2z"></path></svg>`:e.button}
            </button>
        </div>
        ${e.error?et` <p class="cl-po--discount-error">${e.error}</p>`:null}
       
        ${t.valid?et`
        <div class="cl-po--discount-wrap">
            <input type="hidden" name="discount" .value=${fi(t.code)} form=${mi(e.cartFormLink)} />
            
            <div class="cl-po--discount-tag">
                <svg class="cl-po--icon tag" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18"><path d="M17.78 3.09C17.45 2.443 16.778 2 16 2h-5.165c-.535 0-1.046.214-1.422.593l-6.82 6.89c0 .002 0 .003-.002.003-.245.253-.413.554-.5.874L.738 8.055c-.56-.953-.24-2.178.712-2.737L9.823.425C10.284.155 10.834.08 11.35.22l4.99 1.337c.755.203 1.293.814 1.44 1.533z" fill-opacity=".55"></path><path d="M10.835 2H16c1.105 0 2 .895 2 2v5.172c0 .53-.21 1.04-.586 1.414l-6.818 6.818c-.777.778-2.036.782-2.82.01l-5.166-5.1c-.786-.775-.794-2.04-.02-2.828.002 0 .003 0 .003-.002l6.82-6.89C9.79 2.214 10.3 2 10.835 2zM13.5 8c.828 0 1.5-.672 1.5-1.5S14.328 5 13.5 5 12 5.672 12 6.5 12.672 8 13.5 8z"></path></svg>
                <span>${t.code}</span>
                <button @click=${t=>r(t)}>
                    <svg class="cl-po--icon remove" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 13 13"><path d="M1.5 1.5l10.05 10.05M11.5 1.5L1.45 11.55" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round"></path></svg>
                </button>
            </div>
    
            ${e.success?et` <p class="cl-po--discount-success">${e.success}</p>`:null}
        </div>
        `:null}
    </div>
    `:null}
`;var co=class{setup(){this.destroy(),this.shopifyStore.parseProductJsonElements(),this.shopifyStore.tryGetProductMap().then((t=>{for(let e=0;e<this.config.configs.length;e++){const i=this.config.configs[e];if(a.debug("-> evaluating options-config:",i.uuid),0===i.targetMode){let e=[{data:"product",field:"product",products:[i.product]}];for(let r in t)if(t.hasOwnProperty(r)){let o=t[r];this._evaluateProductTargeting(i,o,e,1)}}else if(0===i.conditionMode){if(this.shopifyStore.isProduct()){let e=t[this.shopifyStore.getHandleFromUrl()+".js"];e&&this._evaluateProductTargeting(i,e,[],0)}}else if(i.conditions.length>0)for(let e in t)if(t.hasOwnProperty(e)){let r=t[e];this._evaluateProductTargeting(i,r,i.conditions,i.conditionMode)}}0===this.products.length?this.shopifyStore.isThemeEditor()&&this._evaluateThemeEditor(t):this._compatible()})),this.config.setup&&this.config.configs.length>0&&(this._watchCartItems(),this._watchFormSubmit())}destroy(){for(;this.products.length;){this.products.pop().destroy()}}_evaluateProductTargeting(t,e,i,r){this.conditionsEngine.data.product=e;let o=this.conditionsEngine.evaluateConditions(i,r,"config.uuid="+t.uuid);if(o){let i="#product_form_"+e.id;i+=', [data-product-form="'+e.id+'"]',o=this._createProductOptions(t,e,i),o||(o=this._createProductOptions(t,e))}a.debug("--\x3e evaluated options-config:",t.uuid,e,o)}_evaluateThemeEditor(t){const e="cl_live_theme";if("0"!==i.readCookie(e))for(let r in t)if(t.hasOwnProperty(r)){let o=t[r],n=this._findOrCreateContainer(null,o,'form[action*="/cart/add"]:not([id*=instal])');if(n){let t=0===this.config.configs.length,r=void 0!==n.dataset.liveOptions;n.classList.add("cl-block");let o=`<style>\n                            .cl-block { padding: 10px;border-radius: 3px;background-color: rgb(55, 167, 220, 1); border: 2px solid #000;margin-bottom: 10px;opacity: 0.75; position: relative; }\n                            .cl-block span { font-size:14px; display: block; margin-bottom:5px; }\n                            .cl-block a, .cl-block span { color:#fff; }\n                            .cl-block a.live { font-size:20px;font-weight:bold;line-height: 1;text-shadow: 1px 1px 1px black;text-decoration: none; }\n                            .cl-block a.link { font-weight:bold;text-shadow: 1px 1px 1px black; }\n                            .cl-block .live-close { position: absolute; right:7px; top:0px; font-size:20px; cursor:pointer; }\n                    </style>\n                    <span class="live-close">✅</span>\n                    <span><a class="live" href="/admin/apps/live-product-options">Live Product Options</a></span>\n                    <span>Custom product options will appear here. ${t?"":"<b>(only shown in editor)</b>"}</span>`;return t?o+="<span><b>NEXT:</b> save the theme & continue with the setup in the app.</span>":r||(o+='<span>To change the location visit: <a class="link" href="https://docs.cloudlift.app/article/126-product-options-block-in-theme-editor" target="_blank">Product Options App Block</a></span>'),n.innerHTML=o,void n.querySelector(".live-close").addEventListener("click",(t=>{n.parentElement.removeChild(n),i.writeCookie(e,"0",30,"/")}))}}}_createProductOptions(t,e,r){for(let i=0;i<this.products.length;i++){const r=this.products[i];if(r.settings.product.id===e.id)return a.debug("-> MERGING options with existing productOptions for product.id: "+e.id,t.options),r._generateOptionIds(t.options,"option_"+e.id+"_"),r._translate&&(r._translate.config=t,r._translate.translate()),r.config.options.push(...t.options),r._wrapper&&r.render(),!0}r||(r='form[action*="/cart/add"]:not([id*=instal])');let o=1===this.config.locationMode?this.config.selector:"",n=1===this.config.locationMode?this.config.position:void 0,s=this._findOrCreateContainer(o,e,r);if(this._autoPosition&&(n=this._autoPosition,delete this._autoPosition),s){let r,o=JSON.parse(JSON.stringify(t)),a=1===this.config.previewLocationMode?this.config.previewSelector:"",l=1===this.config.previewLocationMode?this.config.previewPosition:void 0;r=i.isNodeList(s)?s:[s];for(let t=0;t<r.length;t++){const i=r[t],s=o.preview?this._findOrCreatePreviewContainer(a,e,o):void 0;this.products.push(new so(o,{api:this.config.api,assets:this.config.assets,queryParams:{shop:this.config.shop},selector:i,position:n,selectorPreview:s,positionPreview:l,selectorThumbnail:this.config.previewImgThumbnailSelector,stickyPreview:this.config.previewSticky,stickyPreviewMobile:this.config.previewStickyMobile,product:e,priceDraft:this.config.priceDraft,priceWeight:this.config.priceWeight,lists:this.config.lists}))}return!0}return!1}_findOrCreateContainer(t,e,i){let r,o;i&&(o=document.querySelector(i));const n=(t,e)=>e&&(r=e.querySelectorAll(t),r.length>0)?(a.debug("using container in form with provided selector:",i,t,r),!0):(r=document.querySelectorAll(t),r.length>0&&(a.debug("using container with provided selector:",t,r),!0));if(t)return n(t,o)?r:(a.debug("no container found with selector:",t),null);if(r=document.querySelector('[data-live-options="'+e.id+'"]'),null!=r)return a.debug("using default container with selector: [data-live-options]"),r;if(this.config.autoSelector&&n(this.config.autoSelector,o))return this.config.autoSelectorPosition&&(this._autoPosition=this.config.autoSelectorPosition),r;if(o){let t=o.querySelector("[type=submit],.add_to_cart,.btn.add-to-cart");return r=document.createElement("div"),r.className="inject",r.style.width="100%",t?t.parentNode.insertBefore(r,t):o.insertBefore(r,o.firstChild),a.debug("injected container into form:",o),r}return null}_findOrCreatePreviewContainer(t,e,r){let o;if(!t&&this.shopifyStore.isTheme("Dawn")&&(this.config.autoPreviewSelector||this.config.autoGallerySelector||(r.previewConfig.gallery?document.querySelector(".product media-gallery")?this.config.autoGallerySelector=".product media-gallery":this.config.autoGallerySelector=".product slider-component":this.config.autoPreviewSelector='.product slider-component:not([class*="thumb"]) ul li:first-child')),o=this._checkPersonalizeContainer(r),o)return o;const n=t=>{let i=document.querySelectorAll(t);if(i.length>0){if(i.length>1)for(let t=0;t<i.length&&(o=i[t],-1===o.className.indexOf(e.id)&&o.dataset.livePreview!=e.id);t++);else o=i[0];a.debug("using container preview with provided selector:",t,o)}};let s=!0;if(t||(t='[data-live-preview="'+e.id+'"]',s=!1),n(t),s&&!o)return a.error("no container preview found with selector:",t),null;if(o||(r.previewConfig.gallery&&this.config.autoGallerySelector?n(this.config.autoGallerySelector):this.config.autoPreviewSelector&&n(this.config.autoPreviewSelector)),!o){let t;if(e.media&&e.media.length){let i=0;if(r.previewConfig&&r.previewConfig.layers.length)for(let t=0;t<r.previewConfig.layers.length;t++){const o=r.previewConfig.layers[t];if("product"===o.type){o.params.imgPos&&e.media.length>o.params.imgPos-1&&(i=o.params.imgPos-1);break}}t=e.media[i]}else e.featured_image&&(t={src:e.featured_image});if(t){let e=this.config.previewImgParent,r=this.config.previewImgParentSelector,n=i.pathBaseName(t.src,!1),s=[];if(this.config.previewImgMainSelector&&(s=document.querySelectorAll(this.config.previewImgMainSelector)),0===s.length&&(s=document.querySelectorAll('img[src*="'+n+'"], img[data-src*="'+n+'"], img[data-srcset*="'+n+'"]')),s.length>0){if(a.debug("found main product images:",s),1===s.length)o=s[0];else{let t=Number.MAX_VALUE,e=-1;for(let r=0;r<s.length;r++){const a=s[r];let l=a.offsetWidth*a.offsetHeight;if(0===l&&a.src){let t=this.shopifyStore.parseImageDimension(a.src);l=t.x*t.y}let c=a.src&&0!==a.src.indexOf("data:")?a.src:null,p=i.pathBaseName(c||a.dataset.src||a.dataset.srcset||a.src,!1);p=this.shopifyStore.stripImageDimension(p);let d=p.replace(n,"").length;d<t?(t=d,e=l,o=a):d===t&&l>e&&(e=l,o=a)}}let t;if(a.debug("selected auto preview img:",o),r&&(t=i.findParent(o,r)),null!=t)o=t,a.debug("using auto preview container with parent selector:",r,o);else if(o){1===e&&(o.parentElement&&null!==o.parentElement.getAttribute("data-zoom")||-1!==o.parentElement.id.indexOf("Zoom")||-1!==o.parentElement.className.indexOf("modal"))&&(e=2);for(let t=0;t<e;t++)o=o.parentElement;a.debug("using auto preview container with parent:",e,o)}}else a.debug("failed to find main product image:",n)}}if(o){for(o.style.minHeight||(o.style.minHeight="1px");o.firstChild;)o.removeChild(o.lastChild);let t=document.querySelectorAll('[data-live-preview-hide="'+e.id+'"]');if(t.length)for(let e=0;e<t.length;e++){t[e].style.display="none"}}else a.warn("[live-options] no preview container found");return o}_checkPersonalizeContainer(t){for(let e=0;e<t.options.length;e++){const i=t.options[e];if("personalize"===i.type){if(i.params.popup){return document.createElement("div")}break}}return null}_watchFormSubmit(){this.shopifyStore.onCartFormSubmit((t=>this._handleFormSubmit(t)),ji.cartFormCapture),window.addEventListener("cloudlift.checkout",(t=>{delete this.shopifyCart.cache,this._processCartItems().then((()=>{this._handleFormSubmit(t)}))}))}_handleFormSubmit(t){if(!t.submitter||!t.submitter.name||"update"!==t.submitter.name)if(this._draftCheckout){if(t.preventDefault(),t.stopImmediatePropagation(),this._checkoutRequest)return void a.warn("checkout is processing");try{let e;t.target&&("FORM"===t.target.tagName?e=t.target:t.target!==window&&(e=i.findParent(t.target,"form")));let r=this._getCheckout(e),o=Promise.reject(),s=t=>new Promise((function(e,i){setTimeout(i.bind(null,t),1e3)}));for(let t=0;t<3;t++)o=o.catch((e=>{let i={shop:this.config.shop};return t>0&&(i.retry=t),this._checkoutRequest=new n(this.config.api+"/api/checkout",{method:"POST",data:{checkout:r},responseType:"json",headers:{"Content-type":"application/json"},queryParams:i}),e&&a.warn("[live-options-api] checkout error",e),this._checkoutRequest})).catch(s);o=o.then((t=>{a.debug("[live-options-api] checkout response",t.data),window.location.href=t.data.url})).catch((t=>{t.xhr&&0===t.xhr.status||(a.error("[live-options-api] checkout error",t),window.location.href=this.shopifyStore.settings.api+"/checkout")})),"function"==typeof o.finally&&o.finally((()=>{delete this._checkoutRequest}))}catch(t){a.error("[live-options] checkout error",t),window.location.href=this.shopifyStore.settings.api+"/checkout"}}else if(!this.config.priceDraft&&this._discountCheckout){if(this._discountRequest)return void delete this._checkoutRequest;t.preventDefault(),t.stopImmediatePropagation();try{let e=this._getCheckout(null);this._discountRequest=new n(this.config.api+"/api/checkout/discount/quantity",{method:"POST",data:{checkout:e},responseType:"json",headers:{"Content-type":"application/json"},queryParams:{shop:this.config.shop}}),this._discountRequest.then((e=>{var r=e.data;let o=document.querySelector('[name="discount"]');if(!o){let e;t.target&&("FORM"===t.target.tagName?e=t.target:t.target!==window&&(e=i.findParent(t.target,"form"))),e&&(o=document.createElement("input"),o.type="hidden",o.name="discount",e.appendChild(o))}var n=!1;o&&(o.value=r.code,t.submitter&&t.submitter.click&&(n=!0,t.submitter.click())),n||(window.location.href=this.shopifyStore.settings.api+"/checkout?discount="+r.code),a.debug("[live-options-api] checkout discount response",e.data)})).catch((t=>{a.error("[live-options-api] checkout discount error",t),window.location.href=this.shopifyStore.settings.api+"/checkout"}))}catch(t){a.error("[live-options] checkout discount error",t),window.location.href=this.shopifyStore.settings.api+"/checkout"}}else"cloudlift.checkout"===t.type&&(window.location.href=this.shopifyStore.settings.api+"/checkout")}_getCheckout(t){let e=[],i={};for(let t=0;t<this._cart.items.length;t++){const r=this._cart.items[t];if(r.properties&&r.properties.hasOwnProperty(Ri.PRICE)&&r.properties.hasOwnProperty(Ri.ID)){Ni.currencyConvert&&r.properties.hasOwnProperty(Ri.PRICE_BASE)&&(r.properties[Ri.PRICE]=r.properties[Ri.PRICE_BASE],delete r.properties[Ri.PRICE_BASE]);const t=r.properties[Ri.ID];let e=eo.getItem(t);e&&(i[t]=e.properties)}let o=this.shopifyCart.toItem(r.id,r.quantity,r.properties);o.productTitle=r.product_title,o.productId=r.product_id,e.push(o)}this._discount||(this._discount=this._getDiscount());let r,o={};if(t){const e=new FormData(t);o=Array.from(e.keys()).reduce(((t,i)=>{if(-1!==i.indexOf("attributes")){let r=i.indexOf("["),o=i.indexOf("]");if(-1!==r&&-1!==o){let n=i.substring(r+1,o);if(t.hasOwnProperty(n)){let r=e.getAll(i);t[n]=r[r.length-1]}else t[n]=e.get(i)}}else"note"===i&&(r=e.get(i));return t}),{})}return{items:e,options:i,optionsTitle:this.config.priceDraftTitle,optionsShipping:!0===this.config.priceDraftShipping,optionsTaxable:!0!==this.config.priceDraftTaxFree,note:r,attributes:o,discount:0===this._discount.type||this._discountCheckout?null:this._discount,currency:this._cart.currency,country:window.Shopify?window.Shopify.country:void 0,total:this._cartTotal,customerId:this.shopifyStore.getCustomerId()}}_getDiscount(){let t={type:Vi};for(let e=0;e<this._cart.items.length;e++){const i=this._cart.items[e];i.discounts&&i.discounts.length&&(t.type=Hi,t.code=i.discounts[0].title)}if(0===t.type){let e=this.shopifyStore.getDiscountCode();e&&(t.type=Bi,t.code=e)}return t}_watchCartItems(){if(window.theme&&window.theme.Cart&&window.theme.Cart.prototype&&window.theme.Cart.prototype._setProductDetailsList){const t=window.theme.Cart.prototype._setProductDetailsList;window.theme.Cart.prototype._setProductDetailsList=function(e,i){t(e,i.filter((t=>t)))}}this._processCartItems();let t=i.debounced(1e3,(()=>this._processCartItems()));v.register((e=>{/.*cart.*/.test(e.url)&&((e.method&&"POST"===e.method.toString().toUpperCase()||-1!==e.url.indexOf("/cart/add")||-1!==e.url.indexOf("/cart/change"))&&delete this.shopifyCart.cache,t())}));setTimeout((()=>t()),2e3)}_processCartItems(){return this.shopifyCart.getCart(!0).then((t=>{this._cart=t,this._cartCount=0,this._cartTotal=0,this._draftCheckout=!1,this._discountCheckout=!1;for(let e=0;e<t.items.length;e++){let i=t.items[e];if(!this._processCartItem(t,i,e))return}this._patchCartCount(t),this._patchCartTotal(t),this._checkDiscount(t),-1!==Ni.moneyFormat.indexOf("class")&&window.dispatchEvent(new Event("resize"));let e=document.querySelectorAll("[data-live-enabled]");if(e.length)for(let t=0;t<e.length;t++){const i=e[t];!0===i.disabled&&(i.disabled=!1),"none"===i.style.display&&(i.style.display="block")}}))}_processCartItem(t,e,r){let o=e.quantity,n=e.original_line_price;if(e.properties){let r=!1;if((e.properties.hasOwnProperty(Ri.OPTIONS)||e.properties.hasOwnProperty(Ri.ID))&&(r=!0),r){if(this.config.priceDraft){if(Ni.currencyConvert&&e.properties.hasOwnProperty(Ri.CURRENCY)&&e.properties[Ri.CURRENCY]!==Ni.currency){let i=eo.getItem(e.properties[Ri.ID]);if(null!=i&&i.properties){this._convertOptionsPriceProperties(i.properties),eo.storeItem(e.properties[Ri.ID],i);let r=parseInt(e.properties[Ri.PRICE_BASE]);isNaN(r)||(e.properties[Ri.PRICE]=String(Math.round(100*qi(r/100))),e.properties[Ri.CURRENCY]=Ni.currency,this._updateItemCurrencyPromise||(this._updateItemCurrencyPromise=Promise.resolve()),this._updateItemCurrencyPromise=this._updateItemCurrencyPromise.then((()=>{let i=e.key,r=this.shopifyCart.getItemLine(t,e);return this.shopifyCart.updateItem(r,{quantity:e.quantity,properties:e.properties}).then((t=>{let e=document.querySelector('[data-live-item-key="'+i+'"]');e&&(e.dataset.liveItemKey=t.items[r-1].key)}))})))}}e.properties.hasOwnProperty(Ri.WEIGHT)&&(this._draftCheckout=!0)}else if(e.properties.hasOwnProperty(Ri.ID)&&Ri.VALIDATE&&!this._validateCartItemOptionsPrice(t,e))return!1;let r=0,s=!1;e.properties[Ri.ID]&&e.properties.hasOwnProperty(Ri.OPTIONS)&&e.properties[Ri.PRICE]&&(r=parseInt(e.properties[Ri.PRICE]),this.config.priceDraft&&(n=e.original_line_price+r*e.quantity),s=r>0);let c=null;e.properties.hasOwnProperty(Ri.QUANTITY_ID)&&(c=this._processCartQuantityDiscount(t,e,r),null!=c&&(n=c,this._discountCheckout=!0,s=!0,this.config.priceDraft?this._draftCheckout=!0:n-=r*e.quantity));let p=this._resolveCartItemEl(t,e);0===p.length&&a.warn("[live-options] missing cart item element for: ",e);for(let n=0;n<p.length;n++){const d=p[n];if(e.properties.hasOwnProperty(Ri.OPTIONS)||(o=0),d){let o="_preview";if(e.properties[o]){let t=d.querySelector("[data-live-item-image]");if(!t&&ji.cartItemPreview){let r=i.pathBaseName(e.image,!1);t=d.querySelector('img[src*="'+r+'"], img[data-src*="'+r+'"], img[data-srcset*="'+r+'"]')}t&&(t.src=e.properties[o],t.hasAttribute("srcset")&&t.removeAttribute("srcset"),t.hasAttribute("data-srcset")&&t.removeAttribute("data-srcset"),t.hasAttribute("data-src")&&t.removeAttribute("data-src"))}if(!window.Cloudlift.upload)for(const t in e.properties)if(e.properties.hasOwnProperty(t)){let r=e.properties[t];if("string"==typeof r&&-1!==r.indexOf("cloudlift.app")){let t=i.findElementContainsText("*",i.escapeRegex(r),d);if(t.length>0){let e=t[t.length-1],i=document.createElement("span");i.className="cl-prop",i.innerHTML=e.textContent.replace(r,'<a href="'+r+'" target="_blank" style="cursor:pointer;border:0;">'+l.get("product.options.file.link")+"</a>"),e.parentNode.replaceChild(i,e)}}}let n=d.querySelector("[data-live-item-edit]");if(!n&&ji.cartItemEdit){let t,r="afterend",o=[];for(let r in e.properties)if(e.properties.hasOwnProperty(r)){if("_"===r.charAt(0))continue;let n=i.findElementContainsRegex("*",new RegExp(`${r}.*${e.properties[r]}`,"s"),d);if(n.length>0)if(o.length){for(let e=n.length-1;e>=0;e--){const i=n[e];if(-1!==o.indexOf(i)){t=i;break}}if(t)break}else o.push(...n)}if(!t&&o.length&&(t=o[o.length-1]),t||(t=d.querySelector('a[href*="/cart/change"]'),r="beforebegin"),null!=t){a.debug("---\x3e adding editBtn: "+r,t),n=document.createElement("a"),n.style.padding="5px 10px",n.style.border="1px solid #d1d5db",n.style.borderRadius="3px",n.innerText=l.get("product.options.item.edit"),n.dataset.liveItemEdit="1";let e=document.createElement("div");e.style.padding="10px 0",e.appendChild(n),t.insertAdjacentElement(r,e)}}if(n){a.debug("---\x3e using editBtn element",n);let t=e.url+"&item="+e.key;"A"===n.tagName?n.href=t:n.addEventListener("click",(()=>window.location.href=t))}if(ji.cartItemClOptions)for(let t in e.properties)if(e.properties.hasOwnProperty(t)&&t.startsWith(Ri.OPTIONS)&&-1!==d.innerHTML.indexOf(t)){let r=i.findElementContainsRegex("*",new RegExp(`${t}.*${e.properties[t]}`,"s"),d);if(r.length>0){let i=r[r.length-1],o=!0;for(let t in e.properties)if(e.properties.hasOwnProperty(t)&&-1!==i.innerHTML.indexOf(t)){o=!1;break}if(o)i.parentNode.removeChild(i);else{let r=String(e.properties[t]),o=i.innerHTML.indexOf(t),n=i.innerHTML.indexOf(r)+r.length;i.innerHTML=i.innerHTML.replace(i.innerHTML.slice(o,n),"")}}}if(s){const t=Ni.moneyFormat,i=this.shopifyStore.trimMoneyFormatAmount(Ni.moneyFormat),o=t=>this._findPriceEl("*",t,i,d),n=(e,i,r,o)=>{let n=d.querySelector(r);(o||n)&&(i.classList.contains("cl-price-lt")?n||(n=i.parentNode.querySelector(".cl-price-d")):i.classList.add("cl-price-lt"),n||(n=document.createElement("span"),i.parentNode.insertBefore(n,i.nextSibling)),n.classList.add("cl-price-d"),n.innerHTML=Di(e,t))},s=(t,e)=>{if(t.classList.contains("cl-price-lt")){t.classList.remove("cl-price-lt");let i=d.querySelector(e);i?i.innerHTML="":(i=t.parentNode.querySelector(".cl-price-d"),i&&i.parentNode.removeChild(i))}};let l=d.querySelector("[data-live-item-final-price]");!l&&ji.cartItemPrice&&(l=o(e.final_price)),l&&(a.debug("---\x3e found item.final_price element",l),l.innerHTML=Di(e.final_price+r,t),null!=c?n(c/e.quantity,l,"[data-live-item-final-price-discount]",!1):s(l,"[data-live-item-final-price-discount]")),l=d.querySelector("[data-live-item-original-price]"),!l&&ji.cartItemPrice&&(l=o(e.original_price)),l&&(a.debug("---\x3e found item.original_price element",l),l.innerHTML=Di(e.original_price+r,t)),l=d.querySelector("[data-live-item-final-line-price]"),!l&&ji.cartItemPrice&&(l=o(e.final_line_price)),l&&(a.debug("---\x3e found item.final_line_price element",l),l.innerHTML=Di(e.final_line_price+r*e.quantity,t),null!=c?n(c,l,"[data-live-item-final-line-price-discount]",!0):s(l,"[data-live-item-final-line-price-discount]")),l=d.querySelector("[data-live-item-original-line-price]"),!l&&ji.cartItemPrice&&(l=o(e.original_line_price)),l&&(a.debug("---\x3e found item.original_line_price element",l),l.innerHTML=Di(e.original_line_price+r*e.quantity,t))}if(e.properties[Ri.ID])if(e.properties.hasOwnProperty(Ri.OPTIONS)){if(ji.cartItemPriceOptions){let r;if(r=this.config.priceDraft?eo.getItem(e.properties[Ri.ID]):this._findCartItemByProperty(t,Ri.ID,e.properties[Ri.ID],e.key),null!=r&&r.properties)for(let t in r.properties)if("_"!==t.charAt(0)&&r.properties.hasOwnProperty(t)&&e.properties.hasOwnProperty(t)){let o=i.findElementContainsRegex("*",new RegExp(`${i.escapeRegex(t)}.*${i.escapeRegex(e.properties[t])}`,"s"),d);if(o.length>0){let i=o[o.length-1],n=t.replace(/^[^a-zA-Z]+|[^\w]+/g,"");const s="p"+n.charAt(0).toUpperCase()+n.slice(1);if(!i.dataset[s]){a.debug("--\x3e found element to display options price for property: "+t,i);let o=e.properties[t];-1!==o.indexOf("&")&&-1!==i.innerHTML.indexOf("&amp;")&&(o=o.replace(/&/g,"&amp;")),i.innerHTML=i.innerHTML.replace(o,o+" | "+r.properties[t]),i.dataset[s]="1"}}}}}else ji.cartItemPriceRemove&&d.parentNode&&d.parentNode.removeChild(d)}else e.properties.hasOwnProperty(Ri.OPTIONS)&&a.debug("--\x3e no cart item node found for item: ",e)}}}return this._cartCount+=o,this._cartTotal+=n,!0}_processCartQuantityDiscount(t,e,i){let r,o=0,n=e.properties[Ri.QUANTITY_ID];for(let e=0;e<t.items.length;e++){const i=t.items[e];i.properties&&i.properties.hasOwnProperty(Ri.QUANTITY_ID)&&i.properties[Ri.QUANTITY_ID]===n&&(!r&&i.properties.hasOwnProperty(Ri.QUANTITY_DISCOUNT)&&(r=i.properties[Ri.QUANTITY_DISCOUNT]),o+=i.quantity)}if(r){let t,n=r.split(","),a=0;for(let e=0;e<n.length;e++){const i=n[e].split(":");if(2===i.length){const e=parseInt(i[0]);o>=e&&a<e&&(t=i[1],a=e)}}if(t){let r=e.original_line_price+i*e.quantity;if(-1!==t.indexOf("%")){return r-r*(parseFloat(t.replace("%",""))/100)}return t=parseFloat(t),Ni.currencyConvert&&(t=qi(t)),r-Math.min(r,100*parseFloat(t)*e.quantity)}}return null}_findCartItemByProperty(t,e,i,r){for(let o=0;o<t.items.length;o++){const n=t.items[o];if((!r||n.key!==r)&&(n.properties&&n.properties.hasOwnProperty(e)&&n.properties[e]===i))return n}return null}_validateCartItemOptionsPrice(t,e){let i=this._findCartItemByProperty(t,Ri.ID,e.properties[Ri.ID],e.key);if(!i)return a.warn("[live-options] missing cart item options_id : "+e.properties[Ri.ID]+" => removing cartItem",e),this.shopifyCart.removeItem(this.shopifyCart.getItemLine(t,e)).then((()=>window.location.reload())),!1;if(e.properties.hasOwnProperty(Ri.PRICE)){let r=parseInt(e.properties[Ri.PRICE]),o=r*e.quantity;if(o!==i.original_line_price){if(Ni.currencyConvert){if(e.properties.hasOwnProperty(Ri.CURRENCY)&&e.properties[Ri.CURRENCY]!==Ni.currency){let t=parseInt(e.properties[Ri.PRICE_BASE]);Ni.priceVariantValue=i.original_price/100,t=qi(t),o=t*e.quantity,e.properties[Ri.CURRENCY]=Ni.currency,this._convertOptionsPriceProperties(i.properties)}}else{let t={};t[Ri.ID]=i.properties[Ri.ID],i.properties=t}let n=Math.round(o/i.original_price),a=Math.round(i.original_price*n/e.quantity),s=Promise.resolve();return a!==r&&(e.properties[Ri.PRICE]=String(a),s=this.shopifyCart.updateItem(this.shopifyCart.getItemLine(t,e),{quantity:e.quantity,properties:e.properties})),s.then((()=>this.shopifyCart.updateItem(this.shopifyCart.getItemLine(t,i),{quantity:n,properties:i.properties}))).then((()=>{window.location.reload()})),!1}}return!0}_resolveCartItemEl(t,e){let r=[],o=['[data-live-item-key="'+e.key+'"]','[data-line-item-key="'+e.key+'"]','[data-cart-item-key="'+e.key+'"]','[data-key="'+e.key+'"]:not(a)',".cart_item_"+e.id];for(let t=0;t<o.length;t++){const e=o[t];if(r=document.querySelectorAll(e),r.length)return r}if(e.image&&ji.cartItem){let r;a.debug("--\x3e [cart-item] image fallback ",e);let o=i.pathBaseName(e.image,!1),n=['img[src*="'+o+'"]','img[data-src*="'+o+'"]','img[data-srcset*="'+o+'"]'];if(this.config.itemImgParentSelector){let t=this.config.itemImgParentSelector.split(","),e=[];for(let i=0;i<t.length;i++){const r=t[i];for(let t=0;t<n.length;t++){const i=n[t];e.push(r+" "+i)}}n=e}let s=document.querySelectorAll(n.join(","));if(s.length>0){for(let o=0;o<s.length;o++){const n=s[o];if(this.config.itemImgParentSelector){let t=i.findParent(n,this.config.itemImgParentSelector);if(t&&!t.dataset.liveItemKey)return t.dataset.liveItemKey=e.key,a.debug("resolved cart item node via parent selector ",this.config.itemImgParentSelector,t),[t]}let l=i.findParent(n,"form");if(!l){if(1===s.length)return r=s[0].parentNode,r.dataset.liveItemKey=e.key,[r];continue}let c=n;for(;c!==l;){if(-1!==c.innerHTML.indexOf(e.key)){let i=!0;if(t.items.length>1)for(let r=0;r<t.items.length;r++){const o=t.items[r];if(o!==e&&-1!==c.innerHTML.indexOf(o.key)){i=!1;break}}if(i)return c.dataset.liveItemKey=e.key,a.debug("auto resolved cart item node ",c),[c];break}c=c.parentElement}}let o=s[0];r=i.findParent(o,"tr")||i.findParent(o,"li")||i.findParent(o,"div")||o.parentNode,r.dataset.liveItemKey=e.key,a.debug("fallback cart item parent ",r)}return[r]}return r}_patchCartCount(t){let e=t.item_count,r=[],o=["[data-live-cart-count]","[data-cart-count]"];for(let t=0;t<o.length;t++){const e=o[t];let i=document.querySelectorAll(e);i.length&&r.push(...i)}for(let t=0;t<r.length;t++){const i=r[t];a.debug("--\x3e found cart count element to patch count: "+e+"  => "+this._cartCount,i),i.innerText=this._cartCount}if(ji.cartCount&&e!==this._cartCount){let t=i.findElementContainsRegex("*",new RegExp(`^.{0,3}${e}.{0,3}$`,"s"));if(this.shopifyStore.isTheme("Dawn")){let e=document.querySelector("#cart-notification-button");e&&t.push(e)}for(let i=0;i<t.length;i++){const r=t[i];a.debug("--\x3e found cart count element to replace path count: "+e+"  => "+this._cartCount,r),r.innerHTML=r.innerHTML.replace(e,this._cartCount)}}}_patchCartTotal(t){if(this.config.priceDraft||this._discountCheckout){let e=t.total_price,r=[],o=t.original_total_price!==this._cartTotal;this.config.priceDraft&&o&&(this._draftCheckout=!0),this._cartTotal-=t.total_discount;let n=Di(this._cartTotal,Ni.moneyFormatWithCurrency),s=["[data-live-cart-total]",".totals__subtotal-value"];for(let t=0;t<s.length;t++){const e=s[t];let i=document.querySelectorAll(e);i.length&&r.push(...i)}for(let t=0;t<r.length;t++){const i=r[t];a.debug("--\x3e found cart total element to patch total: "+e+" => "+this._cartTotal,i),i.innerHTML=n}if(ji.cartTotal&&o){let t=this.shopifyStore.trimMoneyFormatAmount(Ni.moneyFormat),r=this._findPriceEl('form[action*="/cart"]:not(form[action*="/cart/add"]) *, form[action*="/checkout"] *',e,t);r&&(i.findParent(r,"[data-live-item-key]")||(a.debug("---\x3e found cart.total_price element",r),r.innerHTML=n))}if(this._draftCheckout&&(this._checkoutBtns=this.shopifyStore.findExpressDynamicCheckoutCart(),this._checkoutBtns.length))for(let t=0;t<this._checkoutBtns.length;t++){this._checkoutBtns[t].style.display="none"}}}_checkDiscount(){if(this._discountEl=document.querySelector("[data-live-discount]"),!this._discountEl&&ji.cartDiscount){if(this.shopifyStore.isTheme("Dawn")){let t=document.querySelector(".cart__blocks, .drawer__footer");t&&(this._discountEl=document.createElement("div"),this._discountEl.dataset.liveDiscount="",t.insertBefore(this._discountEl,t.firstChild))}if(!this._discountEl){let t=this.shopifyStore.trimMoneyFormatAmount(Ni.moneyFormat),e=this._findPriceEl('form[action*="/cart"]:not(form[action*="/cart/add"]) *, form[action*="/checkout"] *',this._cartTotal,t);if(e){let t=e.parentNode;for(;t;){if("P"!==t.tagName){let e=getComputedStyle(t).display;if("block"===e||"flex"===e){this._discountEl=document.createElement("div"),this._discountEl.dataset.liveDiscount="1",t.insertBefore(this._discountEl,t.firstChild);break}}t=t.parentNode}}}}if(null!=this._discountEl){let t=this._getDiscount();if(this._discountCheckout?this._discountEl.style.display="none":"none"===this._discountEl.style.display&&(this._discountEl.style.display=""),t.type===Hi&&(t.valid=!0,delete this._discount),!this._discount||this._discount.code!==t.code){if(this._discount=t,this._discountInput={code:"",loading:!1,button:l.get("product.options.discount.button"),placeholder:l.get("product.options.discount.placeholder")},this._discount.type!==Vi){if(window.localStorage){let t=localStorage.getItem("cl_discount");if(t){let e=JSON.parse(t);e.code===this._discount.code&&(this._discount=e)}}this._discount.valid||(this._discountInput.code=this._discount.code,this._applyDiscount())}let e='form[action*="/cart"]:not(form[action*="/cart/add"]):not([id="cart-notification-form"]), form[action*="/checkout"]',r=i.findParent(this._discountEl,e);if(!r&&(r=document.querySelector(e),r)){let t=r.getAttribute("id");t&&(this._discountInput.cartFormLink=t)}}this._renderDiscount()}}_removeDiscount(t){t&&(t.preventDefault(),t.stopImmediatePropagation()),this._discount.type=Vi,this._discount.code="",this._discount.valid=!1,this.shopifyStore.removeDiscountCode(),this._renderDiscount()}_applyDiscount(t){if(t&&(t.preventDefault(),t.stopImmediatePropagation()),!this._discountInput.code)return;this._discount.type=Bi,this._discount.code=this._discountInput.code,this._discount.valid=!1,this._discountInput.loading=!0,this._discountInput.error="",this._discountInput.success="";let e=this._getCheckout(),i=new n(this.config.api+"/api/checkout/discount",{method:"POST",data:{checkout:e},responseType:"json",headers:{"Content-type":"application/json"},queryParams:{shop:this.config.shop}});return this._renderDiscount(),i.then((t=>{this._discountInput.loading=!1,t.data?(this._discount=t.data,this._discount.valid=!0,this._discountInput.code="",window.localStorage&&localStorage.setItem("cl_discount",JSON.stringify(this._discount)),this.shopifyStore.saveDiscountCode(this._discount.code),this._discountInput.success=l.get("product.options.discount.valid")):this._discountInput.error=l.get("product.options.discount.invalid"),this._renderDiscount(),a.debug("[live-options-api] checkout discount response",t.data)})).catch((t=>{this._discountInput.loading=!1,this._discountInput.error="Please try again",this._renderDiscount(),a.error("[live-options-api] checkout discount error",t)}))}_renderDiscount(){tt(lo(this._discount,this._discountInput,this._applyDiscount.bind(this),this._removeDiscount.bind(this),(t=>{this._discountInput.code=t.target.value,this._discountInput.error&&(this._discountInput.error="",this._renderDiscount())})),this._discountEl)}_findPriceEl(t,e,r,o){let n,s=Di(e,r);if(n=0===e||ji.cartPriceRegex?i.findElementContainsRegex(t,new RegExp(`[^0-9]${s}[^0-9]`,"s"),o):i.findElementContainsText(t,s,o),0===n.length&&(a.debug("no price elements found for price:",s,o),ji.amountNoDecimals&&(s=Di(e,"{{ amount_no_decimals }}"),a.debug("fallback {{ amount_no_decimals }} price: ",s,o),n=i.findElementContainsText("*",s,o))),n.length){let t=n[n.length-1];if(-1===t.className.indexOf("cl-price"))return t;a.warn("found price element with cl-price - ignoring update",s,o)}return null}_convertOptionsPriceProperties(t){for(let e in t)if("_"!==e.charAt(0)&&t.hasOwnProperty(e)&&t.hasOwnProperty("_"+e)){let i=parseInt(t["_"+e]);i=qi(i),t[e]=Di(100*i,Ni.moneyFormat).replace(/(<([^>]+)>)/gi,"")}}_compatible(){const t=t=>`[Live Product Options] found incompatible app: ${t} \n**Please reach out to our app support to check your theme**`,e=e=>this.shopifyStore.isThemeEditor()?alert(t(e)):console.error(t(e));"undefined"!=typeof cst_money_formate?e("Customify"):window.customilyShopify?e("Customly"):window.ymq_option&&e("YMQ Product Options")}constructor(t){this.config=t,this.products=[];let e={};if(l.locale&&String.prototype.startsWith&&window.location.pathname.toLowerCase().startsWith("/"+l.locale.toLowerCase())&&(e.api="/"+l.locale.toLowerCase()),window.Shopify&&window.Shopify.routes&&window.Shopify.routes.root&&"/"!==window.Shopify.routes.root){let t=window.Shopify.routes.root;e.api="/"===t[t.length-1]?t.substr(0,t.length-1):t}if(this.shopifyStore=u.getInstance({api:e.api}),this.shopifyCart=f.getInstance(e),this.conditionsEngine=new Br,this.currency=Ni,this.config.theme)for(let t in this.config.theme)this.config.theme.hasOwnProperty(t)&&(ji[t]=this.config.theme[t]);this.config.themeId&&window.Shopify&&window.Shopify.theme&&window.Shopify.theme.id&&this.config.themeId!==window.Shopify.theme.id.toString()&&(a.debug("--\x3e theme.id config does not match - reseting custom selectors ",this.config.themeId,window.Shopify.theme.id.toString()),delete this.config.previewImgMainSelector,delete this.config.previewImgThumbnailSelector,delete this.config.itemImgParentSelector),this.shopifyStore.isTheme("Dawn")&&(ji.themeGallery=void 0===this.config.theme.themeGallery||this.config.theme.themeGallery,ji.productPriceObserver=!0,this.config.itemImgParentSelector=".cart-notification, .cart-item"),window.theme&&window.theme.settings&&window.theme.settings.superScriptPrice&&(ji.amountNoDecimals=!0);for(let t in this.config.currencyFormats)if(this.config.currencyFormats.hasOwnProperty(t)){let e=this.config.currencyFormats[t];-1!==e.indexOf("&")&&(e=i.decodeHtml(e)),"moneyWithCurrencyFormat"===t&&(t="moneyFormatWithCurrency"),Ni[t]=e}if(void 0!==window.clPriceDraft&&(this.config.priceDraft=window.clPriceDraft),Ni.priceVariant=!this.config.priceDraft,Ni.priceVariantId=this.config.priceVariantId,Ni.priceVariantValue=this.config.priceVariantValue,Ni.priceProductHandle=this.config.priceProductHandle,Ni.currencyConvert=window.theme&&Array.isArray(window.theme.currencies)?window.theme.currencies.length>1:this.config.currencyConvert,window.Shopify&&window.Shopify.currency&&(Ni.currency=window.Shopify.currency.active,Ni.currencyConvert)){let t=parseFloat(window.Shopify.currency.rate);isNaN(t)||1===t||(Ni.currencyFactor=t)}if(Ni.currencyConvert||-1===Ni.moneyFormat.indexOf("<")||-1===Ni.moneyFormat.indexOf(">")||(ji.currencyFormat=!1),ji.currencyFormat&&window.theme&&window.theme.moneyFormat&&(Ni.moneyFormat=window.theme.moneyFormat,Ni.moneyFormatWithCurrency=window.theme.moneyFormatWithCurrency||window.theme.moneyFormat),t.extensions){let e=t.extensions.split(",");for(let t=0;t<e.length;t++){const i=e[t];Xi[i.toUpperCase()]=!0}}this.config.setup&&(/complete|interactive|loaded/.test(document.readyState)?this.setup():(a.debug("---\x3e document not ready ("+document.readyState+") => waiting for DOMContentLoaded"),document.addEventListener("DOMContentLoaded",(()=>this.setup()),!1)),this.shopifyStore.onThemeSectionEvent("load",(t=>{this.setup()})))}};const po=(t=!1)=>{if(!t&&"content"in document.createElement("template"))return;const e=document.implementation.createHTMLDocument("template"),i=e.body,r={enumerable:!0,configurable:!0},o=Document.prototype.createElement;Document.prototype.createElement=function(t,n){const a=o.call(this,t,n);return"TEMPLATE"===a.tagName&&(t=>{const o=e.createDocumentFragment();Object.defineProperties(t,{content:Object.assign(Object.assign({},r),{get:()=>o}),innerHTML:Object.assign(Object.assign({},r),{set:function(t){i.innerHTML=t,C(o,o.firstChild),x(o,i.firstChild)}})})})(a),a}};let ho=()=>{po();const t=window.Cloudlift.options.config;a.setDefaultLevel(a.levels.ERROR);let e=a.getLevel();a.setLevel(void 0!==t.log?t.log:e),a.debug("got config",t),window.addEventListener("cloudlift.options.ready",(t=>{a.debug("resources loaded")}));const r=-1===t.api.indexOf("local")?t.api.replace("api.","assets."):t.api;d.fonts=t.fonts,d.api=r+"/api/font",d.apiParams.shop=t.shop,l.translations=t.i18n||{},t.setup?window.clTranslate?l.translations=i.extend(l.translations,window.clTranslate):(l.api=r+"/api/assets/"+t.app+"/translate/{locale}?shop="+t.shop,l.event+="."+t.app,l.locale&&t.locale&&l.locale!=t.locale&&l.fetch(l.locale)):(window.Translate=l,window.FontLoader=d),window.Cloudlift.options.lib={ProductOptions:so,ProductPreview:Zr},l.ready.then((()=>{window.Cloudlift.options.App=new co(t)}))};"Promise"in window&&"assign"in Object&&String.prototype.startsWith&&Array.prototype.flat?ho():t(er)(window.Cloudlift.options.config.assets+"/static/lib/core-js/core-js.min.js",ho)}();